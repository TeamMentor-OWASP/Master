<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="cfb27b01-2baa-476e-8d80-207548c6facc" Author="" Category="Input and Data Validation" Priority="2" Rule_Type="Guideline" Status="" Technology="Java" title="Do Not Rely on Client-Side Validation" Topic="Security" phase="Design" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;Applies to&lt;/h1&gt;&lt;p&gt;Applications written using Servlets or JSP.&lt;/p&gt;&lt;h1&gt;What to Do&lt;/h1&gt;&lt;p&gt;Avoid placing the validation procedures only on the client side. All input should be validated server side.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Client-side validation is executed by the client and can be easily bypassed. Client-side validation is a major design problem when it appears in web applications. It places trust in the browser, an entity that should never be trusted.&lt;/p&gt;&lt;h1&gt;When&lt;/h1&gt;&lt;p&gt;If your application accepts input from the client, always validate for length, range and type on the server.&lt;/p&gt;&lt;h1&gt;How&lt;/h1&gt;&lt;p&gt;Client-side validation should only be used to improve user experience, never for security purposes. A client-side input validation check can improve application performance by catching malformed input on the client and, therefore, saving a roundtrip to the server. However, client side validation can be easily bypassed and should never be used for security purposes. Always use server-side validation to protect your application from malicious attacks.&lt;/p&gt;&lt;p&gt;Use the following steps when developing client side validation: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Never trust the browser.&lt;/strong&gt; Because the browser is running on the user's machine, it can be fully controlled by the user. Therefore, any client-side validation code can be controlled and bypassed by an attacker.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Use JavaScript only to enhance your pages.&lt;/strong&gt; JavaScript is useful for enhancing your application's presentation. However, it has no mechanism to protect the integrity of its code. Do not rely on JavaScript to enforce security decisions. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Place a server-side validator for all input. &lt;/strong&gt;Input validation should be executed on the server side. Use the following steps to properly set the validation routines: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Identify input.&lt;/strong&gt; Determine the data that is to be passed from the client to your application. Input can take the following forms on the client-side:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;URL-based parameters &lt;/li&gt;&lt;li&gt;Form-based parameters &lt;/li&gt;&lt;li&gt;Hidden fields &lt;/li&gt;&lt;li&gt;Cookies&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Understand the input.&lt;/strong&gt; Understand the use and constraints associated with each input. Be clear how each input is used. Define the format and type of each input. Build a server-side validator for each format and type of expected input.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Create a set of validators.&lt;/strong&gt; Build a validator for each type of input. Place the set of validators on the server-side of your application. If there are validators on the client-side, make sure the same validators are implemented on the server-side as well. Consult the &lt;a href="ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Validate Input from All Sources&lt;/a&gt; and &lt;a href="ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Validate Input for Length, Range, Format, and Type&lt;/a&gt; guidelines about creating the validators.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Once developed, it is important to place the validation routines at your application's trust boundary. Because your application's trust boundary extends only to your application's process space, the user's browser should not be considered&amp;nbsp;a part of your application's trust boundary.&lt;/p&gt;&lt;p&gt;Example of correctly set validation:&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;&amp;lt;%-- Filename: sample.jsp --%&amp;gt;&lt;br&gt;&amp;lt;%boolean validateJSP(String input)&lt;br&gt;{&lt;br&gt;      // Validation routine&lt;br&gt;}&lt;br&gt;String idx = request.getParameter("index");&lt;br&gt;if(idx != null &amp;amp;&amp;amp; validateJSP(idx))&lt;br&gt;{&lt;br&gt;      ...&lt;br&gt;}&lt;br&gt;else&lt;br&gt;{&lt;br&gt;      //Display a generic error message (e.g. "Invalid query.")&lt;br&gt;}&lt;br&gt;%&amp;gt;&lt;br&gt; ...&lt;br&gt;&amp;lt;form method="post" action="sample.jsp"&amp;gt;&lt;br&gt;  &amp;lt;input name="index" type="text" size="50"&amp;gt;&lt;br&gt;  &amp;lt;input name="submit" value="submit" type="submit"&amp;gt;&lt;br&gt;&amp;lt;/form&amp;gt;&lt;/pre&gt;&lt;/blockquote&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Problem Example&lt;/h1&gt;&lt;p&gt;The following code produces a data analysis based on a financial index. Unfortunately, the user's input is validated only on the client side via a JavaScript routine. Since there is no validation on the server, an attacker can bypass all validation and exploit cross-site scripting and SQL injection vulnerabilities.&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;&amp;lt;!-- Filename: idv01.html --&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;!-- The page uses client-side validation only --&amp;gt;&lt;br&gt;    &amp;lt;script language="JavaScript"&amp;gt;&lt;br&gt;&amp;lt;!--function validate()&lt;br&gt;{&lt;br&gt;   var idx = document.forms[0].elements[0].value;&lt;br&gt;   var regex = new RegExp("[a-zA-Z0-9]+");&lt;br&gt;   var match = regex.exec(idx);&lt;br&gt;   var ret = false;&lt;br&gt;    if(idx.length &amp;lt; 9 &amp;amp;&amp;amp; match != null)&lt;br&gt;    {&lt;br&gt;      ret = true;&lt;br&gt;    }&lt;br&gt;   else&lt;br&gt;   {&lt;br&gt;      alert("Invalid index!");&lt;br&gt;   }&lt;br&gt;    return ret;&lt;br&gt;}&lt;br&gt;// --&amp;gt;&lt;br&gt;    &amp;lt;/script&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Query for index&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;!-- The application relies on client side validation --&amp;gt;&lt;br&gt;    &amp;lt;form method="post" action="/myapp/aggregate" onsubmit="return validate()"&amp;gt;&lt;br&gt;      index:&amp;amp;nbsp;&amp;lt;input name="index" type="text" size="10"&amp;gt;&lt;br&gt;      &amp;lt;input name="submit" value="query" type="submit"&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;// Filename: /myapp/aggregate&lt;br&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter("index");&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  String retString;&lt;br&gt;                  retString = "The queried index \"";&lt;br&gt;                  retString += encodeHtml(searchTerm);&lt;br&gt;                  retString += "\" produced the following results:&amp;lt;br&amp;gt; ";&lt;br&gt;                  out.println(retString);&lt;br&gt;                   // The application does not provide a server-side validation&lt;br&gt;                  aggregateData(out, searchTerm);&lt;br&gt;            }&lt;br&gt;             catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println("We cannot handle your request at the moment."&lt;br&gt;                           +  "Please try again later.");&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;            out.close();&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;&lt;/blockquote&gt;&lt;h1&gt;Solution Example&lt;/h1&gt;&lt;p&gt;The following code produces a data analysis based on a financial index. Because the application uses server-side validation, it is impossible for an attacker to bypass the validation routines and exploit any cross-site scripting and/or SQL injection vulnerabilities.&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;&amp;lt;!-- Filename: idv01.html --&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;!-- The page uses server-side validation only --&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;Query for index&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;!-- The application uses no client-side validation --&amp;gt;&lt;br&gt;    &amp;lt;form method="post" action="/myapp/aggregate"&amp;gt;&lt;br&gt;      index:&amp;amp;nbsp;&amp;lt;input name="index" type="text" size="10"&amp;gt;&lt;br&gt;      &amp;lt;input name="submit" value="query" type="submit"&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;// Filename: /myapp/aggregate&lt;br&gt;import java.io.*;&lt;br&gt;import java.util.*;&lt;br&gt;import java.lang.*;&lt;br&gt;import javax.servlet.*;&lt;br&gt;import javax.servlet.http.*;&lt;br&gt;import java.util.regex.*;&lt;br&gt; public final class DataAggregator extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request, HttpServletResponse response)&lt;br&gt;            throws ServletException, IOException&lt;br&gt;      {&lt;br&gt;            PrintWriter out = response.getWriter();&lt;br&gt;            String searchTerm = request.getParameter("index");&lt;br&gt;             try&lt;br&gt;            {&lt;br&gt;                  // The application uses only server-side validation&lt;br&gt;                  if (validateSearchTerm(searchTerm))&lt;br&gt;                  {&lt;br&gt;                        String retString;&lt;br&gt;                        retString = "The queried index \"";&lt;br&gt;                        retString += encodeHtml(searchTerm);&lt;br&gt;                        retString += "\" produced the following results:&amp;lt;br&amp;gt; ";&lt;br&gt;                        out.println(retString);&lt;br&gt;                        aggregateData(out, searchTerm);&lt;br&gt;                  }&lt;br&gt;                  else&lt;br&gt;                  {&lt;br&gt;                        // Add the appropriate logging and exception handling&lt;br&gt;                        // mechanisms. Consult the Exception Handling and&lt;br&gt;                        // Logging sections&lt;br&gt;                        out.println("We cannot handle your request at the moment."&lt;br&gt;                                 +  "Please try again later.");&lt;br&gt;                  }&lt;br&gt;            }&lt;br&gt;            catch (Exception e)&lt;br&gt;            {&lt;br&gt;                  // Add the appropriate logging and exception handling&lt;br&gt;                  // mechanisms. Consult the Exception Handling and&lt;br&gt;                  // Logging sections&lt;br&gt;                  out.println("We cannot handle your request at the moment."&lt;br&gt;                           +  "Please try again later.");&lt;br&gt;            }&lt;br&gt;             out.flush();&lt;br&gt;             out.close();&lt;br&gt;      }&lt;br&gt;       boolean validateSearchTerm(String input)&lt;br&gt;      {&lt;br&gt;            String goodPattern = "(\\w|\\d)+";&lt;br&gt;            int goodLength = 8;&lt;br&gt;             if (input == null)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;             if(input.length() &amp;gt; goodLength)&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        Pattern p = Pattern.compile(goodPattern);&lt;br&gt;            Matcher m = p.matcher(input);&lt;br&gt;                        if(!m.matches())&lt;br&gt;            {&lt;br&gt;                  return false;&lt;br&gt;            }&lt;br&gt;                        return true;&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;&lt;/blockquote&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:71225A92-ECA2-481E-ADEE-EA9C222DEA43"&gt;Guideline: Validate Input from All Sources (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:044B9F0A-6A95-442C-BF24-3F890D0B10EF"&gt;Attack: Client-side Validation Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:D089D9CA-860C-4F98-BC7E-5AD7553DB6DD"&gt;Checklist Item: Client-Side Validation is Not Relied On (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;</content>
</guidanceItem>