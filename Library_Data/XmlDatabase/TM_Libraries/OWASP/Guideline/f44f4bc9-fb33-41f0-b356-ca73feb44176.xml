<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="f44f4bc9-fb33-41f0-b356-ca73feb44176" Author="" Category="Authentication" Priority="2" Rule_Type="Guideline" Status="" Technology="ASP.NET 3.5" title="Partition Application Between Public And Private Domains" Topic="Security" phase="Deployment" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Do&lt;/h1&gt;&lt;p&gt;Define a boundary between public and restricted content in both the URL namespace and the filesystem namespace.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Defining a boundary between public and restricted content simplifies the task of user authorization and is generally less prone to error. When the content is separated, server configuration can be used to automatically apply authorization rules without relying on the developer to explicitly add checks in the code.&lt;/p&gt;&lt;h1&gt;When&lt;/h1&gt;&lt;p&gt;Consider using this guideline when your application restricts access to specific resources. For instance, anonymous users are granted access to some, but not all of the application while authenticated users are granted access based on their role.&lt;/p&gt;&lt;h1&gt;How&lt;/h1&gt;&lt;p&gt;Defining the boundary requires: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Determine roles&lt;/strong&gt;: Define the various types of user and their rights. Build a security policy that documents the rights required to access each page of your application.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Determine pages that should require SSL&lt;/strong&gt;: This would include pages that transmit credentials, unprotected authentication cookies, or sensitive user information such as credit card or social security numbers. Such pages should be transmitted using SSL only.&lt;/p&gt;&lt;p&gt;It should be noted that the Forms Authentication cookie is unprotected in the sense that it is vulnerable to HTTP Replay Attacks. As such, any page in a Forms Auth ASP.Net application that requires an authenticated user should only be accessible via SSL.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Structure the URL namespace&lt;/strong&gt;: Structure the application URL namespace to first separate the pages that require SSL from those that do not. Then define separate directories according to the various roles defined for your application. For instance you might have the following directories under your application root:&lt;/p&gt;&lt;pre&gt;//secure/usr/secure/admin&lt;/pre&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Configure IIS to require SSL on the appropriate portions of your application&lt;/strong&gt;:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Right-click on 'My Computer' and select 'Manage &lt;/li&gt;&lt;li&gt;Under the 'Services and Applications' node, expand 'Internet Information Services' and locate your website &lt;/li&gt;&lt;li&gt;Right click on the restricted folder and choose 'Properties' &lt;/li&gt;&lt;li&gt;Click on 'Edit' under the 'Secure Communications' section to require SSL connections. (NOTE: If you have not installed configured a certificate for this server, see the related section for steps to setup SSL on your IIS website)&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Use absolute URLs to transition to or from the sensitive portion of the namespace&lt;/strong&gt;: Relative links use the same protocol (HTTP or HTTPS) as the current page. This can result in broken links that point to pages within your application that require SSL. It can also lead to unnecessary use of SSL, which does have an associated performance hit.&lt;/p&gt;&lt;p&gt;The fix for both of these issues is to use absolute URLs that explicitly specify the protocol instead of relative URLs. An example redirection using an absolute URL is shown below.&lt;/p&gt;&lt;pre&gt;private void btnLogon_Click( object sender, System.EventArgs e ){// Form an absolute path using the server name and v-dir namestring serverName = HttpUtility.UrlEncode(Request.ServerVariables["SERVER_NAME"]);string vdirName = Request.ApplicationPath;Response.Redirect("https://" + serverName + vdirName + "/Restricted/Login.aspx");}&lt;/pre&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Use URL Authorization Restrict Access&lt;/strong&gt;: Use an &lt;strong&gt;&amp;lt;authorization&amp;gt;&lt;/strong&gt; element to ensure that only authenticated users can access secure pages. Place this element beneath the closing &lt;strong&gt;&amp;lt;/system.web&amp;gt;&lt;/strong&gt; tag, as shown here.&lt;/p&gt;&lt;pre&gt;&amp;lt;!-- The secure folder is for authenticated and SSL access only. --&amp;gt;&amp;lt;location path="Secure" &amp;gt;  &amp;lt;system.web&amp;gt;    &amp;lt;authorization&amp;gt;      &amp;lt;deny users="?" /&amp;gt;    &amp;lt;/authorization&amp;gt;  &amp;lt;/system.web&amp;gt;&amp;lt;/location&amp;gt;&lt;/pre&gt;&lt;p&gt;Additionally, the following configuration ensures that unauthenticated users are allowed to access pages in the application's root directory. Place this configuration in the main &lt;strong&gt;&amp;lt;system.web&amp;gt;&lt;/strong&gt; element.&lt;/p&gt;&lt;pre&gt;&amp;lt;system.web&amp;gt;  &amp;lt;!-- The virtual directory root folder contains general pages.       Unauthenticated users can view them and they do not need        to be secured with SSL. --&amp;gt;  &amp;lt;authorization&amp;gt;    &amp;lt;allow users="*" /&amp;gt;  &amp;lt;/authorization&amp;gt;&amp;lt;/system.web&amp;gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; If you use this type of site structure, your application must not rely on the user's identity on the non-SSL pages. In the preceding configuration, no forms authentication ticket is sent for requests for non-SSL pages. As a result, the user is considered anonymous. This has implications for related features, such as personalization, that require the user name.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Problem Example&lt;/h1&gt;&lt;p&gt;MyApp is a financial tool that generates reports based on sensitive data. It allows the user to upload the financial data and download the report. Since the application is small, all of its content is located within the same directory. The access control is enforced by the web application through checking the required permissions before a given call is executed.&lt;/p&gt;&lt;p&gt;Since both data and code is within the same directory, it may be possible for an attacker to gain access to the raw financial data.&lt;/p&gt;&lt;h1&gt;Solution Example&lt;/h1&gt;&lt;p&gt;MyApp is a financial tool that generates reports based on some sensitive data. It allows the user to upload the financial data and download the report. The application has a dedicated /data/ directory for the financial data. Access to contents within the /data/ directory is handled by the server hosting MyApp, making it much more difficult for an unauthorized user to gain access.&lt;/p&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;For more information about setting up SSL on your application's web server, visit: &lt;a href="http://msdn2.microsoft.com/en-us/library/aa302411.aspx"&gt;How To: Set Up SSL on a Web Server&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:1780A63B-D445-4DA2-94AB-06D0C40CEAC2"&gt;Guideline: Separate Account Administration from the Main Application Interface&amp;nbsp;&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:8A2388A7-FC6F-47D1-B45E-C6CAC8511C78"&gt;Guideline: Perform Role-Based Security Checks &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:14FBF85D-0E97-4CD1-A0EE-D5AA791FA45C"&gt;Guideline: Define a Security Policy &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:4CFC9E41-67FB-445F-8D5C-1680EF283D45"&gt;Guideline: Partition Code Into Separate Assemblies &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:EB8D8FDB-1AEB-4923-A8F3-8FF7D90B6B5A"&gt;Guideline: Disable Directory Browsing &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:1D7F6072-1A5F-472E-9D27-F15E396EAB2E"&gt;Attack: Forceful Browsing Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:8D14E285-3827-4005-AE79-1D75B6B2802D"&gt;Checklist Item: Application is Partitioned into Public and Private Domains&lt;/a&gt; &lt;hr&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;</content>
</guidanceItem>