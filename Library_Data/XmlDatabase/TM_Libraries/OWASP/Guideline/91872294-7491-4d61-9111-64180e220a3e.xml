<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="91872294-7491-4d61-9111-64180e220a3e" Author="" Category="Deployment Considerations" Priority="2" Rule_Type="Guideline" Status="" Technology="Java" title="Protect Sensitive Data Inside Configuration Files" Topic="Security" phase="Implementation" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;Applies to&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;Applications written using Servlets or JSP.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;What to Do&lt;/h1&gt;&lt;p&gt;Protect all sensitive data that is stored within configuration files.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Configuration files are a likely target for any attacker. If an attacker does compromise the configuration files, any unprotected sensitive data inside them will also be compromised.&lt;/p&gt;&lt;h1&gt;When&lt;/h1&gt;&lt;p&gt;If your application uses configuration files that contain sensitive data such as connection strings, directory paths or credentials, then protect the files.&lt;/p&gt;&lt;h1&gt;How&lt;/h1&gt;&lt;p&gt;To protect sensitive data inside configuration files use the following steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Identify the sensitive data. &lt;/strong&gt;Locate all sensitive data that is stored inside configuration files. Examples of sensitive data include, but are not limited to, credentials, connection strings and directory paths.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Encrypt sensitive data inside the configuration files. &lt;/strong&gt;Encrypt the sensitive data inside the configuration file to ensure its confidentiality in case this file is compromised. Once the application accesses the configuration file, it should decrypt the sensitive data just before use. Example:&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;public Properties loadDatabaseCredentials()&lt;br&gt;      throws GeneralSecurityException, IOException{&lt;br&gt;      // Set the decryption mechanism&lt;br&gt;      byte[] rawKey = getEncryptionKey();&lt;br&gt;      SecretKeySpec skeySpec = new SecretKeySpec(rawKey, "AES");&lt;br&gt;      Cipher cipher = Cipher.getInstance("AES");&lt;br&gt;      cipher.init(Cipher.DECRYPT_MODE, skeySpec);&lt;br&gt; &lt;br&gt;      // Decrypt config file&lt;br&gt; &lt;br&gt;      File configFile = new File("../../config/testProp.config");&lt;br&gt;      byte[] tempBuff = new byte[(int)configFile.length()];&lt;br&gt;      FileInputStream fileStream = new FileInputStream(configFile);&lt;br&gt;      fileStream.read(tempBuff, 0, tempBuff.length);&lt;br&gt; &lt;br&gt;      InputStream propStream = new ByteArrayInputStream(cipher.doFinal(tempBuff));&lt;br&gt;      prop.load(propStream);&lt;br&gt;      propStream.close();&lt;br&gt;      fileStream.close();&lt;br&gt; &lt;br&gt;      return prop;}&lt;/pre&gt;&lt;/blockquote&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Protect configuration files.&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Choose a configuration directory&lt;/strong&gt;: Dedicate a directory for storing your application's configuration files. Make sure the directory is not web-accessible. This limits the scope of users&amp;nbsp;who can potentially compromise the contents inside the directory.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Set appropriate permissions&lt;/strong&gt;: Apply the appropriate filesystem permissions such that the configuration files can be only accessed by your application and its administrators.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Problem Example&lt;/h1&gt;&lt;p&gt;The following code retrieves database credentials from a configuration file. Unfortunately, the credentials are not encrypted; therefore, anybody with access to the configuration file can retrieve the credentials and access the database on behalf of the application.&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;public Properties loadDatabaseCredentials() throws IOException{&lt;br&gt;      Properties prop = new Properties();&lt;br&gt;      InputStream propStream = new FileInputStream("../../config/testProp.config");&lt;br&gt;      prop.load(propStream);&lt;br&gt;      propStream.close();&lt;br&gt; &lt;br&gt;      return prop;}&lt;/pre&gt;&lt;/blockquote&gt;&lt;h1&gt;Solution Example&lt;/h1&gt;&lt;p&gt;The following code retrieves database credentials from a configuration file. Because the credentials are encrypted, the application decrypts them in real time, protecting the credentials' confidentiality in case the local access to the configuration file is not properly secured.&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;public Properties loadDatabaseCredentials()&lt;br&gt;      throws GeneralSecurityException, IOException{&lt;br&gt;      // Set the decryption mechanism&lt;br&gt;      byte[] rawKey = getEncryptionKey();&lt;br&gt;      SecretKeySpec skeySpec = new SecretKeySpec(rawKey, "AES");&lt;br&gt;      Cipher cipher = Cipher.getInstance("AES");&lt;br&gt;      cipher.init(Cipher.DECRYPT_MODE, skeySpec);&lt;br&gt; &lt;br&gt;      // Decrypt config file&lt;br&gt; &lt;br&gt;      File configFile = new File("../../config/testProp.config");&lt;br&gt;      byte[] tempBuff = new byte[(int)configFile.length()];&lt;br&gt;      FileInputStream fileStream = new FileInputStream(configFile);&lt;br&gt;      fileStream.read(tempBuff, 0, tempBuff.length);&lt;br&gt; &lt;br&gt;      InputStream propStream = new ByteArrayInputStream(cipher.doFinal(tempBuff));&lt;br&gt;      prop.load(propStream);&lt;br&gt;      propStream.close();&lt;br&gt;      fileStream.close();&lt;br&gt; &lt;br&gt;      return prop;}&lt;/pre&gt;&lt;/blockquote&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;To learn more about the JCE API, see: &lt;a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jce/JCERefGuide.html"&gt;Java Cryptography Extension for the Java 2 SDK, v 1.4&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:235E588E-621B-4C5E-A50E-8EA447330AD0"&gt;Guideline: Use a Secure Key Storage Location (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:EA0D0F4E-A363-4777-9F0D-91E8C5042F9C"&gt;Guideline: Do Not Store Plaintext Sensitive Data (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:BEC58471-A0EF-40C5-8C9D-9BF5C4B91F1F"&gt;Guideline: Filter All User-Supplied Filename and Path Input (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:EAD019CA-025A-4DC6-A4DC-6DFDC9FBA131"&gt;Guideline: Disable Directory Browsing (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:809D9208-0247-40FB-B559-A0EA2069E0E0"&gt;Guideline: Protect the JAAS Policy and Configuration Files (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:8DC2828C-AD66-46AE-B1D0-1C4C942C86AA"&gt;Checklist Item: Sensitive Data Inside Configuration Files is Protected (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;</content>
</guidanceItem>