<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="c463b66b-1319-48c7-9f96-51f1254b4d93" Author="" Category="Authentication" Priority="2" Rule_Type="Guideline" Status="" Technology="ASP.NET 3.5" title="Use SSL When Transmitting Credentials" Topic="Security" phase="Implementation" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Do&lt;/h1&gt;&lt;p&gt;Use Secure Sockets Layer (SSL) to protect the authentication credentials passed between browser and server.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Using SSL prevents the credentials from being sniffed or tampered with as they are transmitted over the network. If SSL is not used, user credentials may be compromised by attacks such as a &lt;a href="ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Network Credential Sniffing Attack&lt;/a&gt; or a &lt;a href="ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Phishing Attack&lt;/a&gt;. Additionally, use the &lt;a href="ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;Protect Session Cookies&lt;/a&gt; guideline to minimize the risk of exposing your application's session cookies to an attacker.&lt;/p&gt;&lt;h1&gt;When&lt;/h1&gt;&lt;p&gt;If your application accepts form-based authentication credentials from users.&lt;/p&gt;&lt;h1&gt;How&lt;/h1&gt;&lt;p&gt;Using Secure Socket Layer (SSL) over HTTP requires the following steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Create a certificate request.&lt;/strong&gt; Using the IIS management console, generate an SSL certificate request. This request is then sent to a Certification Authority to be signed. Follow these steps to generate the certificate request.&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Start the &lt;strong&gt;IIS management console&lt;/strong&gt;. To do this, click on &lt;strong&gt;Control Panel&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Administrative Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Internet Information Services&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select &lt;strong&gt;Properties&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click on &lt;strong&gt;Server Certificate&lt;/strong&gt; under the &lt;strong&gt;Directory Security&lt;/strong&gt; tab. &lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Create a new certificate&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Prepare the request now, but send it later&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your application's FQDN&lt;/strong&gt; and the desired bit length for your SSL certificate's encryption key, and then click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your organization's details&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your application's FQDN&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Provide &lt;strong&gt;your organization's location details&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Specify the location where you would like the IIS management console to store your application's certificate request. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Finish&lt;/strong&gt; to complete the process.&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Present the request to a Certification Authority (CA).&lt;/strong&gt; If all conditions for obtaining an SSL certificate are met, the CA will produce a new SSL certificate based on the certificate request. Because the requirements for obtaining an SSL certificate depend on the Certification Authority, consult with the Certification Authority in regards to the administrative steps necessary for obtaining such certificate.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Install the certificate.&lt;/strong&gt; Follow these steps to properly install your application's SSL certificate.&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Start the &lt;strong&gt;IIS management console&lt;/strong&gt;. To do this, click on &lt;strong&gt;Control Panel&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Administrative Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Internet Information Services&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select &lt;strong&gt;Properties&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click on &lt;strong&gt;Server Certificate&lt;/strong&gt; under the &lt;strong&gt;Directory Security&lt;/strong&gt; tab. &lt;/li&gt;&lt;li&gt;Select &lt;strong&gt;Process the pending request and install the certificate&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Specify the location of your application's SSL certificate and click &lt;strong&gt;Next&lt;/strong&gt;. &lt;/li&gt;&lt;li&gt;Click &lt;strong&gt;Finish&lt;/strong&gt; to complete the process. &lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Ensure credentials are sent over SSL. &lt;/strong&gt;Place the authentication portion of your application on a dedicated subdomain. Configure the server to accept only HTTPS traffic for the authentication subdomain. Ensure that form posts containing credentials are sent over HTTPS. You can enforce your application's use SSL through several approaches: &lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Server configuration.&lt;/strong&gt; Using the IIS management console, configure IIS to use SSL for all HTTP requests. Follow these steps to enable this option:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Start the IIS management console. To do this, click on Control Panel -&amp;gt; Administrative Tools -&amp;gt; Internet Information Services. &lt;/li&gt;&lt;li&gt;Right click on your application's virtual host and select Properties. &lt;/li&gt;&lt;li&gt;Select the Directory Security tab. &lt;/li&gt;&lt;li&gt;Click Edit in the Secure Communications dialog. &lt;/li&gt;&lt;li&gt;Select Require Secure Channel (SSL) and click OK. &lt;/li&gt;&lt;li&gt;Click OK to apply the changes and close the property window. &lt;/li&gt;&lt;li&gt;Browse to http://&amp;lt;your application's FQDN&amp;gt;//. Verify that you receive the following error message: &lt;pre&gt;HTTP 403.4 - Forbidden: SSL required.&lt;/pre&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Programatically.&lt;/strong&gt; Use the following considerations to improve your application's use of SSL:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;absolute URLs&lt;/strong&gt;: Use absolute URL paths when making form requests. Example:&lt;/p&gt;&lt;pre&gt;&amp;lt;form method="POST" action="https://login.example.com/myapp/login.aspx"&amp;gt;&lt;/pre&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;requireSSL attribute&lt;/strong&gt;: In your application's &lt;strong&gt;web.config&lt;/strong&gt;, set the secure property by using &lt;strong&gt;requireSSL="true"&lt;/strong&gt; on the &lt;strong&gt;&amp;lt;forms&amp;gt;&lt;/strong&gt; element as follows:&lt;/p&gt;&lt;pre&gt;&amp;lt;authentication mode="Forms"&amp;gt;&lt;br&gt;   &amp;lt;forms loginUrl=&lt;a href="https://login.example.com/myapp/login.aspx"&gt;https://login.example.com/myapp/login.aspx&lt;/a&gt;&lt;br&gt;           requireSSL="true"&lt;br&gt;           ...&lt;br&gt;   /&amp;gt;&lt;br&gt;&amp;lt;/authentication&amp;gt;&lt;/pre&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Problem Example&lt;/h1&gt;&lt;p&gt;The following snippet is part of an application's web.config. The application uses form based authentication and has configured its &amp;lt;forms&amp;gt; element accordingly. Unfortunately, the &amp;lt;forms&amp;gt; element does not have the requireSSL attribute set to true. Therefore the application fails to enforce the use of SSL when performing form-based authentication.&lt;/p&gt;&lt;pre&gt;&amp;lt;!-- The forms element does not have a requireSSL attribute --&amp;gt;&lt;br&gt;&amp;lt;forms loginUrl="Secure/Login.aspx"&lt;br&gt;       protection="All"&lt;br&gt;       timeout="00:30:00" &lt;br&gt;       slidingExpiration="true"&lt;br&gt;       name="MyApp"&lt;br&gt;       path="/Secure"&lt;br&gt; /&amp;gt;&lt;/pre&gt;&lt;h1&gt;Solution Example&lt;/h1&gt;&lt;p&gt;The following snippet is part of an application's web.config. The application uses form based authentication and has configured its &amp;lt;forms&amp;gt; element accordingly. Because the &amp;lt;forms&amp;gt; element has the requireSSL attribute set to true, all form-based authentication will be performed over an HTTPS connection.&lt;/p&gt;&lt;pre&gt;&amp;lt;!-- The forms element has the requireSSL attribute set to true --&amp;gt;&lt;br&gt;&amp;lt;forms loginUrl="Secure/Login.aspx"&lt;br&gt;       protection="All"&lt;br&gt;       &lt;strong&gt;requireSSL="true"&lt;br&gt;&lt;/strong&gt;       timeout="00:30:00"&lt;br&gt;       slidingExpiration="true"&lt;br&gt;       name="MyApp"&lt;br&gt;       path="/Secure"&lt;br&gt; /&amp;gt;&lt;/pre&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;For more information on using SSL with IIS, visit: &lt;a href="http://support.microsoft.com/kb/299875"&gt;How to implement SSL in IIS&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:FCB0A4AC-A559-430D-9145-08340EC73FED"&gt;Guideline: Protect Sensitive Data Over the Network &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;Guideline: Protect Session Cookies &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:B47A6486-A73E-44B9-AD17-1F7F94199828"&gt;Attack: Network Credential Sniffing Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:4572037A-2166-4AD1-8E73-D623E468A7B9"&gt;Attack: Information Disclosure Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:B446B34C-8DEC-4F74-A392-C30D1719D90D"&gt;Attack: Trust Relationship Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:5CDA1EF2-79F3-4167-8E8F-E47E4B0A607A"&gt;Checklist Item: SSL is Used when Transmitting Credentials &lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;</content>
</guidanceItem>