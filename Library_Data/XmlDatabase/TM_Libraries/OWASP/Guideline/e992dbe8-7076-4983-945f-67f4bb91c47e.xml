<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="e992dbe8-7076-4983-945f-67f4bb91c47e" Author="" Category="Authorization" Priority="2" Rule_Type="Guideline" Status="" Technology="ASP.NET 3.5" title="Configure Appropriate ACLs on Web Site Files" Topic="Security" phase="Deployment" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Do&lt;/h1&gt;&lt;p&gt;Configure access control lists (ACLs) on your Web site files so that IIS and ASP.NET file authorization appropriately control access to these files.&amp;nbsp;&amp;nbsp; &lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Failure to apply proper&amp;nbsp;access control restrictions on files&amp;nbsp;may allow users&amp;nbsp;to read, edit,&amp;nbsp;or remove files they should not be able to.&amp;nbsp;ACLs are an important layer of defense against unauthorized file&amp;nbsp;access.&amp;nbsp;&lt;/p&gt;&lt;h1&gt;When&lt;/h1&gt;&lt;p&gt;All ASP.NET applications can benefit from appropriate file ACLs.&amp;nbsp;ACLs should be established&amp;nbsp;in the&amp;nbsp;design&amp;nbsp;phase, prior to&amp;nbsp;implementing the application.&amp;nbsp;The&amp;nbsp;ACLs&amp;nbsp;are applied at deploy time.&amp;nbsp;&lt;/p&gt;&lt;h1&gt;How&lt;/h1&gt;&lt;p&gt;You need to configure the right access control lists (ACLs) for the right identities on your Web site files so that IIS and also ASP.NET file authorization control access to these files appropriately. You need to grant access to the following identities: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Your Web application identity.&lt;/strong&gt; If you are using a custom service account to run your ASP.NET application, you can grant the appropriate permissions to the IIS metabase and to the file system by running Aspnet_regiis.exe with the-&lt;strong&gt;ga&lt;/strong&gt; switch. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Your application's users.&lt;/strong&gt; ASP.NET file authorization performs access checks for file types mapped by IIS to the ASP.NET ISAPI extension (Aspnet_isapi.dll). If you are using Windows authentication, the authenticated user's Windows access token (which may be IUSR_MACHINE for anonymous users) is checked against the ACL attached to the requested ASP.NET file. If you are using forms authentication, access is checked against IUSR_MACHINE.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Use the following steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Determine the users/roles that need to access the application's resources.&lt;/strong&gt; Create a list of all roles in the application.&amp;nbsp;The Web application's process&amp;nbsp;identity and the application's users are the entities that&amp;nbsp;require access to application resources. If&amp;nbsp;a custom service account is being utilised to run&amp;nbsp;the ASP.NET application be sure to list it as well, it will need the appropriate permissions to the IIS metabase and the file system.&amp;nbsp;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Evaluate the level of access each user/role should have to use the application resources.&lt;/strong&gt; It is important to assign the minimum privilege level for all entities that access resources.&amp;nbsp; To do this create a table that contains roles on one axis and resources on another.&amp;nbsp; Within the&amp;nbsp;matrix cells describe the level of access each role will need for each resource (eg. Read Only, Read/Write, Full Access, etc.).&amp;nbsp; This is commonly called a subject/object matrix:&lt;/p&gt;&lt;p&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;Objects&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Subjects&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;User Administration&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;Page Content&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Admin&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Create, Delete, Modify&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Content Creator&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;Create, Delete, Modify, Read&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Reader&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;Read&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Anonymous&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;Read&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Apply ACLs to enforce these restrictions.&lt;/strong&gt; To assign ASP.NET permissions to the&amp;nbsp;application's account, run the following command:&lt;/p&gt;&lt;pre&gt;aspnet_regiis -ga MachineName\AccountName &lt;/pre&gt;&lt;p&gt;Where MachineName is the name of your server or the domain name if you are using a domain account, and AccountName is the name of your custom account. When you run Aspnet_regiis.exe with the -ga switch, the command grants the following rights to the account:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;div&gt;Access to the IIS Metabase&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;Permission to write to the %Windir%\Microsoft.NET\Framework\version\Temporary ASP.NET Files folder&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The account is also a member of the local Users group; therefore, it has read access to the \Inetpub directory tree (these directories have an ACL that grants read access to the Users group).&amp;nbsp;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;div&gt;An Introduction to the IIS Metabase &lt;a href="http://support.microsoft.com/kb/240941/en-us"&gt;http://support.microsoft.com/kb/240941/en-us&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Rules&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;div&gt;&lt;a href="ruledisplay:bdff2308-96e1-4787-9162-a115d1366f76"&gt;Block Protected Files from being Retrieved&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;&lt;a href="ruledisplay:0def44d6-fea1-45a9-951c-79b54d549e5c"&gt;Restrict Access to Audit and Log Files&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;</content>
</guidanceItem>