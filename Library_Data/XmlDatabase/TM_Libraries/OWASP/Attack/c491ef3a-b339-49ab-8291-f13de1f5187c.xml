<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="c491ef3a-b339-49ab-8291-f13de1f5187c" Author="" Category="Application State" Priority="1" Rule_Type="Attack" Status="" Technology=" Any" title="Cross Site Request Forgery Attack" Topic="Security" phase="Any" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;br&gt;&lt;br&gt;&lt;h1&gt;Applies To&lt;/h1&gt;&lt;p&gt;All web applications.&lt;/p&gt;&lt;h1&gt;Description&lt;/h1&gt;&lt;p&gt;A Cross Site Request Forgery attack occurs when an attacker tricks a victim into loading a page that contains a malicious request. This request may be able to change the state of the web application and is possible because the request is sent in the context of the logged in victim. For many sites each request automatically sends the victim's credentials such as the session cookie or authentication credentials. Due to this fact there is no way to distinguish the false request from a legitimate request.&lt;/p&gt;&lt;p&gt;Cross Site Request Forgery attacks are known by other names including XSRF, Session Riding, One-Click and Zero-Click attacks. &lt;/p&gt;&lt;p&gt;A One-Click attack refers to a link that causes a malicious action to be performed when a victim clicks on it. A Zero-Click attack is automatically executed upon page load. A common way to perform a zero-click attack is to embed the request in the source of an image.&lt;/p&gt;&lt;h1&gt;Impact&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Elevation of privilege&lt;/strong&gt; - the attacker can execute commands on the web application on behalf of the victim&lt;/p&gt;&lt;h1&gt;Vulnerabilities&lt;/h1&gt;&lt;p&gt;Executing single requests that can change the state of the application, such as add users, change account balances or passwords, etc.&lt;/p&gt;&lt;h1&gt;Countermeasures&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;Add a session identifier or nonce value to each session and/or viewstate to track each request. &lt;/li&gt;&lt;li&gt;Use "double submit" cookies (for Ajax requests only). &lt;/li&gt;&lt;li&gt;Minimize single request GET commands. &lt;/li&gt;&lt;li&gt;Never allow a single request to change the state of the web application.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Example&lt;/h1&gt;&lt;p&gt;If the application allows a user to change the state of the application in a single request this attack is possible. In this example the web application allows a logged in administrator to create a new user sending a single GET request.&lt;/p&gt;&lt;p&gt;This GET request looks like this:&lt;/p&gt;&lt;pre&gt;GET http://teammentorexample.com/adduser.aspx?username=joe&amp;amp;password=1234&amp;amp;usertype=userHTTP/1.1&lt;/pre&gt;&lt;p&gt;The attacker discovers that this request will create a new user and creates his own request which he embeds in an e-mail with the following image tag:&lt;/p&gt;&lt;pre&gt;&amp;lt;img src="http://teammentorexample.com/adduser.aspx?username=HACKER&amp;amp;password=TEST&amp;amp;usertype=admin" /&amp;gt;&lt;/pre&gt;&lt;p&gt;When the victim's e-mail client attempts to download the image located at the above source the request is made without the knowledge of the victim. &lt;/p&gt;&lt;p&gt;The application should require a two step authorization mechanism for any change to server state. In this example the server should send the client a nonce value to verify the admin would indeed like to add this user. The admin would have to verify the action on a separate page and return the nonce value. Only after the server receives the action and verifies the nonce should the user be created. &lt;/p&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;p&gt;To learn more about CSRF attacks, see:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="http://www.owasp.org/index.php/Cross-Site_Request_Forgery"&gt;http://www.owasp.org/index.php/Cross-Site_Request_Forgery&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="http://www.cgisecurity.com/articles/csrf-faq.shtml"&gt;http://www.cgisecurity.com/articles/csrf-faq.shtml&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="http://www.owasp.org/index.php/Testing_for_CSRF"&gt;http://www.owasp.org/index.php/Testing_for_CSRF&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:9E3FC30A-B55C-4AF6-8B77-A534C6F87197"&gt;Attack: Phishing Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:BC10DCE2-CA48-44BF-8BF6-FEFBE8DCCB7E"&gt;Attack: Cross Site Scripting Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:5582C496-8E58-4EF8-86EA-D0E565197525"&gt;Attack: Reflection Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:5B0B4683-2F43-4F71-8DF4-121013673B4C"&gt;Attack: URL Redirection Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:3EB8979E-59F0-4C2B-8D8A-CFB173E5D66B"&gt;Attack: HTTP Session Hijacking Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:48BB4D3A-9295-4263-B3E7-090E483DEC5D"&gt;Attack: Man in the Middle Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:ECAF57F9-0C13-4FC2-B298-811A706BED8F"&gt;Guideline: Do Not Place Sensitive Data in Parameters &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:04A281E9-1078-48B4-ABBC-74CB259F8C92"&gt;Guideline: Use Page.ViewStateUserKey to Counter Cross Site Request Forgery Attacks &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:BB960347-F2E9-4926-8B75-ECCEE36D3EE8"&gt;Guideline: Protect Session Cookies &lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content>
</guidanceItem>