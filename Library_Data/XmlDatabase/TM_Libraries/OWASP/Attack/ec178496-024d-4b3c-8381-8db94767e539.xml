<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="ec178496-024d-4b3c-8381-8db94767e539" Author="" Category="Input and Data Validation" Priority="1" Rule_Type="Attack" Status="" Technology=" Any" title="Cross Site Scripting Attack" Topic="Security" phase="Any" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;br&gt;&lt;br&gt;&lt;h1&gt;Applies To&lt;/h1&gt;&lt;p&gt;All web applications.&lt;/p&gt;&lt;h1&gt;Description&lt;/h1&gt;&lt;p&gt;A Cross Site Scripting (XSS) attack can cause arbitrary code to run in a user's browser while the browser is connected to a trusted Web site. The attack targets your application's users and not the application itself, but it uses your application as the vehicle for the attack. Because the script code is downloaded by the browser from a trusted site, the browser has no way of knowing that the code is not legitimate. Internet Explorer security zones provide no defense. As the attacker's code has access to the cookies associated with the trusted site and are stored on the user's local computer, a user's authentication cookies are typically the target of attack. &lt;/p&gt;&lt;p&gt;There are two primary types of XSS, persistent and non-persistent. If the attacker is able to inject his malicious script to the web applications data store, then the script will be persistent and anyone who then loads a page with that content will run the script and become a victim of the attack. Forums and other web services that have user supplied HTML content are a classic example of this. If this content is not validated and encoded then anyone can leave a malicious script on the site. Non-Persistent XSS uses some reflective aspect of the page to deliver the payload. Web applications often echo user input back to them without altering it. Search engines are a good example of this type of behavior. Attackers can create and distribute URLs that contain a malicious script that gets reflected back to the user. The most common example of this is the "page not found" error page which echoes the requested page back to the user.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Confidentiality: The most common attack performed with cross-site scripting involves the disclosure of information stored in user cookies. &lt;/li&gt;&lt;li&gt;Access control: In some circumstances it may be possible to run arbitrary code on a victim's computer when cross-site scripting is combined with other flaws. &lt;/li&gt;&lt;li&gt;Elevation of privilege: Even if an attacker cannot get at the authentication information of a user, they can act as that user.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Impact&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;Credential compromise &lt;/li&gt;&lt;li&gt;Credential disclosure &lt;/li&gt;&lt;li&gt;Information disclosure &lt;/li&gt;&lt;li&gt;Execute code on client machine &lt;/li&gt;&lt;li&gt;Elevation of Privilege &lt;/li&gt;&lt;li&gt;Repudiation&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Vulnerabilities&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;Failure to validate user input for script tags when that input can be echoed back into a web page. &lt;/li&gt;&lt;li&gt;Trusting data retrieved from a shared database. &lt;/li&gt;&lt;li&gt;Failing to encode any remotely provided data, including reverse DNS lookup, cookie contents, uploaded files, etc. &lt;/li&gt;&lt;li&gt;Improperly converting "safe" tags to HTML. &lt;/li&gt;&lt;li&gt;Displaying user input directly without encoding it appropriately for the context in which it is used. &lt;/li&gt;&lt;li&gt;Checking user submitted data against a blacklist instead of a whitelist.&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Countermeasures&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;Perform context sensitive encoding of untrusted input before it is echoed back to a browser by using an encoding library (e.g., the Microsoft Anti-Cross Site Scripting Library or OWASP Reform). The following language-specific functionality may be helpful, is not sufficient to properly protect against cross-site scripting; a whitelisting library should be used instead. Most of these libraries only convert the symbols ", &amp;amp;, &amp;lt;, and &amp;gt; to safe HTML equivalents. &lt;ul&gt;&lt;li&gt;&lt;strong&gt;Python&lt;/strong&gt;: cgi.escape (only escapes 3 characters by default, escaping " is optional) &lt;/li&gt;&lt;li&gt;&lt;strong&gt;ASP&lt;/strong&gt;: HttpUtility.HtmlEncode and HttpUtility.UrlEncode (only encodes 4 characters) &lt;/li&gt;&lt;li&gt;&lt;strong&gt;Perl&lt;/strong&gt;: HTML::Entities::encode (only escapes 4 characters by default, but it makes it easy to specify other unsafe characters) &lt;/li&gt;&lt;li&gt;&lt;strong&gt;PHP&lt;/strong&gt;: htmlentities and urlencode (only escapes 4 characters by default, and can optionally encode ' (single quote))&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Untrusted input should be validated against an inclusion list before use. For example, use a regular expressions to define acceptable character sequences and use it as a filter. f the input is meant to be a primitive type it can be cast appropriately to assure that it is the expected type (a type constraint) and then checked to ensure it's in appropriate range (a range constraint). In the case where there are only a limited number of acceptable inputs, then the input can be constrained to that set with simple if or switch control structures, or by matching against a fixed list of strings (a domain constraint).&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;For more information on the Microsoft Anti-Cross Site Scripting Library, see the &lt;a href="http://www.microsoft.com/downloads/details.aspx?familyid=9A2B9C92-7AD9-496C-9A89-AF08DE2E5982&amp;amp;displaylang=en"&gt;Microsoft Downloads Site&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on the "Reform" encoding project, see &lt;a href="http://www.owasp.org/index.php/Category:OWASP_Encoding_Project"&gt;The OWASP Encoding Project site&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on Cross Site Scripting, see &lt;a href="http://www.owasp.org/index.php/Cross_site_scripting"&gt;Cross Site Scripting on the OWASP Site&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on attacks used in Cross Site Scripting, see &lt;a href="http://ha.ckers.org/xss.html"&gt;ha.ckers.org&lt;/a&gt; &lt;/li&gt;&lt;li&gt;For more information on mitigations, see &lt;a href="http://msdn2.microsoft.com/en-us/library/ms998274.aspx"&gt;How To: Prevent Cross-Site Scripting in ASP.NET&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:198CBDAF-3F87-4291-870D-8B6F077D8D36"&gt;Attack: AJAX Injection Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:685CA8C0-E102-4517-A539-4B826D1962EB"&gt;Attack: Double Encoding Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:B9DD25F1-3C5C-40DD-A82E-464D0C02C14D"&gt;Attack: Command Injection Attack&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:DD60FFDF-904D-45A8-8278-F3E8CEBA911F"&gt;Guideline: Do Not Rely on Request Validation &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:0FFC3880-7F2B-47A5-BC54-F9BD39117BDD"&gt;Guideline: Validate Input from All Sources &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:DA8CCFC9-F04F-4913-B05E-F574D3E4A559"&gt;Guideline: Validate Input for Length, Range, Format, and Type &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:1AB38C50-F31D-4CD8-89B1-CE397E6895E8"&gt;Guideline: Encode All Output Data &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:D6593992-DC9E-42C5-9E98-30E8EF075B93"&gt;Guideline: Do Not Rely on Client-Side Validation &lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="ruledisplay:F0E2BFFC-E6D1-4DC6-A6C2-D078F54AE10E"&gt;Guideline: Protect Session Cookies &lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content>
</guidanceItem>