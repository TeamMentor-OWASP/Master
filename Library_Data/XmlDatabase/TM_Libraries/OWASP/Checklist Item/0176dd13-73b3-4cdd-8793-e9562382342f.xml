<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="0176dd13-73b3-4cdd-8793-e9562382342f" Author="" Category="Authorization" Priority="2" Rule_Type="Checklist Item" Status="" Technology="ASP.NET 3.5" title="URL Authorization Is Used for Page And Directory Access Control" Topic="Security" phase="Implementation" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Check For&lt;/h1&gt;&lt;p&gt;Ensure URL Authorization is used&amp;nbsp;to control which users and groups of users have access to specific pages or the application itself.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Rather than having to password-protect pages, URL Authorization allows you to tie page access to user accounts or roles.&amp;nbsp;&amp;nbsp;&lt;/p&gt;&lt;h1&gt;How to Check&lt;/h1&gt;&lt;p&gt;Use the following steps to check if your application uses URL Authorization:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;div&gt;Check if your application has an&amp;nbsp;&amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element in its Web.config file.&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;Check to ensure that the users, roles and access rights listed in the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element match to your application's requirements.&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Below is an example of the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element configured to deny access to all but a few chosen users and roles:&lt;/p&gt;&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;allow users="DomainName\Bob, DomainName\Mary" /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;allow roles="BUILTIN\Administrators, DomainName\Manager" /&amp;gt;&lt;br&gt;&amp;nbsp; &amp;lt;deny users="*" /&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;&lt;br&gt;&lt;/pre&gt;&lt;h1&gt;How to Fix&lt;/h1&gt;&lt;p&gt;To configure URL authorization, use an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element in Web.config and specify which user and/or role names are allowed access to the current directory or the nominated directory or file. ASP.NET on Windows Server 2003 or later protects all files in a given directory, even those not mapped to ASP.NET, such as .html, .gif, and .jpg files. &lt;/p&gt;&lt;p&gt;Authorization settings in Web.config refer to all of the files in the current directory and all subdirectories unless a subdirectory contains its own Web.config with an &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element. In&amp;nbsp;such a&amp;nbsp;case, the settings in the subdirectory override the parent directory settings. &lt;/p&gt;&lt;p&gt;URL authorization can be used for both forms authentication and Windows authentication. In the case of Windows authentication, user names take the form "DomainName\WindowsUserName" and role names take the form "DomainName\WindowsGroupName". The local administrators group is referred to as "BUILTIN\Administrators". The local users group is referred to as "BUILTIN\Users". &lt;/p&gt;&lt;p&gt;The following example shows Windows users and Windows roles: &lt;/p&gt;&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow users="DomainName\Bob, DomainName\Mary" /&amp;gt;&lt;br&gt;  &amp;lt;allow roles="BUILTIN\Administrators, DomainName\Manager" /&amp;gt;&lt;br&gt;  &amp;lt;deny users="*" /&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;/pre&gt;&lt;p&gt;The following example uses a custom role: &lt;/p&gt;&lt;pre&gt;&amp;lt;authorization&amp;gt;&lt;br&gt;  &amp;lt;allow roles="Manager"/&amp;gt;&lt;br&gt;  &amp;lt;deny users="*"/&amp;gt;&lt;br&gt;&amp;lt;/authorization&amp;gt;  &lt;/pre&gt;&lt;p&gt;To apply authorization rules to a specific file or folder, enclose the &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; element inside a &amp;lt;&lt;strong&gt;location&lt;/strong&gt;&amp;gt; element as shown here: &lt;/p&gt;&lt;pre&gt;&amp;lt;location path="Secure" &amp;gt;&lt;br&gt;  &amp;lt;system.web&amp;gt;&lt;br&gt;    &amp;lt;authorization&amp;gt;&lt;br&gt;      &amp;lt;deny users="?" /&amp;gt;&lt;br&gt;    &amp;lt;/authorization&amp;gt;&lt;br&gt;  &amp;lt;/system.web&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;&lt;p&gt;This example denies access to unauthenticated users and forces a redirect to the login page that is specified on the &amp;lt;&lt;strong&gt;forms&lt;/strong&gt;&amp;gt; element. &lt;/p&gt;&lt;p&gt;The following example shows how you can apply authorization to a specific file (Page.aspx). &lt;/p&gt;&lt;pre&gt;&amp;lt;location path="page.aspx"&amp;gt;&lt;br&gt;    &amp;lt;authorization&amp;gt;&lt;br&gt;        ...&lt;br&gt;    &amp;lt;/authorization&amp;gt;&lt;br&gt;&amp;lt;/location&amp;gt;  &lt;/pre&gt;&lt;p&gt;If necessary, you can apply different authorization rules for separate pages based on the identity, or more commonly, the role membership of the caller, by using multiple &amp;lt;&lt;strong&gt;authorization&lt;/strong&gt;&amp;gt; elements within separate &amp;lt;&lt;strong&gt;location&lt;/strong&gt;&amp;gt; elements. &lt;/p&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;div&gt;&lt;a href="ruledisplay:3a62f823-e567-400f-96aa-b1e9374266bd"&gt;Guideline: Use URL Authorization for Pages and Directory Access Control&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;</content>
</guidanceItem>