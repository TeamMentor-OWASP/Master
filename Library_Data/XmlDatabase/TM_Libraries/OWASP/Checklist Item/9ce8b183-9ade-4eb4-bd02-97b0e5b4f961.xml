<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="9ce8b183-9ade-4eb4-bd02-97b0e5b4f961" Author="" Category="Input and Data Validation" Priority="2" Rule_Type="Checklist Item" Status="" Technology="ASP.NET 3.5" title="Output That Contains Untrusted Data Is Encoded with HtmlEncode Or UrlEncode" Topic="Security" phase="Implementation" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Check For&lt;/h1&gt;&lt;p&gt;Ensure&amp;nbsp;that any untrusted input used in the output stream is first encoded with &lt;strong&gt;HtmlEncode&lt;/strong&gt; or &lt;strong&gt;UrlEncode&lt;/strong&gt;.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Echoing input directly back to the user makes your application vulnerable to cross-site scripting attacks. &lt;/p&gt;&lt;h1&gt;How to Check&lt;/h1&gt;&lt;p&gt;Use the following steps to check for this problem:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Look for user supplied input inside HTML tag. &lt;/strong&gt;Check for the existence of user supplied input inside html tags your application generates. For instance &amp;lt;A href='somelink'&amp;gt;USERINPUT&amp;lt;/a&amp;gt;&amp;nbsp;&lt;br&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Look for user supplied input elsewhere in your application output. &lt;/strong&gt;Check for existing user supplied input in the following locations: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;In the HTML tags themselves. For instance, &amp;lt;A href='USERINPUT'&amp;gt; &lt;/li&gt;&lt;li&gt;In database tables that are later used as page content. For instance, you may find unencoded user input in a user profile stored in your database. &lt;/li&gt;&lt;li&gt;In files that are later used as page content. For instance, you may find unencoded user input in a local configuration file.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Verify all&amp;nbsp;user&amp;nbsp;input&amp;nbsp;input is encoded. &lt;/strong&gt;The untrusted data should be encoded using &lt;strong&gt;HtmlEncode&lt;/strong&gt; or &lt;strong&gt;UrlEncode&lt;/strong&gt;. Make sure that you encode data at the last possible opportunity before the data is returned to the client. If you encode any earlier, you may not know the exact context that the data will be used in and&amp;nbsp;the corresponding&amp;nbsp;format you need to encode into. Early encoding of some data can also&amp;nbsp;result in double encoding problems. &lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;How to Fix&lt;/h1&gt;&lt;p&gt;Encode untrusted data ensures that it is treated as literal text and not as script.&amp;nbsp; You can use the &lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.HtmlEncode&lt;/strong&gt; method to encode untrusted data.&amp;nbsp;&amp;nbsp;If you write URLs that might contain unsafe characters because they have been constructed from input data or data from a shared database, use &lt;strong&gt;Microsoft.Security.ApplicationAntiXSSLibrary.UrlEncode&lt;/strong&gt; to make them safe. &lt;/p&gt;&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; &amp;nbsp; &amp;nbsp; Make sure that you encode data at the last possible opportunity before the data is returned to the client.&amp;nbsp; If you encode any earlier than this, you may not know the exact context that the data will be used in, and hence the format you need to encode into.&amp;nbsp; Also, early encoding of some data can result in double encoding problems. &lt;/p&gt;&lt;h1&gt;Additional Resources&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;div&gt;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000003.asp"&gt;How To: Protect From Injection Attacks in ASP.NET&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000001.asp"&gt;How To: Use Regular Expressions to Constrain Input in ASP.NET&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;&lt;a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000004.asp"&gt;How To: Prevent Cross-Site Scripting in ASP.NET&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Related Items&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;div&gt;&lt;a href="ruledisplay:8a220644-4285-423d-9ebc-7f9069a038a5"&gt;Guideline: Validate Input from All Sources For Type, Length, Format, and Range&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;&lt;a href="ruledisplay:4dfedb8e-17d3-495d-843e-476c5e470f27"&gt;Guideline: Encode all Output Which Contains Untrusted Data by Context&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;li&gt;&lt;div&gt;&lt;a href="ruledisplay:417133af-0ab8-4ad5-9aea-a59b08abf022"&gt;Checklist Item: All the Input is Validated For Length, Range, Format, and Type&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;&lt;p&gt;Adapted from Microsoft patterns &amp;amp; practices guidance. &lt;/p&gt;</content>
</guidanceItem>